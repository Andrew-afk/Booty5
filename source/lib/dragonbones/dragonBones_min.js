"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,a){e.__proto__=a}||function(e,a){for(var t in a)a.hasOwnProperty(t)&&(e[t]=a[t])};return function(a,t){function r(){this.constructor=a}e(a,t),a.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),dragonBones;(function(e){var a=function(){function a(t){this._clock=new e.WorldClock,this._events=[],this._objects=[],this._eventManager=null,this._eventManager=t,console.info("DragonBones: "+a.VERSION+"\nWebsite: http://dragonbones.com/\nSource and Demo: https://github.com/DragonBones/")}return a.prototype.advanceTime=function(a){if(0<this._objects.length){for(var t=0,r=this._objects,n;t<r.length;t++)n=r[t],n.returnToPool();this._objects.length=0}if(this._clock.advanceTime(a),0<this._events.length){for(var o=0;o<this._events.length;++o){var l=this._events[o],s=l.armature;null!==s._armatureData&&(s.eventDispatcher.dispatchDBEvent(l.type,l),l.type===e.EventObject.SOUND_EVENT&&this._eventManager.dispatchDBEvent(l.type,l)),this.bufferObject(l)}this._events.length=0}},a.prototype.bufferEvent=function(e){0>this._events.indexOf(e)&&this._events.push(e)},a.prototype.bufferObject=function(e){0>this._objects.indexOf(e)&&this._objects.push(e)},Object.defineProperty(a.prototype,"clock",{get:function(){return this._clock},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"eventManager",{get:function(){return this._eventManager},enumerable:!0,configurable:!0}),a.VERSION="5.7.000",a.yDown=!0,a.debug=!1,a.debugDraw=!1,a}();e.DragonBones=a})(dragonBones||(dragonBones={})),console.warn||(console.warn=function(){}),console.assert||(console.assert=function(){}),Date.now||(Date.now=function(){return new Date().getTime()});var __extends=function(a,t){function e(){this.constructor=a}for(var r in t)t.hasOwnProperty(r)&&(a[r]=t[r]);e.prototype=t.prototype,a.prototype=new e};if("undefined"==typeof global&&"undefined"!=typeof window)var global=window;"object"==typeof exports&&"object"==typeof module?module.exports=dragonBones:"function"==typeof define&&define.amd?define(["dragonBones"],function(){return dragonBones}):"object"==typeof exports?exports=dragonBones:"undefined"!=typeof global&&(global.dragonBones=dragonBones);var dragonBones;(function(e){var a=function(){function e(){this.hashCode=e._hashCode++,this._isInPool=!1}return e._returnObject=function(a){var t=a.constructor+"",r=t in e._maxCountMap?e._maxCountMap[t]:e._defaultMaxCount,n=e._poolsMap[t]=e._poolsMap[t]||[];n.length<r&&(a._isInPool?console.warn("The object is already in the pool."):(a._isInPool=!0,n.push(a)))},e.toString=function(){throw new Error},e.setMaxCount=function(a,t){if((0>t||t!==t)&&(t=0),null!==a){var r=a+"",n=r in e._poolsMap?e._poolsMap[r]:null;null!==n&&n.length>t&&(n.length=t),e._maxCountMap[r]=t}else for(var r in e._defaultMaxCount=t,e._poolsMap){var n=e._poolsMap[r];n.length>t&&(n.length=t),r in e._maxCountMap&&(e._maxCountMap[r]=t)}},e.clearPool=function(a){if(void 0===a&&(a=null),null!==a){var t=a+"",r=t in e._poolsMap?e._poolsMap[t]:null;null!==r&&0<r.length&&(r.length=0)}else for(var n in e._poolsMap){var r=e._poolsMap[n];r.length=0}},e.borrowObject=function(a){var t=a+"",r=t in e._poolsMap?e._poolsMap[t]:null;if(null!==r&&0<r.length){var n=r.pop();return n._isInPool=!1,n}var i=new a;return i._onClear(),i},e.prototype.returnToPool=function(){this._onClear(),e._returnObject(this)},e._hashCode=0,e._defaultMaxCount=3e3,e._maxCountMap={},e._poolsMap={},e}();e.BaseObject=a})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var t=Math.ceil,r=Math.floor,a=function(){function e(e,t,r,n,i,o){void 0===e&&(e=1),void 0===t&&(t=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===i&&(i=0),void 0===o&&(o=0),this.a=e,this.b=t,this.c=r,this.d=n,this.tx=i,this.ty=o}return e.prototype.toString=function(){return"[object dragonBones.Matrix] a:"+this.a+" b:"+this.b+" c:"+this.c+" d:"+this.d+" tx:"+this.tx+" ty:"+this.ty},e.prototype.copyFrom=function(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this},e.prototype.copyFromArray=function(e,a){return void 0===a&&(a=0),this.a=e[a],this.b=e[a+1],this.c=e[a+2],this.d=e[a+3],this.tx=e[a+4],this.ty=e[a+5],this},e.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this},e.prototype.concat=function(e){var a=this.a*e.a,t=0,r=0,n=this.d*e.d,i=this.tx*e.a+e.tx,o=this.ty*e.d+e.ty;return(0!==this.b||0!==this.c)&&(a+=this.b*e.c,t+=this.b*e.d,r+=this.c*e.a,n+=this.c*e.b),(0!==e.b||0!==e.c)&&(t+=this.a*e.b,r+=this.d*e.c,i+=this.ty*e.c,o+=this.tx*e.b),this.a=a,this.b=t,this.c=r,this.d=n,this.tx=i,this.ty=o,this},e.prototype.invert=function(){var e=this.a,a=this.b,t=this.c,r=this.d,n=this.tx,i=this.ty;if(0===a&&0===t)return this.b=this.c=0,0===e||0===r?this.a=this.b=this.tx=this.ty=0:(e=this.a=1/e,r=this.d=1/r,this.tx=-e*n,this.ty=-r*i),this;var o=e*r-a*t;if(0==o)return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this;o=1/o;var l=this.a=r*o;return a=this.b=-a*o,t=this.c=-t*o,r=this.d=e*o,this.tx=-(l*n+t*i),this.ty=-(a*n+r*i),this},e.prototype.transformPoint=function(e,a,t,r){void 0===r&&(r=!1),t.x=this.a*e+this.c*a,t.y=this.b*e+this.d*a,r||(t.x+=this.tx,t.y+=this.ty)},e.prototype.transformRectangle=function(e,n){void 0===n&&(n=!1);var i=this.a,a=this.b,o=this.c,l=this.d,s=n?0:this.tx,_=n?0:this.ty,d=e.x,m=e.y,p=d+e.width,f=m+e.height,u=i*d+o*m+s,y=a*d+l*m+_,c=i*p+o*m+s,g=a*p+l*m+_,D=i*p+o*f+s,h=a*p+l*f+_,T=i*d+o*f+s,b=a*d+l*f+_,A=0;u>c&&(A=u,u=c,c=A),D>T&&(A=D,D=T,T=A),e.x=r(u<D?u:D),e.width=t((c>T?c:T)-e.x),y>g&&(A=y,y=g,g=A),h>b&&(A=h,h=b,b=A),e.y=r(y<h?y:h),e.height=t((g>b?g:b)-e.y)},e}();e.Matrix=a})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=Math.sin,t=Math.cos,r=Math.PI,n=function(){function e(e,a,t,r,n,i){void 0===e&&(e=0),void 0===a&&(a=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===i&&(i=1),this.x=e,this.y=a,this.skew=t,this.rotation=r,this.scaleX=n,this.scaleY=i}return e.normalizeRadian=function(e){return e=(e+r)%(2*r),e+=0<e?-r:r,e},e.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+180*this.skew/r+" skewY:"+180*this.rotation/r+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY},e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.skew=e.skew,this.rotation=e.rotation,this.scaleX=e.scaleX,this.scaleY=e.scaleY,this},e.prototype.identity=function(){return this.x=this.y=0,this.skew=this.rotation=0,this.scaleX=this.scaleY=1,this},e.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this.skew+=e.skew,this.rotation+=e.rotation,this.scaleX*=e.scaleX,this.scaleY*=e.scaleY,this},e.prototype.minus=function(e){return this.x-=e.x,this.y-=e.y,this.skew-=e.skew,this.rotation-=e.rotation,this.scaleX/=e.scaleX,this.scaleY/=e.scaleY,this},e.prototype.fromMatrix=function(n){var i=Math.atan,o=this.scaleX,l=this.scaleY,s=e.PI_Q;this.x=n.tx,this.y=n.ty,this.rotation=i(n.b/n.a);var _=i(-n.c/n.d);return this.scaleX=this.rotation>-s&&this.rotation<s?n.a/t(this.rotation):n.b/a(this.rotation),this.scaleY=_>-s&&_<s?n.d/t(_):-n.c/a(_),0<=o&&0>this.scaleX&&(this.scaleX=-this.scaleX,this.rotation-=r),0<=l&&0>this.scaleY&&(this.scaleY=-this.scaleY,_-=r),this.skew=_-this.rotation,this},e.prototype.toMatrix=function(e){return 0===this.rotation?(e.a=1,e.b=0):(e.a=t(this.rotation),e.b=a(this.rotation)),0===this.skew?(e.c=-e.b,e.d=e.a):(e.c=-a(this.skew+this.rotation),e.d=t(this.skew+this.rotation)),1!==this.scaleX&&(e.a*=this.scaleX,e.b*=this.scaleX),1!==this.scaleY&&(e.c*=this.scaleY,e.d*=this.scaleY),e.tx=this.x,e.ty=this.y,this},e.PI=r,e.PI_D=2*r,e.PI_H=r/2,e.PI_Q=r/4,e.RAD_DEG=180/r,e.DEG_RAD=r/180,e}();e.Transform=n})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(){function e(e,a,t,r,n,i,o,l){void 0===e&&(e=1),void 0===a&&(a=1),void 0===t&&(t=1),void 0===r&&(r=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===l&&(l=0),this.alphaMultiplier=e,this.redMultiplier=a,this.greenMultiplier=t,this.blueMultiplier=r,this.alphaOffset=n,this.redOffset=i,this.greenOffset=o,this.blueOffset=l}return e.prototype.copyFrom=function(e){this.alphaMultiplier=e.alphaMultiplier,this.redMultiplier=e.redMultiplier,this.greenMultiplier=e.greenMultiplier,this.blueMultiplier=e.blueMultiplier,this.alphaOffset=e.alphaOffset,this.redOffset=e.redOffset,this.greenOffset=e.greenOffset,this.blueOffset=e.blueOffset},e.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1,this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0},e}();e.ColorTransform=a})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(){function e(e,a){void 0===e&&(e=0),void 0===a&&(a=0),this.x=e,this.y=a}return e.prototype.copyFrom=function(e){this.x=e.x,this.y=e.y},e.prototype.clear=function(){this.x=this.y=0},e}();e.Point=a})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(){function e(e,a,t,r){void 0===e&&(e=0),void 0===a&&(a=0),void 0===t&&(t=0),void 0===r&&(r=0),this.x=e,this.y=a,this.width=t,this.height=r}return e.prototype.copyFrom=function(e){this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height},e.prototype.clear=function(){this.x=this.y=0,this.width=this.height=0},e}();e.Rectangle=a})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(e){function a(){var a=null!==e&&e.apply(this,arguments)||this;return a.ints=[],a.floats=[],a.strings=[],a}return __extends(a,e),a.toString=function(){return"[class dragonBones.UserData]"},a.prototype._onClear=function(){this.ints.length=0,this.floats.length=0,this.strings.length=0},a.prototype.addInt=function(e){this.ints.push(e)},a.prototype.addFloat=function(e){this.floats.push(e)},a.prototype.addString=function(e){this.strings.push(e)},a.prototype.getInt=function(e){return void 0===e&&(e=0),0<=e&&e<this.ints.length?this.ints[e]:0},a.prototype.getFloat=function(e){return void 0===e&&(e=0),0<=e&&e<this.floats.length?this.floats[e]:0},a.prototype.getString=function(e){return void 0===e&&(e=0),0<=e&&e<this.strings.length?this.strings[e]:""},a}(e.BaseObject);e.UserData=a;var t=function(e){function a(){var a=null!==e&&e.apply(this,arguments)||this;return a.data=null,a}return __extends(a,e),a.toString=function(){return"[class dragonBones.ActionData]"},a.prototype._onClear=function(){null!==this.data&&this.data.returnToPool(),this.type=0,this.name="",this.bone=null,this.slot=null,this.data=null},a}(e.BaseObject);e.ActionData=t})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(e){function a(){var a=null!==e&&e.apply(this,arguments)||this;return a.frameIndices=[],a.cachedFrames=[],a.armatureNames=[],a.armatures={},a.userData=null,a}return __extends(a,e),a.toString=function(){return"[class dragonBones.DragonBonesData]"},a.prototype._onClear=function(){for(var e in this.armatures)this.armatures[e].returnToPool(),delete this.armatures[e];null!==this.userData&&this.userData.returnToPool(),this.autoSearch=!1,this.frameRate=0,this.version="",this.name="",this.stage=null,this.frameIndices.length=0,this.cachedFrames.length=0,this.armatureNames.length=0,this.binary=null,this.intArray=null,this.floatArray=null,this.frameIntArray=null,this.frameFloatArray=null,this.frameArray=null,this.timelineArray=null,this.colorArray=null,this.userData=null},a.prototype.addArmature=function(e){return e.name in this.armatures?void console.warn("Same armature: "+e.name):void(e.parent=this,this.armatures[e.name]=e,this.armatureNames.push(e.name))},a.prototype.getArmature=function(e){return e in this.armatures?this.armatures[e]:null},a}(e.BaseObject);e.DragonBonesData=a})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(a){function t(){var t=null!==a&&a.apply(this,arguments)||this;return t.aabb=new e.Rectangle,t.animationNames=[],t.sortedBones=[],t.sortedSlots=[],t.defaultActions=[],t.actions=[],t.bones={},t.slots={},t.constraints={},t.skins={},t.animations={},t.canvas=null,t.userData=null,t}return __extends(t,a),t.toString=function(){return"[class dragonBones.ArmatureData]"},t.prototype._onClear=function(){for(var e=0,a=this.defaultActions,t;e<a.length;e++)t=a[e],t.returnToPool();for(var r=0,n=this.actions,t;r<n.length;r++)t=n[r],t.returnToPool();for(var i in this.bones)this.bones[i].returnToPool(),delete this.bones[i];for(var i in this.slots)this.slots[i].returnToPool(),delete this.slots[i];for(var i in this.constraints)this.constraints[i].returnToPool(),delete this.constraints[i];for(var i in this.skins)this.skins[i].returnToPool(),delete this.skins[i];for(var i in this.animations)this.animations[i].returnToPool(),delete this.animations[i];null!==this.canvas&&this.canvas.returnToPool(),null!==this.userData&&this.userData.returnToPool(),this.type=0,this.frameRate=0,this.cacheFrameRate=0,this.scale=1,this.name="",this.aabb.clear(),this.animationNames.length=0,this.sortedBones.length=0,this.sortedSlots.length=0,this.defaultActions.length=0,this.actions.length=0,this.defaultSkin=null,this.defaultAnimation=null,this.canvas=null,this.userData=null,this.parent=null},t.prototype.sortBones=function(){var e=this.sortedBones.length;if(!(0>=e)){var a=this.sortedBones.concat(),t=0,r=0;for(this.sortedBones.length=0;r<e;){var n=a[t++];if(t>=e&&(t=0),!(0<=this.sortedBones.indexOf(n))){var i=!1;for(var o in this.constraints){var l=this.constraints[o];if(l.root===n&&0>this.sortedBones.indexOf(l.target)){i=!0;break}}i||null!==n.parent&&0>this.sortedBones.indexOf(n.parent)||(this.sortedBones.push(n),r++)}}}},t.prototype.cacheFrames=function(e){if(!(0<this.cacheFrameRate))for(var a in this.cacheFrameRate=e,this.animations)this.animations[a].cacheFrames(this.cacheFrameRate)},t.prototype.setCacheFrame=function(e,a){var t=this.parent.cachedFrames,r=t.length;return t.length+=10,t[r]=e.a,t[r+1]=e.b,t[r+2]=e.c,t[r+3]=e.d,t[r+4]=e.tx,t[r+5]=e.ty,t[r+6]=a.rotation,t[r+7]=a.skew,t[r+8]=a.scaleX,t[r+9]=a.scaleY,r},t.prototype.getCacheFrame=function(e,a,t){var r=this.parent.cachedFrames;e.a=r[t],e.b=r[t+1],e.c=r[t+2],e.d=r[t+3],e.tx=r[t+4],e.ty=r[t+5],a.rotation=r[t+6],a.skew=r[t+7],a.scaleX=r[t+8],a.scaleY=r[t+9],a.x=e.tx,a.y=e.ty},t.prototype.addBone=function(e){return e.name in this.bones?void console.warn("Same bone: "+e.name):void(this.bones[e.name]=e,this.sortedBones.push(e))},t.prototype.addSlot=function(e){return e.name in this.slots?void console.warn("Same slot: "+e.name):void(this.slots[e.name]=e,this.sortedSlots.push(e))},t.prototype.addConstraint=function(e){return e.name in this.constraints?void console.warn("Same constraint: "+e.name):void(this.constraints[e.name]=e)},t.prototype.addSkin=function(e){return e.name in this.skins?void console.warn("Same skin: "+e.name):void(e.parent=this,this.skins[e.name]=e,null===this.defaultSkin&&(this.defaultSkin=e),"default"===e.name&&(this.defaultSkin=e))},t.prototype.addAnimation=function(e){return e.name in this.animations?void console.warn("Same animation: "+e.name):void(e.parent=this,this.animations[e.name]=e,this.animationNames.push(e.name),null===this.defaultAnimation&&(this.defaultAnimation=e))},t.prototype.addAction=function(e,a){a?this.defaultActions.push(e):this.actions.push(e)},t.prototype.getBone=function(e){return e in this.bones?this.bones[e]:null},t.prototype.getSlot=function(e){return e in this.slots?this.slots[e]:null},t.prototype.getConstraint=function(e){return e in this.constraints?this.constraints[e]:null},t.prototype.getSkin=function(e){return e in this.skins?this.skins[e]:null},t.prototype.getMesh=function(e,a,t){var r=this.getSkin(e);return null===r?null:r.getDisplay(a,t)},t.prototype.getAnimation=function(e){return e in this.animations?this.animations[e]:null},t}(e.BaseObject);e.ArmatureData=a;var t=function(a){function t(){var t=null!==a&&a.apply(this,arguments)||this;return t.transform=new e.Transform,t.userData=null,t}return __extends(t,a),t.toString=function(){return"[class dragonBones.BoneData]"},t.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.inheritReflection=!1,this.type=0,this.length=0,this.alpha=1,this.name="",this.transform.identity(),this.userData=null,this.parent=null},t}(e.BaseObject);e.BoneData=t;var r=function(a){function t(){var t=null!==a&&a.apply(this,arguments)||this;return t.geometry=new e.GeometryData,t}return __extends(t,a),t.toString=function(){return"[class dragonBones.SurfaceData]"},t.prototype._onClear=function(){a.prototype._onClear.call(this),this.type=1,this.segmentX=0,this.segmentY=0,this.geometry.clear()},t}(t);e.SurfaceData=r;var n=function(a){function t(){var e=null!==a&&a.apply(this,arguments)||this;return e.color=null,e.userData=null,e}return __extends(t,a),t.createColor=function(){return new e.ColorTransform},t.toString=function(){return"[class dragonBones.SlotData]"},t.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.blendMode=0,this.displayIndex=0,this.zOrder=0,this.zIndex=0,this.alpha=1,this.name="",this.color=null,this.userData=null,this.parent=null},t.DEFAULT_COLOR=new e.ColorTransform,t}(e.BaseObject);e.SlotData=n})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.prototype._onClear=function(){this.order=0,this.name="",this.type=0,this.target=null,this.root=null,this.bone=null},a}(e.BaseObject);e.ConstraintData=a;var t=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.IKConstraintData]"},a.prototype._onClear=function(){e.prototype._onClear.call(this),this.scaleEnabled=!1,this.bendPositive=!1,this.weight=1},a}(a);e.IKConstraintData=t;var r=function(e){function a(){var a=null!==e&&e.apply(this,arguments)||this;return a.bones=[],a}return __extends(a,e),a.toString=function(){return"[class dragonBones.PathConstraintData]"},a.prototype._onClear=function(){e.prototype._onClear.call(this),this.pathSlot=null,this.pathDisplayData=null,this.bones.length=0,this.positionMode=0,this.spacingMode=1,this.rotateMode=1,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=0,this.translateMix=0},a.prototype.AddBone=function(e){this.bones.push(e)},a}(a);e.PathConstraintData=r})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.CanvasData]"},a.prototype._onClear=function(){this.hasBackground=!1,this.color=0,this.x=0,this.y=0,this.width=0,this.height=0},a}(e.BaseObject);e.CanvasData=a})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(e){function a(){var a=null!==e&&e.apply(this,arguments)||this;return a.displays={},a}return __extends(a,e),a.toString=function(){return"[class dragonBones.SkinData]"},a.prototype._onClear=function(){for(var e in this.displays){for(var a=this.displays[e],t=0,r=a,n;t<r.length;t++)n=r[t],null!==n&&n.returnToPool();delete this.displays[e]}this.name="",this.parent=null},a.prototype.addDisplay=function(e,a){e in this.displays||(this.displays[e]=[]),null!==a&&(a.parent=this);var t=this.displays[e];t.push(a)},a.prototype.getDisplay=function(e,a){var t=this.getDisplays(e);if(null!==t)for(var r=0,n=t,i;r<n.length;r++)if(i=n[r],null!==i&&i.name===a)return i;return null},a.prototype.getDisplays=function(e){return e in this.displays?this.displays[e]:null},a}(e.BaseObject);e.SkinData=a})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(){function e(){this.weight=null}return e.prototype.clear=function(){this.isShared||null===this.weight||this.weight.returnToPool(),this.isShared=!1,this.inheritDeform=!1,this.offset=0,this.data=null,this.weight=null},e.prototype.shareFrom=function(e){this.isShared=!0,this.offset=e.offset,this.weight=e.weight},Object.defineProperty(e.prototype,"vertexCount",{get:function(){var e=this.data.intArray;return e[this.offset+0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"triangleCount",{get:function(){var e=this.data.intArray;return e[this.offset+1]},enumerable:!0,configurable:!0}),e}();e.GeometryData=a;var t=function(a){function t(){var t=null!==a&&a.apply(this,arguments)||this;return t.transform=new e.Transform,t}return __extends(t,a),t.prototype._onClear=function(){this.name="",this.path="",this.transform.identity(),this.parent=null},t}(e.BaseObject);e.DisplayData=t;var r=function(a){function t(){var t=null!==a&&a.apply(this,arguments)||this;return t.pivot=new e.Point,t}return __extends(t,a),t.toString=function(){return"[class dragonBones.ImageDisplayData]"},t.prototype._onClear=function(){a.prototype._onClear.call(this),this.type=0,this.pivot.clear(),this.texture=null},t}(t);e.ImageDisplayData=r;var n=function(e){function a(){var a=null!==e&&e.apply(this,arguments)||this;return a.actions=[],a}return __extends(a,e),a.toString=function(){return"[class dragonBones.ArmatureDisplayData]"},a.prototype._onClear=function(){e.prototype._onClear.call(this);for(var a=0,t=this.actions,r;a<t.length;a++)r=t[a],r.returnToPool();this.type=1,this.inheritAnimation=!1,this.actions.length=0,this.armature=null},a.prototype.addAction=function(e){this.actions.push(e)},a}(t);e.ArmatureDisplayData=n;var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.geometry=new a,t}return __extends(t,e),t.toString=function(){return"[class dragonBones.MeshDisplayData]"},t.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=2,this.geometry.clear(),this.texture=null},t}(t);e.MeshDisplayData=i;var o=function(e){function a(){var a=null!==e&&e.apply(this,arguments)||this;return a.boundingBox=null,a}return __extends(a,e),a.toString=function(){return"[class dragonBones.BoundingBoxDisplayData]"},a.prototype._onClear=function(){e.prototype._onClear.call(this),null!==this.boundingBox&&this.boundingBox.returnToPool(),this.type=3,this.boundingBox=null},a}(t);e.BoundingBoxDisplayData=o;var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.geometry=new a,t.curveLengths=[],t}return __extends(t,e),t.toString=function(){return"[class dragonBones.PathDisplayData]"},t.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=4,this.closed=!1,this.constantSpeed=!1,this.geometry.clear(),this.curveLengths.length=0},t}(t);e.PathDisplayData=l;var s=function(e){function a(){var a=null!==e&&e.apply(this,arguments)||this;return a.bones=[],a}return __extends(a,e),a.toString=function(){return"[class dragonBones.WeightData]"},a.prototype._onClear=function(){this.count=0,this.offset=0,this.bones.length=0},a.prototype.addBone=function(e){this.bones.push(e)},a}(e.BaseObject);e.WeightData=s})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var t=Math.atan2,r=Math.sqrt,n=Math.PI,a=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.prototype._onClear=function(){this.color=0,this.width=0,this.height=0},a}(e.BaseObject);e.BoundingBoxData=a;var i=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.RectangleBoundingBoxData]"},a._computeOutCode=function(e,a,t,r,n,i){var o=0;return e<t?o|=1:e>n&&(o|=2),a<r?o|=4:a>i&&(o|=8),o},a.rectangleIntersectsSegment=function(e,t,r,i,o,l,s,_,d,m,p){void 0===d&&(d=null),void 0===m&&(m=null),void 0===p&&(p=null);var f=e>o&&e<s&&t>l&&t<_,u=r>o&&r<s&&i>l&&i<_;if(f&&u)return-1;for(var c=0,g=a._computeOutCode(e,t,o,l,s,_),D=a._computeOutCode(r,i,o,l,s,_);;){if(0==(g|D)){c=2;break}else if(0!=(g&D))break;var h=0,T=0,b=0,A=0===g?D:g;0==(4&A)?0==(8&A)?0==(2&A)?0!=(1&A)&&(T=t+(i-t)*(o-e)/(r-e),h=o,null!==p&&(b=n)):(T=t+(i-t)*(s-e)/(r-e),h=s,null!==p&&(b=0)):(h=e+(r-e)*(_-t)/(i-t),T=_,null!==p&&(b=.5*n)):(h=e+(r-e)*(l-t)/(i-t),T=l,null!==p&&(b=.5*-n)),A===g?(e=h,t=T,g=a._computeOutCode(e,t,o,l,s,_),null!==p&&(p.x=b)):(r=h,i=T,D=a._computeOutCode(r,i,o,l,s,_),null!==p&&(p.y=b))}return c&&(f?(c=2,null!==d&&(d.x=r,d.y=i),null!==m&&(m.x=r,m.y=r),null!==p&&(p.x=p.y+n)):u?(c=1,null!==d&&(d.x=e,d.y=t),null!==m&&(m.x=e,m.y=t),null!==p&&(p.y=p.x+n)):(c=3,null!==d&&(d.x=e,d.y=t),null!==m&&(m.x=r,m.y=i))),c},a.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=0},a.prototype.containsPoint=function(e,a){var t=.5*this.width;if(e>=-t&&e<=t){var r=.5*this.height;if(a>=-r&&a<=r)return!0}return!1},a.prototype.intersectsSegment=function(e,t,r,n,i,o,l){void 0===i&&(i=null),void 0===o&&(o=null),void 0===l&&(l=null);var s=.5*this.width,_=.5*this.height,d=a.rectangleIntersectsSegment(e,t,r,n,-s,-_,s,_,i,o,l);return d},a}(a);e.RectangleBoundingBoxData=i;var o=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.EllipseData]"},a.ellipseIntersectsSegment=function(e,i,o,l,s,_,m,p,f,u,y){void 0===f&&(f=null),void 0===u&&(u=null),void 0===y&&(y=null);var c=m/p,d=c*c;i*=c,l*=c;var g=o-e,D=l-i,h=r(g*g+D*D),T=g/h,b=D/h,A=(s-e)*T+(_-i)*b,a=e*e+i*i,S=m*m,P=S-a+A*A,O=0;if(0<=P){var x=r(P),E=A-x,B=A+x,I=0>E?-1:E<=h?0:1,F=0>B?-1:B<=h?0:1,C=I*F;if(0>C)return-1;0==C&&(-1==I?(O=2,o=e+B*T,l=(i+B*b)/c,null!==f&&(f.x=o,f.y=l),null!==u&&(u.x=o,u.y=l),null!==y&&(y.x=t(l/S*d,o/S),y.y=y.x+n)):1==F?(O=1,e+=E*T,i=(i+E*b)/c,null!==f&&(f.x=e,f.y=i),null!==u&&(u.x=e,u.y=i),null!==y&&(y.x=t(i/S*d,e/S),y.y=y.x+n)):(O=3,null!==f&&(f.x=e+E*T,f.y=(i+E*b)/c,null!==y&&(y.x=t(f.y/S*d,f.x/S))),null!==u&&(u.x=e+B*T,u.y=(i+B*b)/c,null!==y&&(y.y=t(u.y/S*d,u.x/S)))))}return O},a.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=1},a.prototype.containsPoint=function(e,a){var t=.5*this.width;if(e>=-t&&e<=t){var n=.5*this.height;if(a>=-n&&a<=n)return a*=t/n,r(e*e+a*a)<=t}return!1},a.prototype.intersectsSegment=function(e,t,r,n,i,o,l){void 0===i&&(i=null),void 0===o&&(o=null),void 0===l&&(l=null);var s=a.ellipseIntersectsSegment(e,t,r,n,0,0,.5*this.width,.5*this.height,i,o,l);return s},a}(a);e.EllipseBoundingBoxData=o;var l=function(e){function a(){var a=null!==e&&e.apply(this,arguments)||this;return a.vertices=[],a}return __extends(a,e),a.toString=function(){return"[class dragonBones.PolygonBoundingBoxData]"},a.polygonIntersectsSegment=function(e,a,r,o,l,s,_,m){void 0===s&&(s=null),void 0===_&&(_=null),void 0===m&&(m=null),e===r&&(e=r+1e-6),a===o&&(a=o+1e-6);for(var p=l.length,f=e-r,u=a-o,c=e*o-a*r,g=0,D=l[p-2],h=l[p-1],T=0,b=0,A=0,S=0,P=0,O=0,E=0;E<p;E+=2){var B=l[E],I=l[E+1];D===B&&(D=B+1e-4),h===I&&(h=I+1e-4);var F=D-B,C=h-I,M=D*I-h*B,N=f*C-u*F,w=(c*F-f*M)/N;if((w>=D&&w<=B||w>=B&&w<=D)&&(0==f||w>=e&&w<=r||w>=r&&w<=e)){var x=(c*C-u*M)/N;if((x>=h&&x<=I||x>=I&&x<=h)&&(0==u||x>=a&&x<=o||x>=o&&x<=a))if(null!==_){var y=w-e;0>y&&(y=-y),0==g?(T=y,b=y,A=w,S=x,P=w,O=x,null!==m&&(m.x=t(I-h,B-D)-.5*n,m.y=m.x)):(y<T&&(T=y,A=w,S=x,null!==m&&(m.x=t(I-h,B-D)-.5*n)),y>b&&(b=y,P=w,O=x,null!==m&&(m.y=t(I-h,B-D)-.5*n))),g++}else{A=w,S=x,P=w,O=x,g++,null!==m&&(m.x=t(I-h,B-D)-.5*n,m.y=m.x);break}}D=B,h=I}return 1==g?(null!==s&&(s.x=A,s.y=S),null!==_&&(_.x=A,_.y=S),null!==m&&(m.y=m.x+n)):1<g&&(g++,null!==s&&(s.x=A,s.y=S),null!==_&&(_.x=P,_.y=O)),g},a.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=2,this.x=0,this.y=0,this.vertices.length=0},a.prototype.containsPoint=function(e,a){var t=!1;if(e>=this.x&&e<=this.width&&a>=this.y&&a<=this.height)for(var r=0,n=this.vertices.length,o=n-2;r<n;r+=2){var l=this.vertices[o+1],s=this.vertices[r+1];if(s<a&&l>=a||l<a&&s>=a){var _=this.vertices[o],d=this.vertices[r];(a-s)*(_-d)/(l-s)+d<e&&(t=!t)}o=r}return t},a.prototype.intersectsSegment=function(e,t,r,n,o,l,s){void 0===o&&(o=null),void 0===l&&(l=null),void 0===s&&(s=null);var _=0;return 0!==i.rectangleIntersectsSegment(e,t,r,n,this.x,this.y,this.x+this.width,this.y+this.height,null,null,null)&&(_=a.polygonIntersectsSegment(e,t,r,n,this.vertices,o,l,s)),_},a}(a);e.PolygonBoundingBoxData=l})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=Math.ceil,t=function(e){function t(){var a=null!==e&&e.apply(this,arguments)||this;return a.cachedFrames=[],a.boneTimelines={},a.slotTimelines={},a.constraintTimelines={},a.animationTimelines={},a.boneCachedFrameIndices={},a.slotCachedFrameIndices={},a.actionTimeline=null,a.zOrderTimeline=null,a}return __extends(t,e),t.toString=function(){return"[class dragonBones.AnimationData]"},t.prototype._onClear=function(){for(var e in this.boneTimelines){for(var a=0,t=this.boneTimelines[e],r;a<t.length;a++)r=t[a],r.returnToPool();delete this.boneTimelines[e]}for(var e in this.slotTimelines){for(var n=0,i=this.slotTimelines[e],r;n<i.length;n++)r=i[n],r.returnToPool();delete this.slotTimelines[e]}for(var e in this.constraintTimelines){for(var o=0,l=this.constraintTimelines[e],r;o<l.length;o++)r=l[o],r.returnToPool();delete this.constraintTimelines[e]}for(var e in this.animationTimelines){for(var s=0,_=this.animationTimelines[e],r;s<_.length;s++)r=_[s],r.returnToPool();delete this.animationTimelines[e]}for(var e in this.boneCachedFrameIndices)delete this.boneCachedFrameIndices[e];for(var e in this.slotCachedFrameIndices)delete this.slotCachedFrameIndices[e];null!==this.actionTimeline&&this.actionTimeline.returnToPool(),null!==this.zOrderTimeline&&this.zOrderTimeline.returnToPool(),this.frameIntOffset=0,this.frameFloatOffset=0,this.frameOffset=0,this.blendType=0,this.frameCount=0,this.playTimes=0,this.duration=0,this.scale=1,this.fadeInTime=0,this.cacheFrameRate=0,this.name="",this.cachedFrames.length=0,this.actionTimeline=null,this.zOrderTimeline=null,this.parent=null},t.prototype.cacheFrames=function(e){if(!(0<this.cacheFrameRate)){this.cacheFrameRate=Math.max(a(e*this.scale),1);var t=a(this.cacheFrameRate*this.duration)+1;this.cachedFrames.length=t;for(var r=0,n=this.cacheFrames.length;r<n;++r)this.cachedFrames[r]=!1;for(var o=0,s=this.parent.sortedBones;o<s.length;o++){for(var _=s[o],d=Array(t),r=0,n=d.length;r<n;++r)d[r]=-1;this.boneCachedFrameIndices[_.name]=d}for(var m=0,p=this.parent.sortedSlots;m<p.length;m++){for(var f=p[m],d=Array(t),r=0,n=d.length;r<n;++r)d[r]=-1;this.slotCachedFrameIndices[f.name]=d}}},t.prototype.addBoneTimeline=function(e,a){var t=e in this.boneTimelines?this.boneTimelines[e]:this.boneTimelines[e]=[];0>t.indexOf(a)&&t.push(a)},t.prototype.addSlotTimeline=function(e,a){var t=e in this.slotTimelines?this.slotTimelines[e]:this.slotTimelines[e]=[];0>t.indexOf(a)&&t.push(a)},t.prototype.addConstraintTimeline=function(e,a){var t=e in this.constraintTimelines?this.constraintTimelines[e]:this.constraintTimelines[e]=[];0>t.indexOf(a)&&t.push(a)},t.prototype.addAnimationTimeline=function(e,a){var t=e in this.animationTimelines?this.animationTimelines[e]:this.animationTimelines[e]=[];0>t.indexOf(a)&&t.push(a)},t.prototype.getBoneTimelines=function(e){return e in this.boneTimelines?this.boneTimelines[e]:null},t.prototype.getSlotTimelines=function(e){return e in this.slotTimelines?this.slotTimelines[e]:null},t.prototype.getConstraintTimelines=function(e){return e in this.constraintTimelines?this.constraintTimelines[e]:null},t.prototype.getAnimationTimelines=function(e){return e in this.animationTimelines?this.animationTimelines[e]:null},t.prototype.getBoneCachedFrameIndices=function(e){return e in this.boneCachedFrameIndices?this.boneCachedFrameIndices[e]:null},t.prototype.getSlotCachedFrameIndices=function(e){return e in this.slotCachedFrameIndices?this.slotCachedFrameIndices[e]:null},t}(e.BaseObject);e.AnimationData=t;var r=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.TimelineData]"},a.prototype._onClear=function(){this.type=10,this.offset=0,this.frameIndicesOffset=-1},a}(e.BaseObject);e.TimelineData=r;var n=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.AnimationTimelineData]"},a.prototype._onClear=function(){e.prototype._onClear.call(this),this.x=0,this.y=0},a}(r);e.AnimationTimelineData=n})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(e){function a(){var a=null!==e&&e.apply(this,arguments)||this;return a.boneMask=[],a}return __extends(a,e),a.toString=function(){return"[class dragonBones.AnimationConfig]"},a.prototype._onClear=function(){this.pauseFadeOut=!0,this.fadeOutMode=4,this.fadeOutTweenType=1,this.fadeOutTime=-1,this.actionEnabled=!0,this.additive=!1,this.displayControl=!0,this.pauseFadeIn=!0,this.resetToPose=!0,this.fadeInTweenType=1,this.playTimes=-1,this.layer=0,this.position=0,this.duration=-1,this.timeScale=-100,this.weight=1,this.fadeInTime=-1,this.autoFadeOutTime=-1,this.name="",this.animation="",this.group="",this.boneMask.length=0},a.prototype.clear=function(){this._onClear()},a.prototype.copyFrom=function(e){this.pauseFadeOut=e.pauseFadeOut,this.fadeOutMode=e.fadeOutMode,this.autoFadeOutTime=e.autoFadeOutTime,this.fadeOutTweenType=e.fadeOutTweenType,this.actionEnabled=e.actionEnabled,this.additive=e.additive,this.displayControl=e.displayControl,this.pauseFadeIn=e.pauseFadeIn,this.resetToPose=e.resetToPose,this.playTimes=e.playTimes,this.layer=e.layer,this.position=e.position,this.duration=e.duration,this.timeScale=e.timeScale,this.fadeInTime=e.fadeInTime,this.fadeOutTime=e.fadeOutTime,this.fadeInTweenType=e.fadeInTweenType,this.weight=e.weight,this.name=e.name,this.animation=e.animation,this.group=e.group,this.boneMask.length=e.boneMask.length;for(var a=0,t=this.boneMask.length;a<t;++a)this.boneMask[a]=e.boneMask[a]},a}(e.BaseObject);e.AnimationConfig=a})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(e){function a(){var a=null!==e&&e.apply(this,arguments)||this;return a.textures={},a}return __extends(a,e),a.prototype._onClear=function(){for(var e in this.textures)this.textures[e].returnToPool(),delete this.textures[e];this.autoSearch=!1,this.width=0,this.height=0,this.scale=1,this.name="",this.imagePath=""},a.prototype.copyFrom=function(e){for(var a in this.autoSearch=e.autoSearch,this.scale=e.scale,this.width=e.width,this.height=e.height,this.name=e.name,this.imagePath=e.imagePath,this.textures)this.textures[a].returnToPool(),delete this.textures[a];for(var a in e.textures){var t=this.createTexture();t.copyFrom(e.textures[a]),this.textures[a]=t}},a.prototype.addTexture=function(e){return e.name in this.textures?void console.warn("Same texture: "+e.name):void(e.parent=this,this.textures[e.name]=e)},a.prototype.getTexture=function(e){return e in this.textures?this.textures[e]:null},a}(e.BaseObject);e.TextureAtlasData=a;var t=function(a){function t(){var t=null!==a&&a.apply(this,arguments)||this;return t.region=new e.Rectangle,t.frame=null,t}return __extends(t,a),t.createRectangle=function(){return new e.Rectangle},t.prototype._onClear=function(){this.rotated=!1,this.name="",this.region.clear(),this.parent=null,this.frame=null},t.prototype.copyFrom=function(e){this.rotated=e.rotated,this.name=e.name,this.region.copyFrom(e.region),this.parent=e.parent,null===this.frame&&null!==e.frame?this.frame=t.createRectangle():null!==this.frame&&null===e.frame&&(this.frame=null),null!==this.frame&&null!==e.frame&&this.frame.copyFrom(e.frame)},t}(e.BaseObject);e.TextureData=t})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(a){function t(){var e=null!==a&&a.apply(this,arguments)||this;return e._bones=[],e._slots=[],e._constraints=[],e._actions=[],e._animation=null,e._proxy=null,e._replaceTextureAtlasData=null,e._clock=null,e}return __extends(t,a),t.toString=function(){return"[class dragonBones.Armature]"},t._onSortSlots=function(e,a){return 1e3*e._zIndex+e._zOrder>1e3*a._zIndex+a._zOrder?1:-1},t.prototype._onClear=function(){null!==this._clock&&this._clock.remove(this);for(var e=0,a=this._bones,t;e<a.length;e++)t=a[e],t.returnToPool();for(var r=0,n=this._slots,i;r<n.length;r++)i=n[r],i.returnToPool();for(var o=0,l=this._constraints,s;o<l.length;o++)s=l[o],s.returnToPool();for(var _=0,d=this._actions,m;_<d.length;_++)m=d[_],m.returnToPool();null!==this._animation&&this._animation.returnToPool(),null!==this._proxy&&this._proxy.dbClear(),null!==this._replaceTextureAtlasData&&this._replaceTextureAtlasData.returnToPool(),this.inheritAnimation=!0,this.userData=null,this._lockUpdate=!1,this._slotsDirty=!0,this._zOrderDirty=!1,this._zIndexDirty=!1,this._alphaDirty=!0,this._flipX=!1,this._flipY=!1,this._cacheFrameIndex=-1,this._alpha=1,this._globalAlpha=1,this._bones.length=0,this._slots.length=0,this._constraints.length=0,this._actions.length=0,this._armatureData=null,this._animation=null,this._proxy=null,this._display=null,this._replaceTextureAtlasData=null,this._replacedTexture=null,this._dragonBones=null,this._clock=null,this._parent=null},t.prototype._sortZOrder=function(e,a){var t=this._armatureData.sortedSlots,r=null===e;if(this._zOrderDirty||!r){for(var n=0,o=t.length,l;n<o;++n)if(l=r?n:e[a+n],!(0>l||l>=o)){var s=t[l],_=this.getSlot(s.name);null!==_&&_._setZOrder(n)}this._slotsDirty=!0,this._zOrderDirty=!r}},t.prototype._addBone=function(e){0>this._bones.indexOf(e)&&this._bones.push(e)},t.prototype._addSlot=function(e){0>this._slots.indexOf(e)&&this._slots.push(e)},t.prototype._addConstraint=function(e){0>this._constraints.indexOf(e)&&this._constraints.push(e)},t.prototype._bufferAction=function(e,a){0>this._actions.indexOf(e)&&(a?this._actions.push(e):this._actions.unshift(e))},t.prototype.dispose=function(){null!==this._armatureData&&(this._lockUpdate=!0,this._dragonBones.bufferObject(this))},t.prototype.init=function(a,t,r,n){null!==this._armatureData||(this._armatureData=a,this._animation=e.BaseObject.borrowObject(e.Animation),this._proxy=t,this._display=r,this._dragonBones=n,this._proxy.dbInit(this),this._animation.init(this),this._animation.animations=this._armatureData.animations)},t.prototype.advanceTime=function(e){if(!this._lockUpdate){if(this._lockUpdate=!0,null===this._armatureData)return void console.warn("The armature has been disposed.");if(null===this._armatureData.parent)return void console.warn("The armature data has been disposed.\nPlease make sure dispose armature before call factory.clear().");var a=this._cacheFrameIndex;if(this._animation.advanceTime(e),this._slotsDirty||this._zIndexDirty){if(this._slots.sort(t._onSortSlots),this._zIndexDirty)for(var r=0,n=this._slots.length;r<n;++r)this._slots[r]._setZOrder(r);this._slotsDirty=!1,this._zIndexDirty=!1}if(this._alphaDirty){this._alphaDirty=!1,this._globalAlpha=this._alpha*(null===this._parent?1:this._parent._globalAlpha);for(var o=0,s=this._bones,_;o<s.length;o++)_=s[o],_._updateAlpha();for(var d=0,m=this._slots,p;d<m.length;d++)p=m[d],p._updateAlpha()}if(0>this._cacheFrameIndex||this._cacheFrameIndex!==a){var r=0,n=0;for(r=0,n=this._bones.length;r<n;++r)this._bones[r].update(this._cacheFrameIndex);for(r=0,n=this._slots.length;r<n;++r)this._slots[r].update(this._cacheFrameIndex)}if(0<this._actions.length){for(var f=0,u=this._actions;f<u.length;f++){var y=u[f],c=y.actionData;if(null!==c&&0===c.type)if(null!==y.slot){var g=y.slot.childArmature;null!==g&&g.animation.fadeIn(c.name)}else if(null!==y.bone){for(var D=0,h=this.getSlots(),p;D<h.length;D++)if(p=h[D],p.parent===y.bone){var g=p.childArmature;null!==g&&g.animation.fadeIn(c.name)}}else this._animation.fadeIn(c.name);y.returnToPool()}this._actions.length=0}this._lockUpdate=!1,this._proxy.dbUpdate()}},t.prototype.invalidUpdate=function(e,a){if(void 0===e&&(e=null),void 0===a&&(a=!1),null!==e&&0<e.length){var t=this.getBone(e);if(null!==t&&(t.invalidUpdate(),a))for(var r=0,n=this._slots,i;r<n.length;r++)i=n[r],i.parent===t&&i.invalidUpdate()}else{for(var o=0,l=this._bones,t;o<l.length;o++)t=l[o],t.invalidUpdate();if(a)for(var s=0,_=this._slots,i;s<_.length;s++)i=_[s],i.invalidUpdate()}},t.prototype.containsPoint=function(e,a){for(var t=0,r=this._slots,n;t<r.length;t++)if(n=r[t],n.containsPoint(e,a))return n;return null},t.prototype.intersectsSegment=function(e,a,t,r,n,i,o){void 0===n&&(n=null),void 0===i&&(i=null),void 0===o&&(o=null);for(var l=0,s=0,_=0,m=0,p=0,f=0,u=0,y=0,c=null,g=null,D=0,h=this._slots;D<h.length;D++){var T=h[D],b=T.intersectsSegment(e,a,t,r,n,i,o);if(0<b)if(null!==n||null!==i){if(null!==n){var A=e===t?n.y-a:n.x-e;0>A&&(A=-A),(null===c||A<l)&&(l=A,_=n.x,m=n.y,c=T,o&&(u=o.x))}if(null!==i){var A=i.x-e;0>A&&(A=-A),(null===g||A>s)&&(s=A,p=i.x,f=i.y,g=T,null!==o&&(y=o.y))}}else{c=T;break}}return null!==c&&null!==n&&(n.x=_,n.y=m,null!==o&&(o.x=u)),null!==g&&null!==i&&(i.x=p,i.y=f,null!==o&&(o.y=y)),c},t.prototype.getBone=function(e){for(var a=0,t=this._bones,r;a<t.length;a++)if(r=t[a],r.name===e)return r;return null},t.prototype.getBoneByDisplay=function(e){var a=this.getSlotByDisplay(e);return null===a?null:a.parent},t.prototype.getSlot=function(e){for(var a=0,t=this._slots,r;a<t.length;a++)if(r=t[a],r.name===e)return r;return null},t.prototype.getSlotByDisplay=function(e){if(null!==e)for(var a=0,t=this._slots,r;a<t.length;a++)if(r=t[a],r.display===e)return r;return null},t.prototype.getBones=function(){return this._bones},t.prototype.getSlots=function(){return this._slots},Object.defineProperty(t.prototype,"flipX",{get:function(){return this._flipX},set:function(e){this._flipX===e||(this._flipX=e,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"flipY",{get:function(){return this._flipY},set:function(e){this._flipY===e||(this._flipY=e,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cacheFrameRate",{get:function(){return this._armatureData.cacheFrameRate},set:function(e){if(this._armatureData.cacheFrameRate!==e){this._armatureData.cacheFrames(e);for(var a=0,t=this._slots;a<t.length;a++){var r=t[a],n=r.childArmature;null!==n&&(n.cacheFrameRate=e)}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._armatureData.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"armatureData",{get:function(){return this._armatureData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"proxy",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventDispatcher",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"replacedTexture",{get:function(){return this._replacedTexture},set:function(e){if(this._replacedTexture!==e){null!==this._replaceTextureAtlasData&&(this._replaceTextureAtlasData.returnToPool(),this._replaceTextureAtlasData=null),this._replacedTexture=e;for(var a=0,t=this._slots,r;a<t.length;a++)r=t[a],r.invalidUpdate(),r.update(-1)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clock",{get:function(){return this._clock},set:function(e){if(this._clock!==e){null!==this._clock&&this._clock.remove(this),this._clock=e,this._clock&&this._clock.add(this);for(var a=0,t=this._slots;a<t.length;a++){var r=t[a],n=r.childArmature;null!==n&&(n.clock=this._clock)}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),t.prototype.getDisplay=function(){return this._display},t}(e.BaseObject);e.Armature=a})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(a){function t(){var t=null!==a&&a.apply(this,arguments)||this;return t.globalTransformMatrix=new e.Matrix,t.global=new e.Transform,t.offset=new e.Transform,t}return __extends(t,a),t.prototype._onClear=function(){this.globalTransformMatrix.identity(),this.global.identity(),this.offset.identity(),this.origin=null,this.userData=null,this._globalDirty=!1,this._alpha=1,this._globalAlpha=1,this._armature=null},t.prototype.updateGlobalTransform=function(){this._globalDirty&&(this._globalDirty=!1,this.global.fromMatrix(this.globalTransformMatrix))},Object.defineProperty(t.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),t._helpMatrix=new e.Matrix,t._helpTransform=new e.Transform,t._helpPoint=new e.Point,t}(e.BaseObject);e.TransformObject=a})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=Math.PI,t=function(t){function r(){var a=null!==t&&t.apply(this,arguments)||this;return a.animationPose=new e.Transform,a}return __extends(r,t),r.toString=function(){return"[class dragonBones.Bone]"},r.prototype._onClear=function(){t.prototype._onClear.call(this),this.offsetMode=1,this.animationPose.identity(),this._transformDirty=!1,this._childrenTransformDirty=!1,this._localDirty=!0,this._hasConstraint=!1,this._visible=!0,this._cachedFrameIndex=-1,this._boneData=null,this._parent=null,this._cachedFrameIndices=null},r.prototype._updateGlobalTransformMatrix=function(t){var r=this._boneData,n=this.global,i=this.globalTransformMatrix,o=this.origin,l=this.offset,s=this.animationPose,_=this._parent,d=this._armature.flipX,m=this._armature.flipY===e.DragonBones.yDown,p=null!==_,f=0;if(1===this.offsetMode?null===o?n.copyFrom(l).add(s):(n.x=o.x+l.x+s.x,n.y=o.y+l.y+s.y,n.skew=o.skew+l.skew+s.skew,n.rotation=o.rotation+l.rotation+s.rotation,n.scaleX=o.scaleX*l.scaleX*s.scaleX,n.scaleY=o.scaleY*l.scaleY*s.scaleY):0===this.offsetMode?null===o?n.copyFrom(s):n.copyFrom(o).add(s):(p=!1,n.copyFrom(l)),p){var u=1===_._boneData.type,c=u?_._bone:null,g=u?_._getGlobalTransformMatrix(n.x,n.y):_.globalTransformMatrix;if(r.inheritScale&&(!u||null!==c))u?(r.inheritRotation&&(n.rotation+=_.global.rotation),c.updateGlobalTransform(),n.scaleX*=c.global.scaleX,n.scaleY*=c.global.scaleY,g.transformPoint(n.x,n.y,n),n.toMatrix(i),r.inheritTranslation?(n.x=i.tx,n.y=i.ty):(i.tx=n.x,i.ty=n.y)):(!r.inheritRotation&&(_.updateGlobalTransform(),f=d&&m?n.rotation-(_.global.rotation+a):d?n.rotation+_.global.rotation+a:m?n.rotation+_.global.rotation:n.rotation-_.global.rotation,n.rotation=f),n.toMatrix(i),i.concat(g),r.inheritTranslation?(n.x=i.tx,n.y=i.ty):(i.tx=n.x,i.ty=n.y),t?n.fromMatrix(i):this._globalDirty=!0);else{if(r.inheritTranslation){var D=n.x,h=n.y;n.x=g.a*D+g.c*h+g.tx,n.y=g.b*D+g.d*h+g.ty}else d&&(n.x=-n.x),m&&(n.y=-n.y);r.inheritRotation?(_.updateGlobalTransform(),f=0>_.global.scaleX?n.rotation+_.global.rotation+a:n.rotation+_.global.rotation,0>g.a*g.d-g.b*g.c&&(f-=2*n.rotation,(d!==m||r.inheritReflection)&&(n.skew+=a)),n.rotation=f):(d||m)&&(d&&m?f=n.rotation+a:(f=d?a-n.rotation:-n.rotation,n.skew+=a),n.rotation=f),n.toMatrix(i)}}else(d||m)&&(d&&(n.x=-n.x),m&&(n.y=-n.y),d&&m?f=n.rotation+a:(f=d?a-n.rotation:-n.rotation,n.skew+=a),n.rotation=f),n.toMatrix(i)},r.prototype._updateAlpha=function(){this._globalAlpha=null===this._parent?this._alpha*this._armature._globalAlpha:this._alpha*this._parent._globalAlpha},r.prototype.init=function(e,a){null!==this._boneData||(this._boneData=e,this._armature=a,this._alpha=this._boneData.alpha,null!==this._boneData.parent&&(this._parent=this._armature.getBone(this._boneData.parent.name)),this._armature._addBone(this),this.origin=this._boneData.transform)},r.prototype.update=function(e){if(0<=e&&null!==this._cachedFrameIndices){var a=this._cachedFrameIndices[e];if(0<=a&&this._cachedFrameIndex===a)this._transformDirty=!1;else if(0<=a)this._transformDirty=!0,this._cachedFrameIndex=a;else{if(this._hasConstraint)for(var t=0,r=this._armature._constraints,n;t<r.length;t++)n=r[t],n._root===this&&n.update();this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):0<=this._cachedFrameIndex?(this._transformDirty=!1,this._cachedFrameIndices[e]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var i=0,o=this._armature._constraints,n;i<o.length;i++)n=o[i],n._root===this&&n.update();(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(e=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(!this._transformDirty)this._childrenTransformDirty&&(this._childrenTransformDirty=!1);else if(this._transformDirty=!1,this._childrenTransformDirty=!0,0>this._cachedFrameIndex){var l=0<=e;this._localDirty&&this._updateGlobalTransformMatrix(l),l&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[e]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);this._localDirty=!0},r.prototype.updateByConstraint=function(){this._localDirty&&(this._localDirty=!1,(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&this._updateGlobalTransformMatrix(!0),this._transformDirty=!0)},r.prototype.invalidUpdate=function(){this._transformDirty=!0},r.prototype.contains=function(e){if(e===this)return!1;for(var a=e;a!==this&&null!==a;)a=a.parent;return a===this},Object.defineProperty(r.prototype,"boneData",{get:function(){return this._boneData},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"visible",{get:function(){return this._visible},set:function(e){if(this._visible!==e){this._visible=e;for(var a=0,t=this._armature.getSlots(),r;a<t.length;a++)r=t[a],r.parent===this&&r._updateVisible()}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"name",{get:function(){return this._boneData.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),r}(e.TransformObject);e.Bone=t})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=Math.atan2,t=Math.sqrt,r=Math.PI,n=Math.floor,i=function(e){function o(){var a=null!==e&&e.apply(this,arguments)||this;return a._vertices=[],a._deformVertices=[],a._hullCache=[],a._matrixCahce=[],a}return __extends(o,e),o.toString=function(){return"[class dragonBones.Surface]"},o.prototype._onClear=function(){e.prototype._onClear.call(this),this._dX=0,this._dY=0,this._k=0,this._kX=0,this._kY=0,this._vertices.length=0,this._deformVertices.length=0,this._matrixCahce.length=0,this._hullCache.length=0,this._bone=null},o.prototype._getAffineTransform=function(e,n,i,o,l,s,_,d,m,p,f,u,y){var c=_-l,g=d-s,D=m-l,h=p-s;f.rotation=a(g,c),f.skew=a(h,D)-.5*r-f.rotation,y&&(f.rotation+=r),f.scaleX=t(c*c+g*g)/i,f.scaleY=t(D*D+h*h)/o,f.toMatrix(u),f.x=u.tx=l-(u.a*e+u.c*n),f.y=u.ty=s-(u.b*e+u.d*n)},o.prototype._updateVertices=function(){var e=this._armature.armatureData.parent,a=this._boneData.geometry,t=e.intArray,r=e.floatArray,n=t[a.offset+0],o=t[a.offset+2],s=this._vertices,_=this._deformVertices;if(null===this._parent)for(var d=0,m=n,p;d<m;++d)p=2*d,s[p]=r[o+p]+_[p],s[p+1]=r[o+p+1]+_[p+1];else if(1===this._parent._boneData.type)for(var d=0,m=n;d<m;++d){var p=2*d,f=r[o+p]+_[p],u=r[o+p+1]+_[p+1],c=this._parent._getGlobalTransformMatrix(f,u);s[p]=c.a*f+c.c*u+c.tx,s[p+1]=c.b*f+c.d*u+c.ty}else for(var g=this._parent.globalTransformMatrix,d=0,m=n;d<m;++d){var p=2*d,f=r[o+p]+_[p],u=r[o+p+1]+_[p+1];s[p]=g.a*f+g.c*u+g.tx,s[p+1]=g.b*f+g.d*u+g.ty}},o.prototype._updateGlobalTransformMatrix=function(e){var a=2*this._boneData.segmentX,t=this._vertices.length-2,r=this._vertices[0],n=this._vertices[1],i=this._vertices[a],o=this._vertices[a+1],l=this._vertices[t],s=this._vertices[t+1],_=this._vertices[t-a],d=this._vertices[t-a+1],m=r+.5*(l-r),p=n+.5*(s-n);this._getAffineTransform(0,0,200,200,m+.5*(i+.5*(_-i)-m),p+.5*(o+.5*(d-o)-p),i+.5*(l-i),o+.5*(s-o),_+.5*(l-_),d+.5*(s-d),this.global,this.globalTransformMatrix,!1),this._globalDirty=!1},o.prototype._getGlobalTransformMatrix=function(e,a){if(-1000>e||1000<e||-1000>a||1000<a)return this.globalTransformMatrix;var t=!1,r=this._boneData,i=r.segmentX,l=r.segmentY,s=2*r.segmentX,_=this._dX,d=this._dY,m=n((e+200)/_),p=n((a+200)/d),f=0,u=m*_-200,y=p*d-200,c=this._matrixCahce,g=o._helpMatrix;if(-200>e){if(-200>a||200<=a)return this.globalTransformMatrix;if(t=a>this._kX*(e+200)+y,f=7*(2*(i*l+i+l+l+p)+(t?1:0)),0<c[f])g.copyFromArray(c,f+1);else{var D=p*(s+2),h=this._hullCache[4],T=this._hullCache[5],b=this._hullCache[2]-(l-p)*h,A=this._hullCache[3]-(l-p)*T,S=this._vertices;t?this._getAffineTransform(-200,y+d,800,d,S[D+s+2],S[D+s+3],b+h,A+T,S[D],S[D+1],o._helpTransform,g,!0):this._getAffineTransform(-1000,y,800,d,b,A,S[D],S[D+1],b+h,A+T,o._helpTransform,g,!1),c[f]=1,c[f+1]=g.a,c[f+2]=g.b,c[f+3]=g.c,c[f+4]=g.d,c[f+5]=g.tx,c[f+6]=g.ty}}else if(200<=e){if(-200>a||200<=a)return this.globalTransformMatrix;if(t=a>this._kX*(e-1000)+y,f=7*(2*(i*l+i+p)+(t?1:0)),0<c[f])g.copyFromArray(c,f+1);else{var D=(p+1)*(s+2)-2,h=this._hullCache[4],T=this._hullCache[5],b=this._hullCache[0]+p*h,A=this._hullCache[1]+p*T,S=this._vertices;t?this._getAffineTransform(1000,y+d,800,d,b+h,A+T,S[D+s+2],S[D+s+3],b,A,o._helpTransform,g,!0):this._getAffineTransform(200,y,800,d,S[D],S[D+1],b,A,S[D+s+2],S[D+s+3],o._helpTransform,g,!1),c[f]=1,c[f+1]=g.a,c[f+2]=g.b,c[f+3]=g.c,c[f+4]=g.d,c[f+5]=g.tx,c[f+6]=g.ty}}else if(-200>a){if(-200>e||200<=e)return this.globalTransformMatrix;if(t=a>this._kY*(e-u-_)-1000,f=7*(2*(i*l+m)+(t?1:0)),0<c[f])g.copyFromArray(c,f+1);else{var D=2*m,h=this._hullCache[10],T=this._hullCache[11],b=this._hullCache[8]+m*h,A=this._hullCache[9]+m*T,S=this._vertices;t?this._getAffineTransform(u+_,-200,_,800,S[D+2],S[D+3],S[D],S[D+1],b+h,A+T,o._helpTransform,g,!0):this._getAffineTransform(u,-1000,_,800,b,A,b+h,A+T,S[D],S[D+1],o._helpTransform,g,!1),c[f]=1,c[f+1]=g.a,c[f+2]=g.b,c[f+3]=g.c,c[f+4]=g.d,c[f+5]=g.tx,c[f+6]=g.ty}}else if(200<=a){if(-200>e||200<=e)return this.globalTransformMatrix;if(t=a>this._kY*(e-u-_)+200,f=7*(2*(i*l+i+l+m)+(t?1:0)),0<c[f])g.copyFromArray(c,f+1);else{var D=l*(s+2)+2*m,h=this._hullCache[10],T=this._hullCache[11],b=this._hullCache[6]-(i-m)*h,A=this._hullCache[7]-(i-m)*T,S=this._vertices;t?this._getAffineTransform(u+_,1000,_,800,b+h,A+T,b,A,S[D+2],S[D+3],o._helpTransform,g,!0):this._getAffineTransform(u,200,_,800,S[D],S[D+1],S[D+2],S[D+3],b,A,o._helpTransform,g,!1),c[f]=1,c[f+1]=g.a,c[f+2]=g.b,c[f+3]=g.c,c[f+4]=g.d,c[f+5]=g.tx,c[f+6]=g.ty}}else if(t=a>this._k*(e-u-_)+y,f=7*(2*(i*p+m)+(t?1:0)),0<c[f])g.copyFromArray(c,f+1);else{var D=2*m+p*(s+2),S=this._vertices;t?this._getAffineTransform(u+_,y+d,_,d,S[D+s+4],S[D+s+5],S[D+s+2],S[D+s+3],S[D+2],S[D+3],o._helpTransform,g,!0):this._getAffineTransform(u,y,_,d,S[D],S[D+1],S[D+2],S[D+3],S[D+s+2],S[D+s+3],o._helpTransform,g,!1),c[f]=1,c[f+1]=g.a,c[f+2]=g.b,c[f+3]=g.c,c[f+4]=g.d,c[f+5]=g.tx,c[f+6]=g.ty}return g},o.prototype.init=function(a,t){if(null===this._boneData){e.prototype.init.call(this,a,t);var r=a.segmentX,n=a.segmentY,o=this._armature.armatureData.parent.intArray[a.geometry.offset+0];this._dX=400/r,this._dY=400/n,this._k=-this._dY/this._dX,this._kX=-this._dY/800,this._kY=-800/this._dX,this._vertices.length=2*o,this._deformVertices.length=2*o,this._matrixCahce.length=7*(2*(r*n+2*r+2*n)),this._hullCache.length=10;for(var l=0;l<2*o;++l)this._deformVertices[l]=0;null!==this._parent&&(0===this._parent.boneData.type?this._bone=this._parent:this._bone=this._parent._bone)}},o.prototype.update=function(e){if(0<=e&&null!==this._cachedFrameIndices){var a=this._cachedFrameIndices[e];if(0<=a&&this._cachedFrameIndex===a)this._transformDirty=!1;else if(0<=a)this._transformDirty=!0,this._cachedFrameIndex=a;else{if(this._hasConstraint)for(var t=0,r=this._armature._constraints,n;t<r.length;t++)n=r[t],n._root===this&&n.update();this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):0<=this._cachedFrameIndex?(this._transformDirty=!1,this._cachedFrameIndices[e]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var s=0,_=this._armature._constraints,n;s<_.length;s++)n=_[s],n._root===this&&n.update();(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(e=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty){this._transformDirty=!1,this._childrenTransformDirty=!0;for(var d=0,m=this._matrixCahce.length;d<m;d+=7)this._matrixCahce[d]=-1;if(this._updateVertices(),0>this._cachedFrameIndex){var l=0<=e;this._localDirty&&this._updateGlobalTransformMatrix(l),l&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[e]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);var p=2*this.global.x,f=2*this.global.y,u=o._helpPoint;this.globalTransformMatrix.transformPoint(1000,-200,u),this._hullCache[0]=u.x,this._hullCache[1]=u.y,this._hullCache[2]=p-u.x,this._hullCache[3]=f-u.y,this.globalTransformMatrix.transformPoint(0,this._dY,u,!0),this._hullCache[4]=u.x,this._hullCache[5]=u.y,this.globalTransformMatrix.transformPoint(200,1000,u),this._hullCache[6]=u.x,this._hullCache[7]=u.y,this._hullCache[8]=p-u.x,this._hullCache[9]=f-u.y,this.globalTransformMatrix.transformPoint(this._dX,0,u,!0),this._hullCache[10]=u.x,this._hullCache[11]=u.y}else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},o}(e.Bone);e.Surface=i})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=Math.atan2,t=Math.sin,r=Math.cos,n=function(e){function a(){var a=null!==e&&e.apply(this,arguments)||this;return a.deformVertices=[],a}return __extends(a,e),a.toString=function(){return"[class dragonBones.DisplayFrame]"},a.prototype._onClear=function(){this.rawDisplayData=null,this.displayData=null,this.textureData=null,this.display=null,this.deformVertices.length=0},a.prototype.updateDeformVertices=function(){if(null!==this.rawDisplayData&&0===this.deformVertices.length){var e;if(2===this.rawDisplayData.type)e=this.rawDisplayData.geometry;else if(4===this.rawDisplayData.type)e=this.rawDisplayData.geometry;else return;var a=0;a=null===e.weight?2*e.data.intArray[e.offset+0]:2*e.weight.count,this.deformVertices.length=a;for(var t=0,r=this.deformVertices.length;t<r;++t)this.deformVertices[t]=0}},a.prototype.getGeometryData=function(){if(null!==this.displayData){if(2===this.displayData.type)return this.displayData.geometry;if(4===this.displayData.type)return this.displayData.geometry}if(null!==this.rawDisplayData){if(2===this.rawDisplayData.type)return this.rawDisplayData.geometry;if(4===this.rawDisplayData.type)return this.rawDisplayData.geometry}return null},a.prototype.getBoundingBox=function(){return null!==this.displayData&&3===this.displayData.type?this.displayData.boundingBox:null!==this.rawDisplayData&&3===this.rawDisplayData.type?this.rawDisplayData.boundingBox:null},a.prototype.getTextureData=function(){if(null!==this.displayData){if(0===this.displayData.type)return this.displayData.texture;if(2===this.displayData.type)return this.displayData.texture}if(null!==this.textureData)return this.textureData;if(null!==this.rawDisplayData){if(0===this.rawDisplayData.type)return this.rawDisplayData.texture;if(2===this.rawDisplayData.type)return this.rawDisplayData.texture}return null},a}(e.BaseObject);e.DisplayFrame=n;var i=function(i){function o(){var a=null!==i&&i.apply(this,arguments)||this;return a._localMatrix=new e.Matrix,a._colorTransform=new e.ColorTransform,a._displayFrames=[],a._geometryBones=[],a._rawDisplay=null,a._meshDisplay=null,a._display=null,a}return __extends(o,i),o.prototype._onClear=function(){i.prototype._onClear.call(this);for(var a=[],t=0,r=this._displayFrames;t<r.length;t++){var n=r[t],o=n.display;o!==this._rawDisplay&&o!==this._meshDisplay&&0>a.indexOf(o)&&a.push(o),n.returnToPool()}for(var l=0,s=a,_;l<s.length;l++)_=s[l],_ instanceof e.Armature?_.dispose():this._disposeDisplay(_,!0);null!==this._meshDisplay&&this._meshDisplay!==this._rawDisplay&&this._disposeDisplay(this._meshDisplay,!1),null!==this._rawDisplay&&this._disposeDisplay(this._rawDisplay,!1),this.displayController=null,this._displayDataDirty=!1,this._displayDirty=!1,this._geometryDirty=!1,this._textureDirty=!1,this._visibleDirty=!1,this._blendModeDirty=!1,this._zOrderDirty=!1,this._colorDirty=!1,this._verticesDirty=!1,this._transformDirty=!1,this._visible=!0,this._blendMode=0,this._displayIndex=-1,this._animationDisplayIndex=-1,this._zOrder=0,this._zIndex=0,this._cachedFrameIndex=-1,this._pivotX=0,this._pivotY=0,this._localMatrix.identity(),this._colorTransform.identity(),this._displayFrames.length=0,this._geometryBones.length=0,this._slotData=null,this._displayFrame=null,this._geometryData=null,this._boundingBoxData=null,this._textureData=null,this._rawDisplay=null,this._meshDisplay=null,this._display=null,this._childArmature=null,this._parent=null,this._cachedFrameIndices=null},o.prototype._hasDisplay=function(e){for(var a=0,t=this._displayFrames,r;a<t.length;a++)if(r=t[a],r.display===e)return!0;return!1},o.prototype._isBonesUpdate=function(){for(var e=0,a=this._geometryBones,t;e<a.length;e++)if(t=a[e],null!==t&&t._childrenTransformDirty)return!0;return!1},o.prototype._updateAlpha=function(){var e=this._alpha*this._parent._globalAlpha;this._globalAlpha!==e&&(this._globalAlpha=e,this._colorDirty=!0)},o.prototype._updateDisplayData=function(){var a=this._displayFrame,t=this._geometryData,r=this._textureData,n=null,s=null;if(this._displayFrame=null,this._geometryData=null,this._boundingBoxData=null,this._textureData=null,0<=this._displayIndex&&this._displayIndex<this._displayFrames.length&&(this._displayFrame=this._displayFrames[this._displayIndex],n=this._displayFrame.rawDisplayData,s=this._displayFrame.displayData,this._geometryData=this._displayFrame.getGeometryData(),this._boundingBoxData=this._displayFrame.getBoundingBox(),this._textureData=this._displayFrame.getTextureData()),this._displayFrame!==a||this._geometryData!==t||this._textureData!==r){if(null===this._geometryData&&null!==this._textureData){var _=null!==s&&0===s.type?s:n,d=this._textureData.parent.scale*this._armature._armatureData.scale,m=this._textureData.frame;this._pivotX=_.pivot.x,this._pivotY=_.pivot.y;var p=null===m?this._textureData.region:m,f=p.width,u=p.height;this._textureData.rotated&&null===m&&(f=p.height,u=p.width),this._pivotX*=f*d,this._pivotY*=u*d,null!==m&&(this._pivotX+=m.x*d,this._pivotY+=m.y*d),null!==n&&_!=n&&(n.transform.toMatrix(o._helpMatrix),o._helpMatrix.invert(),o._helpMatrix.transformPoint(0,0,o._helpPoint),this._pivotX-=o._helpPoint.x,this._pivotY-=o._helpPoint.y,_.transform.toMatrix(o._helpMatrix),o._helpMatrix.invert(),o._helpMatrix.transformPoint(0,0,o._helpPoint),this._pivotX+=o._helpPoint.x,this._pivotY+=o._helpPoint.y),e.DragonBones.yDown||(this._pivotY=(this._textureData.rotated?this._textureData.region.width:this._textureData.region.height)*d-this._pivotY)}else this._pivotX=0,this._pivotY=0;if(this.origin=null===n?null===s?null:s.transform:n.transform,null===this.origin?this.global.copyFrom(this.offset).toMatrix(this._localMatrix):this.global.copyFrom(this.origin).add(this.offset).toMatrix(this._localMatrix),this._geometryData!==t)if(this._geometryDirty=!0,this._verticesDirty=!0,null===this._geometryData)this._geometryBones.length=0,this._geometryData=null;else if(this._geometryBones.length=0,null!==this._geometryData.weight)for(var y=0,c=this._geometryData.weight.bones.length,l;y<c;++y)l=this._armature.getBone(this._geometryData.weight.bones[y].name),this._geometryBones.push(l);this._textureDirty=this._textureData!==r,this._transformDirty=!0}},o.prototype._updateDisplay=function(){var a=null===this._display?this._rawDisplay:this._display,t=this._childArmature;null===this._displayFrame?(this._display=null,this._childArmature=null):(this._display=this._displayFrame.display,null!==this._display&&this._display instanceof e.Armature?(this._childArmature=this._display,this._display=this._childArmature.display):this._childArmature=null);var r=null===this._display?this._rawDisplay:this._display;if(r!==a&&(this._textureDirty=!0,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0,this._transformDirty=!0,this._onUpdateDisplay(),this._replaceDisplay(a)),this._childArmature!==t&&(null!==t&&(t._parent=null,t.clock=null,t.inheritAnimation&&t.animation.reset()),null!==this._childArmature&&(this._childArmature._parent=this,this._childArmature.clock=this._armature.clock,this._childArmature.inheritAnimation))){if(0===this._childArmature.cacheFrameRate){var n=this._armature.cacheFrameRate;0!==n&&(this._childArmature.cacheFrameRate=n)}if(null!==this._displayFrame){var i=null,o=null===this._displayFrame.displayData?this._displayFrame.rawDisplayData:this._displayFrame.displayData;if(null!==o&&1===o.type&&(i=o.actions),null!==i&&0<i.length)for(var l=0,s=i;l<s.length;l++){var _=s[l],d=e.BaseObject.borrowObject(e.EventObject);e.EventObject.actionDataToInstance(_,d,this._armature),d.slot=this,this._armature._bufferAction(d,!1)}else this._childArmature.animation.play()}}},o.prototype._updateGlobalTransformMatrix=function(e){var a=0===this._parent._boneData.type?this._parent.globalTransformMatrix:this._parent._getGlobalTransformMatrix(this.global.x,this.global.y);this.globalTransformMatrix.copyFrom(this._localMatrix),this.globalTransformMatrix.concat(a),e?this.global.fromMatrix(this.globalTransformMatrix):this._globalDirty=!0},o.prototype._setDisplayIndex=function(e,a){if(void 0===a&&(a=!1),a){if(this._animationDisplayIndex===e)return;this._animationDisplayIndex=e}this._displayIndex===e||(this._displayIndex=e<this._displayFrames.length?e:this._displayFrames.length-1,this._displayDataDirty=!0,this._displayDirty=0>this._displayIndex||this._display!==this._displayFrames[this._displayIndex].display)},o.prototype._setZOrder=function(e){return this._zOrder===e,this._zOrder=e,this._zOrderDirty=!0,this._zOrderDirty},o.prototype._setColor=function(e){return this._colorTransform.copyFrom(e),this._colorDirty=!0},o.prototype.init=function(e,a,t,r){if(null===this._slotData){this._slotData=e,this._colorDirty=!0,this._blendModeDirty=!0,this._blendMode=this._slotData.blendMode,this._zOrder=this._slotData.zOrder,this._zIndex=this._slotData.zIndex,this._alpha=this._slotData.alpha,this._colorTransform.copyFrom(this._slotData.color),this._rawDisplay=t,this._meshDisplay=r,this._armature=a;var n=this._armature.getBone(this._slotData.parent.name);null!==n&&(this._parent=n),this._armature._addSlot(this),this._initDisplay(this._rawDisplay,!1),this._rawDisplay!==this._meshDisplay&&this._initDisplay(this._meshDisplay,!1),this._onUpdateDisplay(),this._addDisplay()}},o.prototype.update=function(e){if(this._displayDataDirty&&(this._updateDisplayData(),this._displayDataDirty=!1),this._displayDirty&&(this._updateDisplay(),this._displayDirty=!1),(this._geometryDirty||this._textureDirty)&&((null===this._display||this._display===this._rawDisplay||this._display===this._meshDisplay)&&this._updateFrame(),this._geometryDirty=!1,this._textureDirty=!1),null!==this._display){if(this._visibleDirty&&(this._updateVisible(),this._visibleDirty=!1),this._blendModeDirty&&(this._updateBlendMode(),this._blendModeDirty=!1),this._colorDirty&&(this._updateColor(),this._colorDirty=!1),this._zOrderDirty&&(this._updateZOrder(),this._zOrderDirty=!1),null!==this._geometryData&&this._display===this._meshDisplay){var a=null!==this._geometryData.weight,t=0!==this._parent._boneData.type;if((this._verticesDirty||a&&this._isBonesUpdate()||t&&this._parent._childrenTransformDirty)&&(this._updateMesh(),this._verticesDirty=!1),a||t)return}if(0<=e&&null!==this._cachedFrameIndices){var r=this._cachedFrameIndices[e];0<=r&&this._cachedFrameIndex===r?this._transformDirty=!1:0<=r?(this._transformDirty=!0,this._cachedFrameIndex=r):this._transformDirty||this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):0<=this._cachedFrameIndex?(this._transformDirty=!1,this._cachedFrameIndices[e]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}else(this._transformDirty||this._parent._childrenTransformDirty)&&(e=-1,this._transformDirty=!0,this._cachedFrameIndex=-1);if(this._transformDirty){if(0>this._cachedFrameIndex){var n=0<=e;this._updateGlobalTransformMatrix(n),n&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[e]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);this._updateTransform(),this._transformDirty=!1}}},o.prototype.invalidUpdate=function(){this._displayDataDirty=!0,this._displayDirty=!0,this._transformDirty=!0},o.prototype.updateTransformAndMatrix=function(){this._transformDirty&&(this._updateGlobalTransformMatrix(!1),this._transformDirty=!1)},o.prototype.replaceRawDisplayData=function(e,a){if(void 0===a&&(a=-1),0>a)a=0>this._displayIndex?0:this._displayIndex;else if(a>=this._displayFrames.length)return;var t=this._displayFrames[a];if(t.rawDisplayData!==e){if(t.deformVertices.length=0,t.rawDisplayData=e,null===t.rawDisplayData){var r=this._armature._armatureData.defaultSkin;if(null!==r){var n=r.getDisplays(this._slotData.name);null!==n&&a<n.length&&(t.rawDisplayData=n[a])}}a===this._displayIndex&&(this._displayDataDirty=!0)}},o.prototype.replaceDisplayData=function(e,a){if(void 0===a&&(a=-1),0>a)a=0>this._displayIndex?0:this._displayIndex;else if(a>=this._displayFrames.length)return;var t=this._displayFrames[a];t.displayData!==e&&t.rawDisplayData!==e&&(t.displayData=e,a===this._displayIndex&&(this._displayDataDirty=!0))},o.prototype.replaceTextureData=function(e,a){if(void 0===a&&(a=-1),0>a)a=0>this._displayIndex?0:this._displayIndex;else if(a>=this._displayFrames.length)return;var t=this._displayFrames[a];t.textureData!==e&&(t.textureData=e,a===this._displayIndex&&(this._displayDataDirty=!0))},o.prototype.replaceDisplay=function(a,t){if(void 0===t&&(t=-1),0>t)t=0>this._displayIndex?0:this._displayIndex;else if(t>=this._displayFrames.length)return;var r=this._displayFrames[t];if(r.display!==a){var n=r.display;r.display=a,null!==n&&n!==this._rawDisplay&&n!==this._meshDisplay&&!this._hasDisplay(n)&&(n instanceof e.Armature||this._disposeDisplay(n,!0)),null===a||a===this._rawDisplay||a===this._meshDisplay||this._hasDisplay(n)||a instanceof e.Armature||this._initDisplay(a,!0),t===this._displayIndex&&(this._displayDirty=!0)}},o.prototype.containsPoint=function(e,a){return null!==this._boundingBoxData&&(this.updateTransformAndMatrix(),o._helpMatrix.copyFrom(this.globalTransformMatrix),o._helpMatrix.invert(),o._helpMatrix.transformPoint(e,a,o._helpPoint),this._boundingBoxData.containsPoint(o._helpPoint.x,o._helpPoint.y))},o.prototype.intersectsSegment=function(e,n,i,l,s,_,d){if(void 0===s&&(s=null),void 0===_&&(_=null),void 0===d&&(d=null),null===this._boundingBoxData)return 0;this.updateTransformAndMatrix(),o._helpMatrix.copyFrom(this.globalTransformMatrix),o._helpMatrix.invert(),o._helpMatrix.transformPoint(e,n,o._helpPoint),e=o._helpPoint.x,n=o._helpPoint.y,o._helpMatrix.transformPoint(i,l,o._helpPoint),i=o._helpPoint.x,l=o._helpPoint.y;var m=this._boundingBoxData.intersectsSegment(e,n,i,l,s,_,d);return 0<m&&(1===m||2===m?null===s?null!==_&&this.globalTransformMatrix.transformPoint(_.x,_.y,_):(this.globalTransformMatrix.transformPoint(s.x,s.y,s),null!==_&&(_.x=s.x,_.y=s.y)):(null!==s&&this.globalTransformMatrix.transformPoint(s.x,s.y,s),null!==_&&this.globalTransformMatrix.transformPoint(_.x,_.y,_)),null!==d&&(this.globalTransformMatrix.transformPoint(r(d.x),t(d.x),o._helpPoint,!0),d.x=a(o._helpPoint.y,o._helpPoint.x),this.globalTransformMatrix.transformPoint(r(d.y),t(d.y),o._helpPoint,!0),d.y=a(o._helpPoint.y,o._helpPoint.x))),m},o.prototype.getDisplayFrameAt=function(e){return this._displayFrames[e]},Object.defineProperty(o.prototype,"visible",{get:function(){return this._visible},set:function(e){this._visible===e||(this._visible=e,this._updateVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"displayFrameCount",{get:function(){return this._displayFrames.length},set:function(a){var t=this._displayFrames.length;if(t<a){this._displayFrames.length=a;for(var r=t;r<a;++r)this._displayFrames[r]=e.BaseObject.borrowObject(n)}else if(t>a){for(var r=t-1;r<a;--r)this.replaceDisplay(null,r),this._displayFrames[r].returnToPool();this._displayFrames.length=a}},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(e){this._setDisplayIndex(e),this.update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"name",{get:function(){return this._slotData.name},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"displayList",{get:function(){for(var e=[],a=0,t=this._displayFrames,r;a<t.length;a++)r=t[a],e.push(r.display);return e},set:function(e){this.displayFrameCount=e.length;for(var a=0,t=0,r=e,n;t<r.length;t++)n=r[t],this.replaceDisplay(n,a++)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"slotData",{get:function(){return this._slotData},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"boundingBoxData",{get:function(){return this._boundingBoxData},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"meshDisplay",{get:function(){return this._meshDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"display",{get:function(){return this._display},set:function(e){this._display===e||(0===this._displayFrames.length&&(this.displayFrameCount=1,this._displayIndex=0),this.replaceDisplay(e,this._displayIndex))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"childArmature",{get:function(){return this._childArmature},set:function(e){this._childArmature===e||(this.display=e)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),o.prototype.getDisplay=function(){return this._display},o.prototype.setDisplay=function(e){this.display=e},o}(e.TransformObject);e.Slot=i})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var n=Math.atan2,a=Math.sqrt,t=Math.sin,i=Math.cos,o=Math.PI,r=function(a){function t(){return null!==a&&a.apply(this,arguments)||this}return __extends(t,a),t.prototype._onClear=function(){this._armature=null,this._target=null,this._root=null,this._bone=null},Object.defineProperty(t.prototype,"name",{get:function(){return this._constraintData.name},enumerable:!0,configurable:!0}),t._helpMatrix=new e.Matrix,t._helpTransform=new e.Transform,t._helpPoint=new e.Point,t}(e.BaseObject);e.Constraint=r;var l=function(r){function l(){return null!==r&&r.apply(this,arguments)||this}return __extends(l,r),l.toString=function(){return"[class dragonBones.IKConstraint]"},l.prototype._onClear=function(){r.prototype._onClear.call(this),this._scaleEnabled=!1,this._bendPositive=!1,this._weight=1,this._constraintData=null},l.prototype._computeA=function(){var a=this._target.global,t=this._root.global,r=this._root.globalTransformMatrix,i=n(a.y-t.y,a.x-t.x);0>t.scaleX&&(i+=o),t.rotation+=e.Transform.normalizeRadian(i-t.rotation)*this._weight,t.toMatrix(r)},l.prototype._computeB=function(){var l=this._bone._boneData.length,s=this._root,_=this._target.global,d=s.global,m=this._bone.global,p=this._bone.globalTransformMatrix,f=p.a*l,u=p.b*l,y=f*f+u*u,c=a(y),g=m.x-d.x,D=m.y-d.y,T=g*g+D*D,b=a(T),A=m.rotation,S=d.rotation,P=n(D,g);g=_.x-d.x,D=_.y-d.y;var O=g*g+D*D,x=a(O),E=0;if(c+b<=x||x+c<=b||x+b<=c)E=n(_.y-d.y,_.x-d.x),c+b<=x||b<c&&(E+=o);else{var B=(T-y+O)/(2*O),h=a(T-B*B*O)/x,r=d.x+g*B,I=d.y+D*B,F=-D*h,C=g*h,M=!1,N=s.parent;if(null!==N){var w=N.globalTransformMatrix;M=0>w.a*w.d-w.b*w.c}M===this._bendPositive?(m.x=r+F,m.y=I+C):(m.x=r-F,m.y=I-C),E=n(m.y-d.y,m.x-d.x)}var v=e.Transform.normalizeRadian(E-P);d.rotation=S+v*this._weight,d.toMatrix(s.globalTransformMatrix);var R=P+v*this._weight;m.x=d.x+i(R)*b,m.y=d.y+t(R)*b;var k=n(_.y-m.y,_.x-m.x);0>m.scaleX&&(k+=o),m.rotation=d.rotation+A-S+e.Transform.normalizeRadian(k-v-A)*this._weight,m.toMatrix(p)},l.prototype.init=function(e,a){if(null===this._constraintData){this._constraintData=e,this._armature=a,this._target=this._armature.getBone(this._constraintData.target.name),this._root=this._armature.getBone(this._constraintData.root.name),this._bone=null===this._constraintData.bone?null:this._armature.getBone(this._constraintData.bone.name);{var t=this._constraintData;this._scaleEnabled=t.scaleEnabled,this._bendPositive=t.bendPositive,this._weight=t.weight}this._root._hasConstraint=!0}},l.prototype.update=function(){this._root.updateByConstraint(),null===this._bone?this._computeA():(this._bone.updateByConstraint(),this._computeB())},l.prototype.invalidUpdate=function(){this._root.invalidUpdate(),null!==this._bone&&this._bone.invalidUpdate()},l}(r);e.IKConstraint=l;var s=function(r){function o(){var e=null!==r&&r.apply(this,arguments)||this;return e._bones=[],e._spaces=[],e._positions=[],e._curves=[],e._boneLengths=[],e._pathGlobalVertices=[],e._segments=[10],e}return __extends(o,r),o.toString=function(){return"[class dragonBones.PathConstraint]"},o.prototype._onClear=function(){r.prototype._onClear.call(this),this.dirty=!1,this.pathOffset=0,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=1,this.translateMix=1,this._pathSlot=null,this._bones.length=0,this._spaces.length=0,this._positions.length=0,this._curves.length=0,this._boneLengths.length=0,this._pathGlobalVertices.length=0},o.prototype._updatePathVertices=function(e){var a=this._armature,t=a.armatureData.parent,r=a.armatureData.scale,n=t.intArray,o=t.floatArray,l=e.offset,s=n[l+0],_=n[l+2];this._pathGlobalVertices.length=2*s;var d=e.weight;if(null===d){var m=this._pathSlot.parent;m.updateByConstraint();for(var p=m.globalTransformMatrix,f=0,u=_;f<s;f+=2){var c=o[u++]*r,g=o[u++]*r,D=p.a*c+p.c*g+p.tx,h=p.b*c+p.d*g+p.ty;this._pathGlobalVertices[f]=D,this._pathGlobalVertices[f+1]=h}return}for(var y=this._pathSlot._geometryBones,T=d.bones.length,b=d.offset,A=n[b+1],S=A,P=b+2+T,f=0,O=0;f<s;f++){for(var x=n[P++],E=0,B=0,I=0;I<x;I++){var F=n[P++],C=y[F];if(null!==C){C.updateByConstraint();var p=C.globalTransformMatrix,M=o[S++],c=o[S++]*r,g=o[S++]*r;E+=(p.a*c+p.c*g+p.tx)*M,B+=(p.b*c+p.d*g+p.ty)*M}}this._pathGlobalVertices[O++]=E,this._pathGlobalVertices[O++]=B}},o.prototype._computeVertices=function(e,a,t,r){for(var n=t,o=e;n<a;n+=2)r[n]=this._pathGlobalVertices[o++],r[n+1]=this._pathGlobalVertices[o++]},o.prototype._computeBezierCurve=function(e,t,r,n,l){var s=this._armature,_=s.armatureData.parent.intArray,d=_[e.geometry.offset+0],m=this._positions,f=this._spaces,u=e.closed,y=[],c=2*d,g=c/6,D=-1,h=this.position;m.length=3*t+2;var T=0;if(!e.constantSpeed){var b=e.curveLengths;if(g-=u?1:2,T=b[g],n&&(h*=T),l)for(var A=0;A<t;A++)f[A]*=T;y.length=8;for(var A=0,S=0,P=0,O;A<t;A++,S+=3){if(O=f[A],h+=O,u)h%=T,0>h&&(h+=T),P=0;else if(0>h)continue;else if(h>T)continue;for(var x=0,E;;P++)if(E=b[P],!(h>E)){if(0==P)x=h/E;else{var B=b[P-1];x=(h-B)/(E-B)}break}P!=D&&(D=P,u&&P==g?(this._computeVertices(c-4,4,0,y),this._computeVertices(0,4,4,y)):this._computeVertices(6*P+2,8,0,y)),this.addCurvePosition(x,y[0],y[1],y[2],y[3],y[4],y[5],y[6],y[7],m,S,r)}return}u?(c+=2,y.length=d,this._computeVertices(2,c-4,0,y),this._computeVertices(0,2,c-4,y),y[c-2]=y[0],y[c-1]=y[1]):(g--,c-=4,y.length=c,this._computeVertices(2,c,0,y));var I=Array(g);T=0;for(var F=y[0],C=y[1],M=0,N=0,v=0,R=0,k=0,j=0,A=0,L=2,V,Y,U,X,G,z,H,W;A<g;A++,L+=6)M=y[L],N=y[L+1],v=y[L+2],R=y[L+3],k=y[L+4],j=y[L+5],V=.1875*(F-2*M+v),Y=.1875*(C-2*N+R),U=.09375*(3*(M-v)-F+k),X=.09375*(3*(N-R)-C+j),G=2*V+U,z=2*Y+X,H=.75*(M-F)+V+.16666667*U,W=.75*(N-C)+Y+.16666667*X,T+=a(H*H+W*W),H+=G,W+=z,G+=U,z+=X,T+=a(H*H+W*W),H+=G,W+=z,T+=a(H*H+W*W),H+=G+U,W+=z+X,T+=a(H*H+W*W),I[A]=T,F=k,C=j;if(n&&(h*=T),l)for(var A=0;A<t;A++)f[A]*=T;for(var K=this._segments,Z=0,A=0,S=0,P=0,q=0,O;A<t;A++,S+=3){O=f[A],h+=O;var Q=h;if(u)Q%=T,0>Q&&(Q+=T),P=0;else if(0>Q)continue;else if(Q>T)continue;for(;;P++){var J=I[P];if(!(Q>J)){if(0==P)Q/=J;else{var $=I[P-1];Q=(Q-$)/(J-$)}break}}if(P!=D){D=P;var ee=6*P;for(F=y[ee],C=y[ee+1],M=y[ee+2],N=y[ee+3],v=y[ee+4],R=y[ee+5],k=y[ee+6],j=y[ee+7],V=.03*(F-2*M+v),Y=.03*(C-2*N+R),U=.006*(3*(M-v)-F+k),X=.006*(3*(N-R)-C+j),G=2*V+U,z=2*Y+X,H=.3*(M-F)+V+.16666667*U,W=.3*(N-C)+Y+.16666667*X,Z=a(H*H+W*W),K[0]=Z,ee=1;8>ee;ee++)H+=G,W+=z,G+=U,z+=X,Z+=a(H*H+W*W),K[ee]=Z;H+=G,W+=z,Z+=a(H*H+W*W),K[8]=Z,H+=G+U,W+=z+X,Z+=a(H*H+W*W),K[9]=Z,q=0}for(Q*=Z;;q++){var ae=K[q];if(!(Q>ae)){if(0==q)Q/=ae;else{var $=K[q-1];Q=q+(Q-$)/(ae-$)}break}}this.addCurvePosition(.1*Q,F,C,M,N,v,R,k,j,m,S,r)}},o.prototype.addCurvePosition=function(e,t,r,i,o,l,s,_,m,p,f,u){if(0===e)return p[f]=t,p[f+1]=r,void(p[f+2]=0);if(1===e)return p[f]=_,p[f+1]=m,void(p[f+2]=0);var g=1-e,D=g*g,h=e*e,T=D*g,a=3*(D*e),b=3*(g*h),c=e*h,d=T*t+a*i+b*l+c*_,A=T*r+a*o+b*s+c*m;p[f]=d,p[f+1]=A,p[f+2]=u?n(A-(T*r+a*o+b*s),d-(T*t+a*i+b*l)):0},o.prototype.init=function(e,a){this._constraintData=e,this._armature=a;var t=e;this.pathOffset=t.pathDisplayData.geometry.offset,this.position=t.position,this.spacing=t.spacing,this.rotateOffset=t.rotateOffset,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this._root=this._armature.getBone(t.root.name),this._target=this._armature.getBone(t.target.name),this._pathSlot=this._armature.getSlot(t.pathSlot.name);for(var r=0,n=t.bones.length,o;r<n;r++)o=this._armature.getBone(t.bones[r].name),null!==o&&this._bones.push(o);2===t.rotateMode&&(this._boneLengths.length=this._bones.length),this._root._hasConstraint=!0},o.prototype.update=function(){var o=this._pathSlot;if(null!==o._geometryData&&o._geometryData.offset===this.pathOffset){var l=this._constraintData,_=!1;if(this._root._childrenTransformDirty?(this._updatePathVertices(o._geometryData),_=!0):(o._verticesDirty||o._isBonesUpdate())&&(this._updatePathVertices(o._geometryData),o._verticesDirty=!1,_=!0),_||this.dirty){var m=l.positionMode,f=l.spacingMode,u=l.rotateMode,g=this._bones,D=2===u,h=0===u,T=g.length,A=h?T:T+1,S=this.spacing,P=this._spaces;if(P.length=A,D||0===f){P[0]=0;for(var O=0,E;O<A-1;O++){E=g[O],E.updateByConstraint();var B=E._boneData.length,I=E.globalTransformMatrix,F=B*I.a,C=B*I.b,M=a(F*F+C*C);D&&(this._boneLengths[O]=M),P[O+1]=(B+S)*M/B}}else for(var O=0;O<A;O++)P[O]=S;this._computeBezierCurve(o._displayFrame.rawDisplayData,A,h,1===m,2===f);var N=this._positions,w=this.rotateOffset,v=N[0],R=N[1],k;if(0===w)k=1===u;else{k=!1;var E=o.parent;if(null!==E){var I=E.globalTransformMatrix;w*=0<I.a*I.d-I.b*I.c?e.Transform.DEG_RAD:-e.Transform.DEG_RAD}}for(var j=this.rotateMix,L=this.translateMix,O=0,V=3,E;O<T;O++,V+=3){E=g[O],E.updateByConstraint();var I=E.globalTransformMatrix;I.tx+=(v-I.tx)*L,I.ty+=(R-I.ty)*L;var F=N[V],C=N[V+1],Y=F-v,U=C-R;if(D){var X=this._boneLengths[O],G=(a(Y*Y+U*U)/X-1)*j+1;I.a*=G,I.b*=G}if(v=F,R=C,0<j){var s=I.a,z=I.b,b=I.c,c=I.d,d=void 0,H,W;if(d=h?N[V-1]:n(U,Y),d-=n(z,s),k){H=i(d),W=t(d);var K=E._boneData.length;v+=(K*(H*s-W*z)-Y)*j,R+=(K*(W*s+H*z)-U)*j}else d+=w;d>e.Transform.PI?d-=e.Transform.PI_D:d<-e.Transform.PI&&(d+=e.Transform.PI_D),d*=j,H=i(d),W=t(d),I.a=H*s-W*z,I.b=W*s+H*z,I.c=H*b-W*c,I.d=W*b+H*c}E.global.fromMatrix(I)}this.dirty=!1}}},o.prototype.invalidUpdate=function(){},o}(r);e.PathConstraint=s})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(){function e(e){void 0===e&&(e=0),this.time=0,this.timeScale=1,this._systemTime=0,this._animatebles=[],this._clock=null,this.time=e,this._systemTime=.001*new Date().getTime()}return e.prototype.advanceTime=function(e){e!==e&&(e=0);var a=.001*Date.now();if(0>e&&(e=a-this._systemTime),this._systemTime=a,1!==this.timeScale&&(e*=this.timeScale),0!==e){0>e?this.time-=e:this.time+=e;for(var t=0,n=0,o=this._animatebles.length,s;t<o;++t)s=this._animatebles[t],null===s?n++:(0<n&&(this._animatebles[t-n]=s,this._animatebles[t]=null),s.advanceTime(e));if(0<n){for(o=this._animatebles.length;t<o;++t){var _=this._animatebles[t];null===_?n++:this._animatebles[t-n]=_}this._animatebles.length-=n}}},e.prototype.contains=function(e){if(e===this)return!1;for(var a=e;a!==this&&null!==a;)a=a.clock;return a===this},e.prototype.add=function(e){0>this._animatebles.indexOf(e)&&(this._animatebles.push(e),e.clock=this)},e.prototype.remove=function(e){var a=this._animatebles.indexOf(e);0<=a&&(this._animatebles[a]=null,e.clock=null)},e.prototype.clear=function(){for(var e=0,a=this._animatebles,t;e<a.length;e++)t=a[e],null!==t&&(t.clock=null)},Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},set:function(e){this._clock===e||(null!==this._clock&&this._clock.remove(this),this._clock=e,null!==this._clock&&this._clock.add(this))},enumerable:!0,configurable:!0}),e}();e.WorldClock=a})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(a){function t(){var e=null!==a&&a.apply(this,arguments)||this;return e._animationNames=[],e._animationStates=[],e._animations={},e._blendStates={},e._animationConfig=null,e}return __extends(t,a),t.toString=function(){return"[class dragonBones.Animation]"},t.prototype._onClear=function(){for(var e=0,a=this._animationStates,t;e<a.length;e++)t=a[e],t.returnToPool();for(var r in this._animations)delete this._animations[r];for(var r in this._blendStates){var n=this._blendStates[r];for(var i in n)n[i].returnToPool();delete this._blendStates[r]}null!==this._animationConfig&&this._animationConfig.returnToPool(),this.timeScale=1,this._animationDirty=!1,this._inheritTimeScale=1,this._animationNames.length=0,this._animationStates.length=0,this._armature=null,this._animationConfig=null,this._lastAnimationState=null},t.prototype._fadeOut=function(e){switch(e.fadeOutMode){case 1:for(var a=0,t=this._animationStates,r;a<t.length;a++)(r=t[a],null===r._parent)&&r.layer===e.layer&&r.fadeOut(e.fadeOutTime,e.pauseFadeOut);break;case 2:for(var n=0,i=this._animationStates,r;n<i.length;n++)(r=i[n],null===r._parent)&&r.group===e.group&&r.fadeOut(e.fadeOutTime,e.pauseFadeOut);break;case 3:for(var o=0,l=this._animationStates,r;o<l.length;o++)(r=l[o],null===r._parent)&&r.layer===e.layer&&r.group===e.group&&r.fadeOut(e.fadeOutTime,e.pauseFadeOut);break;case 4:for(var s=0,_=this._animationStates,r;s<_.length;s++)(r=_[s],null===r._parent)&&r.fadeOut(e.fadeOutTime,e.pauseFadeOut);break;case 5:default:}},t.prototype.init=function(a){null!==this._armature||(this._armature=a,this._animationConfig=e.BaseObject.borrowObject(e.AnimationConfig))},t.prototype.advanceTime=function(e){for(var a in 0>e&&(e=-e),this._inheritTimeScale=this._armature.inheritAnimation&&null!==this._armature._parent?this._armature._parent._armature.animation._inheritTimeScale*this.timeScale:this.timeScale,1!==this._inheritTimeScale&&(e*=this._inheritTimeScale),this._blendStates){var t=this._blendStates[a];for(var n in t)t[n].reset()}var o=this._animationStates.length;if(1===o){var l=this._animationStates[0];if(0<l._fadeState&&0<l._subFadeState)this._armature._dragonBones.bufferObject(l),this._animationStates.length=0,this._lastAnimationState=null;else{var s=l.animationData,_=s.cacheFrameRate;if(this._animationDirty&&0<_){this._animationDirty=!1;for(var d=0,m=this._armature.getBones(),p;d<m.length;d++)p=m[d],p._cachedFrameIndices=s.getBoneCachedFrameIndices(p.name);for(var f=0,u=this._armature.getSlots(),y;f<u.length;f++){if(y=u[f],0<y.displayFrameCount){var c=y.getDisplayFrameAt(0).rawDisplayData;if(null!==c&&c.parent===this._armature.armatureData.defaultSkin){y._cachedFrameIndices=s.getSlotCachedFrameIndices(y.name);continue}}y._cachedFrameIndices=null}}l.advanceTime(e,_)}}else if(1<o){for(var g=0,D=0,l;g<o;++g)l=this._animationStates[g],0<l._fadeState&&0<l._subFadeState?(D++,this._armature._dragonBones.bufferObject(l),this._animationDirty=!0,this._lastAnimationState===l&&(this._lastAnimationState=null)):(0<D&&(this._animationStates[g-D]=l),l.advanceTime(e,0)),g===o-1&&0<D&&(this._animationStates.length-=D,null===this._lastAnimationState&&0<this._animationStates.length&&(this._lastAnimationState=this._animationStates[this._animationStates.length-1]));this._armature._cacheFrameIndex=-1}else this._armature._cacheFrameIndex=-1},t.prototype.reset=function(){for(var e=0,a=this._animationStates,t;e<a.length;e++)t=a[e],t.returnToPool();this._animationDirty=!1,this._animationConfig.clear(),this._animationStates.length=0,this._lastAnimationState=null},t.prototype.stop=function(e){if(void 0===e&&(e=null),null!==e){var a=this.getState(e);null!==a&&a.stop()}else for(var t=0,r=this._animationStates,a;t<r.length;t++)a=r[t],a.stop()},t.prototype.playConfig=function(a){var t=a.animation;if(!(t in this._animations))return console.warn("Non-existent animation.\n","DragonBones name: "+this._armature.armatureData.parent.name,"Armature name: "+this._armature.name,"Animation name: "+t),null;var r=this._animations[t];if(5===a.fadeOutMode)for(var n=0,o=this._animationStates,s;n<o.length;n++)if(s=o[n],1>s._fadeState&&s.layer===a.layer&&s.animationData===r)return s;0===this._animationStates.length?a.fadeInTime=0:0>a.fadeInTime&&(a.fadeInTime=r.fadeInTime),0>a.fadeOutTime&&(a.fadeOutTime=a.fadeInTime),-100>=a.timeScale&&(a.timeScale=1/r.scale),0<r.frameCount?(0>a.position?(a.position%=r.duration,a.position=r.duration-a.position):a.position===r.duration?a.position-=1e-6:a.position>r.duration&&(a.position%=r.duration),0<a.duration&&a.position+a.duration>r.duration&&(a.duration=r.duration-a.position),0>a.playTimes&&(a.playTimes=r.playTimes)):(a.playTimes=1,a.position=0,0<a.duration&&(a.duration=0)),0===a.duration&&(a.duration=-1),this._fadeOut(a);var _=e.BaseObject.borrowObject(e.AnimationState);if(_.init(this._armature,r,a),this._animationDirty=!0,this._armature._cacheFrameIndex=-1,0<this._animationStates.length){for(var d=!1,m=0,p=this._animationStates.length;m<p;++m)if(_.layer>this._animationStates[m].layer){d=!0,this._animationStates.splice(m,0,_);break}else if(m!==p-1&&_.layer>this._animationStates[m+1].layer){d=!0,this._animationStates.splice(m+1,0,_);break}d||this._animationStates.push(_)}else this._animationStates.push(_);for(var l=0,f=this._armature.getSlots();l<f.length;l++){var u=f[l],y=u.childArmature;null!==y&&y.inheritAnimation&&y.animation.hasAnimation(t)&&null===y.animation.getState(t)&&y.animation.fadeIn(t)}for(var c in r.animationTimelines){var g=this.fadeIn(c,0,1,_.layer,"",5);if(null!==g){var D=r.animationTimelines[c];g.actionEnabled=!1,g.resetToPose=!1,g.stop(),_.addState(g,D);var h=this._animationStates.indexOf(_),T=this._animationStates.indexOf(g);T<h&&(this._animationStates.splice(h,1),this._animationStates.splice(T,0,_))}}return this._lastAnimationState=_,_},t.prototype.play=function(e,a){if(void 0===e&&(e=null),void 0===a&&(a=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=a,this._animationConfig.fadeInTime=0,this._animationConfig.animation=null===e?"":e,null!==e&&0<e.length)this.playConfig(this._animationConfig);else if(null===this._lastAnimationState){var t=this._armature.armatureData.defaultAnimation;null!==t&&(this._animationConfig.animation=t.name,this.playConfig(this._animationConfig))}else this._lastAnimationState.isPlaying||this._lastAnimationState.isCompleted?(this._animationConfig.animation=this._lastAnimationState.name,this.playConfig(this._animationConfig)):this._lastAnimationState.play();return this._lastAnimationState},t.prototype.fadeIn=function(e,a,t,r,n,i){return void 0===a&&(a=-1),void 0===t&&(t=-1),void 0===r&&(r=0),void 0===n&&(n=null),void 0===i&&(i=3),this._animationConfig.clear(),this._animationConfig.fadeOutMode=i,this._animationConfig.playTimes=t,this._animationConfig.layer=r,this._animationConfig.fadeInTime=a,this._animationConfig.animation=e,this._animationConfig.group=null===n?"":n,this.playConfig(this._animationConfig)},t.prototype.gotoAndPlayByTime=function(e,a,t){return void 0===a&&(a=0),void 0===t&&(t=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=t,this._animationConfig.position=a,this._animationConfig.fadeInTime=0,this._animationConfig.animation=e,this.playConfig(this._animationConfig)},t.prototype.gotoAndPlayByFrame=function(e,a,t){void 0===a&&(a=0),void 0===t&&(t=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=t,this._animationConfig.fadeInTime=0,this._animationConfig.animation=e;var r=e in this._animations?this._animations[e]:null;return null!==r&&(this._animationConfig.position=0<r.frameCount?r.duration*a/r.frameCount:0),this.playConfig(this._animationConfig)},t.prototype.gotoAndPlayByProgress=function(e,a,t){void 0===a&&(a=0),void 0===t&&(t=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=t,this._animationConfig.fadeInTime=0,this._animationConfig.animation=e;var r=e in this._animations?this._animations[e]:null;return null!==r&&(this._animationConfig.position=r.duration*(0<a?a:0)),this.playConfig(this._animationConfig)},t.prototype.gotoAndStopByTime=function(e,a){void 0===a&&(a=0);var t=this.gotoAndPlayByTime(e,a,1);return null!==t&&t.stop(),t},t.prototype.gotoAndStopByFrame=function(e,a){void 0===a&&(a=0);var t=this.gotoAndPlayByFrame(e,a,1);return null!==t&&t.stop(),t},t.prototype.gotoAndStopByProgress=function(e,a){void 0===a&&(a=0);var t=this.gotoAndPlayByProgress(e,a,1);return null!==t&&t.stop(),t},t.prototype.getBlendState=function(a,t,r){a in this._blendStates||(this._blendStates[a]={});var n=this._blendStates[a];if(!(t in n)){var i=n[t]=e.BaseObject.borrowObject(e.BlendState);i.target=r}return n[t]},t.prototype.getState=function(e,a){void 0===a&&(a=-1);for(var t=this._animationStates.length,r;t--;)if(r=this._animationStates[t],r.name===e&&(0>a||r.layer===a))return r;return null},t.prototype.hasAnimation=function(e){return e in this._animations},t.prototype.getStates=function(){return this._animationStates},Object.defineProperty(t.prototype,"isPlaying",{get:function(){for(var e=0,a=this._animationStates,t;e<a.length;e++)if(t=a[e],t.isPlaying)return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCompleted",{get:function(){for(var e=0,a=this._animationStates,t;e<a.length;e++)if(t=a[e],!t.isCompleted)return!1;return 0<this._animationStates.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastAnimationName",{get:function(){return null===this._lastAnimationState?"":this._lastAnimationState.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animations",{get:function(){return this._animations},set:function(e){if(this._animations!==e){for(var a in this._animationNames.length=0,this._animations)delete this._animations[a];for(var a in e)this._animationNames.push(a),this._animations[a]=e[a]}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationConfig",{get:function(){return this._animationConfig.clear(),this._animationConfig},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:!0,configurable:!0}),t}(e.BaseObject);e.Animation=a})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=Math.floor,t=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._boneMask=[],e._boneTimelines=[],e._boneBlendTimelines=[],e._slotTimelines=[],e._slotBlendTimelines=[],e._constraintTimelines=[],e._animationTimelines=[],e._poseTimelines=[],e._actionTimeline=null,e._zOrderTimeline=null,e}return __extends(n,t),n.toString=function(){return"[class dragonBones.AnimationState]"},n.prototype._onClear=function(){for(var e=0,a=this._boneTimelines,t;e<a.length;e++)t=a[e],t.returnToPool();for(var r=0,n=this._boneBlendTimelines,t;r<n.length;r++)t=n[r],t.returnToPool();for(var i=0,o=this._slotTimelines,t;i<o.length;i++)t=o[i],t.returnToPool();for(var l=0,s=this._slotBlendTimelines,t;l<s.length;l++)t=s[l],t.returnToPool();for(var _=0,d=this._constraintTimelines,t;_<d.length;_++)t=d[_],t.returnToPool();for(var m=0,p=this._animationTimelines;m<p.length;m++){var t=p[m],f=t.target;f._parent===this&&(f._fadeState=1,f._subFadeState=1,f._parent=null),t.returnToPool()}null!==this._actionTimeline&&this._actionTimeline.returnToPool(),null!==this._zOrderTimeline&&this._zOrderTimeline.returnToPool(),this.actionEnabled=!1,this.additive=!1,this.displayControl=!1,this.resetToPose=!1,this.blendType=0,this.playTimes=1,this.layer=0,this.timeScale=1,this._weight=1,this.parameterX=0,this.parameterY=0,this.positionX=0,this.positionY=0,this.autoFadeOutTime=0,this.fadeTotalTime=0,this.name="",this.group="",this._timelineDirty=2,this._playheadState=0,this._fadeState=-1,this._subFadeState=-1,this._position=0,this._duration=0,this._fadeTime=0,this._time=0,this._fadeProgress=0,this._weightResult=0,this._boneMask.length=0,this._boneTimelines.length=0,this._boneBlendTimelines.length=0,this._slotTimelines.length=0,this._slotBlendTimelines.length=0,this._constraintTimelines.length=0,this._animationTimelines.length=0,this._poseTimelines.length=0,this._animationData=null,this._armature=null,this._actionTimeline=null,this._zOrderTimeline=null,this._activeChildA=null,this._activeChildB=null,this._parent=null},n.prototype._updateTimelines=function(){for(var a=0,t=this._armature._constraints;a<t.length;a++){var r=t[a],n=this._animationData.getConstraintTimelines(r.name);if(null!==n)for(var i=0,o=n,l;i<o.length;i++)switch(l=o[i],l.type){case 30:{var s=e.BaseObject.borrowObject(e.IKConstraintTimelineState);s.target=r,s.init(this._armature,this,l),this._constraintTimelines.push(s);break}default:}else if(this.resetToPose){var s=e.BaseObject.borrowObject(e.IKConstraintTimelineState);s.target=r,s.init(this._armature,this,null),this._constraintTimelines.push(s),this._poseTimelines.push(s)}}},n.prototype._updateBoneAndSlotTimelines=function(){{for(var a={},t=0,n=this._boneTimelines;t<n.length;t++){var o=n[t],s=o.target.target.name;s in a||(a[s]=[]),a[s].push(o)}for(var _=0,d=this._boneBlendTimelines;_<d.length;_++){var o=d[_],s=o.target.target.name;s in a||(a[s]=[]),a[s].push(o)}for(var m=0,p=this._armature.getBones();m<p.length;m++){var f=p[m],s=f.name;if(this.containsBoneMask(s))if(s in a)delete a[s];else{var u=this._animationData.getBoneTimelines(s),y=this._armature.animation.getBlendState(r.BONE_TRANSFORM,f.name,f);if(null!==u)for(var c=0,g=u,D;c<g.length;c++)switch(D=g[c],D.type){case 10:{var o=e.BaseObject.borrowObject(e.BoneAllTimelineState);o.target=y,o.init(this._armature,this,D),this._boneTimelines.push(o);break}case 11:{var o=e.BaseObject.borrowObject(e.BoneTranslateTimelineState);o.target=y,o.init(this._armature,this,D),this._boneTimelines.push(o);break}case 12:{var o=e.BaseObject.borrowObject(e.BoneRotateTimelineState);o.target=y,o.init(this._armature,this,D),this._boneTimelines.push(o);break}case 13:{var o=e.BaseObject.borrowObject(e.BoneScaleTimelineState);o.target=y,o.init(this._armature,this,D),this._boneTimelines.push(o);break}case 60:{var o=e.BaseObject.borrowObject(e.AlphaTimelineState);o.target=this._armature.animation.getBlendState(r.BONE_ALPHA,f.name,f),o.init(this._armature,this,D),this._boneBlendTimelines.push(o);break}case 50:{var o=e.BaseObject.borrowObject(e.SurfaceTimelineState);o.target=this._armature.animation.getBlendState(r.SURFACE,f.name,f),o.init(this._armature,this,D),this._boneBlendTimelines.push(o);break}default:}else if(this.resetToPose)if(0===f._boneData.type){var o=e.BaseObject.borrowObject(e.BoneAllTimelineState);o.target=y,o.init(this._armature,this,null),this._boneTimelines.push(o),this._poseTimelines.push(o)}else{var o=e.BaseObject.borrowObject(e.SurfaceTimelineState);o.target=this._armature.animation.getBlendState(r.SURFACE,f.name,f),o.init(this._armature,this,null),this._boneBlendTimelines.push(o),this._poseTimelines.push(o)}}}for(var h in a)for(var T=0,b=a[h];T<b.length;T++){var o=b[T],A=this._boneTimelines.indexOf(o);0<=A&&(this._boneTimelines.splice(A,1),o.returnToPool()),A=this._boneBlendTimelines.indexOf(o),0<=A&&(this._boneBlendTimelines.splice(A,1),o.returnToPool())}}{for(var S={},P=[],O=0,x=this._slotTimelines;O<x.length;O++){var o=x[O],s=o.target.name;s in S||(S[s]=[]),S[s].push(o)}for(var E=0,B=this._slotBlendTimelines;E<B.length;E++){var o=B[E],s=o.target.target.name;s in S||(S[s]=[]),S[s].push(o)}for(var I=0,F=this._armature.getSlots();I<F.length;I++){var C=F[I],M=C.parent.name;if(this.containsBoneMask(M)){var s=C.name;if(s in S)delete S[s];else{var N=!1,w=!1;P.length=0;var u=this._animationData.getSlotTimelines(s);if(null!==u)for(var v=0,R=u,D;v<R.length;v++)switch(D=R[v],D.type){case 20:{var o=e.BaseObject.borrowObject(e.SlotDislayTimelineState);o.target=C,o.init(this._armature,this,D),this._slotTimelines.push(o),N=!0;break}case 23:{var o=e.BaseObject.borrowObject(e.SlotZIndexTimelineState);o.target=this._armature.animation.getBlendState(r.SLOT_Z_INDEX,C.name,C),o.init(this._armature,this,D),this._slotBlendTimelines.push(o);break}case 21:{var o=e.BaseObject.borrowObject(e.SlotColorTimelineState);o.target=C,o.init(this._armature,this,D),this._slotTimelines.push(o),w=!0;break}case 22:{var o=e.BaseObject.borrowObject(e.DeformTimelineState);o.target=this._armature.animation.getBlendState(r.SLOT_DEFORM,C.name,C),o.init(this._armature,this,D),null===o.target?o.returnToPool():(this._slotBlendTimelines.push(o),P.push(o.geometryOffset));break}case 24:{var o=e.BaseObject.borrowObject(e.AlphaTimelineState);o.target=this._armature.animation.getBlendState(r.SLOT_ALPHA,C.name,C),o.init(this._armature,this,D),this._slotBlendTimelines.push(o);break}default:}if(this.resetToPose){if(!N){var o=e.BaseObject.borrowObject(e.SlotDislayTimelineState);o.target=C,o.init(this._armature,this,null),this._slotTimelines.push(o),this._poseTimelines.push(o)}if(!w){var o=e.BaseObject.borrowObject(e.SlotColorTimelineState);o.target=C,o.init(this._armature,this,null),this._slotTimelines.push(o),this._poseTimelines.push(o)}for(var j=0,L=C.displayFrameCount,l;j<L;++j)if(l=C.getDisplayFrameAt(j),0!==l.deformVertices.length){var V=l.getGeometryData();if(null!==V&&0>P.indexOf(V.offset)){var o=e.BaseObject.borrowObject(e.DeformTimelineState);o.geometryOffset=V.offset,o.displayFrame=l,o.target=this._armature.animation.getBlendState(r.SLOT_DEFORM,C.name,C),o.init(this._armature,this,null),this._slotBlendTimelines.push(o),this._poseTimelines.push(o)}}}}}}for(var h in S)for(var Y=0,U=S[h];Y<U.length;Y++){var o=U[Y],A=this._slotTimelines.indexOf(o);0<=A&&(this._slotTimelines.splice(A,1),o.returnToPool()),A=this._slotBlendTimelines.indexOf(o),0<=A&&(this._slotBlendTimelines.splice(A,1),o.returnToPool())}}},n.prototype._advanceFadeTime=function(a){var t=0<this._fadeState;if(0>this._subFadeState){this._subFadeState=0;var r=null===this._parent&&this.actionEnabled;if(r){var n=t?e.EventObject.FADE_OUT:e.EventObject.FADE_IN;if(this._armature.eventDispatcher.hasDBEventListener(n)){var i=e.BaseObject.borrowObject(e.EventObject);i.type=n,i.armature=this._armature,i.animationState=this,this._armature._dragonBones.bufferEvent(i)}}}if(0>a&&(a=-a),this._fadeTime+=a,this._fadeTime>=this.fadeTotalTime?(this._subFadeState=1,this._fadeProgress=t?0:1):0<this._fadeTime?this._fadeProgress=t?1-this._fadeTime/this.fadeTotalTime:this._fadeTime/this.fadeTotalTime:this._fadeProgress=t?1:0,0<this._subFadeState){t||(this._playheadState|=1,this._fadeState=0);var r=null===this._parent&&this.actionEnabled;if(r){var n=t?e.EventObject.FADE_OUT_COMPLETE:e.EventObject.FADE_IN_COMPLETE;if(this._armature.eventDispatcher.hasDBEventListener(n)){var i=e.BaseObject.borrowObject(e.EventObject);i.type=n,i.armature=this._armature,i.animationState=this,this._armature._dragonBones.bufferEvent(i)}}}},n.prototype.init=function(a,t,r){if(null===this._armature){if(this._armature=a,this._animationData=t,this.resetToPose=r.resetToPose,this.additive=r.additive,this.displayControl=r.displayControl,this.actionEnabled=r.actionEnabled,this.blendType=t.blendType,this.layer=r.layer,this.playTimes=r.playTimes,this.timeScale=r.timeScale,this.fadeTotalTime=r.fadeInTime,this.autoFadeOutTime=r.autoFadeOutTime,this.name=0<r.name.length?r.name:r.animation,this.group=r.group,this._weight=r.weight,this._playheadState=r.pauseFadeIn?2:3,0>r.duration?(this._position=0,this._duration=this._animationData.duration,this._time=0===r.position?0:0<=this.timeScale?r.position:r.position-this._duration):(this._position=r.position,this._duration=r.duration,this._time=0),0>this.timeScale&&0===this._time&&(this._time=-1e-6),0>=this.fadeTotalTime&&(this._fadeProgress=.999999),0<r.boneMask.length){this._boneMask.length=r.boneMask.length;for(var n=0,o=this._boneMask.length;n<o;++n)this._boneMask[n]=r.boneMask[n]}this._actionTimeline=e.BaseObject.borrowObject(e.ActionTimelineState),this._actionTimeline.init(this._armature,this,this._animationData.actionTimeline),this._actionTimeline.currentTime=this._time,0>this._actionTimeline.currentTime&&(this._actionTimeline.currentTime=this._duration-this._actionTimeline.currentTime),null!==this._animationData.zOrderTimeline&&(this._zOrderTimeline=e.BaseObject.borrowObject(e.ZOrderTimelineState),this._zOrderTimeline.init(this._armature,this,this._animationData.zOrderTimeline))}},n.prototype.advanceTime=function(e,t){(0!==this._fadeState||0!==this._subFadeState)&&this._advanceFadeTime(e),3===this._playheadState&&(1!==this.timeScale&&(e*=this.timeScale),this._time+=e),0!==this._timelineDirty&&(2===this._timelineDirty&&this._updateTimelines(),this._timelineDirty=0,this._updateBoneAndSlotTimelines());var r=0!==this._fadeState||0===this._subFadeState,n=0===this._fadeState&&0<t,o=!0,s=!0,_=this._time;if(this._weightResult=this._weight*this._fadeProgress,null!==this._parent&&(this._weightResult*=this._parent._weightResult),0>=this._actionTimeline.playState&&this._actionTimeline.update(_),0!==this._weight){if(n){var m=2*t;this._actionTimeline.currentTime=a(this._actionTimeline.currentTime*m)/m}if(null!==this._zOrderTimeline&&0>=this._zOrderTimeline.playState&&this._zOrderTimeline.update(_),n){var p=a(this._actionTimeline.currentTime*t);this._armature._cacheFrameIndex===p?(o=!1,s=!1):(this._armature._cacheFrameIndex=p,this._animationData.cachedFrames[p]?s=!1:this._animationData.cachedFrames[p]=!0)}if(o){var f=!1,u=null;if(s)for(var y=0,c=this._boneTimelines.length,g;y<c;++y){if(g=this._boneTimelines[y],0>=g.playState&&g.update(_),g.target!==u){var D=g.target;if(f=D.update(this),u=D,1===D.dirty){var h=D.target.animationPose;h.x=0,h.y=0,h.rotation=0,h.skew=0,h.scaleX=1,h.scaleY=1}}f&&g.blend(r)}for(var y=0,c=this._boneBlendTimelines.length,g;y<c;++y)g=this._boneBlendTimelines[y],0>=g.playState&&g.update(_),g.target.update(this)&&g.blend(r);if(this.displayControl)for(var y=0,c=this._slotTimelines.length,g;y<c;++y)if(g=this._slotTimelines[y],0>=g.playState){var T=g.target,b=T.displayController;(null===b||b===this.name||b===this.group)&&g.update(_)}for(var y=0,c=this._slotBlendTimelines.length,g;y<c;++y)if(g=this._slotBlendTimelines[y],0>=g.playState){var D=g.target;g.update(_),D.update(this)&&g.blend(r)}for(var y=0,c=this._constraintTimelines.length,g;y<c;++y)g=this._constraintTimelines[y],0>=g.playState&&g.update(_);if(0<this._animationTimelines.length){for(var A=100,S=100,P=null,O=null,y=0,c=this._animationTimelines.length,g;y<c;++y)if(g=this._animationTimelines[y],0>=g.playState&&g.update(_),1===this.blendType){var x=g.target,E=this.parameterX-x.positionX;0<=E?E<A&&(A=E,P=x):-E<S&&(S=-E,O=x)}null!==P&&(this._activeChildA!==P&&(null!==this._activeChildA&&(this._activeChildA.weight=0),this._activeChildA=P,this._activeChildA.activeTimeline()),this._activeChildB!==O&&(null!==this._activeChildB&&(this._activeChildB.weight=0),this._activeChildB=O),P.weight=S/(A+S),O&&(O.weight=1-P.weight))}}if(0===this._fadeState){if(0<this._subFadeState&&(this._subFadeState=0,0<this._poseTimelines.length)){for(var d=0,B=this._poseTimelines;d<B.length;d++){var g=B[d],I=this._boneTimelines.indexOf(g);if(0<=I){this._boneTimelines.splice(I,1),g.returnToPool();continue}if(I=this._boneBlendTimelines.indexOf(g),0<=I){this._boneBlendTimelines.splice(I,1),g.returnToPool();continue}if(I=this._slotTimelines.indexOf(g),0<=I){this._slotTimelines.splice(I,1),g.returnToPool();continue}if(I=this._slotBlendTimelines.indexOf(g),0<=I){this._slotBlendTimelines.splice(I,1),g.returnToPool();continue}if(I=this._constraintTimelines.indexOf(g),0<=I){this._constraintTimelines.splice(I,1),g.returnToPool();continue}}this._poseTimelines.length=0}0<this._actionTimeline.playState&&0<=this.autoFadeOutTime&&this.fadeOut(this.autoFadeOutTime)}}},n.prototype.play=function(){this._playheadState=3},n.prototype.stop=function(){this._playheadState&=1},n.prototype.fadeOut=function(e,a){if(void 0===a&&(a=!0),0>e&&(e=0),a&&(this._playheadState&=2),!(0<this._fadeState)){this._fadeState=1,this._subFadeState=-1,(0>=e||0>=this._fadeProgress)&&(this._fadeProgress=1e-6);for(var t=0,r=this._boneTimelines,n;t<r.length;t++)n=r[t],n.fadeOut();for(var i=0,o=this._boneBlendTimelines,n;i<o.length;i++)n=o[i],n.fadeOut();for(var l=0,s=this._slotTimelines,n;l<s.length;l++)n=s[l],n.fadeOut();for(var _=0,d=this._slotBlendTimelines,n;_<d.length;_++)n=d[_],n.fadeOut();for(var m=0,p=this._constraintTimelines,n;m<p.length;m++)n=p[m],n.fadeOut();for(var f=0,u=this._animationTimelines,n;f<u.length;f++){n=u[f],n.fadeOut();var y=n.target;y.fadeOut(999999,!0)}}else if(e>this.fadeTotalTime-this._fadeTime)return;this.displayControl=!1,this.fadeTotalTime=1e-6<this._fadeProgress?e/this._fadeProgress:0,this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)},n.prototype.containsBoneMask=function(e){return 0===this._boneMask.length||0<=this._boneMask.indexOf(e)},n.prototype.addBoneMask=function(e,a){void 0===a&&(a=!0);var t=this._armature.getBone(e);if(null!==t){if(0>this._boneMask.indexOf(e)&&this._boneMask.push(e),a)for(var r=0,n=this._armature.getBones(),i;r<n.length;r++)i=n[r],0>this._boneMask.indexOf(i.name)&&t.contains(i)&&this._boneMask.push(i.name);this._timelineDirty=1}},n.prototype.removeBoneMask=function(e,a){void 0===a&&(a=!0);var t=this._boneMask.indexOf(e);if(0<=t&&this._boneMask.splice(t,1),a){var r=this._armature.getBone(e);if(null!==r){var n=this._armature.getBones();if(0<this._boneMask.length)for(var i=0,o=n;i<o.length;i++){var l=o[i],s=this._boneMask.indexOf(l.name);0<=s&&r.contains(l)&&this._boneMask.splice(s,1)}else for(var _=0,d=n,l;_<d.length;_++)(l=d[_],l!==r)&&(r.contains(l)||this._boneMask.push(l.name))}}this._timelineDirty=1},n.prototype.removeAllBoneMask=function(){this._boneMask.length=0,this._timelineDirty=1},n.prototype.addState=function(a,t){if(void 0===t&&(t=null),null!==t)for(var r=0,n=t,i;r<n.length;r++)switch(i=n[r],i.type){case 40:{var o=e.BaseObject.borrowObject(e.AnimationProgressTimelineState);if(o.target=a,o.init(this._armature,this,i),this._animationTimelines.push(o),0!==this.blendType){var l=i;a.positionX=l.x,a.positionY=l.y,a.weight=0}a._parent=this,this.resetToPose=!1;break}case 41:{var o=e.BaseObject.borrowObject(e.AnimationWeightTimelineState);o.target=a,o.init(this._armature,this,i),this._animationTimelines.push(o);break}case 42:{var o=e.BaseObject.borrowObject(e.AnimationParametersTimelineState);o.target=a,o.init(this._armature,this,i),this._animationTimelines.push(o);break}default:}null===a._parent&&(a._parent=this)},n.prototype.activeTimeline=function(){for(var e=0,a=this._slotTimelines,t;e<a.length;e++)t=a[e],t.dirty=!0,t.currentTime=-1},Object.defineProperty(n.prototype,"isFadeIn",{get:function(){return 0>this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isFadeOut",{get:function(){return 0<this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isFadeComplete",{get:function(){return 0===this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isPlaying",{get:function(){return 0!=(2&this._playheadState)&&0>=this._actionTimeline.playState},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isCompleted",{get:function(){return 0<this._actionTimeline.playState},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"currentPlayTimes",{get:function(){return this._actionTimeline.currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"totalTime",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"currentTime",{get:function(){return this._actionTimeline.currentTime},set:function(e){var a=this._actionTimeline.currentPlayTimes-(0<this._actionTimeline.playState?1:0);if((0>e||this._duration<e)&&(e=e%this._duration+a*this._duration,0>e&&(e+=this._duration)),0<this.playTimes&&a==this.playTimes-1&&e===this._duration&&null===this._parent&&(e=this._duration-1e-6),this._time!==e){this._time=e,this._actionTimeline.setCurrentTime(this._time),null!==this._zOrderTimeline&&(this._zOrderTimeline.playState=-1);for(var t=0,r=this._boneTimelines,n;t<r.length;t++)n=r[t],n.playState=-1;for(var i=0,o=this._slotTimelines,n;i<o.length;i++)n=o[i],n.playState=-1}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"weight",{get:function(){return this._weight},set:function(e){if(this._weight!==e){this._weight=e;for(var a=0,t=this._boneTimelines,r;a<t.length;a++)r=t[a],r.dirty=!0;for(var n=0,i=this._boneBlendTimelines,r;n<i.length;n++)r=i[n],r.dirty=!0;for(var o=0,l=this._slotBlendTimelines,r;o<l.length;o++)r=l[o],r.dirty=!0}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animationData",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),n}(e.BaseObject);e.AnimationState=t;var r=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.BlendState]"},a.prototype._onClear=function(){this.reset(),this.target=null},a.prototype.update=function(e){var a=e.layer,t=e._weightResult;if(0<this.dirty){if(0<this.leftWeight){if(this.layer!==a){if(this.layerWeight>=this.leftWeight)return this.dirty++,this.layer=a,this.leftWeight=0,this.blendWeight=0,!1;this.layer=a,this.leftWeight-=this.layerWeight,this.layerWeight=0}return t*=this.leftWeight,this.dirty++,this.blendWeight=t,this.layerWeight+=this.blendWeight,!0}return!1}return this.dirty++,this.layer=a,this.leftWeight=1,this.blendWeight=t,this.layerWeight=t,!0},a.prototype.reset=function(){this.dirty=0,this.layer=0,this.leftWeight=0,this.layerWeight=0,this.blendWeight=0},a.BONE_TRANSFORM="boneTransform",a.BONE_ALPHA="boneAlpha",a.SURFACE="surface",a.SLOT_DEFORM="slotDeform",a.SLOT_ALPHA="slotAlpha",a.SLOT_Z_INDEX="slotZIndex",a}(e.BaseObject);e.BlendState=r})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=Math.pow,t=Math.floor,r=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.prototype._onClear=function(){this.dirty=!1,this.playState=-1,this.currentPlayTimes=-1,this.currentTime=-1,this.target=null,this._isTween=!1,this._valueOffset=0,this._frameValueOffset=0,this._frameOffset=0,this._frameRate=0,this._frameCount=0,this._frameIndex=-1,this._frameRateR=0,this._position=0,this._duration=0,this._timeScale=1,this._timeOffset=0,this._animationData=null,this._timelineData=null,this._armature=null,this._animationState=null,this._actionTimeline=null,this._frameArray=null,this._valueArray=null,this._timelineArray=null,this._frameIndices=null},a.prototype._setCurrentTime=function(e){var a=this.playState,r=this.currentPlayTimes,n=this.currentTime;if(null!==this._actionTimeline&&1>=this._frameCount)this.playState=0<=this._actionTimeline.playState?1:-1,this.currentPlayTimes=1,this.currentTime=this._actionTimeline.currentTime;else if(null===this._actionTimeline||1!==this._timeScale||0!==this._timeOffset){var i=this._animationState.playTimes,o=i*this._duration;e*=this._timeScale,0!==this._timeOffset&&(e+=this._timeOffset*this._animationData.duration),0<i&&(e>=o||e<=-o)?(0>=this.playState&&3===this._animationState._playheadState&&(this.playState=1),this.currentPlayTimes=i,this.currentTime=0>e?0:this._duration+1e-6):(0!==this.playState&&3===this._animationState._playheadState&&(this.playState=0),0>e?(e=-e,this.currentPlayTimes=t(e/this._duration),this.currentTime=this._duration-e%this._duration):(this.currentPlayTimes=t(e/this._duration),this.currentTime=e%this._duration)),this.currentTime+=this._position}else this.playState=this._actionTimeline.playState,this.currentPlayTimes=this._actionTimeline.currentPlayTimes,this.currentTime=this._actionTimeline.currentTime;return(this.currentPlayTimes!==r||this.currentTime!==n)&&((0>a&&this.playState!==a||0>=this.playState&&this.currentPlayTimes!==r)&&(this._frameIndex=-1),!0)},a.prototype.init=function(e,a,t){if(this._armature=e,this._animationState=a,this._timelineData=t,this._actionTimeline=this._animationState._actionTimeline,this===this._actionTimeline&&(this._actionTimeline=null),this._animationData=this._animationState.animationData,this._frameRate=this._animationData.parent.frameRate,this._frameRateR=1/this._frameRate,this._position=this._animationState._position,this._duration=this._animationState._duration,null!==this._timelineData){var r=this._animationData.parent.parent;this._frameArray=r.frameArray,this._timelineArray=r.timelineArray,this._frameIndices=r.frameIndices,this._frameCount=this._timelineArray[this._timelineData.offset+2],this._frameValueOffset=this._timelineArray[this._timelineData.offset+4],this._timeScale=100/this._timelineArray[this._timelineData.offset+0],this._timeOffset=.01*this._timelineArray[this._timelineData.offset+1]}},a.prototype.fadeOut=function(){this.dirty=!1},a.prototype.update=function(e){if(this._setCurrentTime(e)){if(1<this._frameCount){var a=t(this.currentTime*this._frameRate),r=this._frameIndices[this._timelineData.frameIndicesOffset+a];this._frameIndex!==r&&(this._frameIndex=r,this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex],this._onArriveAtFrame())}else 0>this._frameIndex&&(this._frameIndex=0,null!==this._timelineData&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5]),this._onArriveAtFrame());(this._isTween||this.dirty)&&this._onUpdateFrame()}},a.prototype.blend=function(){},a}(e.BaseObject);e.TimelineState=r;var n=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r._getEasingValue=function(e,t,r){var n=t;return 3===e?n=a(t,2):4===e?n=1-a(1-t,2):5===e?n=.5*(1-Math.cos(t*Math.PI)):void 0,(n-t)*r+t},r._getEasingCurveValue=function(e,a,r,n){if(0>=e)return 0;if(1<=e)return 1;var i=r+1,o=t(e*i),l=0,s=0;return 0<r?(l=0===o?0:a[n+o-1],s=o===i-1?1e4:a[n+o]):(l=a[n+o-1],s=a[n+o]),1e-4*(l+(s-l)*(e*i-o))},r.prototype._onClear=function(){e.prototype._onClear.call(this),this._tweenType=0,this._curveCount=0,this._framePosition=0,this._frameDurationR=0,this._tweenEasing=0,this._tweenProgress=0,this._valueScale=1},r.prototype._onArriveAtFrame=function(){if(!(1<this._frameCount&&(this._frameIndex!==this._frameCount-1||0===this._animationState.playTimes||this._animationState.currentPlayTimes<this._animationState.playTimes-1)))this.dirty=!0,this._isTween=!1;else if(this._tweenType=this._frameArray[this._frameOffset+1],this._isTween=0!==this._tweenType,this._isTween?2===this._tweenType?this._curveCount=this._frameArray[this._frameOffset+2]:0!==this._tweenType&&1!==this._tweenType&&(this._tweenEasing=.01*this._frameArray[this._frameOffset+2]):this.dirty=!0,this._framePosition=this._frameArray[this._frameOffset]*this._frameRateR,this._frameIndex===this._frameCount-1)this._frameDurationR=1/(this._animationData.duration-this._framePosition);else{var e=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex+1],a=this._frameArray[e]*this._frameRateR-this._framePosition;this._frameDurationR=0<a?1/a:0}},r.prototype._onUpdateFrame=function(){this._isTween&&(this.dirty=!0,this._tweenProgress=(this.currentTime-this._framePosition)*this._frameDurationR,2===this._tweenType?this._tweenProgress=r._getEasingCurveValue(this._tweenProgress,this._frameArray,this._curveCount,this._frameOffset+3):1!==this._tweenType&&(this._tweenProgress=r._getEasingValue(this._tweenType,this._tweenProgress,this._tweenEasing)))},r}(r);e.TweenTimelineState=n;var i=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.prototype._onClear=function(){e.prototype._onClear.call(this),this._current=0,this._difference=0,this._result=0},a.prototype._onArriveAtFrame=function(){if(e.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var a=this._valueScale,t=this._valueArray,r=this._valueOffset+this._frameValueOffset+this._frameIndex;if(this._isTween){var n=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:r+1;1===a?(this._current=t[r],this._difference=t[n]-this._current):(this._current=t[r]*a,this._difference=t[n]*a-this._current)}else this._result=t[r]*a}else this._result=0},a.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this),this._isTween&&(this._result=this._current+this._difference*this._tweenProgress)},a}(n);e.SingleValueTimelineState=i;var o=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.prototype._onClear=function(){e.prototype._onClear.call(this),this._currentA=0,this._currentB=0,this._differenceA=0,this._differenceB=0,this._resultA=0,this._resultB=0},a.prototype._onArriveAtFrame=function(){if(e.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var a=this._valueScale,t=this._valueArray,r=this._valueOffset+this._frameValueOffset+2*this._frameIndex;if(this._isTween){var n=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:r+2;1===a?(this._currentA=t[r],this._currentB=t[r+1],this._differenceA=t[n]-this._currentA,this._differenceB=t[n+1]-this._currentB):(this._currentA=t[r]*a,this._currentB=t[r+1]*a,this._differenceA=t[n]*a-this._currentA,this._differenceB=t[n+1]*a-this._currentB)}else this._resultA=t[r]*a,this._resultB=t[r+1]*a}else this._resultA=0,this._resultB=0},a.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this),this._isTween&&(this._resultA=this._currentA+this._differenceA*this._tweenProgress,this._resultB=this._currentB+this._differenceB*this._tweenProgress)},a}(n);e.DoubleValueTimelineState=o;var l=function(e){function a(){var a=null!==e&&e.apply(this,arguments)||this;return a._rd=[],a}return __extends(a,e),a.prototype._onClear=function(){e.prototype._onClear.call(this),this._valueCount=0,this._rd.length=0},a.prototype._onArriveAtFrame=function(){e.prototype._onArriveAtFrame.call(this);var a=this._valueCount,t=this._rd;if(null!==this._timelineData){var r=this._valueScale,n=this._valueArray,o=this._valueOffset+this._frameValueOffset+this._frameIndex*a;if(this._isTween){var l=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:o+a;if(1===r)for(var s=0;s<a;++s)t[a+s]=n[l+s]-n[o+s];else for(var s=0;s<a;++s)t[a+s]=(n[l+s]-n[o+s])*r}else if(1===r)for(var s=0;s<a;++s)t[s]=n[o+s];else for(var s=0;s<a;++s)t[s]=n[o+s]*r}else for(var s=0;s<a;++s)t[s]=0},a.prototype._onUpdateFrame=function(){if(e.prototype._onUpdateFrame.call(this),this._isTween){var a=this._valueCount,t=this._valueScale,r=this._tweenProgress,n=this._valueArray,o=this._rd,l=this._valueOffset+this._frameValueOffset+this._frameIndex*a;if(1===t)for(var s=0;s<a;++s)o[s]=n[l+s]+o[a+s]*r;else for(var s=0;s<a;++s)o[s]=n[l+s]*t+o[a+s]*r}},a}(n);e.MutilpleValueTimelineState=l})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=Math.floor,t=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return __extends(r,t),r.toString=function(){return"[class dragonBones.ActionTimelineState]"},r.prototype._onCrossFrame=function(a){var t=this._armature.eventDispatcher;if(this._animationState.actionEnabled)for(var r=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+a],n=this._frameArray[r+1],o=this._animationData.parent.actions,l=0;l<n;++l){var s=this._frameArray[r+2+l],_=o[s];if(0===_.type){var d=e.BaseObject.borrowObject(e.EventObject);d.time=this._frameArray[r]/this._frameRate,d.animationState=this._animationState,e.EventObject.actionDataToInstance(_,d,this._armature),this._armature._bufferAction(d,!0)}else{var m=10===_.type?e.EventObject.FRAME_EVENT:e.EventObject.SOUND_EVENT;if(11===_.type||t.hasDBEventListener(m)){var d=e.BaseObject.borrowObject(e.EventObject);d.time=this._frameArray[r]/this._frameRate,d.animationState=this._animationState,e.EventObject.actionDataToInstance(_,d,this._armature),this._armature._dragonBones.bufferEvent(d)}}}},r.prototype._onArriveAtFrame=function(){},r.prototype._onUpdateFrame=function(){},r.prototype.update=function(t){var r=this.playState,n=this.currentPlayTimes,i=this.currentTime;if(this._setCurrentTime(t)){var o=null===this._animationState._parent&&this._animationState.actionEnabled,l=this._armature.eventDispatcher;if(0>r){if(this.playState===r)return;if(this._animationState.displayControl&&this._animationState.resetToPose&&this._armature._sortZOrder(null,0),n=this.currentPlayTimes,o&&l.hasDBEventListener(e.EventObject.START)){var s=e.BaseObject.borrowObject(e.EventObject);s.type=e.EventObject.START,s.armature=this._armature,s.animationState=this._animationState,this._armature._dragonBones.bufferEvent(s)}}var _=0>this._animationState.timeScale,d=null,m=null;if(o&&this.currentPlayTimes!==n&&(l.hasDBEventListener(e.EventObject.LOOP_COMPLETE)&&(d=e.BaseObject.borrowObject(e.EventObject),d.type=e.EventObject.LOOP_COMPLETE,d.armature=this._armature,d.animationState=this._animationState),0<this.playState&&l.hasDBEventListener(e.EventObject.COMPLETE)&&(m=e.BaseObject.borrowObject(e.EventObject),m.type=e.EventObject.COMPLETE,m.armature=this._armature,m.animationState=this._animationState)),1<this._frameCount){var p=this._timelineData,f=a(this.currentTime*this._frameRate),u=this._frameIndices[p.frameIndicesOffset+f];if(this._frameIndex!==u){var y=this._frameIndex;if(this._frameIndex=u,null!==this._timelineArray)if(this._frameOffset=this._animationData.frameOffset+this._timelineArray[p.offset+5+this._frameIndex],_){if(0>y){var c=a(i*this._frameRate);y=this._frameIndices[p.frameIndicesOffset+c],this.currentPlayTimes===n&&y===u&&(y=-1)}for(;0<=y;){var g=this._animationData.frameOffset+this._timelineArray[p.offset+5+y],D=this._frameArray[g]/this._frameRate;if(this._position<=D&&D<=this._position+this._duration&&this._onCrossFrame(y),null!==d&&0===y&&(this._armature._dragonBones.bufferEvent(d),d=null),0<y?y--:y=this._frameCount-1,y===u)break}}else{if(0>y){var c=a(i*this._frameRate);y=this._frameIndices[p.frameIndicesOffset+c];var g=this._animationData.frameOffset+this._timelineArray[p.offset+5+y],D=this._frameArray[g]/this._frameRate;this.currentPlayTimes===n&&(i<=D?0<y?y--:y=this._frameCount-1:y===u&&(y=-1))}for(;0<=y;){y<this._frameCount-1?y++:y=0;var g=this._animationData.frameOffset+this._timelineArray[p.offset+5+y],D=this._frameArray[g]/this._frameRate;if(this._position<=D&&D<=this._position+this._duration&&this._onCrossFrame(y),null!==d&&0===y&&(this._armature._dragonBones.bufferEvent(d),d=null),y===u)break}}}}else if(0>this._frameIndex&&(this._frameIndex=0,null!==this._timelineData)){this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5];var D=this._frameArray[this._frameOffset]/this._frameRate;this.currentPlayTimes===n?i<=D&&this._onCrossFrame(this._frameIndex):this._position<=D&&(!_&&null!==d&&(this._armature._dragonBones.bufferEvent(d),d=null),this._onCrossFrame(this._frameIndex))}null!==d&&this._armature._dragonBones.bufferEvent(d),null!==m&&this._armature._dragonBones.bufferEvent(m)}},r.prototype.setCurrentTime=function(e){this._setCurrentTime(e),this._frameIndex=-1},r}(e.TimelineState);e.ActionTimelineState=t;var r=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.ZOrderTimelineState]"},a.prototype._onArriveAtFrame=function(){if(0<=this.playState){var e=this._frameArray[this._frameOffset+1];0<e?this._armature._sortZOrder(this._frameArray,this._frameOffset+2):this._armature._sortZOrder(null,0)}},a.prototype._onUpdateFrame=function(){},a}(e.TimelineState);e.ZOrderTimelineState=r;var n=function(a){function t(){return null!==a&&a.apply(this,arguments)||this}return __extends(t,a),t.toString=function(){return"[class dragonBones.BoneAllTimelineState]"},t.prototype._onArriveAtFrame=function(){a.prototype._onArriveAtFrame.call(this),this._isTween&&this._frameIndex===this._frameCount-1&&(this._rd[2]=e.Transform.normalizeRadian(this._rd[2]),this._rd[3]=e.Transform.normalizeRadian(this._rd[3])),null===this._timelineData&&(this._rd[4]=1,this._rd[5]=1)},t.prototype.init=function(e,t,r){a.prototype.init.call(this,e,t,r),this._valueOffset=this._animationData.frameFloatOffset,this._valueCount=6,this._valueArray=this._animationData.parent.parent.frameFloatArray},t.prototype.fadeOut=function(){this.dirty=!1,this._rd[2]=e.Transform.normalizeRadian(this._rd[2]),this._rd[3]=e.Transform.normalizeRadian(this._rd[3])},t.prototype.blend=function(e){var a=this._armature.armatureData.scale,t=this._rd,r=this.target,n=r.target,i=r.blendWeight,o=n.animationPose;1<r.dirty?(o.x+=t[0]*i*a,o.y+=t[1]*i*a,o.rotation+=t[2]*i,o.skew+=t[3]*i,o.scaleX+=(t[4]-1)*i,o.scaleY+=(t[5]-1)*i):(o.x=t[0]*i*a,o.y=t[1]*i*a,o.rotation=t[2]*i,o.skew=t[3]*i,o.scaleX=(t[4]-1)*i+1,o.scaleY=(t[5]-1)*i+1),(e||this.dirty)&&(this.dirty=!1,n._transformDirty=!0)},t}(e.MutilpleValueTimelineState);e.BoneAllTimelineState=n;var i=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.BoneTranslateTimelineState]"},a.prototype.init=function(a,t,r){e.prototype.init.call(this,a,t,r),this._valueOffset=this._animationData.frameFloatOffset,this._valueScale=this._armature.armatureData.scale,this._valueArray=this._animationData.parent.parent.frameFloatArray},a.prototype.blend=function(e){var a=this.target,t=a.target,r=a.blendWeight,n=t.animationPose;1<a.dirty?(n.x+=this._resultA*r,n.y+=this._resultB*r):1===r?(n.x=this._resultA,n.y=this._resultB):(n.x=this._resultA*r,n.y=this._resultB*r),(e||this.dirty)&&(this.dirty=!1,t._transformDirty=!0)},a}(e.DoubleValueTimelineState);e.BoneTranslateTimelineState=i;var o=function(a){function t(){return null!==a&&a.apply(this,arguments)||this}return __extends(t,a),t.toString=function(){return"[class dragonBones.BoneRotateTimelineState]"},t.prototype._onArriveAtFrame=function(){a.prototype._onArriveAtFrame.call(this),this._isTween&&this._frameIndex===this._frameCount-1&&(this._differenceA=e.Transform.normalizeRadian(this._differenceA),this._differenceB=e.Transform.normalizeRadian(this._differenceB))},t.prototype.init=function(e,t,r){a.prototype.init.call(this,e,t,r),this._valueOffset=this._animationData.frameFloatOffset,this._valueArray=this._animationData.parent.parent.frameFloatArray},t.prototype.fadeOut=function(){this.dirty=!1,this._resultA=e.Transform.normalizeRadian(this._resultA),this._resultB=e.Transform.normalizeRadian(this._resultB)},t.prototype.blend=function(e){var a=this.target,t=a.target,r=a.blendWeight,n=t.animationPose;1<a.dirty?(n.rotation+=this._resultA*r,n.skew+=this._resultB*r):1===r?(n.rotation=this._resultA,n.skew=this._resultB):(n.rotation=this._resultA*r,n.skew=this._resultB*r),(e||this.dirty)&&(this.dirty=!1,t._transformDirty=!0)},t}(e.DoubleValueTimelineState);e.BoneRotateTimelineState=o;var l=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.BoneScaleTimelineState]"},a.prototype._onArriveAtFrame=function(){e.prototype._onArriveAtFrame.call(this),null===this._timelineData&&(this._resultA=1,this._resultB=1)},a.prototype.init=function(a,t,r){e.prototype.init.call(this,a,t,r),this._valueOffset=this._animationData.frameFloatOffset,this._valueArray=this._animationData.parent.parent.frameFloatArray},a.prototype.blend=function(e){var a=this.target,t=a.target,r=a.blendWeight,n=t.animationPose;1<a.dirty?(n.scaleX+=(this._resultA-1)*r,n.scaleY+=(this._resultB-1)*r):1===r?(n.scaleX=this._resultA,n.scaleY=this._resultB):(n.scaleX=(this._resultA-1)*r+1,n.scaleY=(this._resultB-1)*r+1),(e||this.dirty)&&(this.dirty=!1,t._transformDirty=!0)},a}(e.DoubleValueTimelineState);e.BoneScaleTimelineState=l;var s=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.SurfaceTimelineState]"},a.prototype._onClear=function(){e.prototype._onClear.call(this),this._deformCount=0,this._deformOffset=0,this._sameValueOffset=0},a.prototype.init=function(a,t,r){if(e.prototype.init.call(this,a,t,r),null!==this._timelineData){var n=this._animationData.parent.parent,i=n.frameIntArray,o=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this._valueOffset=this._animationData.frameFloatOffset,this._valueCount=i[o+2],this._deformCount=i[o+1],this._deformOffset=i[o+3],this._sameValueOffset=i[o+4]+this._animationData.frameFloatOffset,this._valueScale=this._armature.armatureData.scale,this._valueArray=n.frameFloatArray,this._rd.length=2*this._valueCount}else this._deformCount=this.target.target._deformVertices.length},a.prototype.blend=function(e){var a=this.target,t=a.target,r=a.blendWeight,n=t._deformVertices,o=this._valueArray;if(null!==o)for(var l=this._valueCount,s=this._deformOffset,_=this._sameValueOffset,d=this._rd,m=0,p;m<this._deformCount;++m)p=0,p=m<s?o[_+m]:m<s+l?d[m-s]:o[_+m-l],1<a.dirty?n[m]+=p*r:n[m]=p*r;else if(1===a.dirty)for(var m=0;m<this._deformCount;++m)n[m]=0;(e||this.dirty)&&(this.dirty=!1,t._transformDirty=!0)},a}(e.MutilpleValueTimelineState);e.SurfaceTimelineState=s;var _=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.AlphaTimelineState]"},a.prototype._onArriveAtFrame=function(){e.prototype._onArriveAtFrame.call(this),null===this._timelineData&&(this._result=1)},a.prototype.init=function(a,t,r){e.prototype.init.call(this,a,t,r),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=.01,this._valueArray=this._animationData.parent.parent.frameIntArray},a.prototype.blend=function(e){var a=this.target,t=a.target,r=a.blendWeight;1<a.dirty?(t._alpha+=this._result*r,1<t._alpha&&(t._alpha=1)):t._alpha=this._result*r,(e||this.dirty)&&(this.dirty=!1,this._armature._alphaDirty=!0)},a}(e.SingleValueTimelineState);e.AlphaTimelineState=_;var d=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.SlotDislayTimelineState]"},a.prototype._onArriveAtFrame=function(){if(0<=this.playState){var e=this.target,a=null===this._timelineData?e._slotData.displayIndex:this._frameArray[this._frameOffset+1];e.displayIndex!==a&&e._setDisplayIndex(a,!0)}},a.prototype._onUpdateFrame=function(){},a}(e.TimelineState);e.SlotDislayTimelineState=d;var m=function(e){function a(){var a=null!==e&&e.apply(this,arguments)||this;return a._current=[0,0,0,0,0,0,0,0],a._difference=[0,0,0,0,0,0,0,0],a._result=[0,0,0,0,0,0,0,0],a}return __extends(a,e),a.toString=function(){return"[class dragonBones.SlotColorTimelineState]"},a.prototype._onArriveAtFrame=function(){if(e.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var a=this._animationData.parent.parent,t=a.colorArray,r=a.frameIntArray,n=this._animationData.frameIntOffset+this._frameValueOffset+this._frameIndex,i=r[n];0>i&&(i+=65536),this._isTween?(this._current[0]=t[i++],this._current[1]=t[i++],this._current[2]=t[i++],this._current[3]=t[i++],this._current[4]=t[i++],this._current[5]=t[i++],this._current[6]=t[i++],this._current[7]=t[i++],i=this._frameIndex===this._frameCount-1?r[this._animationData.frameIntOffset+this._frameValueOffset]:r[n+1],0>i&&(i+=65536),this._difference[0]=t[i++]-this._current[0],this._difference[1]=t[i++]-this._current[1],this._difference[2]=t[i++]-this._current[2],this._difference[3]=t[i++]-this._current[3],this._difference[4]=t[i++]-this._current[4],this._difference[5]=t[i++]-this._current[5],this._difference[6]=t[i++]-this._current[6],this._difference[7]=t[i++]-this._current[7]):(this._result[0]=.01*t[i++],this._result[1]=.01*t[i++],this._result[2]=.01*t[i++],this._result[3]=.01*t[i++],this._result[4]=t[i++],this._result[5]=t[i++],this._result[6]=t[i++],this._result[7]=t[i++])}else{var o=this.target,l=o.slotData.color;this._result[0]=l.alphaMultiplier,this._result[1]=l.redMultiplier,this._result[2]=l.greenMultiplier,this._result[3]=l.blueMultiplier,this._result[4]=l.alphaOffset,this._result[5]=l.redOffset,this._result[6]=l.greenOffset,this._result[7]=l.blueOffset}},a.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this),this._isTween&&(this._result[0]=.01*(this._current[0]+this._difference[0]*this._tweenProgress),this._result[1]=.01*(this._current[1]+this._difference[1]*this._tweenProgress),this._result[2]=.01*(this._current[2]+this._difference[2]*this._tweenProgress),this._result[3]=.01*(this._current[3]+this._difference[3]*this._tweenProgress),this._result[4]=this._current[4]+this._difference[4]*this._tweenProgress,this._result[5]=this._current[5]+this._difference[5]*this._tweenProgress,this._result[6]=this._current[6]+this._difference[6]*this._tweenProgress,this._result[7]=this._current[7]+this._difference[7]*this._tweenProgress)},a.prototype.fadeOut=function(){this._isTween=!1},a.prototype.update=function(a){if(e.prototype.update.call(this,a),this._isTween||this.dirty){var t=this.target,r=t._colorTransform;if(0===this._animationState._fadeState&&0===this._animationState._subFadeState)this.dirty&&(this.dirty=!1,(r.alphaMultiplier!==this._result[0]||r.redMultiplier!==this._result[1]||r.greenMultiplier!==this._result[2]||r.blueMultiplier!==this._result[3]||r.alphaOffset!==this._result[4]||r.redOffset!==this._result[5]||r.greenOffset!==this._result[6]||r.blueOffset!==this._result[7])&&(r.alphaMultiplier=this._result[0],r.redMultiplier=this._result[1],r.greenMultiplier=this._result[2],r.blueMultiplier=this._result[3],r.alphaOffset=this._result[4],r.redOffset=this._result[5],r.greenOffset=this._result[6],r.blueOffset=this._result[7],t._colorDirty=!0));else if(r.alphaMultiplier!==this._result[0]||r.redMultiplier!==this._result[1]||r.greenMultiplier!==this._result[2]||r.blueMultiplier!==this._result[3]||r.alphaOffset!==this._result[4]||r.redOffset!==this._result[5]||r.greenOffset!==this._result[6]||r.blueOffset!==this._result[7]){var n=Math.pow(this._animationState._fadeProgress,4);r.alphaMultiplier+=(this._result[0]-r.alphaMultiplier)*n,r.redMultiplier+=(this._result[1]-r.redMultiplier)*n,r.greenMultiplier+=(this._result[2]-r.greenMultiplier)*n,r.blueMultiplier+=(this._result[3]-r.blueMultiplier)*n,r.alphaOffset+=(this._result[4]-r.alphaOffset)*n,r.redOffset+=(this._result[5]-r.redOffset)*n,r.greenOffset+=(this._result[6]-r.greenOffset)*n,r.blueOffset+=(this._result[7]-r.blueOffset)*n,t._colorDirty=!0}}},a}(e.TweenTimelineState);e.SlotColorTimelineState=m;var p=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.SlotZIndexTimelineState]"},a.prototype._onArriveAtFrame=function(){if(e.prototype._onArriveAtFrame.call(this),null===this._timelineData){var a=this.target,t=a.target;this._result=t.slotData.zIndex}},a.prototype.init=function(a,t,r){e.prototype.init.call(this,a,t,r),this._valueOffset=this._animationData.frameIntOffset,this._valueArray=this._animationData.parent.parent.frameIntArray},a.prototype.blend=function(e){var a=this.target,t=a.target,r=a.blendWeight;1<a.dirty?t._zIndex+=this._result*r:t._zIndex=this._result*r,(e||this.dirty)&&(this.dirty=!1,this._armature._zIndexDirty=!0)},a}(e.SingleValueTimelineState);e.SlotZIndexTimelineState=p;var f=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.DeformTimelineState]"},a.prototype._onClear=function(){e.prototype._onClear.call(this),this.geometryOffset=0,this.displayFrame=null,this._deformCount=0,this._deformOffset=0,this._sameValueOffset=0},a.prototype.init=function(a,t,r){if(e.prototype.init.call(this,a,t,r),null!==this._timelineData){var n=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3],o=this._animationData.parent.parent,s=o.frameIntArray,_=this.target.target;this.geometryOffset=s[n+0],0>this.geometryOffset&&(this.geometryOffset+=65536);for(var d=0,m=_.displayFrameCount;d<m;++d){var l=_.getDisplayFrameAt(d),p=l.getGeometryData();if(null!==p&&p.offset===this.geometryOffset){this.displayFrame=l,this.displayFrame.updateDeformVertices();break}}if(null===this.displayFrame)return void this.returnToPool();this._valueOffset=this._animationData.frameFloatOffset,this._valueCount=s[n+2],this._deformCount=s[n+1],this._deformOffset=s[n+3],this._sameValueOffset=s[n+4]+this._animationData.frameFloatOffset,this._valueScale=this._armature.armatureData.scale,this._valueArray=o.frameFloatArray,this._rd.length=2*this._valueCount}else this._deformCount=this.displayFrame.deformVertices.length},a.prototype.blend=function(e){var a=this.target,t=a.target,r=a.blendWeight,n=this.displayFrame.deformVertices,o=this._valueArray;if(null!==o)for(var l=this._valueCount,s=this._deformOffset,_=this._sameValueOffset,d=this._rd,m=0,p;m<this._deformCount;++m)p=0,p=m<s?o[_+m]:m<s+l?d[m-s]:o[_+m-l],1<a.dirty?n[m]+=p*r:n[m]=p*r;else if(1===a.dirty)for(var m=0;m<this._deformCount;++m)n[m]=0;(e||this.dirty)&&(this.dirty=!1,t._geometryData===this.displayFrame.getGeometryData()&&(t._verticesDirty=!0))},a}(e.MutilpleValueTimelineState);e.DeformTimelineState=f;var u=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.IKConstraintTimelineState]"},a.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this);var a=this.target;if(null!==this._timelineData)a._bendPositive=0<this._currentA,a._weight=this._currentB;else{var t=a._constraintData;a._bendPositive=t.bendPositive,a._weight=t.weight}a.invalidUpdate(),this.dirty=!1},a.prototype.init=function(a,t,r){e.prototype.init.call(this,a,t,r),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=.01,this._valueArray=this._animationData.parent.parent.frameIntArray},a}(e.DoubleValueTimelineState);e.IKConstraintTimelineState=u;var y=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.AnimationProgressTimelineState]"},a.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this);var a=this.target;null!==a._parent&&(a.currentTime=this._result*a.totalTime),this.dirty=!1},a.prototype.init=function(a,t,r){e.prototype.init.call(this,a,t,r),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=1e-4,this._valueArray=this._animationData.parent.parent.frameIntArray},a}(e.SingleValueTimelineState);e.AnimationProgressTimelineState=y;var c=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.AnimationWeightTimelineState]"},a.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this);var a=this.target;null!==a._parent&&(a.weight=this._result),this.dirty=!1},a.prototype.init=function(a,t,r){e.prototype.init.call(this,a,t,r),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=1e-4,this._valueArray=this._animationData.parent.parent.frameIntArray},a}(e.SingleValueTimelineState);e.AnimationWeightTimelineState=c;var g=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.AnimationParametersTimelineState]"},a.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this);var a=this.target;null!==a._parent&&(a.parameterX=this._resultA,a.parameterY=this._resultB),this.dirty=!1},a.prototype.init=function(a,t,r){e.prototype.init.call(this,a,t,r),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=1e-4,this._valueArray=this._animationData.parent.parent.frameIntArray},a}(e.DoubleValueTimelineState);e.AnimationParametersTimelineState=g})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.actionDataToInstance=function(e,t,r){t.type=0===e.type?a.FRAME_EVENT:10===e.type?a.FRAME_EVENT:a.SOUND_EVENT,t.name=e.name,t.armature=r,t.actionData=e,t.data=e.data,null!==e.bone&&(t.bone=r.getBone(e.bone.name)),null!==e.slot&&(t.slot=r.getSlot(e.slot.name))},a.toString=function(){return"[class dragonBones.EventObject]"},a.prototype._onClear=function(){this.time=0,this.type="",this.name="",this.armature=null,this.bone=null,this.slot=null,this.animationState=null,this.actionData=null,this.data=null},a.START="start",a.LOOP_COMPLETE="loopComplete",a.COMPLETE="complete",a.FADE_IN="fadeIn",a.FADE_IN_COMPLETE="fadeInComplete",a.FADE_OUT="fadeOut",a.FADE_OUT_COMPLETE="fadeOutComplete",a.FRAME_EVENT="frameEvent",a.SOUND_EVENT="soundEvent",a}(e.BaseObject);e.EventObject=a})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(){function e(){}return e._getArmatureType=function(e){switch(e.toLowerCase()){case"stage":return 2;case"armature":return 0;case"movieclip":return 1;default:return 0;}},e._getBoneType=function(e){switch(e.toLowerCase()){case"bone":return 0;case"surface":return 1;default:return 0;}},e._getPositionMode=function(e){switch(e.toLocaleLowerCase()){case"percent":return 1;case"fixed":return 0;default:return 1;}},e._getSpacingMode=function(e){switch(e.toLocaleLowerCase()){case"length":return 0;case"percent":return 2;case"fixed":return 1;default:return 0;}},e._getRotateMode=function(e){switch(e.toLocaleLowerCase()){case"tangent":return 0;case"chain":return 1;case"chainscale":return 2;default:return 0;}},e._getDisplayType=function(e){switch(e.toLowerCase()){case"image":return 0;case"mesh":return 2;case"armature":return 1;case"boundingbox":return 3;case"path":return 4;default:return 0;}},e._getBoundingBoxType=function(e){switch(e.toLowerCase()){case"rectangle":return 0;case"ellipse":return 1;case"polygon":return 2;default:return 0;}},e._getBlendMode=function(e){switch(e.toLowerCase()){case"normal":return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13;default:return 0;}},e._getAnimationBlendType=function(e){switch(e.toLowerCase()){case"none":return 0;case"1d":return 1;default:return 0;}},e._getActionType=function(e){switch(e.toLowerCase()){case"play":return 0;case"frame":return 10;case"sound":return 11;default:return 0;}},e.DATA_VERSION_2_3="2.3",e.DATA_VERSION_3_0="3.0",e.DATA_VERSION_4_0="4.0",e.DATA_VERSION_4_5="4.5",e.DATA_VERSION_5_0="5.0",e.DATA_VERSION_5_5="5.5",e.DATA_VERSION_5_6="5.6",e.DATA_VERSION=e.DATA_VERSION_5_6,e.DATA_VERSIONS=[e.DATA_VERSION_4_0,e.DATA_VERSION_4_5,e.DATA_VERSION_5_0,e.DATA_VERSION_5_5,e.DATA_VERSION_5_6],e.TEXTURE_ATLAS="textureAtlas",e.SUB_TEXTURE="SubTexture",e.FORMAT="format",e.IMAGE_PATH="imagePath",e.WIDTH="width",e.HEIGHT="height",e.ROTATED="rotated",e.FRAME_X="frameX",e.FRAME_Y="frameY",e.FRAME_WIDTH="frameWidth",e.FRAME_HEIGHT="frameHeight",e.DRADON_BONES="dragonBones",e.USER_DATA="userData",e.ARMATURE="armature",e.CANVAS="canvas",e.BONE="bone",e.SURFACE="surface",e.SLOT="slot",e.CONSTRAINT="constraint",e.SKIN="skin",e.DISPLAY="display",e.FRAME="frame",e.IK="ik",e.PATH_CONSTRAINT="path",e.ANIMATION="animation",e.TIMELINE="timeline",e.FFD="ffd",e.TRANSLATE_FRAME="translateFrame",e.ROTATE_FRAME="rotateFrame",e.SCALE_FRAME="scaleFrame",e.DISPLAY_FRAME="displayFrame",e.COLOR_FRAME="colorFrame",e.DEFAULT_ACTIONS="defaultActions",e.ACTIONS="actions",e.EVENTS="events",e.INTS="ints",e.FLOATS="floats",e.STRINGS="strings",e.TRANSFORM="transform",e.PIVOT="pivot",e.AABB="aabb",e.COLOR="color",e.VERSION="version",e.COMPATIBLE_VERSION="compatibleVersion",e.FRAME_RATE="frameRate",e.TYPE="type",e.SUB_TYPE="subType",e.NAME="name",e.PARENT="parent",e.TARGET="target",e.STAGE="stage",e.SHARE="share",e.PATH="path",e.LENGTH="length",e.DISPLAY_INDEX="displayIndex",e.Z_ORDER="zOrder",e.Z_INDEX="zIndex",e.BLEND_MODE="blendMode",e.INHERIT_TRANSLATION="inheritTranslation",e.INHERIT_ROTATION="inheritRotation",e.INHERIT_SCALE="inheritScale",e.INHERIT_REFLECTION="inheritReflection",e.INHERIT_ANIMATION="inheritAnimation",e.INHERIT_DEFORM="inheritDeform",e.SEGMENT_X="segmentX",e.SEGMENT_Y="segmentY",e.BEND_POSITIVE="bendPositive",e.CHAIN="chain",e.WEIGHT="weight",e.BLEND_TYPE="blendType",e.FADE_IN_TIME="fadeInTime",e.PLAY_TIMES="playTimes",e.SCALE="scale",e.OFFSET="offset",e.POSITION="position",e.DURATION="duration",e.TWEEN_EASING="tweenEasing",e.TWEEN_ROTATE="tweenRotate",e.TWEEN_SCALE="tweenScale",e.CLOCK_WISE="clockwise",e.CURVE="curve",e.SOUND="sound",e.EVENT="event",e.ACTION="action",e.X="x",e.Y="y",e.SKEW_X="skX",e.SKEW_Y="skY",e.SCALE_X="scX",e.SCALE_Y="scY",e.VALUE="value",e.ROTATE="rotate",e.SKEW="skew",e.ALPHA="alpha",e.ALPHA_OFFSET="aO",e.RED_OFFSET="rO",e.GREEN_OFFSET="gO",e.BLUE_OFFSET="bO",e.ALPHA_MULTIPLIER="aM",e.RED_MULTIPLIER="rM",e.GREEN_MULTIPLIER="gM",e.BLUE_MULTIPLIER="bM",e.UVS="uvs",e.VERTICES="vertices",e.TRIANGLES="triangles",e.WEIGHTS="weights",e.SLOT_POSE="slotPose",e.BONE_POSE="bonePose",e.BONES="bones",e.POSITION_MODE="positionMode",e.SPACING_MODE="spacingMode",e.ROTATE_MODE="rotateMode",e.SPACING="spacing",e.ROTATE_OFFSET="rotateOffset",e.ROTATE_MIX="rotateMix",e.TRANSLATE_MIX="translateMix",e.TARGET_DISPLAY="targetDisplay",e.CLOSED="closed",e.CONSTANT_SPEED="constantSpeed",e.VERTEX_COUNT="vertexCount",e.LENGTHS="lengths",e.GOTO_AND_PLAY="gotoAndPlay",e.DEFAULT_NAME="default",e}();e.DataParser=a})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=Math.floor,t=function(t){function n(){var a=null!==t&&t.apply(this,arguments)||this;return a._rawTextureAtlasIndex=0,a._rawBones=[],a._data=null,a._armature=null,a._bone=null,a._geometry=null,a._slot=null,a._skin=null,a._mesh=null,a._animation=null,a._timeline=null,a._rawTextureAtlases=null,a._frameValueType=0,a._defaultColorOffset=-1,a._prevClockwise=0,a._prevRotation=0,a._frameDefaultValue=0,a._frameValueScale=1,a._helpMatrixA=new e.Matrix,a._helpMatrixB=new e.Matrix,a._helpTransform=new e.Transform,a._helpColorTransform=new e.ColorTransform,a._helpPoint=new e.Point,a._helpArray=[],a._intArray=[],a._floatArray=[],a._frameIntArray=[],a._frameFloatArray=[],a._frameArray=[],a._timelineArray=[],a._colorArray=[],a._cacheRawMeshes=[],a._cacheMeshes=[],a._actionFrames=[],a._weightSlotPose={},a._weightBonePoses={},a._cacheBones={},a._slotChildActions={},a}var o=Math.round;return __extends(n,t),n._getBoolean=function(e,a,t){if(a in e){var r=e[a],n=typeof r;return"boolean"==n?r:"string"==n?"0"!==r&&"NaN"!==r&&""!==r&&"false"!==r&&"null"!==r&&"undefined"!==r:!!r}return t},n._getNumber=function(e,a,t){if(a in e){var r=e[a];return null===r||"NaN"===r?t:+r||0}return t},n._getString=function(e,a,t){if(a in e){var r=e[a];return"string"==typeof r?r:r+""}return t},n.prototype._getCurvePoint=function(e,a,r,n,i,o,l,s,_,t){var d=1-_,m=d*d,p=_*_,f=d*m,u=3*_*m,y=3*d*p,c=_*p;t.x=f*e+u*r+y*i+c*l,t.y=f*a+u*n+y*o+c*s},n.prototype._samplingEasingCurve=function(e,a){var r=e.length;if(1==r%3){for(var n=-2,o=0,s=a.length,_;o<s;++o){for(_=(o+1)/(s+1);(n+6<r?e[n+6]:1)<_;)n+=6;for(var d=0<=n&&n+6<r,m=d?e[n]:0,p=d?e[n+1]:0,f=e[n+2],u=e[n+3],y=e[n+4],c=e[n+5],g=d?e[n+6]:1,D=d?e[n+7]:1,h=0,T=1,b;1e-4<T-h;)b=.5*(T+h),this._getCurvePoint(m,p,f,u,y,c,g,D,b,this._helpPoint),0<_-this._helpPoint.x?h=b:T=b;a[o]=this._helpPoint.y}return!0}for(var n=0,o=0,s=a.length,_;o<s;++o){for(_=(o+1)/(s+1);e[n+6]<_;)n+=6;for(var m=e[n],p=e[n+1],f=e[n+2],u=e[n+3],y=e[n+4],c=e[n+5],g=e[n+6],D=e[n+7],h=0,T=1,b;1e-4<T-h;)b=.5*(T+h),this._getCurvePoint(m,p,f,u,y,c,g,D,b,this._helpPoint),0<_-this._helpPoint.x?h=b:T=b;a[o]=this._helpPoint.y}return!1},n.prototype._parseActionDataInFrame=function(a,t,r,n){e.DataParser.EVENT in a&&this._mergeActionFrame(a[e.DataParser.EVENT],t,10,r,n),e.DataParser.SOUND in a&&this._mergeActionFrame(a[e.DataParser.SOUND],t,11,r,n),e.DataParser.ACTION in a&&this._mergeActionFrame(a[e.DataParser.ACTION],t,0,r,n),e.DataParser.EVENTS in a&&this._mergeActionFrame(a[e.DataParser.EVENTS],t,10,r,n),e.DataParser.ACTIONS in a&&this._mergeActionFrame(a[e.DataParser.ACTIONS],t,0,r,n)},n.prototype._mergeActionFrame=function(e,a,t,n,o){for(var l=this._armature.actions.length,s=this._parseActionData(e,t,n,o),_=0,d=null,m=0,p=s,f;m<p.length;m++)f=p[m],this._armature.addAction(f,!1);0===this._actionFrames.length&&(d=new r,d.frameStart=0,this._actionFrames.push(d),d=null);for(var u=0,y=this._actionFrames,c;u<y.length;u++){if(c=y[u],c.frameStart===a){d=c;break}else if(c.frameStart>a)break;_++}null===d&&(d=new r,d.frameStart=a,this._actionFrames.splice(_,0,d));for(var g=0;g<s.length;++g)d.actions.push(l+g)},n.prototype._parseArmature=function(a,t){var r=e.BaseObject.borrowObject(e.ArmatureData);if(r.name=n._getString(a,e.DataParser.NAME,""),r.frameRate=n._getNumber(a,e.DataParser.FRAME_RATE,this._data.frameRate),r.scale=t,r.type=e.DataParser.TYPE in a&&"string"==typeof a[e.DataParser.TYPE]?e.DataParser._getArmatureType(a[e.DataParser.TYPE]):n._getNumber(a,e.DataParser.TYPE,0),0===r.frameRate&&(r.frameRate=24),this._armature=r,e.DataParser.CANVAS in a){var o=a[e.DataParser.CANVAS],s=e.BaseObject.borrowObject(e.CanvasData);s.hasBackground=!!(e.DataParser.COLOR in o),s.color=n._getNumber(o,e.DataParser.COLOR,0),s.x=n._getNumber(o,e.DataParser.X,0)*r.scale,s.y=n._getNumber(o,e.DataParser.Y,0)*r.scale,s.width=n._getNumber(o,e.DataParser.WIDTH,0)*r.scale,s.height=n._getNumber(o,e.DataParser.HEIGHT,0)*r.scale,r.canvas=s}if(e.DataParser.AABB in a){var _=a[e.DataParser.AABB];r.aabb.x=n._getNumber(_,e.DataParser.X,0)*r.scale,r.aabb.y=n._getNumber(_,e.DataParser.Y,0)*r.scale,r.aabb.width=n._getNumber(_,e.DataParser.WIDTH,0)*r.scale,r.aabb.height=n._getNumber(_,e.DataParser.HEIGHT,0)*r.scale}if(e.DataParser.BONE in a)for(var d=a[e.DataParser.BONE],m=0,p=d;m<p.length;m++){var f=p[m],u=n._getString(f,e.DataParser.PARENT,""),y=this._parseBone(f);if(0<u.length){var c=r.getBone(u);null===c?(!(u in this._cacheBones)&&(this._cacheBones[u]=[]),this._cacheBones[u].push(y)):y.parent=c}if(y.name in this._cacheBones){for(var g=0,D=this._cacheBones[y.name],h;g<D.length;g++)h=D[g],h.parent=y;delete this._cacheBones[y.name]}r.addBone(y),this._rawBones.push(y)}if(e.DataParser.IK in a)for(var T=a[e.DataParser.IK],b=0,A=T;b<A.length;b++){var S=A[b],P=this._parseIKConstraint(S);P&&r.addConstraint(P)}if(r.sortBones(),e.DataParser.SLOT in a)for(var O=0,x=a[e.DataParser.SLOT],E=0,B=x,I;E<B.length;E++)I=B[E],r.addSlot(this._parseSlot(I,O++));if(e.DataParser.SKIN in a)for(var F=a[e.DataParser.SKIN],C=0,M=F,N;C<M.length;C++)N=M[C],r.addSkin(this._parseSkin(N));if(e.DataParser.PATH_CONSTRAINT in a)for(var w=a[e.DataParser.PATH_CONSTRAINT],v=0,R=w;v<R.length;v++){var j=R[v],P=this._parsePathConstraint(j);P&&r.addConstraint(P)}for(var L=0,V=this._cacheRawMeshes.length;L<V;++L){var l=this._cacheRawMeshes[L],Y=n._getString(l,e.DataParser.SHARE,"");if(0!==Y.length){var U=n._getString(l,e.DataParser.SKIN,e.DataParser.DEFAULT_NAME);0===U.length&&(U=e.DataParser.DEFAULT_NAME);var X=r.getMesh(U,"",Y);if(null!==X){var G=this._cacheMeshes[L];G.geometry.shareFrom(X.geometry)}}}if(e.DataParser.ANIMATION in a)for(var z=a[e.DataParser.ANIMATION],H=0,W=z;H<W.length;H++){var K=W[H],Z=this._parseAnimation(K);r.addAnimation(Z)}if(e.DataParser.DEFAULT_ACTIONS in a)for(var q=this._parseActionData(a[e.DataParser.DEFAULT_ACTIONS],0,null,null),Q=0,J=q,$;Q<J.length;Q++)if($=J[Q],r.addAction($,!0),0===$.type){var Z=r.getAnimation($.name);null!==Z&&(r.defaultAnimation=Z)}if(e.DataParser.ACTIONS in a)for(var q=this._parseActionData(a[e.DataParser.ACTIONS],0,null,null),ee=0,ae=q,$;ee<ae.length;ee++)$=ae[ee],r.addAction($,!1);for(var te in this._rawBones.length=0,this._cacheRawMeshes.length=0,this._cacheMeshes.length=0,this._armature=null,this._weightSlotPose)delete this._weightSlotPose[te];for(var te in this._weightBonePoses)delete this._weightBonePoses[te];for(var te in this._cacheBones)delete this._cacheBones[te];for(var te in this._slotChildActions)delete this._slotChildActions[te];return r},n.prototype._parseBone=function(a){var t=0;if(t=e.DataParser.TYPE in a&&"string"==typeof a[e.DataParser.TYPE]?e.DataParser._getBoneType(a[e.DataParser.TYPE]):n._getNumber(a,e.DataParser.TYPE,0),0===t){var r=this._armature.scale,i=e.BaseObject.borrowObject(e.BoneData);return i.inheritTranslation=n._getBoolean(a,e.DataParser.INHERIT_TRANSLATION,!0),i.inheritRotation=n._getBoolean(a,e.DataParser.INHERIT_ROTATION,!0),i.inheritScale=n._getBoolean(a,e.DataParser.INHERIT_SCALE,!0),i.inheritReflection=n._getBoolean(a,e.DataParser.INHERIT_REFLECTION,!0),i.length=n._getNumber(a,e.DataParser.LENGTH,0)*r,i.alpha=n._getNumber(a,e.DataParser.ALPHA,1),i.name=n._getString(a,e.DataParser.NAME,""),e.DataParser.TRANSFORM in a&&this._parseTransform(a[e.DataParser.TRANSFORM],i.transform,r),i}var o=e.BaseObject.borrowObject(e.SurfaceData);return o.alpha=n._getNumber(a,e.DataParser.ALPHA,1),o.name=n._getString(a,e.DataParser.NAME,""),o.segmentX=n._getNumber(a,e.DataParser.SEGMENT_X,0),o.segmentY=n._getNumber(a,e.DataParser.SEGMENT_Y,0),this._parseGeometry(a,o.geometry),o},n.prototype._parseIKConstraint=function(a){var t=this._armature.getBone(n._getString(a,e.DataParser.BONE,""));if(null===t)return null;var r=this._armature.getBone(n._getString(a,e.DataParser.TARGET,""));if(null===r)return null;var i=n._getNumber(a,e.DataParser.CHAIN,0),o=e.BaseObject.borrowObject(e.IKConstraintData);return o.scaleEnabled=n._getBoolean(a,e.DataParser.SCALE,!1),o.bendPositive=n._getBoolean(a,e.DataParser.BEND_POSITIVE,!0),o.weight=n._getNumber(a,e.DataParser.WEIGHT,1),o.name=n._getString(a,e.DataParser.NAME,""),o.type=0,o.target=r,0<i&&null!==t.parent?(o.root=t.parent,o.bone=t):(o.root=t,o.bone=null),o},n.prototype._parsePathConstraint=function(a){var t=this._armature.getSlot(n._getString(a,e.DataParser.TARGET,""));if(null===t)return null;var r=this._armature.defaultSkin;if(null===r)return null;var i=r.getDisplay(t.name,n._getString(a,e.DataParser.TARGET_DISPLAY,t.name));if(null===i||!(i instanceof e.PathDisplayData))return null;var o=a[e.DataParser.BONES];if(null===o||0===o.length)return null;var l=e.BaseObject.borrowObject(e.PathConstraintData);l.name=n._getString(a,e.DataParser.NAME,""),l.type=1,l.pathSlot=t,l.pathDisplayData=i,l.target=t.parent,l.positionMode=e.DataParser._getPositionMode(n._getString(a,e.DataParser.POSITION_MODE,"")),l.spacingMode=e.DataParser._getSpacingMode(n._getString(a,e.DataParser.SPACING_MODE,"")),l.rotateMode=e.DataParser._getRotateMode(n._getString(a,e.DataParser.ROTATE_MODE,"")),l.position=n._getNumber(a,e.DataParser.POSITION,0),l.spacing=n._getNumber(a,e.DataParser.SPACING,0),l.rotateOffset=n._getNumber(a,e.DataParser.ROTATE_OFFSET,0),l.rotateMix=n._getNumber(a,e.DataParser.ROTATE_MIX,1),l.translateMix=n._getNumber(a,e.DataParser.TRANSLATE_MIX,1);for(var s=0,_=o;s<_.length;s++){var d=_[s],m=this._armature.getBone(d);null!==m&&(l.AddBone(m),null===l.root&&(l.root=m))}return l},n.prototype._parseSlot=function(a,t){var r=e.BaseObject.borrowObject(e.SlotData);return r.displayIndex=n._getNumber(a,e.DataParser.DISPLAY_INDEX,0),r.zOrder=t,r.zIndex=n._getNumber(a,e.DataParser.Z_INDEX,0),r.alpha=n._getNumber(a,e.DataParser.ALPHA,1),r.name=n._getString(a,e.DataParser.NAME,""),r.parent=this._armature.getBone(n._getString(a,e.DataParser.PARENT,"")),r.blendMode=e.DataParser.BLEND_MODE in a&&"string"==typeof a[e.DataParser.BLEND_MODE]?e.DataParser._getBlendMode(a[e.DataParser.BLEND_MODE]):n._getNumber(a,e.DataParser.BLEND_MODE,0),e.DataParser.COLOR in a?(r.color=e.SlotData.createColor(),this._parseColorTransform(a[e.DataParser.COLOR],r.color)):r.color=e.SlotData.DEFAULT_COLOR,e.DataParser.ACTIONS in a&&(this._slotChildActions[r.name]=this._parseActionData(a[e.DataParser.ACTIONS],0,null,null)),r},n.prototype._parseSkin=function(a){var t=e.BaseObject.borrowObject(e.SkinData);if(t.name=n._getString(a,e.DataParser.NAME,e.DataParser.DEFAULT_NAME),0===t.name.length&&(t.name=e.DataParser.DEFAULT_NAME),e.DataParser.SLOT in a){var r=a[e.DataParser.SLOT];this._skin=t;for(var i=0,o=r;i<o.length;i++){var l=o[i],s=n._getString(l,e.DataParser.NAME,""),_=this._armature.getSlot(s);if(null!==_){if(this._slot=_,e.DataParser.DISPLAY in l)for(var d=l[e.DataParser.DISPLAY],m=0,p=d,f;m<p.length;m++)f=p[m],f?t.addDisplay(s,this._parseDisplay(f)):t.addDisplay(s,null);this._slot=null}}this._skin=null}return t},n.prototype._parseDisplay=function(a){var t=n._getString(a,e.DataParser.NAME,""),r=n._getString(a,e.DataParser.PATH,""),o=0,s=null;switch(o=e.DataParser.TYPE in a&&"string"==typeof a[e.DataParser.TYPE]?e.DataParser._getDisplayType(a[e.DataParser.TYPE]):n._getNumber(a,e.DataParser.TYPE,o),o){case 0:{var _=s=e.BaseObject.borrowObject(e.ImageDisplayData);_.name=t,_.path=0<r.length?r:t,this._parsePivot(a,_);break}case 1:{var d=s=e.BaseObject.borrowObject(e.ArmatureDisplayData);if(d.name=t,d.path=0<r.length?r:t,d.inheritAnimation=!0,e.DataParser.ACTIONS in a)for(var m=this._parseActionData(a[e.DataParser.ACTIONS],0,null,null),p=0,f=m,u;p<f.length;p++)u=f[p],d.addAction(u);else if(this._slot.name in this._slotChildActions){var y=this._skin.getDisplays(this._slot.name);if(null===y?0===this._slot.displayIndex:this._slot.displayIndex===y.length){for(var c=0,g=this._slotChildActions[this._slot.name],u;c<g.length;c++)u=g[c],d.addAction(u);delete this._slotChildActions[this._slot.name]}}break}case 2:{var D=s=e.BaseObject.borrowObject(e.MeshDisplayData);D.geometry.inheritDeform=n._getBoolean(a,e.DataParser.INHERIT_DEFORM,!0),D.name=t,D.path=0<r.length?r:t,e.DataParser.SHARE in a?(D.geometry.data=this._data,this._cacheRawMeshes.push(a),this._cacheMeshes.push(D)):this._parseMesh(a,D);break}case 3:{var h=this._parseBoundingBox(a);if(null!==h){var T=s=e.BaseObject.borrowObject(e.BoundingBoxDisplayData);T.name=t,T.path=0<r.length?r:t,T.boundingBox=h}break}case 4:{var b=a[e.DataParser.LENGTHS],A=s=e.BaseObject.borrowObject(e.PathDisplayData);A.closed=n._getBoolean(a,e.DataParser.CLOSED,!1),A.constantSpeed=n._getBoolean(a,e.DataParser.CONSTANT_SPEED,!1),A.name=t,A.path=0<r.length?r:t,A.curveLengths.length=b.length;for(var S=0,P=b.length;S<P;++S)A.curveLengths[S]=b[S];this._parsePath(a,A);break}}return null!==s&&e.DataParser.TRANSFORM in a&&this._parseTransform(a[e.DataParser.TRANSFORM],s.transform,this._armature.scale),s},n.prototype._parsePath=function(e,a){this._parseGeometry(e,a.geometry)},n.prototype._parsePivot=function(a,t){if(e.DataParser.PIVOT in a){var r=a[e.DataParser.PIVOT];t.pivot.x=n._getNumber(r,e.DataParser.X,0),t.pivot.y=n._getNumber(r,e.DataParser.Y,0)}else t.pivot.x=.5,t.pivot.y=.5},n.prototype._parseMesh=function(a,t){if(this._parseGeometry(a,t.geometry),e.DataParser.WEIGHTS in a){var r=a[e.DataParser.SLOT_POSE],n=a[e.DataParser.BONE_POSE],i=this._skin.name+"_"+this._slot.name+"_"+t.name;this._weightSlotPose[i]=r,this._weightBonePoses[i]=n}},n.prototype._parseBoundingBox=function(a){var t=null,r=0;return r=e.DataParser.SUB_TYPE in a&&"string"==typeof a[e.DataParser.SUB_TYPE]?e.DataParser._getBoundingBoxType(a[e.DataParser.SUB_TYPE]):n._getNumber(a,e.DataParser.SUB_TYPE,r),0===r?t=e.BaseObject.borrowObject(e.RectangleBoundingBoxData):1===r?t=e.BaseObject.borrowObject(e.EllipseBoundingBoxData):2===r?t=this._parsePolygonBoundingBox(a):void 0,(null!==t&&(t.color=n._getNumber(a,e.DataParser.COLOR,0),(0===t.type||1===t.type)&&(t.width=n._getNumber(a,e.DataParser.WIDTH,0),t.height=n._getNumber(a,e.DataParser.HEIGHT,0))),t)},n.prototype._parsePolygonBoundingBox=function(a){var t=e.BaseObject.borrowObject(e.PolygonBoundingBoxData);if(e.DataParser.VERTICES in a){var r=this._armature.scale,n=a[e.DataParser.VERTICES],o=t.vertices;o.length=n.length;for(var s=0,_=n.length;s<_;s+=2){var l=n[s]*r,d=n[s+1]*r;o[s]=l,o[s+1]=d,0==s?(t.x=l,t.y=d,t.width=l,t.height=d):(l<t.x?t.x=l:l>t.width&&(t.width=l),d<t.y?t.y=d:d>t.height&&(t.height=d))}t.width-=t.x,t.height-=t.y}else console.warn("Data error.\n Please reexport DragonBones Data to fixed the bug.");return t},n.prototype._parseAnimation=function(a){var t=e.BaseObject.borrowObject(e.AnimationData);if(t.blendType=e.DataParser._getAnimationBlendType(n._getString(a,e.DataParser.BLEND_TYPE,"")),t.frameCount=n._getNumber(a,e.DataParser.DURATION,0),t.playTimes=n._getNumber(a,e.DataParser.PLAY_TIMES,1),t.duration=t.frameCount/this._armature.frameRate,t.fadeInTime=n._getNumber(a,e.DataParser.FADE_IN_TIME,0),t.scale=n._getNumber(a,e.DataParser.SCALE,1),t.name=n._getString(a,e.DataParser.NAME,e.DataParser.DEFAULT_NAME),0===t.name.length&&(t.name=e.DataParser.DEFAULT_NAME),t.frameIntOffset=this._frameIntArray.length,t.frameFloatOffset=this._frameFloatArray.length,t.frameOffset=this._frameArray.length,this._animation=t,e.DataParser.FRAME in a){var r=a[e.DataParser.FRAME],o=r.length;if(0<o)for(var l=0,s=0,_;l<o;++l)_=r[l],this._parseActionDataInFrame(_,s,null,null),s+=n._getNumber(_,e.DataParser.DURATION,1)}if(e.DataParser.Z_ORDER in a&&(this._animation.zOrderTimeline=this._parseTimeline(a[e.DataParser.Z_ORDER],null,e.DataParser.FRAME,1,0,0,this._parseZOrderFrame)),e.DataParser.BONE in a)for(var d=a[e.DataParser.BONE],m=0,p=d,f;m<p.length;m++)f=p[m],this._parseBoneTimeline(f);if(e.DataParser.SLOT in a)for(var d=a[e.DataParser.SLOT],u=0,y=d,f;u<y.length;u++)f=y[u],this._parseSlotTimeline(f);if(e.DataParser.FFD in a)for(var d=a[e.DataParser.FFD],c=0,g=d;c<g.length;c++){var f=g[c],D=n._getString(f,e.DataParser.SKIN,e.DataParser.DEFAULT_NAME),h=n._getString(f,e.DataParser.SLOT,""),T=n._getString(f,e.DataParser.NAME,"");if(0===D.length&&(D=e.DataParser.DEFAULT_NAME),this._slot=this._armature.getSlot(h),this._mesh=this._armature.getMesh(D,h,T),null!==this._slot&&null!==this._mesh){var b=this._parseTimeline(f,null,e.DataParser.FRAME,22,2,0,this._parseSlotDeformFrame);null!==b&&this._animation.addSlotTimeline(h,b),this._slot=null,this._mesh=null}}if(e.DataParser.IK in a)for(var d=a[e.DataParser.IK],A=0,S=d;A<S.length;A++){var f=S[A],P=n._getString(f,e.DataParser.NAME,""),O=this._armature.getConstraint(P);if(null!==O){var b=this._parseTimeline(f,null,e.DataParser.FRAME,30,1,2,this._parseIKConstraintFrame);null!==b&&this._animation.addConstraintTimeline(P,b)}}if(0<this._actionFrames.length&&(this._animation.actionTimeline=this._parseTimeline(null,this._actionFrames,"",0,0,0,this._parseActionFrame),this._actionFrames.length=0),e.DataParser.TIMELINE in a)for(var d=a[e.DataParser.TIMELINE],x=0,E=d;x<E.length;x++){var f=E[x],B=n._getNumber(f,e.DataParser.TYPE,0),I=n._getString(f,e.DataParser.NAME,""),b=null;switch(B){case 0:break;case 20:case 23:case 60:case 24:case 40:case 41:if(20===B?(this._frameValueType=0,this._frameValueScale=1):(this._frameValueType=1,this._frameValueScale=23===B?1:40===B||41===B?1e4:100),this._frameDefaultValue=60===B||24===B||41===B?1:0,40===B&&0!==t.blendType){b=e.BaseObject.borrowObject(e.AnimationTimelineData);var F=b;F.x=n._getNumber(f,e.DataParser.X,0),F.y=n._getNumber(f,e.DataParser.Y,0)}b=this._parseTimeline(f,null,e.DataParser.FRAME,B,this._frameValueType,1,this._parseSingleValueFrame,b);break;case 11:case 12:case 13:case 30:case 42:30===B||42===B?(this._frameValueType=1,this._frameValueScale=42===B?1e4:100):(this._frameValueScale=12===B?e.Transform.DEG_RAD:1,this._frameValueType=2),this._frameDefaultValue=13===B||30===B?1:0,b=this._parseTimeline(f,null,e.DataParser.FRAME,B,this._frameValueType,2,this._parseDoubleValueFrame);break;case 1:break;case 50:{var C=this._armature.getBone(I);if(null===C)continue;this._geometry=C.geometry,b=this._parseTimeline(f,null,e.DataParser.FRAME,B,2,0,this._parseDeformFrame),this._geometry=null;break}case 22:{for(var D in this._geometry=null,this._armature.skins){var M=this._armature.skins[D];for(var N in M.displays)for(var w=M.displays[N],v=0,R=w,k;v<R.length;v++)if(k=R[v],null!==k&&k.name===I){this._geometry=k.geometry;break}}if(null===this._geometry)continue;b=this._parseTimeline(f,null,e.DataParser.FRAME,B,2,0,this._parseDeformFrame),this._geometry=null;break}case 21:b=this._parseTimeline(f,null,e.DataParser.FRAME,B,1,1,this._parseSlotColorFrame);}if(null!==b)switch(B){case 0:break;case 1:break;case 11:case 12:case 13:case 50:case 60:this._animation.addBoneTimeline(I,b);break;case 20:case 21:case 22:case 23:case 24:this._animation.addSlotTimeline(I,b);break;case 30:this._animation.addConstraintTimeline(I,b);break;case 40:case 41:case 42:this._animation.addAnimationTimeline(I,b);}}return this._animation=null,t},n.prototype._parseTimeline=function(a,t,l,s,_,d,m,p){if(void 0===p&&(p=null),null!==a&&0<l.length&&l in a&&(t=a[l]),null===t)return null;var f=t.length;if(0===f)return null;var u=this._frameIntArray.length,y=this._frameFloatArray.length,c=this._timelineArray.length;switch(null===p&&(p=e.BaseObject.borrowObject(e.TimelineData)),p.type=s,p.offset=c,this._frameValueType=_,this._timeline=p,this._timelineArray.length+=5+f,null===a?(this._timelineArray[c+0]=100,this._timelineArray[c+1]=0):(this._timelineArray[c+0]=o(100*n._getNumber(a,e.DataParser.SCALE,1)),this._timelineArray[c+1]=o(100*n._getNumber(a,e.DataParser.OFFSET,0))),this._timelineArray[c+2]=f,this._timelineArray[c+3]=d,this._frameValueType){case 0:this._timelineArray[c+4]=0;break;case 1:this._timelineArray[c+4]=u-this._animation.frameIntOffset;break;case 2:this._timelineArray[c+4]=y-this._animation.frameFloatOffset;}if(1===f)p.frameIndicesOffset=-1,this._timelineArray[c+5+0]=m.call(this,t[0],0,0)-this._animation.frameOffset;else{var g=this._animation.frameCount+1,D=this._data.frameIndices,h=D.length;D.length+=g,p.frameIndicesOffset=h;for(var T=0,b=0,A=0,S=0;T<g;++T){if(A+S<=T&&b<f){var P=t[b];A=T,S=b==f-1?this._animation.frameCount-A:P instanceof r?this._actionFrames[b+1].frameStart-A:n._getNumber(P,e.DataParser.DURATION,1),this._timelineArray[c+5+b]=m.call(this,P,A,S)-this._animation.frameOffset,b++}D[h+T]=b-1}}return this._timeline=null,p},n.prototype._parseBoneTimeline=function(a){var t=this._armature.getBone(n._getString(a,e.DataParser.NAME,""));if(null!==t){if(this._bone=t,this._slot=this._armature.getSlot(this._bone.name),e.DataParser.TRANSLATE_FRAME in a){this._frameDefaultValue=0,this._frameValueScale=1;var r=this._parseTimeline(a,null,e.DataParser.TRANSLATE_FRAME,11,2,2,this._parseDoubleValueFrame);null!==r&&this._animation.addBoneTimeline(t.name,r)}if(e.DataParser.ROTATE_FRAME in a){this._frameDefaultValue=0,this._frameValueScale=1;var r=this._parseTimeline(a,null,e.DataParser.ROTATE_FRAME,12,2,2,this._parseBoneRotateFrame);null!==r&&this._animation.addBoneTimeline(t.name,r)}if(e.DataParser.SCALE_FRAME in a){this._frameDefaultValue=1,this._frameValueScale=1;var r=this._parseTimeline(a,null,e.DataParser.SCALE_FRAME,13,2,2,this._parseBoneScaleFrame);null!==r&&this._animation.addBoneTimeline(t.name,r)}if(e.DataParser.FRAME in a){var r=this._parseTimeline(a,null,e.DataParser.FRAME,10,2,6,this._parseBoneAllFrame);null!==r&&this._animation.addBoneTimeline(t.name,r)}this._bone=null,this._slot=null}},n.prototype._parseSlotTimeline=function(a){var t=this._armature.getSlot(n._getString(a,e.DataParser.NAME,""));if(null!==t){var r=null,i=null;this._slot=t,r=e.DataParser.DISPLAY_FRAME in a?this._parseTimeline(a,null,e.DataParser.DISPLAY_FRAME,20,0,0,this._parseSlotDisplayFrame):this._parseTimeline(a,null,e.DataParser.FRAME,20,0,0,this._parseSlotDisplayFrame),i=e.DataParser.COLOR_FRAME in a?this._parseTimeline(a,null,e.DataParser.COLOR_FRAME,21,1,1,this._parseSlotColorFrame):this._parseTimeline(a,null,e.DataParser.FRAME,21,1,1,this._parseSlotColorFrame),null!==r&&this._animation.addSlotTimeline(t.name,r),null!==i&&this._animation.addSlotTimeline(t.name,i),this._slot=null}},n.prototype._parseFrame=function(e,a,t){e,t;var r=this._frameArray.length;return this._frameArray.length+=1,this._frameArray[r+0]=a,r},n.prototype._parseTweenFrame=function(a,t,r){var l=this._parseFrame(a,t,r);if(!(0<r))this._frameArray.length+=1,this._frameArray[l+1]=0;else if(e.DataParser.CURVE in a){var s=r+1;this._helpArray.length=s;var _=this._samplingEasingCurve(a[e.DataParser.CURVE],this._helpArray);this._frameArray.length+=2+this._helpArray.length,this._frameArray[l+1]=2,this._frameArray[l+2]=_?s:-s;for(var d=0;d<s;++d)this._frameArray[l+3+d]=o(1e4*this._helpArray[d])}else{var m=-2;e.DataParser.TWEEN_EASING in a&&(m=n._getNumber(a,e.DataParser.TWEEN_EASING,-2)),-2===m?(this._frameArray.length+=1,this._frameArray[l+1]=0):0===m?(this._frameArray.length+=1,this._frameArray[l+1]=1):0>m?(this._frameArray.length+=2,this._frameArray[l+1]=3,this._frameArray[l+2]=o(100*-m)):1>=m?(this._frameArray.length+=2,this._frameArray[l+1]=4,this._frameArray[l+2]=o(100*m)):(this._frameArray.length+=2,this._frameArray[l+1]=5,this._frameArray[l+2]=o(100*m-100))}return l},n.prototype._parseSingleValueFrame=function(a,t,r){var i=0;switch(this._frameValueType){case 0:{i=this._parseFrame(a,t,r),this._frameArray.length+=1,this._frameArray[i+1]=n._getNumber(a,e.DataParser.VALUE,this._frameDefaultValue);break}case 1:{i=this._parseTweenFrame(a,t,r);var l=this._frameIntArray.length;this._frameIntArray.length+=1,this._frameIntArray[l]=o(n._getNumber(a,e.DataParser.VALUE,this._frameDefaultValue)*this._frameValueScale);break}case 2:{i=this._parseTweenFrame(a,t,r);var l=this._frameFloatArray.length;this._frameFloatArray.length+=1,this._frameFloatArray[l]=n._getNumber(a,e.DataParser.VALUE,this._frameDefaultValue)*this._frameValueScale;break}}return i},n.prototype._parseDoubleValueFrame=function(a,t,r){var i=0;switch(this._frameValueType){case 0:{i=this._parseFrame(a,t,r),this._frameArray.length+=2,this._frameArray[i+1]=n._getNumber(a,e.DataParser.X,this._frameDefaultValue),this._frameArray[i+2]=n._getNumber(a,e.DataParser.Y,this._frameDefaultValue);break}case 1:{i=this._parseTweenFrame(a,t,r);var l=this._frameIntArray.length;this._frameIntArray.length+=2,this._frameIntArray[l]=o(n._getNumber(a,e.DataParser.X,this._frameDefaultValue)*this._frameValueScale),this._frameIntArray[l+1]=o(n._getNumber(a,e.DataParser.Y,this._frameDefaultValue)*this._frameValueScale);break}case 2:{i=this._parseTweenFrame(a,t,r);var l=this._frameFloatArray.length;this._frameFloatArray.length+=2,this._frameFloatArray[l]=n._getNumber(a,e.DataParser.X,this._frameDefaultValue)*this._frameValueScale,this._frameFloatArray[l+1]=n._getNumber(a,e.DataParser.Y,this._frameDefaultValue)*this._frameValueScale;break}}return i},n.prototype._parseActionFrame=function(e,a,t){var r=this._frameArray.length,n=e.actions.length;this._frameArray.length+=2+n,this._frameArray[r+0]=a,this._frameArray[r+0+1]=n;for(var o=0;o<n;++o)this._frameArray[r+0+2+o]=e.actions[o];return r},n.prototype._parseZOrderFrame=function(a,t,r){var n=this._parseFrame(a,t,r);if(e.DataParser.Z_ORDER in a){var o=a[e.DataParser.Z_ORDER];if(0<o.length){for(var s=this._armature.sortedSlots.length,_=Array(s-o.length/2),d=Array(s),m=0;m<_.length;++m)_[m]=0;for(var p=0;p<s;++p)d[p]=-1;for(var f=0,u=0,y=0,c=o.length;y<c;y+=2){for(var l=o[y],g=o[y+1];f!==l;)_[u++]=f++;var D=f+g;d[D]=f++}for(;f<s;)_[u++]=f++;this._frameArray.length+=1+s,this._frameArray[n+1]=s;for(var h=s;h--;)this._frameArray[n+2+h]=-1===d[h]?_[--u]||0:d[h]||0;return n}}return this._frameArray.length+=1,this._frameArray[n+1]=0,n},n.prototype._parseBoneAllFrame=function(a,t,r){this._helpTransform.identity(),e.DataParser.TRANSFORM in a&&this._parseTransform(a[e.DataParser.TRANSFORM],this._helpTransform,1);var i=this._helpTransform.rotation;0!==t&&(0===this._prevClockwise?i=this._prevRotation+e.Transform.normalizeRadian(i-this._prevRotation):((0<this._prevClockwise?i>=this._prevRotation:i<=this._prevRotation)&&(this._prevClockwise=0<this._prevClockwise?this._prevClockwise-1:this._prevClockwise+1),i=this._prevRotation+i-this._prevRotation+e.Transform.PI_D*this._prevClockwise)),this._prevClockwise=n._getNumber(a,e.DataParser.TWEEN_ROTATE,0),this._prevRotation=i;var o=this._parseTweenFrame(a,t,r),l=this._frameFloatArray.length;return this._frameFloatArray.length+=6,this._frameFloatArray[l++]=this._helpTransform.x,this._frameFloatArray[l++]=this._helpTransform.y,this._frameFloatArray[l++]=i,this._frameFloatArray[l++]=this._helpTransform.skew,this._frameFloatArray[l++]=this._helpTransform.scaleX,this._frameFloatArray[l++]=this._helpTransform.scaleY,this._parseActionDataInFrame(a,t,this._bone,this._slot),o},n.prototype._parseBoneTranslateFrame=function(a,t,r){var i=this._parseTweenFrame(a,t,r),o=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[o++]=n._getNumber(a,e.DataParser.X,0),this._frameFloatArray[o++]=n._getNumber(a,e.DataParser.Y,0),i},n.prototype._parseBoneRotateFrame=function(a,t,r){var i=n._getNumber(a,e.DataParser.ROTATE,0)*e.Transform.DEG_RAD;0!==t&&(0===this._prevClockwise?i=this._prevRotation+e.Transform.normalizeRadian(i-this._prevRotation):((0<this._prevClockwise?i>=this._prevRotation:i<=this._prevRotation)&&(this._prevClockwise=0<this._prevClockwise?this._prevClockwise-1:this._prevClockwise+1),i=this._prevRotation+i-this._prevRotation+e.Transform.PI_D*this._prevClockwise)),this._prevClockwise=n._getNumber(a,e.DataParser.CLOCK_WISE,0),this._prevRotation=i;var o=this._parseTweenFrame(a,t,r),l=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[l++]=i,this._frameFloatArray[l++]=n._getNumber(a,e.DataParser.SKEW,0)*e.Transform.DEG_RAD,o},n.prototype._parseBoneScaleFrame=function(a,t,r){var i=this._parseTweenFrame(a,t,r),o=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[o++]=n._getNumber(a,e.DataParser.X,1),this._frameFloatArray[o++]=n._getNumber(a,e.DataParser.Y,1),i},n.prototype._parseSlotDisplayFrame=function(a,t,r){var i=this._parseFrame(a,t,r);return this._frameArray.length+=1,this._frameArray[i+1]=e.DataParser.VALUE in a?n._getNumber(a,e.DataParser.VALUE,0):n._getNumber(a,e.DataParser.DISPLAY_INDEX,0),this._parseActionDataInFrame(a,t,this._slot.parent,this._slot),i},n.prototype._parseSlotColorFrame=function(a,t,r){var n=this._parseTweenFrame(a,t,r),i=-1;if(e.DataParser.VALUE in a||e.DataParser.COLOR in a){var l=e.DataParser.VALUE in a?a[e.DataParser.VALUE]:a[e.DataParser.COLOR];for(var s in l){s,this._parseColorTransform(l,this._helpColorTransform),i=this._colorArray.length,this._colorArray.length+=8,this._colorArray[i++]=o(100*this._helpColorTransform.alphaMultiplier),this._colorArray[i++]=o(100*this._helpColorTransform.redMultiplier),this._colorArray[i++]=o(100*this._helpColorTransform.greenMultiplier),this._colorArray[i++]=o(100*this._helpColorTransform.blueMultiplier),this._colorArray[i++]=o(this._helpColorTransform.alphaOffset),this._colorArray[i++]=o(this._helpColorTransform.redOffset),this._colorArray[i++]=o(this._helpColorTransform.greenOffset),this._colorArray[i++]=o(this._helpColorTransform.blueOffset),i-=8;break}}0>i&&(0>this._defaultColorOffset&&(this._defaultColorOffset=i=this._colorArray.length,this._colorArray.length+=8,this._colorArray[i++]=100,this._colorArray[i++]=100,this._colorArray[i++]=100,this._colorArray[i++]=100,this._colorArray[i++]=0,this._colorArray[i++]=0,this._colorArray[i++]=0,this._colorArray[i++]=0),i=this._defaultColorOffset);var _=this._frameIntArray.length;return this._frameIntArray.length+=1,this._frameIntArray[_]=i,n},n.prototype._parseSlotDeformFrame=function(a,t,r){var o=this._frameFloatArray.length,l=this._parseTweenFrame(a,t,r),s=e.DataParser.VERTICES in a?a[e.DataParser.VERTICES]:null,_=n._getNumber(a,e.DataParser.OFFSET,0),d=this._intArray[this._mesh.geometry.offset+0],m=this._mesh.parent.name+"_"+this._slot.name+"_"+this._mesh.name,p=this._mesh.geometry.weight,f=0,u=0,c=0,g=0;if(null!==p){var D=this._weightSlotPose[m];this._helpMatrixA.copyFromArray(D,0),this._frameFloatArray.length+=2*p.count,c=p.offset+2+p.bones.length}else this._frameFloatArray.length+=2*d;for(var h=0;h<2*d;h+=2)if(null===s?(f=0,u=0):(f=h<_||h-_>=s.length?0:s[h-_],u=h+1<_||h+1-_>=s.length?0:s[h+1-_]),null!==p){var T=this._weightBonePoses[m],b=this._intArray[c++];this._helpMatrixA.transformPoint(f,u,this._helpPoint,!0),f=this._helpPoint.x,u=this._helpPoint.y;for(var A=0,S;A<b;++A)S=this._intArray[c++],this._helpMatrixB.copyFromArray(T,7*S+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(f,u,this._helpPoint,!0),this._frameFloatArray[o+g++]=this._helpPoint.x,this._frameFloatArray[o+g++]=this._helpPoint.y}else this._frameFloatArray[o+h]=f,this._frameFloatArray[o+h+1]=u;if(0===t){var P=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[P+0]=this._mesh.geometry.offset,this._frameIntArray[P+1]=this._frameFloatArray.length-o,this._frameIntArray[P+2]=this._frameFloatArray.length-o,this._frameIntArray[P+3]=0,this._frameIntArray[P+4]=o-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=P-this._animation.frameIntOffset}return l},n.prototype._parseIKConstraintFrame=function(a,t,r){var i=this._parseTweenFrame(a,t,r),l=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[l++]=n._getBoolean(a,e.DataParser.BEND_POSITIVE,!0)?1:0,this._frameIntArray[l++]=o(100*n._getNumber(a,e.DataParser.WEIGHT,1)),i},n.prototype._parseActionData=function(a,t,r,i){var o=[];if("string"==typeof a){var l=e.BaseObject.borrowObject(e.ActionData);l.type=t,l.name=a,l.bone=r,l.slot=i,o.push(l)}else if(a instanceof Array)for(var s=0,_=a;s<_.length;s++){var d=_[s],l=e.BaseObject.borrowObject(e.ActionData);if(e.DataParser.GOTO_AND_PLAY in d?(l.type=0,l.name=n._getString(d,e.DataParser.GOTO_AND_PLAY,"")):(l.type=e.DataParser.TYPE in d&&"string"==typeof d[e.DataParser.TYPE]?e.DataParser._getActionType(d[e.DataParser.TYPE]):n._getNumber(d,e.DataParser.TYPE,t),l.name=n._getString(d,e.DataParser.NAME,"")),e.DataParser.BONE in d){var m=n._getString(d,e.DataParser.BONE,"");l.bone=this._armature.getBone(m)}else l.bone=r;if(e.DataParser.SLOT in d){var p=n._getString(d,e.DataParser.SLOT,"");l.slot=this._armature.getSlot(p)}else l.slot=i;var f=null;if(e.DataParser.INTS in d){null===f&&(f=e.BaseObject.borrowObject(e.UserData));for(var u=d[e.DataParser.INTS],y=0,c=u,g;y<c.length;y++)g=c[y],f.addInt(g)}if(e.DataParser.FLOATS in d){null===f&&(f=e.BaseObject.borrowObject(e.UserData));for(var D=d[e.DataParser.FLOATS],h=0,T=D,g;h<T.length;h++)g=T[h],f.addFloat(g)}if(e.DataParser.STRINGS in d){null===f&&(f=e.BaseObject.borrowObject(e.UserData));for(var b=d[e.DataParser.STRINGS],A=0,S=b,g;A<S.length;A++)g=S[A],f.addString(g)}l.data=f,o.push(l)}return o},n.prototype._parseDeformFrame=function(a,t,r){var o=this._frameFloatArray.length,l=this._parseTweenFrame(a,t,r),s=e.DataParser.VERTICES in a?a[e.DataParser.VERTICES]:e.DataParser.VALUE in a?a[e.DataParser.VALUE]:null,_=n._getNumber(a,e.DataParser.OFFSET,0),d=this._intArray[this._geometry.offset+0],m=this._geometry.weight,p=0,f=0;if(null!==m);else{this._frameFloatArray.length+=2*d;for(var u=0;u<2*d;u+=2)null===s?(p=0,f=0):(p=u<_||u-_>=s.length?0:s[u-_],f=u+1<_||u+1-_>=s.length?0:s[u+1-_]),this._frameFloatArray[o+u]=p,this._frameFloatArray[o+u+1]=f}if(0===t){var c=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[c+0]=this._geometry.offset,this._frameIntArray[c+1]=this._frameFloatArray.length-o,this._frameIntArray[c+2]=this._frameFloatArray.length-o,this._frameIntArray[c+3]=0,this._frameIntArray[c+4]=o-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=c-this._animation.frameIntOffset}return l},n.prototype._parseTransform=function(a,t,r){t.x=n._getNumber(a,e.DataParser.X,0)*r,t.y=n._getNumber(a,e.DataParser.Y,0)*r,e.DataParser.ROTATE in a||e.DataParser.SKEW in a?(t.rotation=e.Transform.normalizeRadian(n._getNumber(a,e.DataParser.ROTATE,0)*e.Transform.DEG_RAD),t.skew=e.Transform.normalizeRadian(n._getNumber(a,e.DataParser.SKEW,0)*e.Transform.DEG_RAD)):(e.DataParser.SKEW_X in a||e.DataParser.SKEW_Y in a)&&(t.rotation=e.Transform.normalizeRadian(n._getNumber(a,e.DataParser.SKEW_Y,0)*e.Transform.DEG_RAD),t.skew=e.Transform.normalizeRadian(n._getNumber(a,e.DataParser.SKEW_X,0)*e.Transform.DEG_RAD)-t.rotation),t.scaleX=n._getNumber(a,e.DataParser.SCALE_X,1),t.scaleY=n._getNumber(a,e.DataParser.SCALE_Y,1)},n.prototype._parseColorTransform=function(a,t){t.alphaMultiplier=.01*n._getNumber(a,e.DataParser.ALPHA_MULTIPLIER,100),t.redMultiplier=.01*n._getNumber(a,e.DataParser.RED_MULTIPLIER,100),t.greenMultiplier=.01*n._getNumber(a,e.DataParser.GREEN_MULTIPLIER,100),t.blueMultiplier=.01*n._getNumber(a,e.DataParser.BLUE_MULTIPLIER,100),t.alphaOffset=n._getNumber(a,e.DataParser.ALPHA_OFFSET,0),t.redOffset=n._getNumber(a,e.DataParser.RED_OFFSET,0),t.greenOffset=n._getNumber(a,e.DataParser.GREEN_OFFSET,0),t.blueOffset=n._getNumber(a,e.DataParser.BLUE_OFFSET,0)},n.prototype._parseGeometry=function(t,r){var n=t[e.DataParser.VERTICES],o=a(n.length/2),s=0,_=this._intArray.length,d=this._floatArray.length;r.offset=_,r.data=this._data,this._intArray.length+=4,this._intArray[_+0]=o,this._intArray[_+2]=d,this._intArray[_+3]=-1,this._floatArray.length+=2*o;for(var m=0,p=2*o;m<p;++m)this._floatArray[d+m]=n[m];if(e.DataParser.TRIANGLES in t){var f=t[e.DataParser.TRIANGLES];s=a(f.length/3),this._intArray.length+=3*s;for(var m=0,p=3*s;m<p;++m)this._intArray[_+4+m]=f[m]}if(this._intArray[_+1]=s,e.DataParser.UVS in t){var u=t[e.DataParser.UVS];this._floatArray.length+=2*o;for(var m=0,p=2*o;m<p;++m)this._floatArray[d+2*o+m]=u[m]}if(e.DataParser.WEIGHTS in t){var c=t[e.DataParser.WEIGHTS],g=a(c.length-o)/2,D=this._intArray.length,h=this._floatArray.length,T=0,b=this._armature.sortedBones,A=e.BaseObject.borrowObject(e.WeightData);if(A.count=g,A.offset=D,this._intArray.length+=2+T+o+g,this._intArray[D+1]=h,e.DataParser.BONE_POSE in t){var S=t[e.DataParser.SLOT_POSE],P=t[e.DataParser.BONE_POSE],O=[];T=a(P.length/7),O.length=T;for(var m=0;m<T;++m){var E=P[7*m],B=this._rawBones[E];A.addBone(B),O[m]=E,this._intArray[D+2+m]=b.indexOf(B)}this._floatArray.length+=3*g,this._helpMatrixA.copyFromArray(S,0);for(var m=0,I=0,F=D+2+T,C=h;m<o;++m){var M=2*m,N=this._intArray[F++]=c[I++],w=this._floatArray[d+M],v=this._floatArray[d+M+1];this._helpMatrixA.transformPoint(w,v,this._helpPoint),w=this._helpPoint.x,v=this._helpPoint.y;for(var R=0;R<N;++R){var E=c[I++],k=O.indexOf(E);this._helpMatrixB.copyFromArray(P,7*k+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(w,v,this._helpPoint),this._intArray[F++]=k,this._floatArray[C++]=c[I++],this._floatArray[C++]=this._helpPoint.x,this._floatArray[C++]=this._helpPoint.y}}}else{var L=t[e.DataParser.BONES];T=L.length;for(var m=0;m<T;m++){var E=L[m],B=this._rawBones[E];A.addBone(B),this._intArray[D+2+m]=b.indexOf(B)}this._floatArray.length+=3*g;for(var m=0,I=0,C=0,F=D+2+T,V=h,N;m<g;m++){N=c[I++],this._intArray[F++]=N;for(var R=0;R<N;R++){var k=c[I++],Y=c[I++],w=n[C++],v=n[C++];this._intArray[F++]=L.indexOf(k),this._floatArray[V++]=Y,this._floatArray[V++]=w,this._floatArray[V++]=v}}}r.weight=A}},n.prototype._parseArray=function(e){e,this._intArray.length=0,this._floatArray.length=0,this._frameIntArray.length=0,this._frameFloatArray.length=0,this._frameArray.length=0,this._timelineArray.length=0,this._colorArray.length=0},n.prototype._modifyArray=function(){0!=this._intArray.length%Int16Array.BYTES_PER_ELEMENT&&this._intArray.push(0),0!=this._frameIntArray.length%Int16Array.BYTES_PER_ELEMENT&&this._frameIntArray.push(0),0!=this._frameArray.length%Int16Array.BYTES_PER_ELEMENT&&this._frameArray.push(0),0!=this._timelineArray.length%Uint16Array.BYTES_PER_ELEMENT&&this._timelineArray.push(0),0!=this._timelineArray.length%Int16Array.BYTES_PER_ELEMENT&&this._colorArray.push(0);for(var e=this._intArray.length*Int16Array.BYTES_PER_ELEMENT,a=this._floatArray.length*Float32Array.BYTES_PER_ELEMENT,t=this._frameIntArray.length*Int16Array.BYTES_PER_ELEMENT,r=this._frameFloatArray.length*Float32Array.BYTES_PER_ELEMENT,n=this._frameArray.length*Int16Array.BYTES_PER_ELEMENT,o=this._timelineArray.length*Uint16Array.BYTES_PER_ELEMENT,s=this._colorArray.length*Int16Array.BYTES_PER_ELEMENT,_=new ArrayBuffer(e+a+t+r+n+o+s),d=new Int16Array(_,0,this._intArray.length),m=new Float32Array(_,e,this._floatArray.length),p=new Int16Array(_,e+a,this._frameIntArray.length),f=new Float32Array(_,e+a+t,this._frameFloatArray.length),u=new Int16Array(_,e+a+t+r,this._frameArray.length),y=new Uint16Array(_,e+a+t+r+n,this._timelineArray.length),c=new Int16Array(_,e+a+t+r+n+o,this._colorArray.length),g=0,D=this._intArray.length;g<D;++g)d[g]=this._intArray[g];for(var g=0,D=this._floatArray.length;g<D;++g)m[g]=this._floatArray[g];for(var g=0,D=this._frameIntArray.length;g<D;++g)p[g]=this._frameIntArray[g];for(var g=0,D=this._frameFloatArray.length;g<D;++g)f[g]=this._frameFloatArray[g];for(var g=0,D=this._frameArray.length;g<D;++g)u[g]=this._frameArray[g];for(var g=0,D=this._timelineArray.length;g<D;++g)y[g]=this._timelineArray[g];for(var g=0,D=this._colorArray.length;g<D;++g)c[g]=this._colorArray[g];this._data.binary=_,this._data.intArray=d,this._data.floatArray=m,this._data.frameIntArray=p,this._data.frameFloatArray=f,this._data.frameArray=u,this._data.timelineArray=y,this._data.colorArray=c,this._defaultColorOffset=-1},n.prototype.parseDragonBonesData=function(a,t){void 0===t&&(t=1),console.assert(null!==a&&void 0!==a,"Data error.");var r=n._getString(a,e.DataParser.VERSION,""),i=n._getString(a,e.DataParser.COMPATIBLE_VERSION,"");if(0<=e.DataParser.DATA_VERSIONS.indexOf(r)||0<=e.DataParser.DATA_VERSIONS.indexOf(i)){var o=e.BaseObject.borrowObject(e.DragonBonesData);if(o.version=r,o.name=n._getString(a,e.DataParser.NAME,""),o.frameRate=n._getNumber(a,e.DataParser.FRAME_RATE,24),0===o.frameRate&&(o.frameRate=24),e.DataParser.ARMATURE in a){this._data=o,this._parseArray(a);for(var l=a[e.DataParser.ARMATURE],s=0,_=l,d;s<_.length;s++)d=_[s],o.addArmature(this._parseArmature(d,t));this._data.binary||this._modifyArray(),e.DataParser.STAGE in a?o.stage=o.getArmature(n._getString(a,e.DataParser.STAGE,"")):0<o.armatureNames.length&&(o.stage=o.getArmature(o.armatureNames[0])),this._data=null}return e.DataParser.TEXTURE_ATLAS in a&&(this._rawTextureAtlases=a[e.DataParser.TEXTURE_ATLAS]),o}return console.assert(!1,"Nonsupport data version: "+r+"\nPlease convert DragonBones data to support version.\nRead more: https://github.com/DragonBones/Tools/"),null},n.prototype.parseTextureAtlasData=function(a,t,r){if(void 0===r&&(r=1),console.assert(void 0!==a),null===a){if(null===this._rawTextureAtlases||0===this._rawTextureAtlases.length)return!1;var o=this._rawTextureAtlases[this._rawTextureAtlasIndex++];return this.parseTextureAtlasData(o,t,r),this._rawTextureAtlasIndex>=this._rawTextureAtlases.length&&(this._rawTextureAtlasIndex=0,this._rawTextureAtlases=null),!0}if(t.width=n._getNumber(a,e.DataParser.WIDTH,0),t.height=n._getNumber(a,e.DataParser.HEIGHT,0),t.scale=1===r?1/n._getNumber(a,e.DataParser.SCALE,1):r,t.name=n._getString(a,e.DataParser.NAME,""),t.imagePath=n._getString(a,e.DataParser.IMAGE_PATH,""),e.DataParser.SUB_TEXTURE in a)for(var s=a[e.DataParser.SUB_TEXTURE],_=0,d=s.length;_<d;++_){var l=s[_],m=n._getNumber(l,e.DataParser.FRAME_WIDTH,-1),p=n._getNumber(l,e.DataParser.FRAME_HEIGHT,-1),f=t.createTexture();f.rotated=n._getBoolean(l,e.DataParser.ROTATED,!1),f.name=n._getString(l,e.DataParser.NAME,""),f.region.x=n._getNumber(l,e.DataParser.X,0),f.region.y=n._getNumber(l,e.DataParser.Y,0),f.region.width=n._getNumber(l,e.DataParser.WIDTH,0),f.region.height=n._getNumber(l,e.DataParser.HEIGHT,0),0<m&&0<p&&(f.frame=e.TextureData.createRectangle(),f.frame.x=n._getNumber(l,e.DataParser.FRAME_X,0),f.frame.y=n._getNumber(l,e.DataParser.FRAME_Y,0),f.frame.width=m,f.frame.height=p),t.addTexture(f)}return!0},n.getInstance=function(){return null===n._objectDataParserInstance&&(n._objectDataParserInstance=new n),n._objectDataParserInstance},n._objectDataParserInstance=null,n}(e.DataParser);e.ObjectDataParser=t;var r=function(){return function(){this.frameStart=0,this.actions=[]}}();e.ActionFrame=r})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=Math.pow,t=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype._inRange=function(e,a,t){return a<=e&&e<=t},r.prototype._decodeUTF8=function(e){for(var t=String.fromCharCode,r=0,n="",i=0,o=0,l=0,s=0,_,d;e.length>r;){if(d=e[r++],-1===d)_=0==o?-1:65533;else if(0==o)this._inRange(d,0,127)?_=d:(this._inRange(d,194,223)?(o=1,s=128,i=d-192):this._inRange(d,224,239)?(o=2,s=2048,i=d-224):this._inRange(d,240,244)&&(o=3,s=65536,i=d-240),i*=a(64,o),_=null);else if(!this._inRange(d,128,191))i=0,o=0,l=0,s=0,r--,_=d;else if(l+=1,i+=(d-128)*a(64,o-l),l!=o)_=null;else{var m=i,p=s;i=0,o=0,l=0,s=0,_=this._inRange(m,p,1114111)&&!this._inRange(m,55296,57343)?m:d}null!==_&&-1!==_&&(65535>=_?0<_&&(n+=t(_)):(_-=65536,n+=t(55296+(1023&_>>10)),n+=t(56320+(1023&_))))}return n},r.prototype._parseBinaryTimeline=function(a,t,r){void 0===r&&(r=null);var n=null===r?e.BaseObject.borrowObject(e.TimelineData):r;n.type=a,n.offset=t,this._timeline=n;var o=this._timelineArrayBuffer[n.offset+2];if(1===o)n.frameIndicesOffset=-1;else{var l=0,s=this._animation.frameCount+1,_=this._data.frameIndices;l=_.length,_.length+=s,n.frameIndicesOffset=l;for(var d=0,m=0,p=0,f=0;d<s;++d)p+f<=d&&m<o&&(p=this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[n.offset+5+m]],f=m==o-1?this._animation.frameCount-p:this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[n.offset+5+m+1]]-p,m++),_[l+d]=m-1}return this._timeline=null,n},r.prototype._parseAnimation=function(a){var t=e.BaseObject.borrowObject(e.AnimationData);t.blendType=e.DataParser._getAnimationBlendType(e.ObjectDataParser._getString(a,e.DataParser.BLEND_TYPE,"")),t.frameCount=e.ObjectDataParser._getNumber(a,e.DataParser.DURATION,0),t.playTimes=e.ObjectDataParser._getNumber(a,e.DataParser.PLAY_TIMES,1),t.duration=t.frameCount/this._armature.frameRate,t.fadeInTime=e.ObjectDataParser._getNumber(a,e.DataParser.FADE_IN_TIME,0),t.scale=e.ObjectDataParser._getNumber(a,e.DataParser.SCALE,1),t.name=e.ObjectDataParser._getString(a,e.DataParser.NAME,e.DataParser.DEFAULT_NAME),0===t.name.length&&(t.name=e.DataParser.DEFAULT_NAME);var r=a[e.DataParser.OFFSET];if(t.frameIntOffset=r[0],t.frameFloatOffset=r[1],t.frameOffset=r[2],this._animation=t,e.DataParser.ACTION in a&&(t.actionTimeline=this._parseBinaryTimeline(0,a[e.DataParser.ACTION])),e.DataParser.Z_ORDER in a&&(t.zOrderTimeline=this._parseBinaryTimeline(1,a[e.DataParser.Z_ORDER])),e.DataParser.BONE in a){var n=a[e.DataParser.BONE];for(var o in n){var s=n[o],_=this._armature.getBone(o);if(null!==_)for(var d=0,m=s.length;d<m;d+=2){var p=s[d],f=s[d+1],u=this._parseBinaryTimeline(p,f);this._animation.addBoneTimeline(_.name,u)}}}if(e.DataParser.SLOT in a){var n=a[e.DataParser.SLOT];for(var o in n){var s=n[o],y=this._armature.getSlot(o);if(null!==y)for(var d=0,m=s.length;d<m;d+=2){var p=s[d],f=s[d+1],u=this._parseBinaryTimeline(p,f);this._animation.addSlotTimeline(y.name,u)}}}if(e.DataParser.CONSTRAINT in a){var n=a[e.DataParser.CONSTRAINT];for(var o in n){var s=n[o],c=this._armature.getConstraint(o);if(null!==c)for(var d=0,m=s.length;d<m;d+=2){var p=s[d],f=s[d+1],u=this._parseBinaryTimeline(p,f);this._animation.addConstraintTimeline(c.name,u)}}}if(e.DataParser.TIMELINE in a)for(var s=a[e.DataParser.TIMELINE],g=0,D=s;g<D.length;g++){var h=D[g],f=e.ObjectDataParser._getNumber(h,e.DataParser.OFFSET,0);if(0<=f){var p=e.ObjectDataParser._getNumber(h,e.DataParser.TYPE,0),T=e.ObjectDataParser._getString(h,e.DataParser.NAME,""),u=null;if(40===p&&0!==t.blendType){u=e.BaseObject.borrowObject(e.AnimationTimelineData);var b=u;b.x=e.ObjectDataParser._getNumber(h,e.DataParser.X,0),b.y=e.ObjectDataParser._getNumber(h,e.DataParser.Y,0)}switch(u=this._parseBinaryTimeline(p,f,u),p){case 0:break;case 1:break;case 11:case 12:case 13:case 50:case 60:this._animation.addBoneTimeline(T,u);break;case 20:case 21:case 22:case 23:case 24:this._animation.addSlotTimeline(T,u);break;case 30:this._animation.addConstraintTimeline(T,u);break;case 40:case 41:case 42:this._animation.addAnimationTimeline(T,u);}}}return this._animation=null,t},r.prototype._parseGeometry=function(a,t){t.offset=a[e.DataParser.OFFSET],t.data=this._data;var r=this._intArrayBuffer[t.offset+3];if(0<=r){var n=e.BaseObject.borrowObject(e.WeightData),o=this._intArrayBuffer[t.offset+0],l=this._intArrayBuffer[r+0];n.offset=r;for(var s=0,_;s<l;++s)_=this._intArrayBuffer[r+2+s],n.addBone(this._rawBones[_]);for(var d=r+2+l,m=0,s=0,p;s<o;++s)p=this._intArrayBuffer[d++],m+=p,d+=p;n.count=m,t.weight=n}},r.prototype._parseArray=function(a){var t=a[e.DataParser.OFFSET],r=t[1],n=t[3],i=t[5],o=t[7],l=t[9],s=t[11],_=12<t.length?t[13]:0,d=new Int16Array(this._binary,this._binaryOffset+t[0],r/Int16Array.BYTES_PER_ELEMENT),m=new Float32Array(this._binary,this._binaryOffset+t[2],n/Float32Array.BYTES_PER_ELEMENT),p=new Int16Array(this._binary,this._binaryOffset+t[4],i/Int16Array.BYTES_PER_ELEMENT),f=new Float32Array(this._binary,this._binaryOffset+t[6],o/Float32Array.BYTES_PER_ELEMENT),u=new Int16Array(this._binary,this._binaryOffset+t[8],l/Int16Array.BYTES_PER_ELEMENT),y=new Uint16Array(this._binary,this._binaryOffset+t[10],s/Uint16Array.BYTES_PER_ELEMENT),c=0<_?new Int16Array(this._binary,this._binaryOffset+t[12],_/Int16Array.BYTES_PER_ELEMENT):d;this._data.binary=this._binary,this._data.intArray=this._intArrayBuffer=d,this._data.floatArray=m,this._data.frameIntArray=p,this._data.frameFloatArray=f,this._data.frameArray=this._frameArrayBuffer=u,this._data.timelineArray=this._timelineArrayBuffer=y,this._data.colorArray=c},r.prototype.parseDragonBonesData=function(e,a){void 0===a&&(a=1),console.assert(null!==e&&void 0!==e&&e instanceof ArrayBuffer,"Data error.");var r=new Uint8Array(e,0,8);if(68!==r[0]||66!==r[1]||68!==r[2]||84!==r[3])return console.assert(!1,"Nonsupport data."),null;var n=new Uint32Array(e,8,1)[0],i=new Uint8Array(e,12,n),o=this._decodeUTF8(i),l=JSON.parse(o);return this._binaryOffset=12+n,this._binary=e,t.prototype.parseDragonBonesData.call(this,l,a)},r.getInstance=function(){return null===r._binaryDataParserInstance&&(r._binaryDataParserInstance=new r),r._binaryDataParserInstance},r._binaryDataParserInstance=null,r}(e.ObjectDataParser);e.BinaryDataParser=t})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(){function a(t){void 0===t&&(t=null),this.autoSearch=!1,this._dragonBonesDataMap={},this._textureAtlasDataMap={},this._dragonBones=null,this._dataParser=null,null===a._objectParser&&(a._objectParser=new e.ObjectDataParser),null===a._binaryParser&&(a._binaryParser=new e.BinaryDataParser),this._dataParser=null===t?a._objectParser:t}return a.prototype._isSupportMesh=function(){return!0},a.prototype._getTextureData=function(e,a){if(e in this._textureAtlasDataMap)for(var t=0,r=this._textureAtlasDataMap[e];t<r.length;t++){var n=r[t],i=n.getTexture(a);if(null!==i)return i}if(this.autoSearch)for(var o in this._textureAtlasDataMap)for(var l=0,s=this._textureAtlasDataMap[o],n;l<s.length;l++)if(n=s[l],n.autoSearch){var i=n.getTexture(a);if(null!==i)return i}return null},a.prototype._fillBuildArmaturePackage=function(e,a,t,r,n){var i=null,o=null;if(0<a.length&&a in this._dragonBonesDataMap&&(i=this._dragonBonesDataMap[a],o=i.getArmature(t)),null===o&&(0===a.length||this.autoSearch))for(var l in this._dragonBonesDataMap)if(i=this._dragonBonesDataMap[l],(0===a.length||i.autoSearch)&&(o=i.getArmature(t),null!==o)){a=l;break}if(null!==o){if(e.dataName=a,e.textureAtlasName=n,e.data=i,e.armature=o,e.skin=null,0<r.length&&(e.skin=o.getSkin(r),null===e.skin&&this.autoSearch))for(var l in this._dragonBonesDataMap){var s=this._dragonBonesDataMap[l],_=s.getArmature(r);if(null!==_){e.skin=_.defaultSkin;break}}return null===e.skin&&(e.skin=o.defaultSkin),!0}return!1},a.prototype._buildBones=function(a,t){for(var r=0,n=a.armature.sortedBones;r<n.length;r++){var i=n[r],o=e.BaseObject.borrowObject(0===i.type?e.Bone:e.Surface);o.init(i,t)}},a.prototype._buildSlots=function(e,a){var t=e.skin,r=e.armature.defaultSkin;if(null!==t&&null!==r){var n={};for(var o in r.displays){var s=r.getDisplays(o);n[o]=s}if(t!==r)for(var o in t.displays){var s=t.getDisplays(o);n[o]=s}for(var _=0,d=e.armature.sortedSlots;_<d.length;_++){var m=d[_],p=m.name in n?n[m.name]:null,f=this._buildSlot(e,m,a);if(null!==p){f.displayFrameCount=p.length;for(var u=0,y=f.displayFrameCount,l;u<y;++u)if(l=p[u],f.replaceRawDisplayData(l,u),null!==l){if(0<e.textureAtlasName.length){var c=this._getTextureData(e.textureAtlasName,l.path);f.replaceTextureData(c,u)}var g=this._getSlotDisplay(e,l,f);f.replaceDisplay(g,u)}else f.replaceDisplay(null)}f._setDisplayIndex(m.displayIndex,!0)}}},a.prototype._buildConstraints=function(a,t){var r=a.armature.constraints;for(var n in r){var i=r[n];switch(i.type){case 0:var o=e.BaseObject.borrowObject(e.IKConstraint);o.init(i,t),t._addConstraint(o);break;case 1:var l=e.BaseObject.borrowObject(e.PathConstraint);l.init(i,t),t._addConstraint(l);break;default:var s=e.BaseObject.borrowObject(e.IKConstraint);s.init(i,t),t._addConstraint(s);}}},a.prototype._buildChildArmature=function(e,a,t){return this.buildArmature(t.path,null===e?"":e.dataName,"",null===e?"":e.textureAtlasName)},a.prototype._getSlotDisplay=function(a,t,r){var n=null===a?t.parent.parent.parent.name:a.dataName,i=null;switch(t.type){case 0:{var o=t;null===o.texture&&(o.texture=this._getTextureData(n,t.path)),i=r.rawDisplay;break}case 2:{var l=t;null===l.texture&&(l.texture=this._getTextureData(n,l.path)),i=this._isSupportMesh()?r.meshDisplay:r.rawDisplay;break}case 1:{var s=t,_=this._buildChildArmature(a,r,s);if(null!==_){if(_.inheritAnimation=s.inheritAnimation,!_.inheritAnimation){var d=0<s.actions.length?s.actions:_.armatureData.defaultActions;if(0<d.length)for(var m=0,p=d;m<p.length;m++){var f=p[m],u=e.BaseObject.borrowObject(e.EventObject);e.EventObject.actionDataToInstance(f,u,r.armature),u.slot=r,r.armature._bufferAction(u,!1)}else _.animation.play()}s.armature=_.armatureData}i=_;break}case 3:break;default:}return i},a.prototype.parseDragonBonesData=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=1);for(var n=e instanceof ArrayBuffer?a._binaryParser:this._dataParser,i=n.parseDragonBonesData(e,r),o;;)if(o=this._buildTextureAtlasData(null,null),n.parseTextureAtlasData(null,o,r))this.addTextureAtlasData(o,t);else{o.returnToPool();break}return null!==i&&this.addDragonBonesData(i,t),i},a.prototype.parseTextureAtlasData=function(e,a,t,r){void 0===t&&(t=null),void 0===r&&(r=1);var n=this._buildTextureAtlasData(null,null);return this._dataParser.parseTextureAtlasData(e,n,r),this._buildTextureAtlasData(n,a||null),this.addTextureAtlasData(n,t),n},a.prototype.updateTextureAtlases=function(e,a){var t=this.getTextureAtlasData(a);if(null!==t)for(var r=0,n=t.length;r<n;++r)r<e.length&&this._buildTextureAtlasData(t[r],e[r])},a.prototype.getDragonBonesData=function(e){return e in this._dragonBonesDataMap?this._dragonBonesDataMap[e]:null},a.prototype.addDragonBonesData=function(e,a){return(void 0===a&&(a=null),a=null===a?e.name:a,a in this._dragonBonesDataMap)?this._dragonBonesDataMap[a]===e?void 0:void console.warn("Can not add same name data: "+a):void(this._dragonBonesDataMap[a]=e)},a.prototype.removeDragonBonesData=function(e,a){void 0===a&&(a=!0),e in this._dragonBonesDataMap&&(a&&this._dragonBones.bufferObject(this._dragonBonesDataMap[e]),delete this._dragonBonesDataMap[e])},a.prototype.getTextureAtlasData=function(e){return e in this._textureAtlasDataMap?this._textureAtlasDataMap[e]:null},a.prototype.addTextureAtlasData=function(e,a){void 0===a&&(a=null),a=null===a?e.name:a;var t=a in this._textureAtlasDataMap?this._textureAtlasDataMap[a]:this._textureAtlasDataMap[a]=[];0>t.indexOf(e)&&t.push(e)},a.prototype.removeTextureAtlasData=function(e,a){if(void 0===a&&(a=!0),e in this._textureAtlasDataMap){var t=this._textureAtlasDataMap[e];if(a)for(var r=0,n=t,i;r<n.length;r++)i=n[r],this._dragonBones.bufferObject(i);delete this._textureAtlasDataMap[e]}},a.prototype.getArmatureData=function(e,a){void 0===a&&(a="");var r=new t;return this._fillBuildArmaturePackage(r,a,e,"","")?r.armature:null},a.prototype.clear=function(e){for(var a in void 0===e&&(e=!0),this._dragonBonesDataMap)e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[a]),delete this._dragonBonesDataMap[a];for(var a in this._textureAtlasDataMap){if(e)for(var t=this._textureAtlasDataMap[a],r=0,n=t,i;r<n.length;r++)i=n[r],this._dragonBones.bufferObject(i);delete this._textureAtlasDataMap[a]}},a.prototype.buildArmature=function(e,a,r,n){void 0===a&&(a=""),void 0===r&&(r=""),void 0===n&&(n="");var i=new t;if(!this._fillBuildArmaturePackage(i,a||"",e,r||"",n||""))return console.warn("No armature data: "+e+", "+(null===a?"":a)),null;var o=this._buildArmature(i);return this._buildBones(i,o),this._buildSlots(i,o),this._buildConstraints(i,o),o.invalidUpdate(null,!0),o.advanceTime(0),o},a.prototype.replaceDisplay=function(e,a,t){if(void 0===t&&(t=-1),0>t&&(t=e.displayIndex),0>t&&(t=0),e.replaceDisplayData(a,t),null!==a){var r=this._getSlotDisplay(null,a,e);if(0===a.type){var n=e.getDisplayFrameAt(t).rawDisplayData;null!==n&&2===n.type&&(r=e.meshDisplay)}e.replaceDisplay(r,t)}else e.replaceDisplay(null,t)},a.prototype.replaceSlotDisplay=function(e,a,t,r,n,i){void 0===i&&(i=-1);var o=this.getArmatureData(a,e||"");if(null===o||null===o.defaultSkin)return!1;var l=o.defaultSkin.getDisplay(t,r);return this.replaceDisplay(n,l,i),!0},a.prototype.replaceSlotDisplayList=function(e,a,t,r){var n=this.getArmatureData(a,e||"");if(!n||!n.defaultSkin)return!1;var o=n.defaultSkin.getDisplays(t);if(!o)return!1;r.displayFrameCount=o.length;for(var s=0,_=r.displayFrameCount,l;s<_;++s)l=o[s],this.replaceDisplay(r,l,s);return!0},a.prototype.replaceSkin=function(e,a,t,r){void 0===t&&(t=!1),void 0===r&&(r=null);for(var n=!1,o=a.parent.defaultSkin,s=0,_=e.getSlots(),d;s<_.length;s++)if(d=_[s],!(null!==r&&0<=r.indexOf(d.name))){var m=a.getDisplays(d.name);if(null===m&&(null!==o&&a!==o&&(m=o.getDisplays(d.name)),null===m)){t&&(d.displayFrameCount=0);continue}d.displayFrameCount=m.length;for(var p=0,f=d.displayFrameCount,l;p<f;++p)l=m[p],d.replaceRawDisplayData(l,p),null===l?d.replaceDisplay(null,p):d.replaceDisplay(this._getSlotDisplay(null,l,d),p);n=!0}return n},a.prototype.replaceAnimation=function(a,t,r){void 0===r&&(r=!0);var n=t.defaultSkin;if(null===n)return!1;if(r)a.animation.animations=t.animations;else{var i=a.animation.animations,o={};for(var l in i)o[l]=i[l];for(var l in t.animations)o[l]=t.animations[l];a.animation.animations=o}for(var s=0,_=a.getSlots();s<_.length;s++)for(var d=_[s],m=0,p=0,f=d.displayList,u;p<f.length;p++){if(u=f[p],u instanceof e.Armature){var y=n.getDisplays(d.name);if(null!==y&&m<y.length){var c=y[m];if(null!==c&&1===c.type){var g=this.getArmatureData(c.path,c.parent.parent.parent.name);g&&this.replaceAnimation(u,g,r)}}}m++}return!0},a.prototype.getAllDragonBonesData=function(){return this._dragonBonesDataMap},a.prototype.getAllTextureAtlasData=function(){return this._textureAtlasDataMap},Object.defineProperty(a.prototype,"clock",{get:function(){return this._dragonBones.clock},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"dragonBones",{get:function(){return this._dragonBones},enumerable:!0,configurable:!0}),a._objectParser=null,a._binaryParser=null,a}();e.BaseFactory=a;var t=function(){return function(){this.dataName="",this.textureAtlasName="",this.skin=null}}();e.BuildArmaturePackage=t})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(a){function r(){var e=null!==a&&a.apply(this,arguments)||this;return e._renderTexture=null,e}return __extends(r,a),r.toString=function(){return"[class dragonBones.b5TextureAtlasData]"},r.prototype._onClear=function(){a.prototype._onClear.call(this),null!==this._renderTexture,this._renderTexture=null},r.prototype.createTexture=function(){return e.BaseObject.borrowObject(t)},Object.defineProperty(r.prototype,"renderTexture",{get:function(){return this._renderTexture},set:function(e){if(this._renderTexture!==e)if(this._renderTexture=e,null!==this._renderTexture)for(var a in this.textures){var t=this.textures[a];t.renderTexture=new b5.ImageAtlas(t.name,this._renderTexture.bitmap,t.region.x,t.region.y,t.region.width,t.region.height,0,0)}else for(var a in this.textures){var t=this.textures[a];t.renderTexture=null}},enumerable:!0,configurable:!0}),r}(e.TextureAtlasData);e.b5TextureAtlasData=a;var t=function(e){function a(){var a=null!==e&&e.apply(this,arguments)||this;return a.renderTexture=null,a}return __extends(a,e),a.toString=function(){return"[class dragonBones.b5TextureData]"},a.prototype._onClear=function(){e.prototype._onClear.call(this),null!==this.renderTexture&&this.renderTexture.destroy(!1),this.renderTexture=null},a}(e.TextureData);e.b5TextureData=t})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(a){function t(){var e=null!==a&&a.apply(this,arguments)||this;return e.debugDraw=!1,e._debugDraw=!1,e._armature=null,e._debugDrawer=null,e}return __extends(t,a),t.prototype.dbInit=function(e){this._armature=e},t.prototype.dbClear=function(){null!==this._debugDrawer&&this._debugDrawer.destroy(!0),this._armature=null,this._debugDrawer=null,a.prototype.destroy.call(this)},t.prototype.dbUpdate=function(){e.DragonBones.debugDraw||this.debugDraw},t.prototype.dispose=function(e){void 0===e&&(e=!0),e,null!==this._armature&&(this._armature.dispose(),this._armature=null)},t.prototype.destroy=function(){this.dispose()},t.prototype.dispatchDBEvent=function(e,a){this.emit(e,a)},t.prototype.hasDBEventListener=function(){return!1},t.prototype.addDBEventListener=function(e,a,t){this.addListener(e,a,t)},t.prototype.removeDBEventListener=function(e,a,t){this.removeListener(e,a,t)},Object.defineProperty(t.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),t}(b5.Actor);e.b5ArmatureDisplay=a})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(a){function t(){return null!==a&&a.apply(this,arguments)||this}return __extends(t,a),t.toString=function(){return"[class dragonBones.b5Slot]"},t.prototype._onClear=function(){a.prototype._onClear.call(this),this._textureScale=1,this._renderDisplay=null},t.prototype._initDisplay=function(e,a){e,a},t.prototype._disposeDisplay=function(e,a){e,a||e.destroy()},t.prototype._onUpdateDisplay=function(){this._renderDisplay=this._display?this._display:this._rawDisplay},t.prototype._addDisplay=function(){var e=this._armature.display;e.addActor(this._renderDisplay)},t.prototype._replaceDisplay=function(e){var a=this._armature.display,t=e;a.addActor(this._renderDisplay);var r=t.getSlot();this._renderDisplay,moveToSlot(r),t.destroy(),this._textureScale=1},t.prototype._removeDisplay=function(){this._renderDisplay.destroy()},t.prototype._updateZOrder=function(){var e=this._armature.display,a=this._renderDisplay.getSlot();e.addActor(this._renderDisplay),this._renderDisplay.moveToSlot(this._zOrder)},t.prototype._updateVisible=function(){this._renderDisplay.visible=this._parent.visible&&this._visible},t.prototype._updateBlendMode=function(){if(this._renderDisplay instanceof b5.Actor)switch(this._blendMode){case 0:this._renderDisplay.composite_op="source-over";break;case 1:this._renderDisplay.composite_op="screen";break;case 3:this._renderDisplay.composite_op="darken";break;case 4:this._renderDisplay.composite_op="difference";break;case 6:this._renderDisplay.composite_op="hard-light";break;case 9:this._renderDisplay.composite_op="soft-light";break;case 10:this._renderDisplay.composite_op="multiply";break;case 11:this._renderDisplay.composite_op="overlay";break;case 12:this._renderDisplay.composite_op="screen";break;default:}},t.prototype._updateColor=function(){var e=this._colorTransform.alphaMultiplier*this._globalAlpha;this._renderDisplay.opacity=e},t.prototype._updateFrame=function(){var a=this._textureData;if(0<=this._displayIndex&&null!==this._display&&null!==a){var t=a.parent;null!==this._armature.replacedTexture&&(null===this._armature._replaceTextureAtlasData?(t=e.BaseObject.borrowObject(e.b5TextureAtlasData),t.copyFrom(a.parent),t.renderTexture=this._armature.replacedTexture,this._armature._replaceTextureAtlasData=t):t=this._armature._replaceTextureAtlasData,a=t.getTexture(a.name));var r=a.renderTexture;if(null!==r){if(null!==this._geometryData);else{this._textureScale=a.parent.scale*this._armature._armatureData.scale;var n=this._renderDisplay;n._atlas=r}return void(this._visibleDirty=!0)}}if(null!==this._geometryData);else{var n=this._renderDisplay;n._atlas=null,n.x=0,n.y=0,n.visible=!1}},t.prototype._updateMesh=function(){},t.prototype._updateTransform=function(){this.updateGlobalTransform();var e=this._renderDisplay.atlas.frames[0],a=e.w/2,t=e.h/2,r=this.global;if(this._renderDisplay===this._rawDisplay||this._renderDisplay===this._meshDisplay){var n=r.x-(this.globalTransformMatrix.a*(this._pivotX-a)+this.globalTransformMatrix.c*(this._pivotY-t)),i=r.y-(this.globalTransformMatrix.b*(this._pivotX-a)+this.globalTransformMatrix.d*(this._pivotY-t));this._renderDisplay.x=n,this._renderDisplay.y=i,this._renderDisplay.scale_x=r.scaleX*this._textureScale,this._renderDisplay.scale_y=r.scaleY*this._textureScale,this._renderDisplay.skew=r.skew,this._renderDisplay.rotation=r.rotation,this._renderDisplay.dirty()}else this._renderDisplay.x=r.x-a,this._renderDisplay.y=r.y-t,this._renderDisplay.scale_x=r.scaleX*this._textureScale,this._renderDisplay.scale_y=r.scaleY*this._textureScale,this._renderDisplay.skew=r.skew,this._renderDisplay.rotation=r.rotation,this._renderDisplay.dirty()},t.prototype._identityTransform=function(){var e=this._renderDisplay.w/2,a=this._renderDisplay.h/2;this._renderDisplay.x=0-e,this._renderDisplay.y=0-a,this._renderDisplay.scaleX=1,this._renderDisplay.scaleY=1,this._renderDisplay.skew=0,this._renderDisplay.rotation=0,this._renderDisplay.dirty()},t}(e.Slot);e.b5Slot=a})(dragonBones||(dragonBones={}));var dragonBones;(function(e){var a=function(a){function t(r){void 0===r&&(r=null);var n=a.call(this,r)||this;if(null===t._dragonBonesInstance){var i=new e.b5ArmatureDisplay;t._dragonBonesInstance=new e.DragonBones(i),b5.app.addTask("dragon_tick",0,-1,function(){t._dragonBonesInstance.advanceTime(b5.app.dt)})}return n._dragonBones=t._dragonBonesInstance,n}return __extends(t,a),Object.defineProperty(t,"factory",{get:function(){return null===t._factory&&(t._factory=new t),t._factory},enumerable:!0,configurable:!0}),t.prototype._buildTextureAtlasData=function(a,t){return a?a.renderTexture=t:a=e.BaseObject.borrowObject(e.b5TextureAtlasData),a},t.prototype._buildArmature=function(a){var t=e.BaseObject.borrowObject(e.Armature),r=new e.b5ArmatureDisplay;return t.init(a.armature,r,r,this._dragonBones),t},t.prototype._buildSlot=function(a,t,r){var n=e.BaseObject.borrowObject(e.b5Slot),i=new b5.Actor;return n.init(t,r,i,i),n},t.prototype.buildArmatureDisplay=function(e,a,t,r){void 0===a&&(a=""),void 0===t&&(t=""),void 0===r&&(r="");var n=this.buildArmature(e,a||"",t||"",r||"");return null===n?null:(this._dragonBones.clock.add(n),n.display)},t.prototype.getTextureDisplay=function(e,a){void 0===a&&(a=null);var t=this._getTextureData(null===a?"":a,e);if(null!==t&&null!==t.renderTexture){var r=new b5.Actor;return r._atlas=t.renderTexture,r}return null},Object.defineProperty(t.prototype,"soundEventManager",{get:function(){return this._dragonBones.eventManager},enumerable:!0,configurable:!0}),t._dragonBonesInstance=null,t._factory=null,t}(e.BaseFactory);e.b5Factory=a})(dragonBones||(dragonBones={}));