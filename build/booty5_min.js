(function(){for(var e=0,t=['ms','moz','webkit','o'],o=0;o<t.length&&!window.requestAnimationFrame;++o)window.requestAnimationFrame=window[t[o]+'RequestAnimationFrame'],window.cancelAnimationFrame=window[t[o]+'CancelAnimationFrame']||window[t[o]+'CancelRequestAnimationFrame'];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var o=new Date().getTime(),a=Math.max(0,16-(o-e)),n=window.setTimeout(function(){t(o+a)},a);return e=o+a,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})(),Array.prototype.includes||Object.defineProperty(Array.prototype,'includes',{value:function(e,t){function a(e,t){return e===t||'number'==typeof e&&'number'==typeof t&&isNaN(e)&&isNaN(t)}if(null==this)throw new TypeError('"this" is null or not defined');var r=Object(this),o=r.length>>>0;if(0==o)return!1;for(var i=0|t,n=Math.max(0<=i?i:o-Math.abs(i),0);n<o;){if(a(r[n],e))return!0;n++}return!1}}),String.prototype.startsWith||Object.defineProperty(String.prototype,'startsWith',{value:function(e,t){return t=!t||0>t?0:+t,this.substring(t,t+e.length)===e}});(function(e){if(!(e.visibilityState||e.webkitVisibilityState)){e.hidden=!1,e.visibilityState='visible';var t=null,o=function(){e.createEvent?(!t&&(t=e.createEvent('HTMLEvents'),t.initEvent('visibilitychange',!0,!0)),e.dispatchEvent(t)):'object'==typeof Visibility&&Visibility._change.call(Visibility,{})},a=function(){e.hidden=!1,e.visibilityState='visible',o()},n=function(){e.hidden=!0,e.visibilityState='hidden',o()};e.addEventListener?(window.addEventListener('focus',a,!0),window.addEventListener('blur',n,!0)):(e.attachEvent('onfocusin',a),e.attachEvent('onfocusout',n))}})(document);(function(e){var t=-1,o={onVisible:function(e){var t=o.isSupported();if(!t||!o.hidden())return e(),t;var a=o.change(function(){o.hidden()||(o.unbind(a),e())});return a},change:function(e){if(!o.isSupported())return!1;t+=1;var a=t;return o._callbacks[a]=e,o._listen(),a},unbind:function(e){delete o._callbacks[e]},afterPrerendering:function(t){var e=o.isSupported();if(!e||'prerender'!=o.state())return t(),e;var a=o.change(function(n,e){'prerender'!=e&&(o.unbind(a),t())});return a},hidden:function(){return!!(o._doc.hidden||o._doc.webkitHidden)},state:function(){return o._doc.visibilityState||o._doc.webkitVisibilityState||'visible'},isSupported:function(){return o._doc.hidden!==void 0||o._doc.webkitHidden!==void 0},_doc:document||{},_callbacks:{},_change:function(e){var t=o.state();for(var a in o._callbacks)o._callbacks[a].call(o._doc,e,t)},_listen:function(){if(!o._init){var e='visibilitychange';o._doc.webkitVisibilityState&&(e='webkit'+e);var t=function(){o._change.apply(o,arguments)};o._doc.addEventListener?o._doc.addEventListener(e,t):o._doc.attachEvent(e,t),o._init=!0}}};'undefined'!=typeof module&&module.exports?module.exports=o:e.Visibility=o})(this);(function(e){var t=-1,o=function(o){return o.every=function(e,a,n){o._time(),n||(n=a,a=null),t+=1;var r=t;return o._timers[r]={visible:e,hidden:a,callback:n},o._run(r,!1),o.isSupported()&&o._listen(),r},o.stop=function(e){return!!o._timers[e]&&(o._stop(e),delete o._timers[e],!0)},o._timers={},o._time=function(){o._timed||(o._timed=!0,o._wasHidden=o.hidden(),o.change(function(){o._stopRun(),o._wasHidden=o.hidden()}))},o._run=function(t,a){var n=o._timers[t],r;if(o.hidden()){if(null===n.hidden)return;r=n.hidden}else r=n.visible;var i=function(){n.last=new Date,n.callback.call(e)};if(a){var s=new Date,c=s-n.last;r>c?n.delay=setTimeout(function(){n.id=setInterval(i,r),i()},r-c):(n.id=setInterval(i,r),i())}else n.id=setInterval(i,r)},o._stop=function(e){var t=o._timers[e];clearInterval(t.id),clearTimeout(t.delay),delete t.id,delete t.delay},o._stopRun=function(){var e=o.hidden(),t=o._wasHidden;if(e&&!t||!e&&t)for(var a in o._timers)o._stop(a),o._run(a,!e)},o};'undefined'!=typeof module&&module.exports?module.exports=o(require('./visibility.core')):o(e.Visibility||require('./visibility.core'))})(window),'use strict';var b5={};b5.app=null,b5.data={},b5.version=1.54,function(){for(var e=0,t=['ms','moz','webkit','o'],o=0;o<t.length&&!window.requestAnimationFrame;++o)window.requestAnimationFrame=window[t[o]+'RequestAnimationFrame'],window.cancelAnimationFrame=window[t[o]+'CancelAnimationFrame']||window[t[o]+'CancelRequestAnimationFrame'];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var o=new Date().getTime(),a=Math.max(0,16-(o-e)),n=window.setTimeout(function(){t(o+a)},a);return e=o+a,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),'use strict',b5.Ease=function(){},b5.Ease.linear=0,b5.Ease.quadin=1,b5.Ease.quadout=2,b5.Ease.cubicin=3,b5.Ease.cubicout=4,b5.Ease.quartin=5,b5.Ease.quartout=6,b5.Ease.sin=7,b5.Ease.sinin=7,b5.Ease.sinout=8,b5.Ease.sininout=9,b5.Ease.quadinout=10,b5.Ease.cubicinout=11,b5.Ease.quarticinout=12,b5.Ease.bouncein=13,b5.Ease.bounceout=14,b5.Ease.bounceinout=15,b5.Ease.backin=16,b5.Ease.backout=17,b5.Ease.backinout=18,b5.Ease.circin=19,b5.Ease.circout=20,b5.Ease.circinout=21,b5.Ease.expin=22,b5.Ease.expout=23,b5.Ease.expinout=24,b5.Ease.easingFuncs=[function(e){return e},function(e){return e*e},function(e){return e*(2-e)},function(e){return e*e*e},function(e){return e-=1,e*e*e+1},function(e){return e*e*e*e},function(e){return e-=1,-(e*e*e*e-1)},function(e){return 1-Math.cos(e*Math.PI/2)},function(e){return Math.sin(e*Math.PI/2)},function(e){return .5*(1-Math.cos(Math.PI*e))},function(e){return .5>e?2*e*e:-1+(4-2*e)*e},function(e){return .5>e?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},function(e){return .5>e?8*e*e*e*e:1-8*--e*e*e*e},function(e){return 1-b5.Ease.easingFuncs[b5.Ease.bounceout](1-e)},function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},function(e){return .5>e?.5*b5.Ease.easingFuncs[b5.Ease.bounceout](2*e):.5*b5.Ease.easingFuncs[b5.Ease.bounceout](2*e-1)+.5},function(e){var t=1.70158;return e*e*((t+1)*e-t)},function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},function(e){var t=1.525*1.70158;e=1>(e*=2)?.5*(e*e*((t+1)*e-t)):.5*((e-=2)*e*((t+1)*e+t)+2)},function(e){return 1-Math.sqrt(1-e*e)},function(e){return Math.sqrt(1- --e*e)},function(e){var t=Math.sqrt;e*=2,e=1>e?-.5*(t(1-e*e)-1):.5*(t(1-(e-=2)*e)+1)},function(e){return 0==e?0:Math.pow(1024,e-1)},function(e){return 1==e?e:1-Math.pow(2,-10*e)},function(e){var t=Math.pow;return 0==e?0:1==e?1:1>(e*=2)?.5*t(1024,e-1):.5*(-t(2,-10*(e-1))+2)}],'use strict',b5.Animation=function(e,t,o,a,n,r,i){this.timeline=e,this.state=b5.Animation.AS_playing,this.time=-1e-6,this.repeats_left=r,this.index=-1,this.name=null,this.target=t,this.property=o,this.frames=a,this.times=n,this.easing=i,this.repeat=r,this.destroy=!0,this.actions=[],this.time_scale=1,this.delay=-.001,this.tween=!0,this.deactivate=!1},b5.Animation.AS_playing=0,b5.Animation.AS_paused=1,b5.Animation.prototype.setRelative=function(e){this.initial_value=e?this.target[this.property]:void 0},b5.Animation.prototype.pause=function(){this.state=b5.Animation.AS_paused},b5.Animation.prototype.play=function(){this.state=b5.Animation.AS_playing},b5.Animation.prototype.restart=function(){this.state=b5.Animation.AS_playing,this.time=this.delay,this.index=-1,this.repeats_left=this.repeat},b5.Animation.prototype.update=function(e){if(this.state!==b5.Animation.AS_playing)return!1;e*=this.time_scale;var o=this.time+e,a=this.times,n=this.frames,r=a.length,i=this.index;if(0>o){var s=n[0];return void 0!==this.initial_value&&(s+=this.initial_value),this.target[this.property]=s,this.time=o,!0}if(1>=r)return!1;for(var c=i,p;c<r;c++)if(p=a[c],o<p){if(this.index=c,o>=a[0]){if(this.index!==i){var d=this.actions[this.index-1];void 0!==d&&d()}var l=a[c-1],y=n[c-1],_=o-l;if(0!=_){var s;if(this.tween){var u=p-l,h=n[c]-y;s=void 0===this.easing?y+h*_/u:y+h*b5.Ease.easingFuncs[this.easing[c-1]](_/u)}else s=y;void 0!==this.initial_value&&(s+=this.initial_value),this.target[this.property]=s}}break}var g=a[a.length-1];if(o>g){if(0<this.repeat&&this.repeats_left--,0===this.repeat||0<this.repeats_left){for(;o>=g;)o-=g;void 0!==this.onRepeat&&this.onRepeat(this);var s=n[0];void 0!==this.initial_value&&(s+=this.initial_value),this.target[this.property]=s}else{var s=n[a.length-1];void 0!==this.initial_value&&(s+=this.initial_value),this.target[this.property]=s,this.state=b5.Animation.AS_paused,this.destroy&&this.timeline.remove(this),void 0!==this.onEnd&&this.onEnd(this),this.deactivate&&(this.target._av=!1)}this.index=-1}return this.time=o,!0},b5.Animation.prototype.setTime=function(e){this.time=e,this.index=-1,this.update(0)},b5.Animation.prototype.setAction=function(e,t){this.actions[e]=t},'use strict',b5.Timeline=function(e,t,o,a,n,r){this.anims=[],this.manager=null,this.name=null,this.playing=!1,e!==void 0&&this.add(e,t,o,a,n,r)},b5.Timeline.prototype.setRelative=function(e){for(var o=this.anims,a=o.length,n=0;n<a;n++)o[n].setRelative(e)},b5.Timeline.prototype.setRepeats=function(e){for(var o=this.anims,a=o.length,n=0;n<a;n++)o[n].repeat=e,o[n].repeats_left=e},b5.Timeline.prototype.add=function(e,t,o,a,n,r){if(1==arguments.length)return e.timeline=this,this.anims.push(e),e;var i=new b5.Animation(this,e,t,o,a,n,r);return this.anims.push(i),i},b5.Timeline.prototype.remove=function(e){for(var o=this.anims,a=o.length,n=0;n<a;n++)if(o[n]===e)return void o.splice(n,1)},b5.Timeline.prototype.changeTarget=function(e){for(var o=this.anims,a=o.length,n=0;n<a;n++)o[n].target=e},b5.Timeline.prototype.find=function(e){for(var o=this.anims,a=o.length,n=0;n<a;n++)if(o[n].name===e)return o[n];return null},b5.Timeline.prototype.setDelay=function(e){for(var o=this.anims,a=o.length,n=0;n<a;n++)o[n].delay=-e,o[n].time=-e},b5.Timeline.prototype.pause=function(){for(var e=this.anims.length,o=0;o<e;o++)this.anims[o].pause()},b5.Timeline.prototype.play=function(){for(var e=this.anims.length,o=0;o<e;o++)this.anims[o].play()},b5.Timeline.prototype.restart=function(){for(var e=this.anims.length,o=0;o<e;o++)this.anims[o].restart()},b5.Timeline.prototype.print=function(){for(var e=this.anims.length,o=0;o<e;o++)console.log(this.anims[o])},b5.Timeline.prototype.update=function(e){var o=this.anims.length;if(0===o&&void 0!==this.manager)return this.manager.remove(this),!0;this.playing=!1;for(var a=o-1;0<=a;a--)this.anims[a].update(e)&&(this.playing=!0);return this.playing},'use strict',b5.TimelineManager=function(){this.timelines=[],this.playing=!1},b5.TimelineManager.prototype.add=function(e){return this.timelines.push(e),e.manager=this,e},b5.TimelineManager.prototype.remove=function(e){if(void 0===e)return void(this.timelines=[]);for(var o=this.timelines,a=o.length,n=0;n<a;n++)if(o[n]===e)return void o.splice(n,1)},b5.TimelineManager.prototype.changeTarget=function(e){for(var o=this.timelines,a=o.length,n=0;n<a;n++)o[n].changeTarget(e)},b5.TimelineManager.prototype.find=function(e){for(var o=this.timelines,a=o.length,n=0;n<a;n++)if(o[n].name===e)return o[n];return null},b5.TimelineManager.prototype.setRepeats=function(e){for(var o=this.timelines,a=o.length,n=0;n<a;n++)o[n].setRepeats(e)},b5.TimelineManager.prototype.pause=function(){for(var e=this.timelines.length,o=0;o<e;o++)this.timelines[o].pause()},b5.TimelineManager.prototype.play=function(){for(var e=this.timelines.length,o=0;o<e;o++)this.timelines[o].play()},b5.TimelineManager.prototype.restart=function(){for(var e=this.timelines.length,o=0;o<e;o++)this.timelines[o].restart()},b5.TimelineManager.prototype.print=function(){for(var e=this.timelines.length,o=0;o<e;o++)console.log(this.timelines[o])},b5.TimelineManager.prototype.update=function(e){var o=this.timelines.length;if(0===o)return!1;this.playing=!1;for(var a=o-1;0<=a;a--)this.timelines[a].update(e)&&(this.playing=!0);return this.playing},'use strict',b5.ActionsRegister={creators:[],register:function(e,t){b5.ActionsRegister.creators[e]=t},create:function(e,t){return b5.ActionsRegister.creators[e](t)}},b5.ActionsList=function(e,t){this.repeats_left=t,this.manager=null,this.name=e,this.repeat=t,this.actions=[],this.current=0,this.destroy=!0,this.playing=!1},b5.ActionsList.prototype.add=function(e){return this.actions.push(e),e.parent=this,e},b5.ActionsList.prototype.remove=function(e){for(var o=this.actions,a=o.length,n=0;n<a;n++)if(o[n]===e)return void o.splice(n,1)},b5.ActionsList.prototype.execute=function(){if(!this.playing)return!0;var e=this.actions,t=e.length;if(0===t)return!1;var o=e[this.current];return!0!==o.initialised&&(void 0!==o.onInit&&o.onInit(),o.initialised=!0),void 0!==o.onTick&&o.onTick()||(o.initialised=!1,this.current++,!(this.current>=t&&(this.current=0,0!==this.repeat&&(this.repeats_left--,0>=this.repeats_left))))||(this.playing=!1,this.repeats_left=this.repeat,!1)},b5.ActionsList.prototype.pause=function(){this.playing=!1},b5.ActionsList.prototype.play=function(){this.playing=!0},b5.ActionsList.prototype.restart=function(){for(var e=this.actions,o=e.length,a=0;a<o;a++)e[a].initialised=!1;this.repeats_left=this.repeat,this.play()},b5.ActionsListManager=function(){this.actions=[]},b5.ActionsListManager.prototype.add=function(e){return this.actions.push(e),e.manager=this,e},b5.ActionsListManager.prototype.remove=function(e){for(var o=this.actions,a=o.length,n=0;n<a;n++)if(o[n]===e)return void o.splice(n,1)},b5.ActionsListManager.prototype.find=function(e){for(var o=this.actions,a=o.length,n=0;n<a;n++)if(o[n].name===e)return o[n];return null},b5.ActionsListManager.prototype.execute=function(){for(var e=[],o=this.actions,a=o.length,n=0;n<a;n++)o[n].execute()||o[n].destroy&&e.push(o[n]);for(var n=0;n<e.length;n++)this.remove(e[n])},'use strict',b5.EventsManager=function(){this.events=[]},b5.EventsManager.prototype.on=function(e,t,o){this.events.push({name:e,func:t,data:o})},b5.EventsManager.prototype.remove=function(e){var t=this.events,o=t.length;this.events=array.filter(function(t){return t.name!==e})},b5.EventsManager.prototype.clear=function(){this.events=[]},b5.EventsManager.prototype.dispatch=function(e){for(var o=this.events,a=o.length,n=0;n<a;n++)if(o[n].name===e)return void o[n].func(o[n])},'use strict',b5.Task=function(e,t,o,a,n){this.name=e,this.func=a,this.data=n,this.state=b5.Task.Stopped,this.running_time=0,this.delay=t,this.loops=0,this.repeat=o,this.last_time=0,this.wait=0,this.pause=function(){this.state=b5.Task.Paused},this.play=function(){this.state=b5.Task.Running},this.stop=function(){this.state=b5.Task.Stopped},0===t?this.play():this.state=b5.Task.Dormant},b5.Task.Dormant=0,b5.Task.Running=1,b5.Task.Paused=2,b5.Task.Stopped=3,b5.TasksQ=function(){this.q=!0,this.tasks=[]},b5.TasksQ.prototype.add=function(e,t,o,a,n){var r=new b5.Task(e,t,o,a,n);return this.tasks.push(r),r},b5.TasksQ.prototype.removeAt=function(e){this.tasks.splice(e,1)},b5.TasksQ.prototype.remove=function(e){for(var o=this.tasks,a=o.length,n=0;n<a;n++)if(o[n].name===e)return void o.splice(n,1)},b5.TasksQ.prototype.removeTask=function(e){for(var o=this.tasks,a=o.length,n=0;n<a;n++)if(o[n]===e)return void o.splice(n,1)},b5.TasksQ.prototype.find=function(e){for(var o=this.tasks,a=o.length,n=0;n<a;n++)if(o[n].name===e)return o[n];return null},b5.TasksQ.prototype.clear=function(){this.tasks=[]},b5.TasksQ.prototype.execute=function(){var e=b5.app.dt,t=this.tasks,o=t.length;if(0===o)return 0;var a=t[0];if(a.state===b5.Task.Dormant&&(a.running_time+=e,a.running_time>=a.delay&&(a.play(),a.running_time-=e)),a.state===b5.Task.Running){var n=!0;0!==a.wait&&(a.last_time+=e,a.last_time>=a.wait?a.last_time-=a.wait:n=!1),!0==n&&(a.func(a),a.running_time+=e,0>a.delay?a.stop():0<a.repeat&&(a.loops++,a.loops>=a.repeat&&(a.stop(),void 0!==a.onComplete&&a.onComplete(this),this.removeTask(a))))}return t.length},b5.TasksManager=function(){this.tasks=[]},b5.TasksManager.prototype.add=function(e,t,o,a,n){var r=new b5.Task(e,t,o,a,n);return this.tasks.push(r),r},b5.TasksManager.prototype.removeAt=function(e){this.tasks.splice(e,1)},b5.TasksManager.prototype.remove=function(e){for(var o=this.tasks,a=o.length,n=0;n<a;n++)if(o[n].name===e)return void o.splice(n,1)},b5.TasksManager.prototype.removeTask=function(e){for(var o=this.tasks,a=o.length,n=0;n<a;n++)if(o[n]===e)return void o.splice(n,1)},b5.TasksManager.prototype.find=function(e){for(var o=this.tasks,a=o.length,n=0;n<a;n++)if(o[n].name===e)return o[n];return null},b5.TasksManager.prototype.clear=function(){this.tasks=[]},b5.TasksManager.prototype.execute=function(){for(var e=[],o=b5.app.dt,a=this.tasks,n=a.length,r=0,i;r<n;r++)if(i=a[r],i.q)0===i.execute()&&(void 0!==i.onComplete&&i.onComplete(this),e.push(i));else if(i.state===b5.Task.Dormant&&(i.running_time+=o,i.running_time>=i.delay&&(i.play(),i.running_time-=o)),i.state===b5.Task.Running){var s=!0;0!==i.wait&&(i.last_time+=o,i.last_time>=i.wait?i.last_time-=i.wait:s=!1),s&&(i.func(i),i.running_time+=o,0>i.delay?i.stop():0<i.repeat&&(i.loops++,i.loops>=i.repeat&&(e.push(i),i.stop(),void 0!==i.onComplete&&i.onComplete(this))))}for(var r=0;r<e.length;r++)this.removeTask(e[r])},'use strict',b5.Actor=function(e){this.type=b5.Actor.Type_Image,this.scene=null,this.parent=null,this.actors=[],this.removals=[],this.joints=[],this.timelines=new b5.TimelineManager,b5.ActionsListManager!==void 0&&(this.actions=new b5.ActionsListManager),this.tasks=new b5.TasksManager,this.frame_count=0,this.accum_scale_x=1,this.accum_scale_y=1,this.accum_opacity=1,this.body=null,this.transform=[],this.transform_dirty=!0,this.layout_dirty=!0,this.touch_et=null,this.touching=!1,this.touchmove=!1,this.layer=0,this.order_changed=!0,this.cache_canvas=null,this.name='',this.tag='',this.id=-1,this.active=!0,this.visible=!0,this.touchable=!1,this.hit=!0,this.x=0,this.y=0,this.w=0,this.h=0,this.ox=0,this.oy=0,this.ignore_atlas_size=!1,this.absolute_origin=!0,this.rotation=0,this.scale_x=1,this.scale_y=1,this.depth=0,this.opacity=1,this.use_parent_opacity=!0,this.current_frame=0,this.prev_frame=0,this.frame_speed=0,this.anim_frames=null,this.frames_repeat=!1,this.bitmap=null,this.atlas=null,this.vr=0,this.vx=0,this.vy=0,this.vd=0,this.vr_damping=1,this.vx_damping=1,this.vy_damping=1,this.vd_damping=1,this.ignore_camera=!1,this.wrap_position=!1,this.dock_x=0,this.dock_y=0,this.dock_screen=!1,this.margin=[0,0,0,0],this.bubbling=!1,this.clip_children=!1,this.clip_margin=[0,0,0,0],this.clip_shape=null,this.self_clip=!1,this.orphaned=!1,this.virtual=!1,this.stacking=0,this.clip_virtual=!0,this.shadow=!1,this.shadow_x=0,this.shadow_y=0,this.shadow_blur=0,this.shadow_colour='#000000',this.composite_op=null,this.cache=!1,this.cached=!1,this.merge_cache=!1,this.round_pixels=!1,this.padding=0,this.scale_method=0,this.draw_reverse=!1,!0===e&&this.makeVirtual()},b5.Actor.FitNone=0,b5.Actor.FitPP=1,b5.Actor.FitX=2,b5.Actor.FitY=3,b5.Actor.FitBest=4,b5.Actor.FitAverage=5,b5.Actor.FitGreatest=6,b5.Actor.FitSmallest=7,b5.Actor.FitSize=8,b5.Actor.FitBest2=9,b5.Actor.Dock_None=0,b5.Actor.Dock_Top=1,b5.Actor.Dock_Bottom=2,b5.Actor.Dock_Left=1,b5.Actor.Dock_Right=2,b5.Actor.Type_Image=0,b5.Actor.Type_Label=1,b5.Actor.Type_Rect=2,b5.Actor.Type_Arc=3,b5.Actor.Type_Polygon=4,b5.Actor.Type_Particle=5,b5.Actor.Type_Map=6,b5.Actor.Stack_None=0,b5.Actor.Stack_H=1,b5.Actor.Stack_V=2,Object.defineProperty(b5.Actor.prototype,'_x',{get:function(){return this.x},set:function(e){this.x!==e&&(this.x=e,this.dirty())}}),Object.defineProperty(b5.Actor.prototype,'_y',{get:function(){return this.y},set:function(e){this.y!==e&&(this.y=e,this.dirty())}}),Object.defineProperty(b5.Actor.prototype,'_ox',{get:function(){return this.ox},set:function(e){this.ox!==e&&(this.ox=e,this.dirty())}}),Object.defineProperty(b5.Actor.prototype,'_oy',{get:function(){return this.oy},set:function(e){this.oy!==e&&(this.oy=e,this.dirty())}}),Object.defineProperty(b5.Actor.prototype,'_rotation',{get:function(){return this.rotation},set:function(e){this.rotation!==e&&(this.rotation=e,this.dirty())}}),Object.defineProperty(b5.Actor.prototype,'_scale_x',{get:function(){return this.scale_x},set:function(e){this.scale_x!==e&&(this.scale_x=e,this.dirty())}}),Object.defineProperty(b5.Actor.prototype,'_scale_y',{get:function(){return this.scale_y},set:function(e){this.scale_y!==e&&(this.scale_y=e,this.dirty())}}),Object.defineProperty(b5.Actor.prototype,'_scale',{set:function(e){this._scale_x=e,this._scale_y=e,this.dirty()}}),Object.defineProperty(b5.Actor.prototype,'_depth',{get:function(){return this.depth},set:function(e){this.depth!==e&&(this.depth=e,this.dirty())}}),Object.defineProperty(b5.Actor.prototype,'_layer',{get:function(){return this.layer},set:function(e){this.layer!==e&&(this.layer=e,null===this.parent?this.scene.order_changed=!0:this.parent.order_changed=!0)}}),Object.defineProperty(b5.Actor.prototype,'_atlas',{get:function(){return this.atlas},set:function(e){if(this.atlas!==e){if(null===e)return void(this.atlas=null);this.atlas=b5.Utils.resolveResource(e,'brush'),this.ignore_atlas_size||(this.ow=this.atlas.frames[0].w,this.oh=this.atlas.frames[0].h)}}}),Object.defineProperty(b5.Actor.prototype,'_bitmap',{get:function(){return this.bitmap},set:function(e){this.bitmap!==e&&(this.atlas=null,this.bitmap=b5.Utils.resolveResource(e,'bitmap'))}}),Object.defineProperty(b5.Actor.prototype,'_clip_shape',{get:function(){return this.clip_shape},set:function(e){this.clip_shape!==e&&(this.clip_shape=b5.Utils.resolveResource(e,'shape'))}}),Object.defineProperty(b5.Actor.prototype,'_av',{set:function(e){e!==this.visible&&this.onAVChanged!==void 0&&this.onAVChanged(e),this.visible=e,this.active=e,this.setBodyActive(this.active)}}),b5.Actor.prototype.setBodyActive=function(e){null!==this.body&&this.body.SetActive(e);for(var o=this.actors,a=o.length,n=0;n<a;n++)o[n].setBodyActive(e)},b5.Actor.prototype.setPosition=function(e,t){if((this.x!==e||this.y!==t)&&(this.x=e,this.y=t,this.dirty(),null!==this.body)){var o=Box2D.Common.Math.b2Vec2,a=this.scene.world_scale;this.body.SetPosition(new o(e/a,t/a))}},b5.Actor.prototype.setPositionPhysics=function(e,t){this.setPosition(e,t)},b5.Actor.prototype.setPosition=function(e,t){if((this.x!==e||this.y!==t)&&(this.x=e,this.y=t,this.dirty(),null!==this.body)){var o=Box2D.Common.Math.b2Vec2,a=this.scene.world_scale;this.body.SetPosition(new o(e/a,t/a))}},b5.Actor.prototype.setSize=function(e,t){(this.w!==e||this.h!==t)&&(this.ignore_atlas_size=!0,this.w=e,this.h=t,this.dirty(),this.virtual&&(this.layout_dirty=!0,this.Virtual_updateLayout(!0)))},b5.Actor.prototype.setOrigin=function(e,t){(this.ox!==e||this.oy!==t)&&(this.ox=e,this.oy=t,this.dirty())},b5.Actor.prototype.setScale=function(e,t){(this.scale_x!==e||this.scale_y!==t)&&(this.scale_x=e,this.scale_y=t,this.dirty())},b5.Actor.prototype.setRotation=function(e){this.rotation!==e&&(this.rotation=e,this.dirty(),null!==this.body&&this.body.SetAngle(e))},b5.Actor.prototype.setRotationPhysics=function(e){this.setRotation(e)},b5.Actor.prototype.setDepth=function(e){this.depth!==e&&(this.depth=e,this.dirty())},b5.Actor.prototype.playAnim=function(e,t){if(this.active||(this._av=!0),null!==this.atlas){var o=this.atlas.getAnim(e);null===o?this.app.debug&&console.log('Warning: Could not find brush anim \''+e+'\' for actor \''+this.name+'\''):(this.current_frame=0,this.anim_frames=o.indices,this.frame_speed=o.speed,this.frames_repeat=t,this.dirty())}},b5.Actor.prototype.playTimeline=function(e,o){var a=this.timelines.find(e);if(null!==a&&(!this.active&&(this._av=!0),a.restart(),a.update(0)),o)for(var n=this.actors,r=n.length,i=0;i<r;i++)n[i].playTimeline(e,o);return a},b5.Actor.prototype.TweenTo=function(e,t,o,a,n,r){!0===n&&this.timelines.remove();var i=new b5.Timeline(this,e,[this[e],t],[0,o],1,[a]);return void 0!==r&&i.setDelay(r),this.timelines.add(i),i},b5.Actor.prototype.TweenToWithEnd=function(e,t,o,a,n,r,i){var s=this.TweenTo(e,t,o,a,n,r);return null!=i&&(s.anims[0].onEnd=i),s},b5.Actor.prototype.TweenToMany=function(e){for(var o=0;o<e.length;o++){var a=e[o],n=!(0!==o)&&a.wipe;this.TweenToWithEnd(a.property,a.to,a.duration,a.easing,n,a.delay,a.onend)}},b5.Actor.prototype.TweenFrom=function(e,t,o,a,n){!0===n&&this.timelines.remove(),this.timelines.add(new b5.Timeline(this,e,[t,this[e]],[0,o],1,[a]))},b5.Actor.prototype.addTask=function(e,t,o,a,n){this.tasks.add(e,t,o,a,n)},b5.Actor.prototype.removeTask=function(e){this.tasks.remove(e)},b5.Actor.prototype.release=function(){this.onDestroy!==void 0&&this.onDestroy(),this.releaseJoints(),this.releaseBody()},b5.Actor.prototype.destroy=function(){null===this.parent?null!==this.scene&&this.scene.removeActor(this):this.parent.removeActor(this)},b5.Actor.prototype.changeParent=function(e){var o=null===this.parent?this.scene.actors:this.parent.actors;for(var a=o.length,n=0;n<a;n++)if(this===o[n]){o.splice(n,1),e.addActor(this);break}},b5.Actor.prototype.addActor=function(e){return null===this.scene&&(this.scene=b5.app.focus_scene),this.actors.push(e),e.parent=this,e.scene=this.scene,this.layout_dirty=!0,e},b5.Actor.prototype.removeActor=function(e){this.removals.push(e),this.layout_dirty=!0},b5.Actor.prototype.removeActorsWithTag=function(e){for(var o=this.actors,a=o.length,n=0,r=this.removals,i=0;i<a;i++)o[i].tag===e&&(r.push(o[i]),n++);return this.layout_dirty=!0,n},b5.Actor.prototype.removeAllActors=function(){for(var e=this.actors,o=e.length,a=this.removals,n=0;n<o;n++)a.push(e[n]);this.layout_dirty=!0},b5.Actor.prototype.cleanupDestroyedActors=function(){var e=this.removals.length;if(0<e)for(var o=this.removals,a=this.actors,n=a.length,r=0,i;r<e;r++){i=o[r];for(var c=0;c<n;c++)if(i===a[c]){i.release(),a.splice(c,1),n--;break}}this.removals=[]},b5.Actor.prototype.findActor=function(e,o){o===void 0&&(o=!1);for(var a=this.actors,n=a.length,r=0;r<n;r++){if(a[r].name===e)return a[r];if(o){var i=a[r].findActor(e,o);if(null!==i)return i}}return null},b5.Actor.prototype.findActorById=function(e,o){o===void 0&&(o=!1);for(var a=this.actors,n=a.length,r=0;r<n;r++){if(a[r].id===e)return a[r];if(o){var i=a[r].findActorById(e,o);if(null!==i)return i}}return null},b5.Actor.prototype.findFirstParent=function(){for(var e=this;null!==e;){if(null===e.parent)return e;e=e.parent}return null},b5.Actor.prototype.findFirstCachedParent=function(){for(var e=this.parent;null!==e;){if(null!==e.cache_canvas)return e;e=e.parent}return null},b5.Actor.prototype.updateParentTransforms=function(){for(var e=[],o=this;null!==o;)e.push(o),o=o.parent;for(var a=e.length-1;0<=a;a--)e[a].updateTransform()},b5.Actor.prototype.getSlot=function(){var e=null===this.parent?this.scene.actors:this.parent.actors;for(var o=e.length,a=0;a<o;a++)if(e[a]===this)return a},b5.Actor.prototype.moveToSlot=function(e){var t=null===this.parent?this.scene.actors:this.parent.actors;var o=this.getSlot();o===e||(t.splice(e,0,this),e<o&&o++,t.splice(o,1))},b5.Actor.prototype.bringToFront=function(){var e=null===this.parent?this.scene.actors:this.parent.actors;for(var o=e.length,a=-1,n=0;n<o;n++)if(e[n]===this){a=n;break}0<=a&&(e.splice(a,1),e.push(this))},b5.Actor.prototype.sendToBack=function(){var e=null===this.parent?this.scene.actors:this.parent.actors;for(var o=e.length,a=-1,n=0;n<o;n++)if(e[n]===this){a=n;break}0<=a&&(e.splice(a,1),e.unshift(this))},b5.Actor.prototype.onBeginTouchBase=function(e){this.touching=!0,this.bubbling&&null!==this.parent&&this.parent.onBeginTouchBase(e),this.onBeginTouch!==void 0&&this.onBeginTouch(e)},b5.Actor.prototype.onEndTouchBase=function(e){if(this.touching&&void 0!==this.onTapped&&(this.onTapped(e),void 0!==this.onDblTapped))if(null===this.touch_et)this.touch_et=Date.now();else{var t=Date.now(),o=t-this.touch_et;500>o&&this.onDblTapped(e),this.touch_et=t}this.touching=!1,this.touchmove=!1,this.bubbling&&null!==this.parent&&this.parent.onEndTouchBase(e),this.onEndTouch!==void 0&&this.onEndTouch(e)},b5.Actor.prototype.onMoveTouchBase=function(e){this.touching&&(this.touchmove=!0),this.bubbling&&null!==this.parent&&this.parent.onMoveTouchBase(e),this.virtual&&this.Virtual_onMoveTouch(e),this.onMoveTouch!==void 0&&this.onMoveTouch(e)},b5.Actor.prototype.releaseBody=function(){null!==this.body&&(this.scene.world.DestroyBody(this.body),this.body=null)},b5.Actor.prototype.releaseJoints=function(){if(null!==this.body){for(var e=0;e<this.joints.length;e++)this.scene.world.DestroyJoint(this.joints[e]);this.joints=null}},b5.Actor.prototype.initBody=function(e,t,o){if(!this.scene.app.box2d)return null;var a=this.scene,n=new Box2D.Dynamics.b2BodyDef,r=a.world_scale;return n.type='static'===e?Box2D.Dynamics.b2Body.b2_staticBody:'kinematic'===e?Box2D.Dynamics.b2Body.b2_kinematicBody:Box2D.Dynamics.b2Body.b2_dynamicBody,n.position.Set(this.x/r,this.y/r),n.angle=this.rotation,n.fixedRotation=t,n.bullet=o,this.body=a.world.CreateBody(n),this.body.SetUserData(this),this.body},b5.Actor.prototype.addFixture=function(e){if(null===this.body)return null;var o=e,a=e,n;void 0!==e.shape&&(o=e.shape),void 0!==e.material&&(a=e.material);var r=this.scene.world_scale,i=this.scale_x,c=this.scale_y;if(o.type===b5.Shape.TypeBox)n=new Box2D.Dynamics.b2FixtureDef,n.shape=new Box2D.Collision.Shapes.b2PolygonShape,n.shape.SetAsBox(o.width/(2*r)*i,o.height/(2*r)*c);else if(o.type===b5.Shape.TypeCircle)n=new Box2D.Dynamics.b2FixtureDef,n.shape=new Box2D.Collision.Shapes.b2CircleShape(o.width/r*i);else if(o.type===b5.Shape.TypePolygon){if(void 0!==o.convexVertices&&0<o.convexVertices.length){for(var p=[],d=o.convexVertices.length,l=0;l<d;l++){n=new Box2D.Dynamics.b2FixtureDef,n.shape=new Box2D.Collision.Shapes.b2PolygonShape;for(var y=o.convexVertices[l],_=[],u=y.length,h=0;h<u;h+=2)_.push({x:y[h]/r*i,y:y[h+1]/r*c});n.shape.SetAsArray(_,_.length),void 0!==a.density&&(n.density=a.density),void 0!==a.friction&&(n.friction=a.friction),void 0!==a.restitution&&(n.restitution=a.restitution),void 0!==e.is_sensor&&(n.isSensor=e.is_sensor),void 0!==e.collision_category&&(n.filter.categoryBits=e.collision_category),void 0!==e.collision_mask&&(n.filter.maskBits=e.collision_mask),void 0!==e.collision_group&&(n.filter.groupIndex=e.collision_group),p.push(this.body.CreateFixture(n))}return p}n=new Box2D.Dynamics.b2FixtureDef,n.shape=new Box2D.Collision.Shapes.b2PolygonShape;for(var y=o.vertices,_=[],u=y.length,h=0;h<u;h+=2)_.push({x:y[h]/r*i,y:y[h+1]/r*c});n.shape.SetAsArray(_,_.length)}return void 0!==a.density&&(n.density=a.density),void 0!==a.friction&&(n.friction=a.friction),void 0!==a.restitution&&(n.restitution=a.restitution),void 0!==a.is_sensor&&(n.isSensor=a.is_sensor),void 0!==e.collision_category&&(n.filter.categoryBits=e.collision_category),void 0!==e.collision_mask&&(n.filter.maskBits=e.collision_mask),void 0!==e.collision_group&&(n.filter.groupIndex=e.collision_group),this.body.CreateFixture(n)},b5.Actor.prototype.addJoint=function(e){var t=Math.PI;if(null===this.body)return null;var o=this.scene,a=o.world,n=o.world_scale,r=Box2D.Common.Math.b2Vec2,i=this.body,s=e.actor_b.body,c=i.GetWorldCenter(),p=s.GetWorldCenter(),d=new r(c.x,c.y),l;d.x+=e.anchor_a.x/n,d.y+=e.anchor_a.y/n;var y=new r(p.x,p.y);if(y.x+=e.anchor_b.x/n,y.y+=e.anchor_b.y/n,'weld'===e.type)l=new Box2D.Dynamics.Joints.b2WeldJointDef,l.Initialize(i,s,d),l.collideConnected=e.self_collide;else if('distance'===e.type)l=new Box2D.Dynamics.Joints.b2DistanceJointDef,l.Initialize(i,s,d,y),l.collideConnected=e.self_collide,l.frequencyHz=e.frequency,l.dampingRatio=e.damping;else if('revolute'===e.type)l=new Box2D.Dynamics.Joints.b2RevoluteJointDef,l.Initialize(i,s,d),l.collideConnected=e.self_collide,e.limit_joint&&(l.enableLimit=!0,l.lowerAngle=e.lower_limit*(t/180),l.upperAngle=e.upper_limit*(t/180)),e.motor_enabled&&(l.enableMotor=!0,l.motorSpeed=e.motor_speed,l.maxMotorTorque=e.max_motor_torque);else if('prismatic'===e.type)l=new Box2D.Dynamics.Joints.b2PrismaticJointDef,l.Initialize(i,s,d,new r(e.axis.x,e.axis.y)),l.collideConnected=e.self_collide,e.limit_joint&&(l.enableLimit=!0,l.lowerTranslation=e.lower_limit/n,l.upperTranslation=e.upper_limit/n),e.motor_enabled&&(l.enableMotor=!0,l.motorSpeed=e.motor_speed,l.maxMotorForce=e.max_motor_force);else if('pulley'===e.type){var _=new r(c.x,c.y);_.x+=e.ground_a.x/n,_.y+=e.ground_a.y/n;var u=new r(p.x,p.y);u.x+=e.ground_b.x/n,u.y+=e.ground_b.y/n,l=new Box2D.Dynamics.Joints.b2PulleyJointDef,l.Initialize(i,s,_,u,d,y,e.ratio),l.collideConnected=e.self_collide}else'wheel'===e.type?(l=new Box2D.Dynamics.Joints.b2LineJointDef,l.Initialize(i,s,d,e.axis),l.collideConnected=e.self_collide,e.limit_joint&&(l.enableLimit=!0,l.lowerTranslation=e.lower_limit/n,l.upperTranslation=e.upper_limit/n),e.motor_enabled&&(l.enableMotor=!0,l.motorSpeed=e.motor_speed,l.maxMotorForce=e.max_motor_force)):'mouse'===e.type&&(l=new Box2D.Dynamics.Joints.b2MouseJointDef,l.collideConnected=e.self_collide,l.bodyA=i,l.bodyB=s,l.collideConnected=e.self_collide,l.maxForce=e.max_motor_force,l.dampingRatio=e.damping);var h=a.CreateJoint(l);return this.joints.push(h),h},b5.Actor.prototype.removeJoint=function(e){for(var o=this.joints,a=o.length,n=0;n<a;n++)if(o[n]===e)return world.DestroyJoint(e),void o.splice(n,1)},b5.Actor.prototype.getScaleFromMethod=function(e){var t=b5.app,o=t.global_scale,a=t.global_scale;if(!t.disable_dock_screen){var n=e;if(n!==b5.Actor.FitNone){var r=1/t.canvas_scale,i=t.inner_width/t.design_width*r,s=t.inner_height/t.design_height*r;if(n===b5.Actor.FitBest)i>s?(o*=i,a*=i):(o*=s,a*=s);else if(n===b5.Actor.FitBest2)i<s?(o*=i,a*=i):(o*=s,a*=s);else if(n===b5.Actor.FitX)o*=i,a*=i;else if(n===b5.Actor.FitY)o*=s,a*=s;else if(n===b5.Actor.FitAverage){var c=.5*(i+s);o*=c,a*=c}else if(n===b5.Actor.FitGreatest){var c;c=t.inner_width>t.inner_height?i:s,o*=c,a*=c}else if(n===b5.Actor.FitSmallest){var c;c=t.inner_width<t.inner_height?i:s,o*=c,a*=c}else n===b5.Actor.FitSize?(o*=i,a*=s):n===b5.Actor.FitPP&&(o*=r,a*=r)}}return{x:o,y:a}},b5.Actor.prototype.updateTransform=function(){if(this.transform_dirty){var e=this.transform,t=this.scene,o=this.rotation,a=this.scale_x,n=this.scale_y;null===this.parent&&(a*=t.scale,n*=t.scale);var r=this.scale_method;if(0!==r){var i=this.getScaleFromMethod(r);a*=i.x,n*=i.y}var s=this.parent;null===s||this.orphaned?(this.accum_scale_x=a,this.accum_scale_y=n):(this.accum_scale_x=a*s.accum_scale_x,this.accum_scale_y=n*s.accum_scale_y);var c=Math.cos(o),p=Math.sin(o);if(0!==this.depth&&1!==this.depth){var d=1/this.depth;a*=d,n*=d,e[4]=(this.x-t.camera_x)*d,e[5]=(this.y-t.camera_y)*d}else this.transform_dirty=!1,e[4]=this.x,e[5]=this.y;e[0]=c*a,e[1]=p*a,e[2]=-p*n,e[3]=c*n;var l=null,y=this.atlas;null!==y&&(null===this.anim_frames?l=y.getFrame(0|this.current_frame):l=y.getFrame(this.anim_frames[0|this.current_frame]));var _=this.ox,u=this.oy;if(0!==_||0!==u||null!==l){this.absolute_origin||(_*=this.w,u*=this.h),e[4]-=_,e[5]-=u,null!==l&&(_-=l.ox,u-=l.oy);var h=[1,0,0,1,_,u];b5.Maths.preMulMatrix(e,h)}null===s||this.orphaned||b5.Maths.mulMatrix(e,s.transform)}},b5.Actor.prototype.draw=function(){if(this.visible){if(this.cache&&(this.drawToCache(),this.cache=!1),this.merge_cache){var e=this.actors.length;if(0<e){var o=this.actors;if(this.draw_reverse)for(var a=e-1;0<=a;a--)o[a].draw();else for(var a=0;a<e;a++)o[a].draw()}return}var n=this.cache_canvas,r=this.scene,i=r.app,s=i.canvas_scale,c=i.display;this.preDraw();var p=b5.app.pixel_ratio;null===n&&(p=1);var d=null;if(null===n){var l=this.atlas;null!==l&&(d=null===this.anim_frames?l.getFrame(0|this.current_frame):l.getFrame(this.anim_frames[0|this.current_frame]),!this.ignore_atlas_size&&(this.w=d.w,this.h=d.h),(0|this.prev_frame)!=(0|this.current_frame)&&this.dirty(),this.prev_frame=this.current_frame)}var y=i.canvas_cx+r.x*s/p,_=i.canvas_cy+r.y*s/p;void 0===this.ow&&(this.ow=this.w,this.oh=this.h);var u=this.ow/2,h=this.oh/2;this.ignore_camera||0!==this.depth&&1!==this.depth||(y-=r.camera_x*s,_-=r.camera_y*s),this.updateTransform();var g=this.self_clip,m=this.clip_children,f=this.transform,A=f[4]*s+y,x=f[5]*s+_;this.round_pixels&&(u=0|u+.5,h=0|h+.5,A=0|A+.5,x=0|x+.5),c.setTransform(f[0]*s,f[1]*s,f[2]*s,f[3]*s,A,x),g&&this.setClipping(0,0),null===n?null===l?null!==this.bitmap&&c.drawImage(this.bitmap.image,-u,-h,this.w,this.h):c.drawAtlasImage(l.bitmap.image,d.x,d.y,d.w,d.h,-u,-h,this.w+1,this.h+1):c.drawImage(n,-n.width>>1,-n.height>>1),this.postDraw(),m?!g&&this.setClipping(-u,-h):g&&c.restoreContext();var e=this.actors.length;if(0<e){var o=this.actors;if(this.draw_reverse)for(var a=e-1;0<=a;a--)o[a].draw();else for(var a=0;a<e;a++)o[a].draw()}m&&c.restoreContext()}},b5.Actor.prototype.enableCache=function(e){this.cache=!0,this.cached=!0,this.merge_cache=e},b5.Actor.prototype.resetCache=function(){if(this.cached){this.cache=!0;var e=this.actors.length;if(0<e)for(var o=this.actors,a=0;a<e;a++)o[a].resetCache()}},b5.Actor.prototype.drawToCache=function(){var e=b5.app.display,t=null,o=null;if(this.merge_cache){var o=this.findFirstCachedParent();null!==o&&(t=o.cache_canvas)}var a=null,n=this.atlas;null!==n&&(null===this.anim_frames?a=n.getFrame(this.current_frame<<0):a=n.getFrame(this.anim_frames[this.current_frame<<0]));var i=b5.app.pixel_ratio;null===t&&(t=e.createCache(),t.width=0|this.ow*i,t.height=0|this.oh*i),e.setCache(t);var s=this.ow/2,c=this.oh/2,p=this.scene,d=[],l=this.rotation,r=Math.cos(l),y=Math.sin(l),_=1/i,u=this.scale_x,h=this.scale_y;d[0]=r*u,d[1]=y*u,d[2]=-y*h,d[3]=r*h,d[4]=this.x+t.width/2-this.ox*this.ow,d[5]=this.y+t.height/2-this.oy*this.oh;var g=[1,0,0,1,this.ox*this.ow,this.oy*this.oh];b5.Maths.preMulMatrix(d,g),this.self_clip&&(e.setTransform(1,0,0,1,0,0),this.setClipping(d[4],d[5])),this.preDrawCached(),e.setTransform(d[0]*_,d[1]*_,d[2]*_,d[3]*_,d[4],d[5]),null===n?null!==this.bitmap&&e.drawImage(this.bitmap.image,-s,-c,this.w,this.h):e.drawAtlasImage(n.bitmap.image,a.x,a.y,a.w,a.h,-s,-c,this.w,this.h),this.postDrawCached(),this.self_clip&&e.restoreContext(),e.setCache(null),this.cached&&!this.merge_cache&&(this.cache_canvas=t)},b5.Actor.prototype.preDraw=function(){var e=b5.app.display;this.accum_opacity=null!==this.parent&&this.use_parent_opacity?this.parent.accum_opacity*this.opacity:this.opacity*this.scene.opacity,this.type===b5.Actor.Type_Image?e.setGlobalAlpha(this.accum_opacity):e.setGlobalAlpha(1),this.shadow&&e.setShadow(this.shadow_x,this.shadow_y,this.shadow_colour,this.shadow_blur),null!==this.composite_op&&e.setGlobalCompositeOp(this.composite_op)},b5.Actor.prototype.postDraw=function(){var e=b5.app.display;this.shadow&&e.setShadowOff(),null!==this.composite_op&&e.setGlobalCompositeOp('source-over')},b5.Actor.prototype.preDrawCached=function(){var e=b5.app.display;this.shadow&&e.setShadow(this.shadow_x,this.shadow_y,this.shadow_colour,this.shadow_blur),null!==this.composite_op&&e.setGlobalCompositeOp(this.composite_op)},b5.Actor.prototype.postDrawCached=function(){var e=b5.app.display;this.shadow&&e.setShadowOff(),null!==this.composite_op&&e.setGlobalCompositeOp('source-over')},b5.Actor.prototype.baseUpdate=function(e){if(this.active){void 0!==this.onTick&&this.onTick(e),this.timelines.update(e),void 0!==this.actions&&this.actions.execute(),this.tasks.execute(),this.virtual&&this.Virtual_update(e);var o=this.scene;if(null!==this.atlas){this.current_frame+=this.frame_speed*e;var a;if(a=null===this.anim_frames?this.atlas.getMaxFrames():this.anim_frames.length,!this.frames_repeat)this.current_frame>=a?(void 0!==this.onAnimEnd&&this.onAnimEnd(),this.current_frame=a-1):0>this.current_frame&&(void 0!==this.onAnimEnd&&this.onAnimEnd(),this.current_frame=0);else if(0>this.current_frame)for(;0>this.current_frame;)this.current_frame+=a;else for(;this.current_frame>=a;)this.current_frame-=a}var n=this.x,r=this.y,i=this.body;if(null!==i){var c=i.GetPosition(),p=o.world_scale;this.setRotation(i.GetAngle()),this.setPosition(c.x*p,c.y*p)}else this.rotation+=this.vr*e,this.vr*=this.vr_damping,this.x+=this.vx*e,this.vx*=this.vx_damping,this.y+=this.vy*e,this.vy*=this.vy_damping;if(0!==this.vd&&(this.depth+=this.vd*e,this.vd*=this.vd_damping),this.wrap_position){var d=o.extents[0],l=d+o.extents[2],y=o.extents[1],_=y+o.extents[3];this.x<d?this.x=l:this.x>l&&(this.x=d),this.y<y?this.y=_:this.y>_&&(this.y=y)}if(null===this.parent||!this.parent.virtual)if(this.dock_screen&&!b5.app.disable_dock_screen){var u=this.scale_method,h=1,g=1;if(0!==u){var m=this.getScaleFromMethod(u);h=m.x,g=m.y}if(0!==this.dock_x){var m=this.getScaleFromMethod(2);this.dock_x===b5.Actor.Dock_Left?this.x=-o.w*m.x/2+(this.w+this.margin[0])*this.scale_x*h/2:this.dock_x===b5.Actor.Dock_Right&&(this.x=o.w*m.x/2-(this.w+this.margin[1])*this.scale_x*h/2)}if(0!==this.dock_y){var m=this.getScaleFromMethod(3);this.dock_y===b5.Actor.Dock_Top?this.y=-o.h*m.y/2+(this.h+this.margin[2])*this.scale_y*g/2:this.dock_y===b5.Actor.Dock_Bottom&&(this.y=o.h*m.y/2-(this.h+this.margin[3])*this.scale_y*g/2)}}else 0!==this.dock_x&&(this.dock_x===b5.Actor.Dock_Left?this.x=-o.w/2+this.w*this.scale_x/2+this.margin[0]:this.dock_x===b5.Actor.Dock_Right&&(this.x=o.w/2-this.w*this.scale_x/2+this.margin[1])),0!==this.dock_y&&(this.dock_y===b5.Actor.Dock_Top?this.y=-o.h/2+this.h*this.scale_y/2+this.margin[2]:this.dock_y===b5.Actor.Dock_Bottom&&(this.y=o.h/2-this.h*this.scale_y/2+this.margin[3]));(this.x!==n||this.y!==r||null===i&&0!==this.vr)&&this.dirty();var f=this.actors.length;if(0<f)for(var A=this.actors,x=0;x<f;x++)A[x].update(e);this.cleanupDestroyedActors(),this.order_changed&&(this.order_changed=!1,b5.Utils.sortLayers(this.actors)),this.frame_count++}},b5.Actor.prototype.update=function(e){this.baseUpdate(e)},b5.Actor.prototype.updateToPhysics=function(){if(null!==this.body){var e=Box2D.Common.Math.b2Vec2;this.body.SetLinearVelocity(new e(this.vx,this.vy)),this.body.SetAngularVelocity(this.vr),this.body.SetAwake(!0)}},b5.Actor.prototype.dirty=function(){this.transform_dirty=!0;for(var e=this.actors,o=e.length,a=0;a<o;a++)e[a].dirty()},b5.Actor.prototype.makeVirtual=function(){this.prev_scroll_pos_x=0,this.prev_scroll_pos_y=0,this.scroll_pos_x=0,this.scroll_pos_y=0,this.scroll_vx=0,this.scroll_vy=0,this.scroll_range=[0,0,0,0],this.virtual=!0},b5.Actor.prototype.Virtual_onMoveTouch=function(){if(this.touching&&(0!==this.scroll_range[2]||0!==this.scroll_range[3])){var e=this.scene.app;this.prev_scroll_pos_x=this.scroll_pos_x,this.prev_scroll_pos_y=this.scroll_pos_y,this.scroll_vx=e.touch_drag_x,this.scroll_pos_x+=e.touch_drag_x,this.scroll_vy=e.touch_drag_y,this.scroll_pos_y+=e.touch_drag_y,(0!==this.scroll_vx||0!==this.scroll_vy)&&(this.Virtual_scrollRangeCheck(),this.layout_dirty=!0,this.Virtual_updateLayout())}},b5.Actor.prototype.Virtual_update=function(){this.touching||(this.prev_scroll_pos_x=this.scroll_pos_x,this.prev_scroll_pos_y=this.scroll_pos_y,this.scroll_pos_x+=this.scroll_vx,this.scroll_pos_y+=this.scroll_vy,(0!==this.scroll_vx||0!==this.scroll_vy)&&(this.Virtual_scrollRangeCheck(),this.layout_dirty=!0,this.Virtual_updateLayout()),this.scroll_vx*=.9,this.scroll_vy*=.9,-.5<this.scroll_vx&&.5>this.scroll_vx&&(this.scroll_vx=0),-.5<this.scroll_vy&&.5>this.scroll_vy&&(this.scroll_vy=0))},b5.Actor.prototype.Virtual_scrollRangeCheck=function(){var e=this.scroll_pos_x,t=this.scroll_pos_y,o=-this.scroll_range[0],a=o-this.scroll_range[2],n=-this.scroll_range[1],r=n-this.scroll_range[3];e<a?(e=a,this.scroll_vx=0):e>o&&(e=o,this.scroll_vx=0),t<r?(t=r,this.scroll_vy=0):t>n&&(t=n,this.scroll_vy=0),this.scroll_pos_x=e,this.scroll_pos_y=t},b5.Actor.prototype.Virtual_clipLayout=function(e,t,o){var a=Math.abs;if(this.clip_virtual){var n=e.w/2,r=e.h/2;e._av=!(e.y<-o-r||e.y>o+r||e.x<-t-n||e.x>t+n)}(1<a(this.scroll_vx)||1<a(this.scroll_vy))&&(e.touching=!1),e.dirty()},b5.Actor.prototype.Virtual_updateLayout=function(e){if(this.layout_dirty){this.layout_dirty=!1;var o=this.prev_scroll_pos_x-this.scroll_pos_x,n=this.prev_scroll_pos_y-this.scroll_pos_y,r=this.actors.length,i=this.w*this.scale_x/2,s=this.h*this.scale_y/2;if(0<r){var c=this.stacking,p=this.actors,d;if(c===b5.Actor.Stack_None)for(var l=0;l<r;l++)d=p[l],0===d.dock_x?d.x+=o:d.dock_x===b5.Actor.Dock_Left?d.x=-i+d.w*d.scale_x/2+d.margin[0]:d.dock_x===b5.Actor.Dock_Right&&(d.x=i-d.w*d.scale_x/2+d.margin[1]),0===d.dock_y?d.y+=n:d.dock_y===b5.Actor.Dock_Top?d.y=-s+d.h*d.scale_y/2+d.margin[2]:d.dock_y===b5.Actor.Dock_Bottom&&(d.y=s-d.h*d.scale_y/2+d.margin[3]),this.Virtual_clipLayout(d,i,s);else if(c===b5.Actor.Stack_H){d=p[0];for(var _=-i+d.w*d.scale_x/2,l=0;l<r;l++)d=p[l],d.x=_+d.margin[0],_+=d.w*d.scale_x+d.margin[1],this.Virtual_clipLayout(d,i,s)}else if(c===b5.Actor.Stack_V){d=p[0];for(var u=-s+d.h*d.scale_y/2,l=0;l<r;l++)d=p[l],d.y=u+d.margin[2],u+=d.h*d.scale_y+d.margin[3],this.Virtual_clipLayout(d,i,s)}}if(e)for(var h=this.actors,l=0;l<h.length;l++)h[l].Virtual_updateLayout(!0)}},b5.Actor.prototype.Virtual_isClipped=function(e){if(!this.clip_virtual)return!1;var t=this.w*this.scale_x/2,o=this.h*this.scale_y/2,a=e.w/2,n=e.h/2;return!!(e.y<-o-n||e.y>o+n||e.x<-t-a||e.x>t+a)},b5.Actor.prototype.hitTest=function(e){if(!this.touchable||!this.active)return null;var o=this.actors.length,a;if(0<o)for(var n=this.actors,r=o-1;0<=r;r--)if(a=n[r].hitTest(e),null!==a)return a;if(this.hit){var i=this.scene,s=this.transform,c=s[4]+i.x,p=s[5]+i.y;this.ignore_camera||(c-=i.camera_x,p-=i.camera_y);var d=this.accum_scale_x,l=this.accum_scale_y,y=(e.x-c)/d,_=(e.y-p)/l,u=y*s[0]+_*s[1],h=y*s[2]+_*s[3],g=this.w*d/2,m=this.h*l/2;if(u>=-g&&u<=g&&h>=-m&&h<=m)return this}return null},b5.Actor.prototype.transformPoint=function(e,t){return b5.Maths.vecMulMatrix(e,t,this.transform)},b5.Actor.prototype.setClipping=function(e,t){var o=Math.PI,a=b5.app.display;a.saveContext();var n=this.clip_margin,r=this.clip_shape;if(null===r){var i=this.type;i===b5.Actor.Type_Arc?a.clipArc(e+n[0],t+n[1],this.radius,0,2*o):i===b5.Actor.Type_Polygon?a.clipPolygon(this.points):a.clipRect(e+n[0],t+n[1],this.w-n[2]-n[0],this.h-n[3]-n[1])}else{var i=r.type;i===b5.Shape.TypeBox?a.clipRect(e+n[0],t+n[1],r.width-n[2]-n[0],r.height-n[3]-n[1]):i===b5.Shape.TypeCircle?a.clipArc(e+n[0],t+n[1],r.width,0,2*o):i===b5.Shape.TypePolygon&&a.clipPolygon(r.vertices)}},b5.Actor.prototype.overlaps=function(e){var t=this.w,o=this.h,a=e.w,n=e.h,r=this.x-t/2,i=this.y-o/2,s=e.x-a/2,c=e.y-n/2;return!(i+o<c||i>c+n||r>s+a||r+t<s)},b5.Actor.prototype.overlapsRect=function(e){var t=this.w,o=this.h,a=e.x2-e.x1,n=e.y2-e.y1,r=this.x-t/2,i=this.y-o/2,s=e.x1,c=e.y1;return!(i+o<c||i>c+n||r>s+a||r+t<s)},b5.Actor.prototype.circleOverlaps=function(e){var t=e.x-e.w/2,o=e.y-e.h/2,a=e.x+e.w/2,n=e.y+e.h/2,r=this.x,i=this.y,s=r<t?t:r>a?a:r,c=i<o?o:i>n?n:i,p=r-s,d=i-c;return p*p+d*d<this.w/2*this.w/2},b5.Actor.prototype.circleOverlapsRect=function(e){var t=e.x1,o=e.y1,a=e.x2,n=e.y2,r=this.x,i=this.y,s=r<t?t:r>a?a:r,c=i<o?o:i>n?n:i,p=r-s,d=i-c;return p*p+d*d<this.w/2*this.w/2},b5.Actor.fullCircleOverlapTest=function(e,t){var o=e.transformPoint(0,0),a=t.transformPoint(0,0),n=a.x-o.x,r=a.y-o.y,i=e.w*e.w/2+t.w*t.w/2;return!!(n*n+r*r<=i)},'use strict',b5.ArcActor=function(){this.fill_style='#ffffff',this.stroke_style='#ffffff',this.stroke_thickness=1,this.radius=1,this.start_angle=0,this.end_angle=2*Math.PI,this.filled=!0,this.stroke_filled=!1,b5.Actor.call(this),this.type=b5.Actor.Type_Arc},b5.ArcActor.prototype=new b5.Actor,b5.ArcActor.prototype.constructor=b5.ArcActor,b5.ArcActor.prototype.parent=b5.Actor.prototype,b5.ArcActor.prototype.update=function(e){return this.baseUpdate(e)},b5.ArcActor.prototype.draw=function(){if(this.visible){if(this.cache&&(this.drawToCache(),this.cache=!1),this.merge_cache){var e=this.actors.length;if(0<e){var o=this.actors;if(this.draw_reverse)for(var a=e-1;0<=a;a--)o[a].draw();else for(var a=0;a<e;a++)o[a].draw()}return}var n=this.cache_canvas,r=this.scene,i=r.app,s=i.canvas_scale,c=i.display;null===n&&(this.filled&&''!==this.fill_style&&c.setFillStyle(this.fill_style),this.stroke_filled&&''!==this.stroke_style&&c.setStrokeStyle(this.stroke_style),this.stroke_filled&&c.setLineWidth(this.stroke_thickness)),this.preDraw();var p=i.canvas_cx+r.x*s,d=i.canvas_cy+r.y*s;this.ignore_camera||0!==this.depth&&1!==this.depth||(p-=r.camera_x*s,d-=r.camera_y*s),this.updateTransform();var l=this.self_clip,y=this.clip_children,_=this.transform,u=_[4]*s+p,h=_[5]*s+d;this.round_pixels&&(u=0|u+.5,h=0|h+.5),c.setTransform(_[0]*s,_[1]*s,_[2]*s,_[3]*s,u,h),l&&this.setClipping(0,0),null===n?c.drawArc(0,0,this.radius,this.start_angle,this.end_angle,this.filled):c.drawImage(n,-n.width>>1,-n.height>>1),this.postDraw(),y?!l&&this.setClipping(0,0):l&&c.restoreContext();var e=this.actors.length;if(0<e)for(var o=this.actors,a=0;a<e;a++)o[a].draw();y&&c.restoreContext()}},b5.ArcActor.prototype.drawToCache=function(){var e=b5.app.display,t=null,o=2*this.padding,a=this.w+o,n=this.h+o,r=0,i=0;if(this.merge_cache){var s=this.findFirstCachedParent();null!==s&&(t=s.cache_canvas,r=this.x+t.width/2-a/2,i=this.y+t.height/2-n/2)}if(null===t){var c=b5.app.pixel_ratio;t=e.createCache(),t.width=0|a*c,t.height=0|n*c}e.setCache(t),this.preDrawCached(),this.filled&&''!==this.fill_style&&e.setFillStyle(this.fill_style),this.stroke_filled&&''!==this.stroke_style&&e.setStrokeStyle(this.stroke_style),this.stroke_filled&&e.setLineWidth(this.stroke_thickness),e.setTransform(1,0,0,1,r+a/2,i+n/2),e.drawArc(0,0,this.radius,this.start_angle,this.end_angle,this.filled),this.postDrawCached(),e.setCache(null),this.cache_canvas=t},b5.ArcActor.prototype.hitTest=function(e){if(!this.touchable)return null;var o=this.actors.length,a;if(0<o)for(var n=this.actors,i=0;i<o;i++)if(a=n[i].hitTest(e),null!==a)return a;var s=this.scene,c=this.transform,p=c[4]+s.x,d=c[5]+s.y;this.ignore_camera||(p-=s.camera_x,d-=s.camera_y);var l=this.accum_scale_x,y=this.accum_scale_y,_=(e.x-p)/l,u=(e.y-d)/y,h=_*c[0]+u*c[1],g=_*c[2]+u*c[3],m=this.radius*l;m*=m;return h*h+g*g<=m?this:null},'use strict',b5.LabelActor=function(){this.text='',this.font='16pt Calibri',this.text_align='center',this.text_baseline='middle',this.fill_style='#ffffff',this.stroke_style='#ffffff',this.stroke_thickness=1,this.line_height=16,this.max_width=0,this.filled=!0,this.stroke_filled=!1,b5.Actor.call(this),this.type=b5.Actor.Type_Label},b5.LabelActor.prototype=new b5.Actor,b5.LabelActor.prototype.constructor=b5.LabelActor,b5.LabelActor.prototype.parent=b5.Actor.prototype,Object.defineProperty(b5.LabelActor.prototype,'_text',{get:function(){return this.text},set:function(e){this.text!==e&&(this.text=''+e,null!==this.cache_canvas&&(this.cache=!0))}}),b5.LabelActor.prototype.update=function(e){return this.baseUpdate(e)},b5.LabelActor.prototype.draw=function(){if(this.visible&&''!==this.text){if(this.cache&&(this.drawToCache(),this.cache=!1),this.merge_cache){var e=this.actors.length;if(0<e){var o=this.actors;if(this.draw_reverse)for(var a=e-1;0<=a;a--)o[a].draw();else for(var a=0;a<e;a++)o[a].draw()}return}var n=this.cache_canvas,r=this.scene,i=r.app,s=i.canvas_scale,c=i.display;null===n&&(''!==this.font&&c.setFont(this.font),''!==this.textAlign&&c.setTextAlign(this.text_align),''!==this.textBaseline&&c.setTextBaseline(this.text_baseline),this.filled&&''!==this.fill_style&&c.setFillStyle(this.fill_style),this.stroke_filled&&''!==this.stroke_style&&c.setStrokeStyle(this.stroke_style),this.stroke_filled&&c.setLineWidth(this.stroke_thickness)),this.preDraw();var p=b5.app.pixel_ratio;null===n&&(p=1);var d=i.canvas_cx+r.x*s/p,l=i.canvas_cy+r.y*s/p;this.ignore_camera||0!==this.depth&&1!==this.depth||(d-=r.camera_x*s,l-=r.camera_y*s),this.updateTransform();var _=this.transform,u=_[4]*s+d,h=_[5]*s+l;if(this.round_pixels&&(u=0|u+.5,h=0|h+.5),s/=p,c.setTransform(_[0]*s,_[1]*s,_[2]*s,_[3]*s,u,h),null===n)this.stroke_filled&&c.drawTextWrap(this.text,0,0,this.max_width,this.line_height,!1,this.text_baseline),this.filled&&c.drawTextWrap(this.text,0,0,this.max_width,this.line_height,!0,this.text_baseline);else{var g=-n.width/2,m=-n.height/2;c.drawImage(n,g,m)}this.postDraw();var e=this.actors.length;if(0<e)for(var o=this.actors,a=0;a<e;a++)o[a].draw()}},b5.LabelActor.prototype.drawToCache=function(){var e=b5.app.display,t=null,o=2*this.padding,a=this.w+o,n=this.h+o,i=0,s=0;if(this.merge_cache){var c=this.findFirstCachedParent();null!==c&&(t=c.cache_canvas,i=this.x+t.width/2-a/2,s=this.y+t.height/2-n/2)}if(null===t){var p=b5.app.pixel_ratio;t=e.createCache(),t.width=0|a*p,t.height=0|n*p}if(e.setCache(t),this.preDrawCached(),''!==this.font&&e.setFont(this.font),''!==this.textAlign&&e.setTextAlign(this.text_align),''!==this.textBaseline&&e.setTextBaseline(this.text_baseline),this.filled&&''!==this.fill_style&&e.setFillStyle(this.fill_style),this.stroke_filled&&''!==this.stroke_style&&e.setStrokeStyle(this.stroke_style),this.stroke_filled&&e.setLineWidth(this.stroke_thickness),e.setTransform(1,0,0,1,0,0),'center'===this.text_align?i+=a/2:'right'===this.text_align&&(i+=a),'middle'===this.text_baseline?s+=n/2:'bottom'===this.text_baseline&&(s+=n),this.merge_cache){var d=this.scene,l=[],y=this.rotation,r=Math.cos(y),_=Math.sin(y),u=this.scale_x,h=this.scale_y;l[0]=r*u,l[1]=_*u,l[2]=-_*h,l[3]=r*h,l[4]=this.x+t.width/2-this.ox*this.ow,l[5]=this.y+t.height/2-this.oy*this.oh;var g=[1,0,0,1,this.ox*this.ow,this.oy*this.oh];b5.Maths.preMulMatrix(l,g),e.setTransform(1*l[0],1*l[1],1*l[2],1*l[3],l[4],l[5]),this.stroke_filled&&e.drawTextWrap(this.text,0,0,this.max_width,this.line_height,!1,this.text_baseline),this.filled&&e.drawTextWrap(this.text,0,0,this.max_width,this.line_height,!0,this.text_baseline),e.setTransform(1,0,0,1,0,0)}else e.setTransform(1,0,0,1,0,0),this.stroke_filled&&e.drawTextWrap(this.text,i,s,this.max_width,this.line_height,!1,this.text_baseline),this.filled&&e.drawTextWrap(this.text,i,s,this.max_width,this.line_height,!0,this.text_baseline);this.postDrawCached(),e.setCache(null),this.cache_canvas=t},'use strict',b5.ParticleActor=function(){b5.Actor.call(this),this.type=b5.Actor.Type_Particle,this.gravity=0,this.added_callback=null,this.reset_callback=null},b5.ParticleActor.prototype=new b5.Actor,b5.ParticleActor.prototype.constructor=b5.ParticleActor,b5.ParticleActor.prototype.parent=b5.Actor.prototype,b5.ParticleActor.prototype.resetParticle=function(e){if(e.life_time=0,e.orphaned){var t=this.transformPoint(e.org_x+this.x,e.org_y+this.y);e.x=t.x,e.y=t.y}else e.x=e.org_x,e.y=e.org_y;e.rotation=e.org_rotation,e.scale_x=e.org_scale_x,e.scale_y=e.org_scale_y,e.depth=e.org_depth,e.opacity=e.org_opacity,e.current_frame=e.org_current_frame,e.vr=e.org_vr,e.vx=e.org_vx,e.vy=e.org_vy,e.vd=e.org_vd,e.vo=e.org_vo,e.vsx=e.org_vsx,e.vsy=e.org_vsy,null!==this.reset_callback&&this.reset_callback(e)},b5.ParticleActor.prototype.addParticle=function(e,t,o,a){if(this.addActor(e),void 0===e.vo&&(e.vo=0),void 0===e.vsx&&(e.vsx=0),void 0===e.vsy&&(e.vsy=0),e.life_time=-a,e.life_span=t,e.num_lives=o,0>e.life_time&&(e.active=!1,e.visible=!1),e.org_num_lives=e.num_lives,e.org_x=e.x,e.org_y=e.y,e.org_rotation=e.rotation,e.org_scale_x=e.scale_x,e.org_scale_y=e.scale_y,e.org_depth=e.depth,e.org_opacity=e.opacity,e.org_current_frame=e.current_frame,e.org_vr=e.vr,e.org_vx=e.vx,e.org_vy=e.vy,e.org_vd=e.vd,e.org_vo=e.vo,e.org_vsx=e.vsx,e.org_vsy=e.vsy,e.orphaned){var n=this.transformPoint(e.org_x+this.x,e.org_y+this.y);e.x=n.x,e.y=n.y}return null!==this.added_callback&&this.added_callback(e),e},b5.ParticleActor.prototype.update=function(e){var o=this.actors,a=o.length;if(0===a)void 0!==this.onParticlesEnd&&this.onParticlesEnd(),this.destroy();else for(var n=a-1,r;0<=n;n--){r=o[n],r.life_time+=e;var i=r.life_time;0<=i&&(0>i-e&&0<=i&&(r.active=!0,r.visible=!0),r.active&&(r.scale_x+=r.vsx*e,r.scale_y+=r.vsy*e,r.opacity+=r.vo*e,0>r.opacity&&(r.opacity=0),r.vy+=this.gravity*e,r.update(e),i>=r.life_span&&(0<r.num_lives&&r.num_lives--,0<r.num_lives||0===r.org_num_lives?this.resetParticle(r):void 0===this.onParticleLost?r.destroy():this.onParticleLost(r)&&r.destroy())))}return this.baseUpdate(e)},b5.ParticleActor.prototype.generateExplosion=function(e,o,a,n,r,i,s,c){this.updateParentTransforms();for(var d=0;d<e;d++){var l;for(var y in l='string'==typeof o?new b5[o]:new o,c)l[y]=c[y];l.vr+=Math.random()*r,l.vx+=Math.random()*n-n/2,l.vy+=Math.random()*n-n/2,l.vx_damping=s,l.vy_damping=s,l.vo=-1/a,this.addParticle(l,a,1,d/(e*i))}},b5.ParticleActor.prototype.generatePlume=function(e,o,a,n,r,i,s,c){this.updateParentTransforms();for(var d=0;d<e;d++){var l;for(var y in l='string'==typeof o?new b5[o]:new o,c)l[y]=c[y];l.vr+=Math.random()*r,l.vx+=Math.random()*n-n/2,l.vy+=Math.random()*-n-n/2,l.vx_damping=s,l.vy_damping=s,l.vo=-1/a,this.addParticle(l,a,0,d/(e*i))}},b5.ParticleActor.prototype.generateRain=function(e,o,a,n,r,i,s,c,d){this.updateParentTransforms();for(var l=0;l<e;l++){var y;for(var _ in y='string'==typeof o?new b5[o]:new o,d)y[_]=d[_];y.x=Math.random()*c-c/2,y.vr+=Math.random()*r,y.vy+=Math.random()*n+n/2,y.vx_damping=s,y.vy_damping=s,y.vo=-1/a,this.addParticle(y,a,0,l/(e*i))}},'use strict',b5.PolygonActor=function(){this.fill_style='#ffffff',this.stroke_style='',this.stroke_thickness=1,this.filled=!0,this.stroke_filled=!1,this.points=null,b5.Actor.call(this),this.type=b5.Actor.Type_Polygon},b5.PolygonActor.prototype=new b5.Actor,b5.PolygonActor.prototype.constructor=b5.PolygonActor,b5.PolygonActor.prototype.parent=b5.Actor.prototype,b5.PolygonActor.prototype.update=function(e){return this.baseUpdate(e)},b5.PolygonActor.prototype.draw=function(){if(this.visible&&null!==this.points){if(this.cache&&(this.drawToCache(),this.cache=!1),this.merge_cache){var e=this.actors.length;if(0<e){var o=this.actors;if(this.draw_reverse)for(var a=e-1;0<=a;a--)o[a].draw();else for(var a=0;a<e;a++)o[a].draw()}return}var n=this.cache_canvas,r=this.scene,i=r.app,s=i.display;null===n&&(this.filled&&''!==this.fill_style&&s.setFillStyle(this.fill_style),this.stroke_filled&&''!==this.stroke_style&&s.setStrokeStyle(this.stroke_style),this.stroke_filled&&s.setLineWidth(this.stroke_thickness)),this.preDraw();var c=i.canvas_scale,p=i.canvas_cx+this.scene.x*c,d=i.canvas_cy+this.scene.y*c;this.ignore_camera||0!==this.depth&&1!==this.depth||(p-=r.camera_x*c,d-=r.camera_y*c),this.updateTransform();var l=this.self_clip,y=this.clip_children,_=this.transform,u=_[4]*c+p,h=_[5]*c+d;this.round_pixels&&(u=0|u+.5,h=0|h+.5),s.setTransform(_[0]*c,_[1]*c,_[2]*c,_[3]*c,u,h),l&&this.setClipping(0,0),null===n?s.drawPolygon(0,0,this.points,this.filled):s.drawImage(n,-n.width>>1,-n.height>>1),this.postDraw(),y?!l&&this.setClipping(0,0):l&&s.restoreContext();var e=this.actors.length;if(0<e)for(var o=this.actors,a=0;a<e;a++)o[a].draw();y&&s.restoreContext()}},b5.PolygonActor.prototype.drawToCache=function(){var e=b5.app.display,t=null,o=2*this.padding,a=this.w+o,n=this.h+o,r=0,i=0;if(this.merge_cache){var s=this.findFirstCachedParent();null!==s&&(t=s.cache_canvas,r=this.x+t.width/2-a/2,i=this.y+t.height/2-n/2)}if(null===t){var c=b5.app.pixel_ratio;t=e.createCache(),t.width=0|a*c,t.height=0|n*c}e.setCache(t),this.preDrawCached(),this.filled&&''!==this.fill_style&&e.setFillStyle(this.fill_style),this.stroke_filled&&''!==this.stroke_style&&e.setStrokeStyle(this.stroke_style),this.stroke_filled&&e.setLineWidth(this.stroke_thickness),e.setTransform(1,0,0,1,r+a/2,i+n/2),e.drawPolygon(0,0,this.points,this.filled),this.postDrawCached(),e.setCache(null),this.cache_canvas=t},'use strict',b5.RectActor=function(){this.fill_style='#ffffff',this.stroke_style='#ffffff',this.stroke_thickness=1,this.corner_radius=0,this.filled=!0,this.stroke_filled=!1,b5.Actor.call(this),this.type=b5.Actor.Type_Rect},b5.RectActor.prototype=new b5.Actor,b5.RectActor.prototype.constructor=b5.RectActor,b5.RectActor.prototype.parent=b5.Actor.prototype,b5.RectActor.prototype.update=function(e){return this.baseUpdate(e)},b5.RectActor.prototype.draw=function(){if(this.visible){if(this.cache&&(this.drawToCache(),this.cache=!1),this.merge_cache){var e=this.actors.length;if(0<e){var o=this.actors;if(this.draw_reverse)for(var a=e-1;0<=a;a--)o[a].draw();else for(var a=0;a<e;a++)o[a].draw()}return}var n=this.cache_canvas,r=this.scene,i=r.app,s=i.canvas_scale,c=i.display;null===n&&(this.filled&&''!==this.fill_style&&c.setFillStyle(this.fill_style),this.stroke_filled&&''!==this.stroke_style&&c.setStrokeStyle(this.stroke_style),this.stroke_filled&&c.setLineWidth(this.stroke_thickness)),this.preDraw();var p=i.canvas_cx+r.x*s,d=i.canvas_cy+r.y*s,l=this.w/2,y=this.h/2;this.ignore_camera||0!==this.depth&&1!==this.depth||(p-=r.camera_x*s,d-=r.camera_y*s),this.updateTransform();var _=this.self_clip,u=this.clip_children,h=this.transform,g=h[4]*s+p,m=h[5]*s+d;this.round_pixels&&(l=0|l+.5,y=0|y+.5,g=0|g+.5,m=0|m+.5),c.setTransform(h[0]*s,h[1]*s,h[2]*s,h[3]*s,g,m),_&&this.setClipping(-l,-y),null===n?0===this.corner_radius?c.drawRect(-l,-y,this.w,this.h,this.filled):c.drawRoundRect(-l,-y,this.w,this.h,this.corner_radius,this.filled):c.drawImage(n,-n.width>>1,-n.height>>1),this.postDraw(),u?!_&&this.setClipping(-l,-y):_&&c.restoreContext();var e=this.actors.length;if(0<e)for(var o=this.actors,a=0;a<e;a++)o[a].draw();u&&c.restoreContext()}},b5.RectActor.prototype.drawToCache=function(){var e=b5.app.display,t=null,o=2*this.padding,a=this.w+o,n=this.h+o,r=0,i=0;if(this.merge_cache){var s=this.findFirstCachedParent();null!==s&&(t=s.cache_canvas,r=this.x+t.width/2-a/2,i=this.y+t.height/2-n/2)}if(null===t){var c=b5.app.pixel_ratio;t=e.createCache(),t.width=0|a*c,t.height=0|n*c}e.setCache(t),this.preDrawCached(),this.filled&&''!==this.fill_style&&e.setFillStyle(this.fill_style),this.stroke_filled&&''!==this.stroke_style&&e.setStrokeStyle(this.stroke_style),this.stroke_filled&&e.setLineWidth(this.stroke_thickness),e.setTransform(1,0,0,1,r+a/2,i+n/2),0===this.corner_radius?e.drawRect(-a/2,-n/2,this.w,this.h,this.filled):e.drawRoundRect(-a/2,-n/2,this.w,this.h,this.corner_radius,this.filled),this.postDrawCached(),e.setCache(null),this.cache_canvas=t},'use strict',b5.MapActor=function(){this.tiles=[],this.map=[],this.collision_map=[],this.tile_width=32,this.tile_height=32,this.map_width=0,this.map_height=0,this.display_width=8,this.display_height=8,b5.Actor.call(this),this.type=b5.Actor.Type_Map},b5.MapActor.prototype=new b5.Actor,b5.MapActor.prototype.constructor=b5.MapActor,b5.MapActor.prototype.parent=b5.Actor.prototype,b5.MapActor.prototype.update=function(e){return this.baseUpdate(e)},b5.MapActor.prototype.generateTiles=function(e,o,a,n){for(var r=.5,i=.5,s=0;s<e;s++)this.tiles[s]={x:r,y:i},r+=o,r>=n&&(r=.5,i+=a);this.tile_width=o,this.tile_height=a},b5.MapActor.prototype.setTile=function(e,t,o,a){var n=this.map_width,r=this.map_height;0>e||e>=n||0>t||t>=r||(a!==void 0&&a?this.collision_map[t*n+e]=o:this.map[t*n+e]=o)},b5.MapActor.prototype.getTile=function(e,t,o){var a=this.map_width,n=this.map_height;return 0>e||e>=a?-1:0>t||t>=n?-1:void 0!==o&&o?this.collision_map[t*a+e]:this.map[t*a+e]},b5.MapActor.prototype.getTileXY=function(e,t){var o=Math.round,a=this.map_width,n=this.map_height,r=this.tile_width,i=this.tile_height;return{x:o((e-r/2)/r)+(a>>1),y:o((t-i/2)/i)+(n>>1)}},b5.MapActor.prototype.getTilePosition=function(e,t,o){var a=this.tile_width,n=this.tile_height,r=this.getTileXY(e,t);return r.x-=this.map_width>>1,r.y-=this.map_height>>1,r.x*=a,r.y*=n,'m'===o?r.y+=n/2:'b'===o?r.y+=n:'c'===o?r.x+=a/2:'r'==o&&(r.x+=a),r},b5.MapActor.prototype.getTileFromPosition=function(e,t,o){var a=this.getTileXY(e,t);return this.getTile(a.x,a.y,o)},b5.MapActor.prototype.draw=function(){if(this.visible){var e=this.scene,o=e.app,a=o.canvas_scale,n=o.display;this.preDraw();var r=o.canvas_cx+e.x*a,i=o.canvas_cy+e.y*a;this.ignore_camera||0!==this.depth&&1!==this.depth||(r-=e.camera_x*a,i-=e.camera_y*a),this.updateTransform();var s=this.transform,c=s[4]*a+r,p=s[5]*a+i;this.round_pixels&&(c=0|c+.5,p=0|p+.5),n.setTransform(s[0]*a,s[1]*a,s[2]*a,s[3]*a,c,p);var d=this.map_width,l=this.map_height,_=this.tile_width,u=this.tile_height,h=this.map,g=this.tiles,m,f,A,v,w;null===this.bitmap?null!==this.atlas&&(w=this.atlas.bitmap):w=this.bitmap;var b=w.image,T=this.display_width,S=this.display_height;r=T===d?-T>>1:0|(e.camera_x-this.x)/_-(T>>1)+.5;var C=r;i=S===l?-S>>1:0|(e.camera_y-this.y)/u-(S>>1)+.5;var k=r*_,P=k,R=i*u;for(r+=d>>1,C=r,i+=l>>1,f=0;f<S;f++){if(0<=i&&i<l)for(r=C,k=P,m=0;m<T&&(0<=r&&(A=h[i*d+r],v=g[A],n.drawAtlasImage(b,v.x,v.y,_-1,u-1,k,R,_+1,u+1)),k+=_,r++,!(r>=d));m++);if(R+=u,i++,i>=l)break}this.postDraw();var D=this.actors.length;if(0<D)for(var M=this.actors,F=0;F<D;F++)M[F].draw()}},'use strict',b5.App=function(e,t){b5.app=this,this.removals=[],this.touched=!1,this.touch_pos={x:0,y:0},this.touch_drag_x=0,this.touch_drag_y=0,this.timer=null,this.last_time=Date.now(),this.dt=0,this.avg_time=0,this.avg_fps=60,this.avg_frame=0,this.canvas_scale=1,this.pixel_ratio=1,this.design_width=e.width,this.design_height=e.height,this.display_width=e.width,this.display_height=e.height,this.canvas_cx=this.design_width>>1,this.canvas_cy=this.design_height>>1,this.order_changed=!0,this.total_loaded=0,this.total_load_errors=0,this.inner_width=b5.Display.getWidth(),this.inner_height=b5.Display.getHeight(),this.fill_screen=!1,this.disable_dock_screen=!1,this.started=null,this.num_logic=0,this.num_draw=0,this.scenes=[],this.canvas=e,this.canvas_scale_method=b5.App.FitNone,this.touch_supported=this.isTouchSupported(),this.allow_touchables=!0,this.target_frame_rate=60,this.adaptive_physics=!1,this.focus_scene=null,this.focus_scene2=null,this.hover_focus=null,this.clear_canvas=!1,this.touch_focus=null,this.global_scale=1,this.prevent_default=!1,this.debug=!1,this.timelines=new b5.TimelineManager,b5.ActionsListManager!==void 0&&(this.actions=new b5.ActionsListManager),this.events=new b5.EventsManager,this.tasks=new b5.TasksManager,this.box2d='undefined'!=typeof Box2D,this.instants='undefined'!=typeof FBInstant,this.loading_screen={background_fill:'#fffff',background_image:'loading.png',bar_background_fill:'#8080ff',bar_fill:'#ffffff'},this.use_web_audio=t||!0,this.mobile=b5.Utils.IsMobile(),this.platform=b5.Utils.GetPlatform(),this.bitmaps={},this.brushes={},this.shapes={},this.materials={},this.sounds={},this.fonts={},this.raw={},this.onResourceLoaded=function(e,t){this.onResourceLoadedBase(e,t)},this.display=new b5.Display(this.canvas),this.use_web_audio=b5.Sound.init(this),window.navigator.msPointerEnabled&&(e.addEventListener('MSPointerDown',this.onTouchStart,!1),e.addEventListener('MSPointerMove',this.onTouchMove,!1),e.addEventListener('MSPointerUp',this.onTouchEnd,!1)),e.addEventListener('touchstart',this.onTouchStart,!1),e.addEventListener('touchmove',this.onTouchMove,!1),e.addEventListener('touchend',this.onTouchEnd,!1),e.addEventListener('mousedown',this.onTouchStart,!1),e.addEventListener('mousemove',this.onTouchMove,!1),e.addEventListener('mouseup',this.onTouchEnd,!1),e.addEventListener('mouseout',this.onTouchEnd,!1);var o='onwheel'in document.createElement('div')?'wheel':document.onmousewheel===void 0?'DOMMouseScroll':'mousewheel';e.addEventListener(o,this.onWheel,!1),window.addEventListener('keypress',this.onKeyPress,!1),window.addEventListener('keydown',this.onKeyDown,!1),window.addEventListener('keyup',this.onKeyUp,!1),Visibility.change(function(t,e){b5.app.onAppPaused!==void 0&&('hidden'===e?b5.app.onAppPaused(!0):'visible'==e&&b5.app.onAppPaused(!1))})},Object.defineProperty(b5.App.prototype,'_focus_scene',{get:function(){return this.focus_scene},set:function(e){this.focus_scene!==e&&(this.focus_scene=b5.Utils.resolveObject(e))}}),Object.defineProperty(b5.App.prototype,'_focus_scene2',{get:function(){return this.focus_scene2},set:function(e){this.focus_scene2!==e&&(this.focus_scene2=b5.Utils.resolveObject(e))}}),b5.App.FitNone=0,b5.App.FitX=1,b5.App.FitY=2,b5.App.FitBest=3,b5.App.FitSize=4,b5.App.FitGreatest=5,b5.App.FitSmallest=6,b5.App.FitBest2=7,b5.App.prototype.onKeyPress=function(e){var t=b5.app;null!=t.focus_scene&&t.focus_scene.onKeyPressBase(e)},b5.App.prototype.onKeyDown=function(e){var t=b5.app;null!=t.focus_scene&&t.focus_scene.onKeyDownBase(e)},b5.App.prototype.onKeyUp=function(e){var t=b5.app;null!=t.focus_scene&&t.focus_scene.onKeyUpBase(e)},b5.App.prototype.isTouchSupported=function(){var e=window.navigator.msMaxTouchPoints,t='ontouchstart'in this.canvas;return!!(e||t)},b5.App.prototype.onTouchStart=function(t){var e=b5.app;e.touch_supported&&(t.stopPropagation(),e.prevent_default&&t.preventDefault());var o=e.focus_scene,a=e.focus_scene2,n=e.display;if(e.touched=!0,e.touch_pos=e.touch_supported&&void 0!==t.changedTouches?n.getCanvasPoint(t.changedTouches[0].pageX,t.changedTouches[0].pageY):n.getCanvasPoint(t.pageX,t.pageY),null!=o&&o.onBeginTouchBase(e.touch_pos),null!=a&&a.onBeginTouchBase(e.touch_pos),e.allow_touchables){var r=e.findHitActor(e.touch_pos);null!=r&&(e.touch_focus=r,r.onBeginTouchBase(e.touch_pos))}},b5.App.prototype.onTouchEnd=function(t){var e=b5.app;b5.Sound.unblock(),e.touch_supported&&(t.stopPropagation(),e.prevent_default&&t.preventDefault());var o=e.focus_scene,a=e.focus_scene2,n=e.display;if(e.touched=!1,e.touch_pos=e.touch_supported&&void 0!==t.changedTouches?n.getCanvasPoint(t.changedTouches[0].pageX,t.changedTouches[0].pageY):n.getCanvasPoint(t.pageX,t.pageY),null!=o&&o.onEndTouchBase(e.touch_pos),null!=a&&a.onEndTouchBase(e.touch_pos),e.allow_touchables){var r=e.findHitActor(e.touch_pos);null!=r&&r.onEndTouchBase(e.touch_pos),null!=e.touch_focus&&(void 0!==e.touch_focus.onLostTouchFocus&&e.touch_focus.onLostTouchFocus(e.touch_pos),e.touch_focus=null)}},b5.App.prototype.onTouchMove=function(t){var e=b5.app;e.touch_supported&&(t.stopPropagation(),e.prevent_default&&t.preventDefault());var o=e.focus_scene,a=e.focus_scene2,n=e.touch_pos.x,r=e.touch_pos.y,i=e.display;if(e.touch_pos=e.touch_supported&&void 0!==t.changedTouches?i.getCanvasPoint(t.changedTouches[0].pageX,t.changedTouches[0].pageY):i.getCanvasPoint(t.pageX,t.pageY),e.raw_touch_x=t.pageX,e.raw_touch_y=t.pageY,e.touch_drag_x=n-e.touch_pos.x,e.touch_drag_y=r-e.touch_pos.y,null!=o&&o.onMoveTouchBase(e.touch_pos),null!=a&&a.onMoveTouchBase(e.touch_pos),e.allow_touchables){var s=e.findHitActor(e.touch_pos);null!=s&&s.onMoveTouchBase(e.touch_pos),null!==e.hover_focus&&void 0!==e.hover_focus.onHover&&e.hover_focus.onHoverEnd(e.touch_pos),e.hover_focus=s,null!==s&&void 0!==s.onHover&&s.onHover(e.touch_pos)}},b5.App.prototype.onWheel=function(t){var e=b5.app;e.touch_supported&&(t.stopPropagation(),e.prevent_default&&t.preventDefault());var o=e.focus_scene,a=e.focus_scene2;null!=o&&o.onWheelBase(t),null!=a&&a.onWheelBase(t)},b5.App.prototype.addScene=function(e){return this.scenes.push(e),e.app=this,e},b5.App.prototype.removeScene=function(e){this.focus_scene==e&&(this.focus_scene=null),this.removals.push(e)},b5.App.prototype.cleanupDestroyedScenes=function(){var e=this.removals.length;if(0<e)for(var o=this.removals,a=this.scenes,n=a.length,r=0,i;r<e;r++){i=o[r];for(var c=0;c<n;c++)if(i==a[c]){i.release(),a.splice(c,1),n--;break}}this.removals=[]},b5.App.prototype.findScene=function(e){for(var o=this.scenes,a=o.length,n=0;n<a;n++)if(o[n].name==e)return o[n];return null},b5.App.prototype.addResource=function(e,t){var o=b5.Utils.getResFromType(this,t);null!=o&&(o[e.name]=e,e.parent=this)},b5.App.prototype.removeResource=function(e,t){var o=b5.Utils.getResFromType(this,t);null!=o&&(o[e.name]=void 0)},b5.App.prototype.findResource=function(e,t){var o=b5.Utils.getResFromType(this,t);if(null==o)return null;var a=o[e];return void 0===a?(this.debug&&console.log('resource \''+e+'\' ('+t+') not found'),null):a},b5.App.prototype.countResourcesNeedLoading=function(){var e=0,t=this.bitmaps;for(var o in t)t[o].preload&&e++;for(var o in t=this.sounds,t)t[o].preload&&e++;for(var o in t=this.fonts,t)t[o].preload&&e++;for(var o in t=this.raw,t)t[o].preload&&e++;return e},b5.App.prototype.onResourceLoadedBase=function(e,t){e.preload&&b5.app.total_loaded++,t?(e.preload&&b5.app.total_load_errors++,console.log('Error loading resource '+e.name)):this.debug&&console.log('Resource loaded '+e.name),e.loaded=!0},b5.App.prototype.waitForResources=function(e){var t=this;if(null!==t.loading_screen){var o=t.display,a=t.canvas_scale;o.setTransform(1,0,0,1,0,0),o.setFillStyle(t.loading_screen.background_fill),o.drawRect(0,0,t.display_width,t.display_height);var n=new Image;n.src=t.loading_screen.background_image,n.onload=function(){o.setTransform(a,0,0,a,t.canvas_cx,t.canvas_cy),o.drawImage(n,-n.width>>1,-n.height>>1,n.width,n.height),o.setFillStyle(t.loading_screen.bar_background_fill),o.drawRoundRect(-200,(t.canvas_height>>2)-40,400,80,20,!0)}}var r=t.countResourcesNeedLoading(!0),i=setInterval(function(){var a=b5.app.total_loaded;if(a>=r){b5.app.debug&&(console.log('Total resources loaded '+a+' of '+r),console.log('Total resource load errors '+b5.app.total_load_errors)),e!==void 0&&e(a,r),clearInterval(i);var n=setInterval(function(){e!==void 0&&e(r,r),t.start(),clearInterval(n)},1e3)}if(null!==t.loading_screen){var s=a/r;1<s&&(s=1);var c=380*s<<0;o.setFillStyle(t.loading_screen.bar_fill),o.drawRoundRect(-190,(t.canvas_height>>2)-30,c,60,10,!0)}},100)},b5.App.prototype.draw=function(){for(var e=this.scenes,o=e.length,a=0;a<o;a++)e[a].draw()},b5.App.prototype.update=function(e){var o=b5.app,a=this.scenes,n=a.length;o.dt=e,o.timelines.update(e),o.actions!==void 0&&o.actions.execute(),o.tasks.execute();for(var r=0;r<n;r++)a[r].update(e);this.cleanupDestroyedScenes(),this.order_changed&&(this.order_changed=!1,b5.Utils.sortLayers(this.scenes))},b5.App.prototype.mainLogic=function(){var e=b5.app,t=Date.now(),o=t-e.last_time;e.last_time=t,e.adt=o/1e3;var a;a=0===e.target_frame_rate?e.adt:1/e.target_frame_rate,.1<a&&(a=.1),e.update(a),e.avg_time+=o,e.avg_frame++,60==e.avg_frame&&(e.avg_frame=0,e.avg_fps=6e4/e.avg_time,e.avg_time=0),e.num_logic++},b5.App.prototype.mainDraw=function(){var e=b5.app,t=0|b5.Display.getWidth()-e.inner_width,o=0|b5.Display.getHeight()-e.inner_height;(0!=t||0!=o)&&e.setCanvasScalingMethod(),e.mainLogic(),e.clear_canvas&&e.display.clear(!0),e.draw(),e.num_draw++,requestAnimationFrame(e.mainDraw)},b5.App.prototype.start=function(){null!==this.started&&this.started(),this.mainDraw(),this.dirty()},b5.App.prototype.findHitActor=function(e){var t=null;return null!==this.focus_scene&&(t=this.focus_scene.findHitActor(e)),null===t&&null!==this.focus_scene2&&(t=this.focus_scene2.findHitActor(e)),t},b5.App.prototype.dirty=function(){for(var e=this.scenes,o=e.length,a=0;a<o;a++)e[a].dirty()},b5.App.prototype.setCanvasScalingMethod=function(e){void 0!==e&&(this.canvas_scale_method=e);var t=this.design_width,o=this.design_height,a=b5.Display.getWidth(),n=b5.Display.getHeight();if(!this.fill_screen){var r=!0;switch(this.canvas_scale_method){case b5.App.FitX:r=!0;break;case b5.App.FitY:r=!1;break;case b5.App.FitBest:r=!!(a/t<n/o);break;case b5.App.FitGreatest:r=!!(a>n);break;case b5.App.FitSmallest:r=!!(a<n);break;case b5.App.FitBest2:r=!!(a/t>n/o);}r?n=a*this.design_height/this.design_width:a=n*this.design_width/this.design_height}this.inner_width=a,this.inner_height=n;var i=t,s=o,c=1,p=1;if(this.canvas_scale=this.global_scale,this.canvas_scale_method===b5.App.FitNone);else if(this.canvas_scale_method===b5.App.FitSize)i=a,s=n;else{i=a,s=n,c=i/t,p=s/o;var d=1;switch(this.canvas_scale_method){case b5.App.FitX:d=c;break;case b5.App.FitY:d=p;break;case b5.App.FitBest:d=c<p?c:p;break;case b5.App.FitGreatest:d=i>s?c:p;break;case b5.App.FitSmallest:d=i<s?c:p;break;case b5.App.FitBest2:d=c>p?c:p;}this.canvas_scale=d*this.global_scale}var l=0|i*this.pixel_ratio,y=0|s*this.pixel_ratio;this.canvas.width=l,this.canvas.height=y,this.canvas.style.width=i+'px',this.canvas.style.height=s+'px',this.canvas_cx=i/2,this.canvas_cy=s/2,this.display_width=i,this.display_height=s,this.dirty()},b5.App.prototype.parseAndSetFocus=function(e){new b5.Xoml(this).parseResources(this,[b5.data[e]]),this.order_changed=!0,this.focus_scene=this.findScene(e)},b5.App.prototype.addTask=function(e,t,o,a,n){return this.tasks.add(e,t,o,a,n)},b5.App.prototype.removeTask=function(e){this.tasks.remove(e)},'use strict',b5.Scene=function(){this.app=null,this.actors=[],this.removals=[],this.world=null,this.timelines=new b5.TimelineManager,b5.ActionsListManager!==void 0&&(this.actions=new b5.ActionsListManager),this.tasks=new b5.TasksManager,this.events=new b5.EventsManager,this.order_changed=!0,this.name='',this.tag='',this.active=!0,this.visible=!0,this.layer=0,this.x=0,this.y=0,this.w=1024,this.h=768,this.scale=1,this.clip_children=!0,this.clip_shape=null,this.camera_x=0,this.camera_y=0,this.camera_vx=0,this.camera_vy=0,this.vx_damping=1,this.vy_damping=1,this.follow_speed_x=.3,this.follow_speed_y=.3,this.target_x=null,this.target_y=null,this.touch_pan_x=!1,this.touch_pan_y=!1,this.panning=!1,this.min_panning=0,this.world_scale=20,this.time_step=0,this.extents=[0,0,0,0],this.opacity=1,this.frame_count=0,this.touching=!1,this.touchmove=!1,this.draw_reverse=!1,this.bitmaps=[],this.brushes=[],this.shapes=[],this.materials=[],this.sounds=[],this.fonts=[],this.raw=[]},Object.defineProperty(b5.Scene.prototype,'_x',{get:function(){return this.x},set:function(e){this.x!==e&&(this.x=e)}}),Object.defineProperty(b5.Scene.prototype,'_y',{get:function(){return this.y},set:function(e){this.y!==e&&(this.y=e)}}),Object.defineProperty(b5.Scene.prototype,'_layer',{get:function(){return this.layer},set:function(e){this.layer!==e&&(this.layer=e,this.app.order_changed=!0)}}),Object.defineProperty(b5.Scene.prototype,'_clip_shape',{get:function(){return this.clip_shape},set:function(e){this.clip_shape!==e&&(this.clip_shape=b5.Utils.resolveResource(e,'shape'))}}),Object.defineProperty(b5.Scene.prototype,'_av',{set:function(e){this.visible=e,this.active=e}}),b5.Scene.prototype.release=function(){this.onDestroy!==void 0&&this.onDestroy(),this.world=null,this.actors=null},b5.Scene.prototype.destroy=function(){this.app.removeScene(this)},b5.Scene.prototype.addActor=function(e){return this.actors.push(e),e.scene=this,e},b5.Scene.prototype.removeActor=function(e){this.removals.push(e)},b5.Scene.prototype.removeActorsWithTag=function(e){for(var o=this.actors,a=o.length,n=this.removals,r=0;r<a;r++)o[r].tag===e&&n.push(o[r])},b5.Scene.prototype.cleanupDestroyedActors=function(){var e=this.removals.length;if(0<e)for(var o=this.removals,a=this.actors,n=a.length,r=0,i;r<e;r++){i=o[r];for(var c=0;c<n;c++)if(i===a[c]){i.release(),a.splice(c,1),n--;break}}this.removals=[]},b5.Scene.prototype.findActor=function(e,o){o===void 0&&(o=!1);for(var a=this.actors,n=a.length,r=0;r<n;r++){if(a[r].name===e)return a[r];if(o){var i=a[r].findActor(e,o);if(null!==i)return i}}return null},b5.Scene.prototype.findActorById=function(e,o){o===void 0&&(o=!1);for(var a=this.actors,n=a.length,r=0;r<n;r++){if(a[r].id===e)return a[r];if(o){var i=a[r].findActorById(e,o);if(null!==i)return i}}return null},b5.Scene.prototype.bringToFront=function(){for(var e=this.app.scenes,o=e.length,a=-1,n=0;n<o;n++)if(e[n]===this){a=n;break}0<=a&&(e.splice(a,1),e.push(this))},b5.Scene.prototype.sendToBack=function(){for(var e=this.app.scenes,o=e.length,a=-1,n=0;n<o;n++)if(e[n]===this){a=n;break}0<=a&&(e.splice(a,1),e.unshift(this))},b5.Scene.prototype.onKeyPressBase=function(e){this.onKeyPress!==void 0&&this.onKeyPress(e)},b5.Scene.prototype.onKeyDownBase=function(e){this.onKeyDown!==void 0&&this.onKeyDown(e)},b5.Scene.prototype.onKeyUpBase=function(e){this.onKeyUp!==void 0&&this.onKeyUp(e)},b5.Scene.prototype.onBeginTouchBase=function(e){this.touching=!0,this.onBeginTouch!==void 0&&this.onBeginTouch(e)},b5.Scene.prototype.onEndTouchBase=function(e){this.touching&&this.onTapped!==void 0&&this.onTapped(e),this.touching=!1,this.touchmove=!1,this.onEndTouch!==void 0&&this.onEndTouch(e),this.panning=!1},b5.Scene.prototype.onMoveTouchBase=function(e){if(this.touchmove=!0,void 0!==this.onMoveTouch&&this.onMoveTouch(e),this.touching){var t=this.app,o=0;this.touch_pan_x&&(o=t.touch_drag_x,this.camera_vx=o*t.target_frame_rate,this.camera_x+=o),this.touch_pan_y&&(o=t.touch_drag_y,this.camera_vy=o*t.target_frame_rate,this.camera_y+=o),t.touch_drag_x*t.touch_drag_x+t.touch_drag_y*t.touch_drag_y>this.min_panning&&(this.panning=!0)}},b5.Scene.prototype.onWheelBase=function(t){this.onWheel!==void 0&&this.onWheel(t)},b5.Scene.prototype.initWorld=function(e,t,o){if(this.app.box2d){this.world=new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(e,t),o);var a=new Box2D.Dynamics.b2ContactListener;a.BeginContact=function(e){var t=e.GetFixtureA().GetBody().GetUserData();void 0!==t.onCollisionStart&&t.onCollisionStart(e),t=e.GetFixtureB().GetBody().GetUserData(),void 0!==t.onCollisionStart&&t.onCollisionStart(e)},a.EndContact=function(e){var t=e.GetFixtureA().GetBody().GetUserData();void 0!==t.onCollisionEnd&&t.onCollisionEnd(e),t=e.GetFixtureB().GetBody().GetUserData(),void 0!==t.onCollisionEnd&&t.onCollisionEnd(e)},this.world.SetContactListener(a)}},b5.Scene.prototype.draw=function(){if(this.visible){var e=this.app,o=e.canvas_scale*this.scale,a=e.display;if(this.clip_children){var n=e.canvas_cx+this.x,r=e.canvas_cy+this.y;if(a.setTransform(o,0,0,o,n,r),a.saveContext(),null===this.clip_shape)a.clipRect(-this.w/2,-this.h/2,this.w,this.h);else{var i=this.clip_shape;this.clip_shape.type===b5.Shape.TypeBox?a.clipRect(0,0,i.width,i.height):this.clip_shape.type===b5.Shape.TypeCircle?a.clipArc(0,0,i.width,0,2*Math.PI):this.clip_shape.type===b5.Shape.TypePolygon&&a.clipPolygon(i.vertices)}}var s=this.actors,c=s.length;if(this.draw_reverse)for(var p=c-1;0<=p;p--)s[p].draw();else for(var p=0;p<c;p++)s[p].draw();this.clip_children&&a.restoreContext()}},b5.Scene.prototype.baseUpdate=function(e){if(!this.active)return!1;void 0!==this.onTick&&this.onTick(e),this.timelines.update(e),void 0!==this.actions&&this.actions.execute(),this.tasks.execute(),this.updateCamera(e);for(var o=this.actors,a=o.length,n=0;n<a;n++)o[n].update(e);if(null!==this.world){var r=b5.app;if(0===this.time_step)this.world.Step(e,10,10);else{var i=1;r.adaptive_physics&&(i=r.target_frame_rate/r.avg_fps+.5<<0,1>i?i=1:3<i&&(i=3));for(var n=0;n<i;n++)this.world.Step(this.time_step,10,10)}}return null!==this.world&&this.world.ClearForces(),this.frame_count++,this.cleanupDestroyedActors(),this.order_changed&&(this.order_changed=!1,b5.Utils.sortLayers(this.actors)),!0},b5.Scene.prototype.update=function(e){return this.baseUpdate(e)},b5.Scene.prototype.updateCamera=function(e){if(null!==this.target_x&&(0===this.follow_speed_x?(this.camera_x=this.target_x.x,this.camera_vx=0):this.camera_vx+=(this.target_x.x-this.camera_x)*this.follow_speed_x),null!==this.target_y&&(0===this.follow_speed_y?(this.camera_y=this.target_y.y,this.camera_vy=0):this.camera_vy+=(this.target_y.y-this.camera_y)*this.follow_speed_y),this.touching||(this.camera_x+=this.camera_vx*e,this.camera_y+=this.camera_vy*e,this.camera_vx*=this.vx_damping,this.camera_vy*=this.vy_damping),0!==this.camera_x||0!==this.camera_y){var t=this.extents[2],o=this.extents[3],a=this.app.design_width,n=this.app.design_height;if(0!==t&&a<=t){var r=a/2,i=this.extents[0]+r,s=this.extents[0]+t-r;this.camera_x<i&&(this.camera_x=i,this.camera_vx=0),this.camera_x>s&&(this.camera_x=s,this.camera_vx=0)}if(a>t&&(this.camera_x=0),0!==o&&n<=o){var c=n/2,p=this.extents[1]+c,d=this.extents[1]+o-c;this.camera_y<p&&(this.camera_y=p,this.camera_vy=0),this.camera_y>d&&(this.camera_y=d,this.camera_vy=0)}n>o&&(this.camera_y=0)}},b5.Scene.prototype.findHitActor=function(e){for(var o=this.actors,a=o.length,n=null,r=a-1;0<=r;r--)if(n=o[r].hitTest(e),null!==n)return n;return n},b5.Scene.prototype.dirty=function(){for(var e=this.actors,o=e.length,a=0;a<o;a++)e[a].dirty()},b5.Scene.prototype.addResource=function(e,t){if(t===void 0)throw'Resource type not specified';var o=b5.Utils.getResFromType(this,t);null!==o&&(o.push(e),e.parent=this)},b5.Scene.prototype.removeResource=function(e,o){var a=b5.Utils.getResFromType(this,o);if(null!==a)for(var n=a.length,r=0;r<n;r++)if(a[r]===e)return a.parent=null,void a.splice(r,1)},b5.Scene.prototype.playTimeline=function(e){this.active||(this.active=!0,this.visible=!0);var t=this.timelines.find(e);null!==t&&t.restart()},b5.Scene.prototype.addTask=function(e,t,o,a,n){this.tasks.add(e,t,o,a,n)},b5.Scene.prototype.removeTask=function(e){this.tasks.remove(e)},b5.Scene.prototype.findResource=function(e,o){var a=b5.Utils.getResFromType(this,o);if(null===a)return null;for(var n=a.length,r=0;r<n;r++)if(a[r].name===e)return a[r];return this.app.findResource(e,o)},b5.Scene.prototype.areResourcesLoaded=function(){for(var e=this.bitmaps,o=e.length,a=0;a<o;a++)if(e[a].preload&&!e[a].loaded)return!1;return!0},b5.Scene.prototype.countResourcesNeedLoading=function(){for(var e=0,o=this.bitmaps,a=o.length,n=0;n<a;n++)o[n].preload&&e++;for(o=this.sounds,a=o.length,n=0;n<a;n++)o[n].preload&&e++;for(o=this.fonts,a=o.length,n=0;n<a;n++)o[n].preload&&e++;for(o=this.raw,a=o.length,n=0;n<a;n++)o[n].preload&&e++;return e},'use strict',b5.Xoml=function(e){this.current_scene=null,this.app=e},b5.Xoml.prototype.parseScene=function(e,o){this.app.debug&&console.log('Parsing Scene '+o.Name);var a=new b5.Scene;null!==e&&(e.addScene(a),o.Current?e.focus_scene=a:o.Current2&&(e.focus_scene2=a)),this.current_scene=a,a.name=o.Name,void 0!==o.Tag&&(a.tag=o.Tag),a.x=o.Position[0],a.y=o.Position[1],void 0!==o.CanvasSize&&(a.w=o.CanvasSize[0],a.h=o.CanvasSize[1]),void 0!==o.Layer&&(a.layer=o.Layer),void 0!==o.Visible&&(a.visible=o.Visible),void 0!==o.Active&&(a.active=o.Active),void 0!==o.Physics&&o.Physics&&(a.initWorld(o.Gravity[0],o.Gravity[1],o.DoSleep),void 0!==o.PhysicsTimestep&&(a.time_step=o.PhysicsTimestep),void 0!==o.WorldScale&&(a.world_scale=o.WorldScale)),void 0!==o.ClipChildren&&(a.clip_children=o.ClipChildren),'Both'===o.TouchPan?(a.touch_pan_x=!0,a.touch_pan_y=!0):'X'===o.TouchPan?a.touch_pan_x=!0:'Y'===o.TouchPan&&(a.touch_pan_y=!0),a.extents[0]=o.Extents[0],a.extents[1]=o.Extents[1],a.extents[2]=o.Extents[2],a.extents[3]=o.Extents[3],a.follow_speedx=o.FollowSpeed[0],a.follow_speedy=o.FollowSpeed[1];var n=o.UserProps;if(void 0!==n)for(var r=0;r<n.length;r++)a[n[r].N]=n[r].V;var i=o.TimelineCollection;if(void 0!==i)for(var r=0;r<i.length;r++)this.parseTimeline(a,i[r]);var s=o.ActionsList;if(void 0!==s)for(var r=0;r<s.length;r++)this.parseActionsList(a,s[r]);return void 0!==o.Alpha&&(a.opacity=o.Alpha),void 0===o.Cn||this.parseResources(a,o.Cn),void 0!==o.ClipShape&&''!==o.ClipShape&&(a.clip_shape=a.findResource(o.ClipShape,'shape')),''!==o.TargetX&&(a.target_x=a.findActor(o.TargetX)),''!==o.TargetY&&(a.target_y=a.findActor(o.TargetY)),void 0!==o.VelocityDamping&&(a.vx_damping=o.VelocityDamping[0],a.vy_damping=o.VelocityDamping[1]),void 0!==o.OnCreate&&(a.onCreate=Function(o.OnCreate)),void 0!==o.OnDestroy&&(a.onDestroy=Function(o.OnDestroy)),void 0!==o.OnTick&&(a.onTick=Function('dt',o.OnTick)),void 0!==o.OnTapped&&(a.onTapped=Function('touch_pos',o.OnTapped)),void 0!==o.OnBeginTouch&&(a.onBeginTouch=Function('touch_pos',o.OnBeginTouch)),void 0!==o.OnEndTouch&&(a.onEndTouch=Function('touch_pos',o.OnEndTouch)),void 0!==o.OnMoveTouch&&(a.onMoveTouch=Function('touch_pos',o.OnMoveTouch)),void 0!==o.OnWheel&&(a.onWheel=Function('event',o.OnWheel)),void 0!==o.OnKeyPress&&(a.onKeyPress=Function('event',o.OnKeyPress)),void 0!==o.OnKeyDown&&(a.onKeyDown=Function('event',o.OnKeyDown)),void 0!==o.OnKeyUp&&(a.onKeyUp=Function('event',o.OnKeyUp)),void 0!==a.onCreate&&a.onCreate(),a},b5.Xoml.prototype.parseBrush=function(e,o){this.app.debug&&console.log('Parsing Brush '+o.N);var a;if(0===o.BT){var n=o.RC,r=e.findResource(o.I,'bitmap'),i=o.F;if(0===i.length)a=new b5.ImageAtlas(o.N,r,n[0],n[1],n[2],n[3],n[4],n[5]);else{a=new b5.ImageAtlas(o.N,r);for(var s=0,c;s<i.length;s++)c=i[s],a.addFrame(c[0],c[1],c[2],c[3],c[5],c[6])}var p=o.AN;if(void 0!==p&&0!==p.length)for(var s=0;s<p.length;s++)a.addAnim(p[s].N,p[s].F,p[s].S)}else{var d=o.ST;a=new b5.Gradient(o.N),a.rad_radius=o.RR,void 0!==a.rad_radius&&(a.rad_pos=[0,0,0,0]),void 0!==o.RP&&(a.rad_pos=o.RP);for(var s=0,l;s<d.length;s++)l=d[s],a.addColourStop(l.c,l.o);void 0!==o.Angle&&(a.angle=o.Angle)}return e.addResource(a,'brush'),a},b5.Xoml.prototype.parseRaw=function(e,t){this.app.debug&&console.log('Parsing Raw '+t.N);var o=new b5.Raw(t.N,t.Loc,t.P);return e.addResource(o,'raw'),o},b5.Xoml.prototype.parseImage=function(e,t){this.app.debug&&console.log('Parsing Image '+t.N);var o;return o=void 0!==t.Loc2&&b5.app.mobile?new b5.Bitmap(t.N,t.Loc2,t.P):new b5.Bitmap(t.N,t.Loc,t.P),e.addResource(o,'bitmap'),o},b5.Xoml.prototype.parseSound=function(e,t){this.app.debug&&console.log('Parsing Sound '+t.N);var o=new b5.Sound(t.N,t.Loc,t.R);return void 0!==t.P&&(o.preload=1==t.P),void 0!==t.A&&(o.auto_play=1==t.A),void 0!==t.Loc2&&(o.location2=t.Loc2),void 0!==t.L&&(o.loop=1==t.L),o.preload&&o.load(),e.addResource(o,'sound'),o},b5.Xoml.prototype.parseFont=function(e,t){this.app.debug&&console.log('Parsing Font '+t.Name);var o=new b5.Font(t.Name,t.Name,t.Preload);e.addResource(o,'font')},b5.Xoml.prototype.parseShape=function(e,o){this.app.debug&&console.log('Parsing Shape '+o.N);var a=new b5.Shape(o.N);if(a.width=o.W,a.height=o.H,'Circle'===o.ST)a.type=b5.Shape.TypeCircle;else if('Box'===o.ST)a.type=b5.Shape.TypeBox;else if('Polygon'===o.ST){a.type=b5.Shape.TypePolygon;for(var n=o.V,r=n.length,i=0;i<r;i++)a.vertices.push(n[i]);if(void 0!==o.CV)for(var c=o.CV.length,i=0;i<c;i++){var p=[],n=o.CV[i];r=n.length;for(var d=0;d<r;d++)p.push(n[d]);a.convexVertices.push(p)}}return e.addResource(a,'shape'),a},b5.Xoml.prototype.parseMaterial=function(e,t){this.app.debug&&console.log('Parsing Material '+t.N);var o=new b5.Material;return o.name=t.N,o.type=t.MT,o.density=t.D,o.friction=t.F,o.restitution=t.R,o.gravity_scale=t.GS,o.fixed_rotation=t.FR,o.is_bullet=t.IB,e.addResource(o,'material'),o},b5.Xoml.prototype.parseTimeline=function(e,o){var a=new b5.Timeline;o.N!==void 0&&(a.name=o.N);for(var n=o.A.length,r=0;r<n;r++){var i=o.A[r],s=new b5.Animation(a,e,i.P,i.V,i.TI,0,i.E);if(void 0!==i.T&&(s.tween=i.T),void 0!==i.D&&(s.destroy=i.D),void 0!==i.R&&(s.repeat=i.R),s.repeats_left=s.repeat,void 0!==i.TS&&(s.time_scale=i.TS),void 0!==i.DA&&(s.deactivate=i.DA),void 0!==i.DE&&(s.delay=-i.DE),!1===i.A&&s.pause(),void 0!==i.OnE&&(s.onEnd=Function(i.OnE)),void 0!==i.OnR&&(s.onRepeat=Function(i.OnR)),void 0!==i.AC)for(var c=0;c<i.AC.length;c++)if(''!==i.Actions[c]){var p=i.AC[c];s.setAction(c,Function(p))}a.anims.push(s)}e.timelines.add(a)},b5.Xoml.prototype.parseActionsList=function(e,o){var a=new b5.ActionsList;o.N!==void 0&&(a.name=o.N),o.R!==void 0&&(a.repeats_left=o.R,a.repeat=o.R),a.destroy=!1;for(var n=o.A,r=n.length,i=0;i<r;i++){var s=n[i][0],c;'Custom'===s&&(s=n[i][1],n[i].splice(0,1)),c=b5.ActionsRegister.create(s,n[i]),a.actions.push(c)}o.P!==void 0&&o.P&&a.play(),e.actions.add(a)},b5.Xoml.prototype.parseActor=function(e,o,a){var n=null;if(e.scene=this.current_scene,void 0!==a.N&&(e.name=a.N),void 0!==a.T&&(e.tag=a.T),void 0!==a.V&&(e.visible=a.V),void 0!==a.Ac&&(e.active=a.Ac),void 0!==a.L&&(e.layer=a.L),void 0!==a.P&&(e.x=a.P[0],e.y=a.P[1]),void 0!==a.S&&(e.scale_x=a.S[0],e.scale_y=a.S[1]),void 0!==a.SM&&(e.scale_method=a.SM),void 0!==a.St&&(e.stacking=a.St),void 0!==a.FX&&a.FX&&(e.scale_x=-e.scale_x),void 0!==a.FY&&a.FY&&(e.scale_y=-e.scale_y),void 0!==a.Or&&(e.orphaned=a.Or),void 0!==a.A&&(e.rotation=a.A),void 0!==a.C&&(e.fill_style=a.C),void 0!==a.SC&&(e.stroke_style=a.SC),void 0!==a.F&&(e.filled=a.F),void 0!==a.FS&&(e.stroke_filled=a.FS),void 0!==a.Th&&(e.stroke_thickness=a.Th),void 0!==a.Sz&&(e.w=a.Sz[0],e.h=a.Sz[1],e.ow=a.Sz[0],e.oh=a.Sz[1]),void 0!==a.O&&(e.ox=a.O[0],e.oy=a.O[1]),e.absolute_origin=!!(-1>=e.ox||1<=e.ox||-1>=e.oy||1<=e.oy),void 0!==a.Al&&(e.opacity=a.Al),void 0!==a.SAl&&(e.stroke_opacity=a.SAl),void 0!==a.UPO&&(e.use_parent_opacity=a.UPO),void 0!==a.D&&(e.depth=a.D),e.use_transform=!0,void 0!==a.Ve&&(e.vx=a.Ve[0],e.vy=a.Ve[1]),void 0!==a.AV&&(e.vr=a.AV),void 0!==a.VD&&(e.vx_damping=a.VD[0],e.vy_damping=a.VD[1]),void 0!==a.AVD&&(e.vr_damping=a.AVD),void 0!==a.WP&&(e.wrap_position=a.WP),void 0!==a.IC&&(e.ignore_camera=a.IC),void 0!==a.CC&&(e.clip_children=a.CC),void 0!==a.To&&(e.touchable=a.To),void 0!==a.Ht&&(e.hit=a.Ht),void 0!==a.Bu&&(e.bubbling=a.Bu),void 0!==a.Do){var r=a.Do;void 0!==a.Dse&&(e.dock_screen=a.Dse),'top'===r||'topleft'===r||'topright'===r?e.dock_y=b5.Actor.Dock_Top:('bottom'===r||'bottomleft'===r||'bottomright'===r)&&(e.dock_y=b5.Actor.Dock_Bottom),'left'===r||'topleft'===r||'bottomleft'===r?e.dock_x=b5.Actor.Dock_Left:('right'===r||'topright'===r||'bottomright'===r)&&(e.dock_x=b5.Actor.Dock_Right)}if(void 0!==a.M&&(e.margin[0]=a.M[0],e.margin[1]=a.M[1],e.margin[2]=a.M[2],e.margin[3]=a.M[3]),void 0!==a.CM&&(e.clip_margin[0]=a.CM[0],e.clip_margin[1]=a.CM[1],e.clip_margin[2]=a.CM[2],e.clip_margin[3]=a.CM[3]),void 0!==a.Sh&&(e.shadow=a.Sh),void 0!==a.ShO&&(e.shadow_x=a.ShO[0],e.shadow_y=a.ShO[1]),void 0!==a.ShB&&(e.shadow_blur=a.ShB),void 0!==a.ShC&&(e.shadow_colour=a.ShC),void 0!==a.CO&&(e.composite_op=a.CO),void 0!==a.BG)if(n=this.current_scene.findResource(a.BG,'brush'),void 0!==n.stops){var i={x:0,y:0},s={x:0,y:1};void 0!==a.GS&&(i.x=a.GS[0],i.y=a.GS[1]),void 0!==a.GE&&(s.x=a.GE[0],s.y=a.GE[1]);var c=n.createStyle(e.w,e.h,i,s);e.filled?e.fill_style=c:e.stroke_filled&&(e.stroke_style=c)}else e.atlas=n;if(void 0!==a.Pd&&(e.padding=a.Pd),void 0!==a.DA&&null!==n&&e.playAnim(a.DA),3===a.RA){var p=a.TX,d=a.TY;e.map_width=a.MW,e.map_height=a.MH,e.tile_width=a.TW,e.tile_height=a.TH,e.display_width=a.DW,e.display_height=a.DH,e.map=a.Map,e.collision_map=a.CMap,e.generateTiles(p*d,e.tile_width,e.tile_height,e.tile_width*p)}null!==o&&o.addActor(e),void 0!==a.OnC&&(e.onCreate=Function(a.OnC)),void 0!==a.OnD&&(e.onDestroy=Function(a.OnD)),void 0!==a.OnTi&&(e.onTick=Function('dt',a.OnTi)),void 0!==a.OnT&&(e.touchable=!0,e.onTapped=Function('touch_pos',a.OnT)),void 0!==a.OnB&&(e.touchable=!0,e.onBeginTouch=Function('touch_pos',a.OnB)),void 0!==a.OnE&&(e.touchable=!0,e.onEndTouch=Function('touch_pos',a.OnE)),void 0!==a.OnM&&(e.touchable=!0,e.onMoveTouch=Function('touch_pos',a.OnM)),void 0!==a.OnL&&(e.touchable=!0,e.onLostTouchFocus=Function('touch_pos',a.OnL)),void 0!==a.OnH&&(e.onHover=Function('touch_pos',a.OnH)),void 0!==a.OnHE&&(e.onHoverEnd=Function('touch_pos',a.OnHE)),void 0!==a.OnCS&&(e.onCollisionStart=Function('contact',a.OnCS)),void 0!==a.OnCE&&(e.onCollisionEnd=Function('contact',a.OnCE));var l=a.UP;if(void 0!==l)for(var y=0;y<l.length;y++)e[l[y].N]=l[y].V;var _=a.Fxs;if(void 0!==_)for(var y=0;y<_.length;y++){var u={},h=null,g=null;void 0!==_[y].M&&''!==_[y].M&&(h=this.current_scene.findResource(_[y].M,'material')),void 0!==_[y].S&&''!==_[y].S&&(g=this.current_scene.findResource(_[y].S,'shape')),0===y&&e.initBody(h.type,h.fixed_rotation,h.is_bullet),null===g?1===a.RA?(u.type=b5.Shape.TypeCircle,u.width=e.w/2):(u.type=b5.Shape.TypeBox,u.width=e.w,u.height=e.h):u.shape=g,null!==h&&(u.material=h),u.is_sensor=_[y].R,void 0!==_[y].C&&(u.collision_category=_[y].C[0],u.collision_mask=_[y].C[1],u.collision_group=_[y].C[2]),e.addFixture(u)}var m=a.Jts;if(void 0!==m)for(var y=0;y<m.length;y++){var u=[],f=this.current_scene.findActor(m[y].AB);u.type=m[y].T,u.actor_b=f,u.anchor_a={x:m[y].OA[0],y:m[y].OA[1]},u.anchor_b={x:m[y].OB[0],y:m[y].OB[1]},u.self_collide=m[y].SC,u.damping=m[y].D,u.frequency=m[y].F,u.limit_joint=m[y].LJ,u.lower_limit=m[y].LL,u.upper_limit=m[y].UL,u.motor_enabled=m[y].ME,u.motor_speed=m[y].MS,u.max_motor_torque=m[y].MT,u.max_motor_force=m[y].MF,u.ground_a={x:m[y].GA[0],y:m[y].GA[1]},u.ground_b={x:m[y].GB[0],y:m[y].GB[1]},u.axis={x:m[y].A[0],y:m[y].A[1]},u.ratio=m[y].R,e.addJoint(u)}var A=a.TC;if(void 0!==A)for(var y=0;y<A.length;y++)this.parseTimeline(e,A[y]);var x=a.AL;if(void 0!==x)for(var y=0;y<x.length;y++)this.parseActionsList(e,x[y]);if(null!==e.body){var v=Box2D.Common.Math.b2Vec2;e.body.SetLinearVelocity(new v(e.vx,e.vy)),e.body.SetAngularVelocity(e.vr),e.body.SetLinearDamping(e.vx_damping),e.body.SetAngularDamping(e.vr_damping)}return void 0!==a.Cn&&this.parseResources(e,a.Cn),e.setBodyActive(e.active),e},b5.Xoml.prototype.parseIcon=function(e,t){this.app.debug&&console.log('Parsing Icon '+t.N);var o=0,a;if(void 0!==t.RA&&(o=t.RA),1===o)a=new b5.ArcActor;else if(2===o)a=new b5.RectActor;else if(3===o)a=new b5.MapActor;else if(0===o)if(void 0!==t.Geo){a=new b5.PolygonActor;var n=this.current_scene.findResource(t.Geo,'shape');null!==n&&(a.points=n.vertices)}else a=new b5.Actor;return void 0!==t.CR&&(a.corner_radius=t.CR),this.parseActor(a,e,t),1===o&&(a.radius=a.w/2),void 0!==t.Vi&&t.Vi&&(a.makeVirtual(),void 0!==t.SR&&(a.scroll_range[0]=t.SR[0],a.scroll_range[1]=t.SR[1],a.scroll_range[2]=t.SR[2],a.scroll_range[3]=t.SR[3]),void 0!==t.SPos&&(a.scroll_pos_x=t.SPos[0],a.scroll_pos_y=t.SPos[1])),void 0!==t.ClV&&(a.clip_virtual=t.ClV),void 0!==t.IAS&&(a.ignore_atlas_size=t.IAS),void 0!==t.SCl&&(a.self_clip=t.SCl),void 0!==t.CS&&(a.clip_shape=this.current_scene.findResource(t.CS,'shape')),!0===t.Ca&&(a.cached=!0,a.cache=!0),!0===t.Me&&(a.merge_cache=!0),!0===t.Rd&&(a.round_pixels=!0),void 0!==a.onCreate&&a.onCreate(),a},b5.Xoml.prototype.parseLabel=function(e,t){this.app.debug&&console.log('Parsing Label '+t.N);var o=new b5.LabelActor;return o.text=t.Text,o.font=t.Font,o.text_align=t.AlignH,o.text_baseline=t.AlignV,this.parseActor(o,e,t),void 0!==t.Lh&&(o.line_height=t.Lh),!0===t.Ca&&(o.cached=!0,o.cache=!0),!0===t.Me&&(o.merge_cache=!0),!0===t.Rd&&(o.round_pixels=!0),void 0!==t.Mw&&(o.max_width=t.Mw),void 0!==o.onCreate&&o.onCreate(),o},b5.Xoml.prototype.parseResources=function(e,o){for(var a=o.length,n=0;n<a;n++)this.parseResource(e,o[n])},b5.Xoml.prototype.parseResource=function(e,t){var o=t.RT;if('Scene'===o)return this.parseScene(e,t);return'Brush'===o?this.parseBrush(e,t):'Image'===o?this.parseImage(e,t):'Sound'===o?this.parseSound(e,t):'Font'===o?this.parseFont(e,t):'Shape'===o?this.parseShape(e,t):'Material'===o?this.parseMaterial(e,t):'Icon'===o?this.parseIcon(e,t):'Label'===o?this.parseLabel(e,t):'GFile'===o?this.parseRaw(e,t):null},b5.Xoml.findResource=function(e,o,a){e.Cn!==void 0&&(e=e.Cn);for(var n=e.length,r=0;r<n;r++)if(e[r].RT.toLowerCase()===a&&e[r].N===o)return e[r];return null},'use strict',b5.Maths=function(){},b5.Maths.mulMatrix=function(e,t){var o=t[0],a=t[1],n=t[2],r=t[3],i=t[4],s=t[5],c=e[0],p=e[1],d=e[2],l=e[3],y=e[4],_=e[5];e[0]=o*c+n*p,e[1]=a*c+r*p,e[2]=o*d+n*l,e[3]=a*d+r*l,e[4]=o*y+n*_+i,e[5]=a*y+r*_+s},b5.Maths.preMulMatrix=function(e,t){var o=e[0],a=e[1],n=e[2],r=e[3],i=e[4],s=e[5],c=t[0],p=t[1],d=t[2],l=t[3],y=t[4],_=t[5];e[0]=o*c+n*p,e[1]=a*c+r*p,e[2]=o*d+n*l,e[3]=a*d+r*l,e[4]=o*y+n*_+i,e[5]=a*y+r*_+s},b5.Maths.vecMulMatrix=function(e,t,o){var a=e*o[0]+t*o[2]+o[4],n=e*o[1]+t*o[3]+o[5];return{x:a,y:n}},'use strict',b5.Display=function(e){this.canvas=e,this.cache_ctx=null,this.context=e.getContext('2d'),this.context.lineWidth=1,this.context.strokeStyle='black',this.context.fillStyle='black',this.context.globalAlpha=1,this.context.lineJoin='round',this.context.lineCap='round';var t=b5.Utils.GetDevicePixelRatio(),o=b5.Utils.GetBackingStorePixelRatio(this.context);t!==o&&(b5.app.pixel_ratio=t/o)},b5.Display.getWidth=function(){return document.documentElement.clientWidth},b5.Display.getHeight=function(){return document.documentElement.clientHeight},b5.Display.prototype.getCanvasPoint=function(e,t){var o=b5.app,a=o.canvas_scale;return{x:(e-this.canvas.offsetLeft-o.canvas_cx)/a,y:(t-this.canvas.offsetTop-o.canvas_cy)/a}},b5.Display.prototype.clear=function(){var e=b5.app,t=this.context,o=b5.app.pixel_ratio;t.setTransform(o,0,0,o,0,0),t.clearRect(0,0,e.display_width,e.display_height)},b5.Display.prototype.drawPolygon=function(e,t,o,a){var n=this.context;null!==this.cache_ctx&&(n=this.cache_ctx);var r=o.length;n.beginPath(),n.moveTo(o[0]+e,o[1]+t);for(var s=2;s<r;s+=2)n.lineTo(o[s]+e,o[s+1]+t);return a?n.fill():(n.lineTo(o[0]+e,o[1]+t),n.stroke()),this},b5.Display.prototype.drawLine=function(e,t,o,a){var n=this.context;return null!==this.cache_ctx&&(n=this.cache_ctx),n.beginPath(),n.moveTo(e,t),n.lineTo(o,a),n.stroke(),this},b5.Display.prototype.drawRect=function(e,t,o,a,n){var r=this.context;return null!==this.cache_ctx&&(r=this.cache_ctx),n?r.fillRect(e,t,o,a):r.strokeRect(e,t,o,a),this},b5.Display.prototype.drawRoundRect=function(e,t,o,a,n,r){var i=this.context;null!==this.cache_ctx&&(i=this.cache_ctx),i.beginPath(),i.moveTo(e+n,t),i.lineTo(e+o-n,t),i.quadraticCurveTo(e+o,t,e+o,t+n),i.lineTo(e+o,t+a-n),i.quadraticCurveTo(e+o,t+a,e+o-n,t+a),i.lineTo(e+n,t+a),i.quadraticCurveTo(e,t+a,e,t+a-n),i.lineTo(e,t+n),i.quadraticCurveTo(e,t,e+n,t),i.closePath(),r?i.fill():i.stroke()},b5.Display.prototype.drawArc=function(e,t,o,a,n,r){var i=this.context;return null!==this.cache_ctx&&(i=this.cache_ctx),i.beginPath(),i.arc(e,t,o,a,n),r?i.fill():i.stroke(),this},b5.Display.prototype.drawAtlasImage=function(e,t,o,a,n,r,i,s,c){if(!(0>=e.width||0>=e.height)){var p=this.context;null!==this.cache_ctx&&(p=this.cache_ctx),p.drawImage(e,t,o,a,n,r,i,s,c)}},b5.Display.prototype.drawImage=function(e,t,o,a,n){if(!(0>=e.width||0>=e.height)){var r=this.context;null!==this.cache_ctx&&(r=this.cache_ctx),void 0===a?r.drawImage(e,t,o):r.drawImage(e,t,o,a,n)}},b5.Display.prototype.drawText=function(e,o,a,n,r){var i=this.context;null!==this.cache_ctx&&(i=this.cache_ctx),e=''+e;for(var s=e.split('\n'),c=0;c<s.length;c++)r?i.fillText(s[c],o,a):i.strokeText(s[c],o,a),a+=n},b5.Display.prototype.drawTextWrap=function(e,o,a,n,r,i,s){if(0===n)return void this.drawText(e,o,a,r,i);e=''+e;var c=this.measureTextLines(e,n);1<c&&'middle'===s&&(a-=r*c/2-r/2);var p=this.context;null!==this.cache_ctx&&(p=this.cache_ctx);for(var d=e.split('\n'),l=0;l<d.length;l++){for(var _='',u=d[l].split(' '),h=0;h<u.length;h++){var g=_+u[h]+' ',m=p.measureText(g);m.width>n?(i?p.fillText(_,o,a):p.strokeText(_,o,a),_=u[h]+' ',a+=r):_=g}i?p.fillText(_,o,a):p.strokeText(_,o,a),a+=r}},b5.Display.prototype.measureText=function(e){var t=this.context;return null!==this.cache_ctx&&(t=this.cache_ctx),t.measureText(e)},b5.Display.prototype.measureTextLines=function(e,o){if(0===o)return 1;var a=this.context;null!==this.cache_ctx&&(a=this.cache_ctx);for(var n=e.split('\n'),r=0,i=0;i<n.length;i++){for(var s='',c=n[i].split(' '),p=0;p<c.length;p++){var d=s+c[p]+' ',l=a.measureText(d);l.width>o?(s=c[p]+' ',r++):s=d}r++}return r},b5.Display.prototype.setTransform=function(e,t,o,a,n,r){var i=b5.app.pixel_ratio;e*=i,t*=i,o*=i,a*=i,n*=i,r*=i;var s=this.context;null!==this.cache_ctx&&(s=this.cache_ctx),s.setTransform(e,t,o,a,n,r)},b5.Display.prototype.clipRect=function(e,t,o,a){var n=this.context;null!==this.cache_ctx&&(n=this.cache_ctx),n.beginPath(),n.rect(e,t,o,a),n.clip()},b5.Display.prototype.clipArc=function(e,t,o,a,n){var r=this.context;null!==this.cache_ctx&&(r=this.cache_ctx),r.beginPath(),r.arc(e,t,o,a,n),r.clip()},b5.Display.prototype.clipPolygon=function(e){var t=this.context;null!==this.cache_ctx&&(t=this.cache_ctx),t.beginPath();var o=e.length;t.moveTo(e[0],e[1]);for(var a=2;a<o;a+=2)t.lineTo(e[a],e[a+1]);t.closePath(),t.clip()},b5.Display.prototype.saveContext=function(){var e=this.context;null!==this.cache_ctx&&(e=this.cache_ctx),e.save()},b5.Display.prototype.restoreContext=function(){var e=this.context;null!==this.cache_ctx&&(e=this.cache_ctx),e.restore()},b5.Display.prototype.createCache=function(){return document.createElement('canvas')},b5.Display.prototype.createCacheWithSize=function(e,t){var o=document.createElement('canvas');return o.width=e,o.height=t,o},b5.Display.prototype.setGlobalAlpha=function(e){this.context.globalAlpha=e},b5.Display.prototype.setGlobalCompositeOp=function(e){this.context.globalCompositeOperation=e},b5.Display.prototype.setShadow=function(e,t,o,a){var n=this.context;null!==this.cache_ctx&&(n=this.cache_ctx),n.shadowOffsetX=e,n.shadowOffsetY=t,n.shadowColor=o,n.shadowBlur=a},b5.Display.prototype.setShadowOff=function(){var e=this.context;null!==this.cache_ctx&&(e=this.cache_ctx),e.shadowColor='transparent'},b5.Display.prototype.setFillStyle=function(e){var t=this.context;null!==this.cache_ctx&&(t=this.cache_ctx),t.fillStyle=e},b5.Display.prototype.setStrokeStyle=function(e){var t=this.context;null!==this.cache_ctx&&(t=this.cache_ctx),t.strokeStyle=e},b5.Display.prototype.setLineWidth=function(e){var t=this.context;null!==this.cache_ctx&&(t=this.cache_ctx),t.lineWidth=e},b5.Display.prototype.setFont=function(e){var t=this.context;null!==this.cache_ctx&&(t=this.cache_ctx),t.font=e},b5.Display.prototype.setTextAlign=function(e){var t=this.context;null!==this.cache_ctx&&(t=this.cache_ctx),t.textAlign=e},b5.Display.prototype.setTextBaseline=function(e){var t=this.context;null!==this.cache_ctx&&(t=this.cache_ctx),t.textBaseline=e},b5.Display.prototype.setSmoothing=function(e){var t=this.context;null!==this.cache_ctx&&(t=this.cache_ctx),t.imageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.oImageSmoothingEnabled=e,t.imageSmoothingEnabled=e,t.msImageSmoothingEnabled=e},b5.Display.prototype.setCache=function(e){this.cache_ctx=null===e?null:e.getContext('2d')},'use strict',b5.Raw=function(e,t,o,a){this.data=null,this.parent=null,this.name=e,this.location=t,this.onload=a,this.preload=o,this.loaded=!1,this.load_retry=0,o&&this.load()},b5.Raw.prototype.load=function(){var e=this;b5.Utils.loadJSON(this.location,!1,function(t){e.data=t,null===t?(e.load_retry++,3<e.load_retry?(b5.app.onResourceLoaded(e,!0),onload!==void 0&&onload(t)):e.load()):(e.loaded=!0,b5.app.onResourceLoaded(e,!1))},!1)},b5.Raw.prototype.destroy=function(){this.data=null,null!==this.parent&&this.parent.removeResource(this,'raw')},function(){function e(e,t){document.addEventListener?e.addEventListener('scroll',t,!1):e.attachEvent('scroll',t)}function o(e){document.body?e():document.addEventListener?document.addEventListener('DOMContentLoaded',function t(){document.removeEventListener('DOMContentLoaded',t),e()}):document.attachEvent('onreadystatechange',function t(){('interactive'==document.readyState||'complete'==document.readyState)&&(document.detachEvent('onreadystatechange',t),e())})}function i(e){this.a=document.createElement('div'),this.a.setAttribute('aria-hidden','true'),this.a.appendChild(document.createTextNode(e)),this.b=document.createElement('span'),this.c=document.createElement('span'),this.h=document.createElement('span'),this.f=document.createElement('span'),this.g=-1,this.b.style.cssText='max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;',this.c.style.cssText='max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;',this.f.style.cssText='max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;',this.h.style.cssText='display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;',this.b.appendChild(this.h),this.c.appendChild(this.f),this.a.appendChild(this.b),this.a.appendChild(this.c)}function r(e,t){e.a.style.cssText='max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:'+t+';'}function t(e){var t=e.a.offsetWidth,o=t+100;return e.f.style.width=o+'px',e.c.scrollLeft=o,e.b.scrollLeft=e.b.scrollWidth+100,e.g!==t&&(e.g=t,!0)}function s(o,n){function a(){var e=r;t(e)&&e.a.parentNode&&n(e.g)}var r=o;e(o.b,a),e(o.c,a),t(o)}function a(e,t){var o=t||{};this.family=e,this.style=o.style||'normal',this.weight=o.weight||'normal',this.stretch=o.stretch||'normal'}function n(){if(null===d)if(p()&&/Apple/.test(window.navigator.vendor)){var e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))(?:\.([0-9]+))/.exec(window.navigator.userAgent);d=!!e&&603>parseInt(e[1],10)}else d=!1;return d}function p(){return null===u&&(u=!!document.fonts),u}function c(){if(null===_){var e=document.createElement('div');try{e.style.font='condensed 100px sans-serif'}catch(e){}_=''!==e.style.font}return _}function l(e,t){return[e.style,e.weight,c()?e.stretch:'','100px',t].join(' ')}var y=null,d=null,_=null,u=null;a.prototype.load=function(e,t){var _=this,c=e||'BESbswy',m=0,h=t||3E3,g=new Date().getTime();return new Promise(function(e,t){if(p()&&!n()){var a=new Promise(function(t,o){function a(){new Date().getTime()-g>=h?o():document.fonts.load(l(_,'"'+_.family+'"'),c).then(function(e){1<=e.length?t():setTimeout(a,25)},function(){o()})}a()}),d=new Promise(function(e,t){m=setTimeout(t,h)});Promise.race([d,a]).then(function(){clearTimeout(m),e(_)},function(){t(_)})}else o(function(){function o(){var t;(t=-1!=p&&-1!=T||-1!=p&&-1!=S||-1!=T&&-1!=S)&&((t=p!=T&&p!=S&&T!=S)||(null===y&&(t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),y=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))),t=y&&(p==a&&T==a&&S==a||p==C&&T==C&&S==C||p==k&&T==k&&S==k)),t=!t),t&&(P.parentNode&&P.parentNode.removeChild(P),clearTimeout(m),e(_))}function u(){if(new Date().getTime()-g>=h)P.parentNode&&P.parentNode.removeChild(P),t(_);else{var e=document.hidden;(!0===e||void 0===e)&&(p=A.a.offsetWidth,T=b.a.offsetWidth,S=n.a.offsetWidth,o()),m=setTimeout(u,50)}}var A=new i(c),b=new i(c),n=new i(c),p=-1,T=-1,S=-1,a=-1,C=-1,k=-1,P=document.createElement('div');P.dir='ltr',r(A,l(_,'sans-serif')),r(b,l(_,'serif')),r(n,l(_,'monospace')),P.appendChild(A.a),P.appendChild(b.a),P.appendChild(n.a),document.body.appendChild(P),a=A.a.offsetWidth,C=b.a.offsetWidth,k=n.a.offsetWidth,u(),s(A,function(e){p=e,o()}),r(A,l(_,'"'+_.family+'",sans-serif')),s(b,function(e){T=e,o()}),r(b,l(_,'"'+_.family+'",serif')),s(n,function(e){S=e,o()}),r(n,l(_,'"'+_.family+'",monospace'))})})},'object'==typeof module?module.exports=a:(window.FontFaceObserver=a,window.FontFaceObserver.prototype.load=a.prototype.load)}(),'use strict',b5.Font=function(e,t,o){this.data=null,this.parent=null,this.name=e,this.font_name=t,this.preload=o,this.loaded=!1,this.load_retry=0,o&&this.load()},b5.Font.prototype.load=function(){var e=this,t=new FontFaceObserver(this.font_name);t.load().then(function(){e.loaded=!0,b5.app.onResourceLoaded(e,!1)},function(){e.load_retry++,3<e.load_retry?b5.app.onResourceLoaded(e,!0):e.load(),b5.app.debug&&console.log('Error: Could not load font')})},b5.Font.prototype.destroy=function(){this.data=null,null!==this.parent&&this.parent.removeResource(this,'font')},'use strict',b5.Bitmap=function(e,t,o,a){this.image=new Image,this.parent=null,this.name=e,this.location=t,this.onload=a,this.preload=o,this.loaded=!1,this.load_retry=0,o&&this.load()},b5.Bitmap.prototype.load=function(){var e=this;this.image.onload=function(){b5.app.onResourceLoaded(e,!1),e.onload!==void 0&&(0>=e.image.width||0>=e.image.naturalWidth||0>=e.image.naturalHeight||!e.image.complete?e.onload(e,!1):e.onload(e,!0))},this.image.onerror=function(){e.load_retry++,3<e.load_retry?(b5.app.onResourceLoaded(e,!0),e.onload!==void 0&&e.onload(e,!1)):e.load()},this.image.src=this.location},b5.Bitmap.prototype.destroy=function(){this.image=null,null!==this.parent&&this.parent.removeResource(this,'bitmap')},'use strict',b5.Gradient=function(e,t){this.parent=null,this.stops=void 0===t?[]:t,this.name=e},b5.Gradient.prototype.addColourStop=function(e,t){this.stops.push({c:e,offs:t})},b5.Gradient.prototype.getColourStop=function(e){return this.stops[e]},b5.Gradient.prototype.getMaxStops=function(){return this.stops.length},b5.Gradient.prototype.destroy=function(){null!==this.parent&&this.parent.removeResource(this,'brush')},b5.Gradient.prototype.createStyle=function(e,o,a,n){if(this.stops!==void 0){var r=0,i=0,c=1,p=0;a!==void 0&&(r=a.x,i=a.y),n!==void 0&&(c=n.x,p=n.y),r=r*e-e/2,i=i*o-o/2,c=c*e-e/2,p=p*o-o/2;var d=void 0===this.rad_pos?b5.app.display.context.createLinearGradient(r,i,c,p):b5.app.display.context.createRadialGradient(this.rad_pos[0]*e,this.rad_pos[1]*e,this.rad_radius[0]*e,this.rad_pos[2]*e,this.rad_pos[3]*e,this.rad_radius[1]*e);for(var l=0,y;l<this.stops.length;l++)y=this.stops[l],d.addColorStop(y.offs,y.c);return d}return null},'use strict',b5.ImageAtlas=function(e,t,o,a,n,r,i,s){this.frames=[],this.anims=[],this.parent=null,this.name=e,this.bitmap=t,o!==void 0&&a!==void 0&&n!==void 0&&r!==void 0&&this.addFrame(o,a,n,r,i,s)},b5.ImageAtlas.prototype.addFrame=function(e,t,o,a,n,r){n===void 0&&(n=0),r===void 0&&(r=0),this.frames.push({x:e,y:t,w:o,h:a,ox:n,oy:r})},b5.ImageAtlas.prototype.getFrame=function(e){return this.frames[e]},b5.ImageAtlas.prototype.getMaxFrames=function(){return this.frames.length},b5.ImageAtlas.prototype.addAnim=function(e,t,o){this.anims[e]={indices:t,speed:o}},b5.ImageAtlas.prototype.getAnim=function(e){return this.anims[e]},b5.ImageAtlas.prototype.generate=function(e,t,o,a,n,r,i){i!==void 0&&(i=n*r);for(var s=t,c=0,p;c<r;c++){p=e;for(var d=0;d<n;d++)if(this.addFrame(p,s,o,a,0,0),p+=o,i--,0>=i)return;s+=a}},b5.ImageAtlas.prototype.destroy=function(){null!==this.parent&&this.parent.removeResource(this,'brush')},'use strict',b5.Material=function(e){this.parent=null,this.name=e,this.type='static',this.density=1,this.friction=.1,this.restitution=.1,this.gravity_scale=1,this.fixed_rotation=!1,this.is_bullet=!1},b5.Material.prototype.destroy=function(){null!==this.parent&&this.parent.removeResource(this,'material')},'use strict',b5.Shape=function(e){this.parent=null,this.name=e,this.type=b5.Shape.TypeBox,this.width=0,this.height=0,this.vertices=[],this.convexVertices=[]},b5.Shape.TypeBox=0,b5.Shape.TypeCircle=1,b5.Shape.TypePolygon=2,b5.Shape.prototype.typeToConst=function(){if('polygon'===shape.type)return b5.Shape.TypePolygon;return'circle'===shape.type?b5.Shape.TypeCircle:b5.Shape.TypeBox},b5.Shape.prototype.remove=function(){null!==this.parent&&this.parent.removeResource(this,'shape')},'use strict',b5.Sound=function(e,t,o){this.parent=null,this.snd=null,this.buffer=null,this.name=e,this.location=t,this.location2=null,this.loop=!1,this.reuse=void 0!==o&&o,this.preload=!1,this.loaded=!1,this.auto_play=!1,this.load_retry=0},b5.Sound.context=null,b5.Sound.blocked=!1,b5.Sound.muted=!1,b5.Sound.unblock=function(){b5.Sound.blocked&&b5.Sound.context.resume().then(function(){b5.Sound.blocked=!1})},b5.Sound.init=function(){try{if(window.AudioContext=window.AudioContext||window.webkitAudioContext,void 0===window.AudioContext)return!1;b5.Sound.context=new AudioContext,'suspended'===b5.Sound.context.state&&(b5.Sound.blocked=!0)}catch(t){return b5.app.instants&&FBInstant.logEvent('Web audio error'),!1}return!0},b5.Sound.isSupported=function(){return!0},b5.Sound.prototype.load=function(e,t){if(!b5.app.use_web_audio)return this.snd=new Audio(this.location),void b5.app.onResourceLoaded(this,!0);var o=b5.app.debug,a=this,n=this.location,r=this.auto_play;b5.Utils.loadJSON(n,!1,function(o){null===o?(a.load_retry++,3<a.load_retry?b5.app.onResourceLoaded(a,!0):a.load()):b5.Sound.context.decodeAudioData(o,function(o){a.buffer=o,b5.app.onResourceLoaded(a,!1),r&&a.play(e),t!==void 0&&t(this)},function(t){console.log(t)})},!0)||(a.load_retry++,3<a.load_retry?b5.app.onResourceLoaded(a,!0):a.load())},b5.Sound.prototype.play=function(e){if(!0!=e&&b5.Sound.muted)return null;if(!b5.app.use_web_audio)return this.snd.loop=this.loop,void this.snd.play();if(null===this.buffer)return null;var t=b5.Sound.context,o=t.createBufferSource(),a=t.createGain();return o.buffer=this.buffer,o.loop=this.loop,o.connect(a),a.connect(t.destination),a.gain.value=1,o.start(0),this.auto_play&&(this.snd={source:o,gain:a}),{source:o,gain:a}},b5.Sound.prototype.stop=function(){var e=this.snd;return null===e||void 0===e?void 0:b5.app.use_web_audio?void(e=e.source,e.stop()):void e.pause()},b5.Sound.prototype.pause=function(){if(!b5.app.use_web_audio)return void(void 0).pause();var e=this.snd},b5.Sound.prototype.destroy=function(){},'use strict',b5.Utils=function(){},b5.Utils.loadJSON=function(e,t,o,a){var n=new XMLHttpRequest;n.open('GET',e,!t),n.overrideMimeType('application/json'),a&&(n.responseType='arraybuffer'),t||(n.onreadystatechange=function(){4===n.readyState&&(200===n.status||0===n.status?a?o(n.response):o(n.responseText):o(null))});try{n.send()}catch(t){return!1}return t&&(200===n.status?a?o(n.response):o(n.responseText):o(null)),!0},b5.Utils.loadJS=function(e){var t=document.createElement('script');t.setAttribute('type','text/javascript'),t.setAttribute('src',e),'undefined'!=typeof t&&document.getElementsByTagName('head')[0].appendChild(t)},b5.Utils.SendGetRequest=function(e,t){var o=new XMLHttpRequest;o.onreadystatechange=function(){t!=null&&4==o.readyState&&t(o)},o.open('GET',e,!0),o.send()},b5.Utils.findObjectFromPath=function(e,o){var a=e.split('.'),n=a.length;if(0===n)return null;var r=b5.app.findScene(a[0]);if(1===n&&void 0===o)return r;if(1<n){if(void 0===o){for(var i=1;i<n;i++)r=r.findActor(a[i]);return null===r?(b5.app.debug&&console.log('Warning: Could not resolve object with path \''+e+'\''),null):r}var s=o.charAt(0);if('t'==s&&'timeline'===o){for(var i=1;i<n-1;i++)r=r.findActor(a[i]);return null===r?(b5.app.debug&&console.log('Warning: Could not resolve timeline with path \''+e+'\''),null):r.timelines.find(a[n-1])}if('a'==s&&'actions'===o){for(var i=1;i<n-1;i++)r=r.findActor(a[i]);return null===r?(b5.app.debug&&console.log('Warning: Could not resolve actions with path \''+e+'\''),null):r.actions.find(a[n-1])}}return b5.app.debug&&console.log('Warning: Could not resolve object with path \''+e+'\''),null},b5.Utils.findResourceFromPath=function(e,t){var o=e.split('.'),a=o.length;if(0===a)return null;var n=b5.app;1<a&&(n=b5.app.findScene(e));var r=n.findResource(o[a-1],t);return null===r?(b5.app.debug&&console.log('Warning: Could not resolve resource for path \''+e+'\''),null):r},b5.Utils.resolveObject=function(e,t){return void 0===e?null:'string'==typeof e?b5.Utils.findObjectFromPath(e,t):e},b5.Utils.resolveResource=function(e,t){return void 0===e?null:'string'==typeof e?b5.Utils.findResourceFromPath(e,t):e},b5.Utils.getResFromType=function(e,t){var o=t.charAt(0);if('b'==o){if('brush'===t)return e.brushes;if('bitmap'===t)return e.bitmaps}else if('s'==o){if('sound'===t)return e.sounds;if('shape'===t)return e.shapes}else{if('m'==o&&'material'===t)return e.materials;if('raw'===t)return e.raw;if('font'===t)return e.fonts}return null},b5.Utils.sortLayers=function(e){var o=e.length,a,n;for(n=0;n<o;n++)for(a=n+1;a<o;a++)if(e[n].layer>e[a].layer){var r=e[n];e[n]=e[a],e[a]=r}},b5.Utils.CreateCanvas=function(e,t,o,a){var n=document.createElement('canvas');return n.id=e,n.width=t,n.style.width=t+'px',n.height=o,n.style.height=o+'px',n.style.zIndex=a,n.style.position='fixed',n.style.display='block',n.style.left=0,n.style.top=0,n.style.right=0,n.style.bottom=0,n.style.margin='auto',n.style.pointerEvents='auto',n.style.visibility='visible',document.body.appendChild(n),n},b5.Utils.GetDevicePixelRatio=function(){if(window.devicePixelRatio!==void 0)return window.devicePixelRatio;var e=window.screen;return e!==void 0&&e.systemXDPI!==void 0&&e.logicalXDPI!==void 0&&e.systemXDPI>e.logicalXDPI?e.systemXDPI/e.logicalXDPI:1},b5.Utils.GetBackingStorePixelRatio=function(e){return e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1},b5.Utils.RunafterTime=function(e,t,o){b5.app.addTask('',e,1,t,o)},b5.Utils.SetFullscreen=function(e){document.fullscreenEnabled&&(e?null==document.fullscreenElement&&b5.app.canvas.requestFullscreen():null!=document.fullscreenElement&&document.exitFullscreen())},b5.Utils.IsMobile=function(){var e=navigator.userAgent;return function(){return e.match(/Android/i)}()||function(){return e.match(/BlackBerry/i)}()||function(){return e.match(/iPhone|iPad|iPod/i)}()||function(){return e.match(/Opera Mini/i)}()||function(){return e.match(/IEMobile/i)}()},b5.Utils.GetPlatform=function(){var e=navigator.userAgent;return e.match(/Android/i)?'ANDROID':e.match(/BlackBerry/i)?'BLACKBERRY':e.match(/iPhone|iPad|iPod/i)?'IOS':e.match(/Opera Mini/i)?'OPERA':e.match(/IEMobile/i)?'WINDOWS':'WEB'},'use strict';var Log=function(e){b5.app.debug&&console.log(e)};b5.Instants=function(){this.onPaused=void 0,this.onPaymentsReady=void 0,this.videoAdsSupported=!1,this.interstitialAdsSupported=!1,this.purchasingSupported=!1,this.purchasingReady=!1,this.preloadedVideoAd=null,this.preloadedInterAd=null,this.adReady=!1,this.adLoadError='',this.shotCache=null;var e=this;FBInstant!==void 0&&(FBInstant.onPause(function(){e.onPaused!==void 0&&e.onPaused()}),FBInstant.payments.onReady(function(){Log('>>>> Purchasing is ready'),e.purchasingReady=!0,e.onPaymentsReady!==void 0&&e.onPaymentsReady()}))},b5.Instants.prototype.Init=function(){var e=FBInstant.getSupportedAPIs();e.includes('getInterstitialAdAsync')&&(this.interstitialAdsSupported=!0),e.includes('getRewardedVideoAsync')&&(this.videoAdsSupported=!0),e.includes('payments.purchaseAsync')&&(this.purchasingSupported=!0)},b5.Instants.prototype.StartInit=function(e){FBInstant.initializeAsync().then(function(){FBInstant.logEvent('FB Init Success'),e!==void 0&&e()})},b5.Instants.prototype.StartGame=function(e){FBInstant.startGameAsync().then(function(){0<b5.app.total_load_errors?FBInstant.logEvent('FB Load Errors'):FBInstant.logEvent('FB Load Finished'),e!==void 0&&e(!0)}).catch(function(){e(!1)})},b5.Instants.prototype.SetLoadingProgress=function(e){FBInstant.setLoadingProgress(e)},b5.Instants.prototype.GetLocale=function(){return FBInstant.getLocale()},b5.Instants.prototype.GetPlatform=function(){return FBInstant.getPlatform()},b5.Instants.prototype.GetEntryPointData=function(){return FBInstant.getEntryPointData()},b5.Instants.prototype.GetPlayerID=function(){return FBInstant.player.getID()},b5.Instants.prototype.GetPlayerName=function(){return FBInstant.player.getName()},b5.Instants.prototype.GetPlayerPhotoURL=function(){return FBInstant.player.getPhoto()},b5.Instants.prototype.GetConnectedPlayers=function(e){FBInstant.player.getConnectedPlayersAsync().then(function(t){e!==void 0&&e(t)}).catch(function(t){Log(t),e!==void 0&&e(null)})},b5.Instants.prototype.GetContext=function(){return FBInstant.context},b5.Instants.prototype.GetContextPlayers=function(e){FBInstant.context.getPlayersAsync().then(function(t){e!==void 0&&e(t)}).catch(function(t){Log(t),e!==void 0&&e(null)})},b5.Instants.prototype.ChooseContext=function(e){FBInstant.context.chooseAsync().then(function(){e!==void 0&&e(!0)}).catch(function(t){Log(t),e!==void 0&&e(!1,t)})},b5.Instants.prototype.ChooseContextWithOptions=function(e,t){FBInstant.context.chooseAsync(e).then(function(){t!==void 0&&t(!0)}).catch(function(e){Log(e),t!==void 0&&t(!1,e)})},b5.Instants.prototype.SwitchContext=function(e,t){FBInstant.context.switchAsync(e).then(function(){t!==void 0&&t(!0)}).catch(function(e){Log(e),t!==void 0&&t(!1,e)})},b5.Instants.prototype.CreateContext=function(e,t){FBInstant.context.createAsync(e).then(function(){t!==void 0&&t(!0,FBInstant.context.getID())}).catch(function(e){Log(e),t!==void 0&&t(!1,e)})},b5.Instants.prototype.SetPlayerData=function(e,t){FBInstant.player.setDataAsync(e).then(function(){t!==void 0&&t(!0),Log('Player data set')}).catch(function(e){Log(e),t!==void 0&&t(!1)})},b5.Instants.prototype.GetPlayerData=function(e,t){FBInstant.player.getDataAsync(e).then(function(e){t!==void 0&&t(e),Log('Player data loaded')}).catch(function(e){Log(e),t!==void 0&&t()})},b5.Instants.prototype.SetSessionData=function(e){FBInstant.setSessionData(e)},b5.Instants.prototype.SwitchGame=function(e,t,o){FBInstant.switchGameAsync(e,t).catch(function(t){o!==void 0&&o(t)})},b5.Instants.prototype.PostCustomUpdate=function(e,t,o,a,n,r,i){FBInstant.updateAsync({action:'CUSTOM',cta:e,image:t,text:{default:o,localizations:{}},template:a,data:{myReplayData:r},strategy:n,notification:'NO_PUSH'}).then(function(){Log('Message was sent successfully'),i!==void 0&&i()}).catch(function(e){Log(e),i!==void 0&&i()})},b5.Instants.prototype.PostLeaderboardUpdate=function(e,t,o){FBInstant.updateAsync({action:'LEADERBOARD',name:e,text:t}).then(function(){Log('Leaderboard message was sent successfully'),o!==void 0&&o()}).catch(function(e){Log(e),o!==void 0&&o()})},b5.Instants.prototype.ShareCustom=function(e,t,o,a,n){FBInstant.shareAsync({intent:e,image:t,text:o,data:{myReplayData:a}}).then(function(){Log('Shared successfully'),n!==void 0&&n(!0)}).catch(function(e){Log(e),n!==void 0&&n(!1,e)})},b5.Instants.prototype.GetLeaderboardEntries=function(e,t,o,a){FBInstant.getLeaderboardAsync(e).then(function(e){return e.getEntriesAsync(o,t)}).then(function(e){Log('Leaderboard retrieved'),Log(e),a!=null&&a(e)}).catch(function(e){Log(e),a!=null&&a(null)})},b5.Instants.prototype.GetConnectedLeaderboardEntries=function(e,t,o,a){FBInstant.getLeaderboardAsync(e).then(function(e){return e.getConnectedPlayerEntriesAsync(o,t)}).then(function(e){Log('Connected leaderboard retrieved'),Log(e),a!=null&&a(e)}).catch(function(e){Log(e),a!=null&&a(null)})},b5.Instants.prototype.SetLeaderboardScore=function(e,t,o,a){FBInstant.getLeaderboardAsync(e).then(function(e){return e.setScoreAsync(t,o)}).then(function(e){Log('Score saved'),Log(e),a!=null&&a(!0,e)}).catch(function(e){Log(e),a!=null&&a(!1)})},b5.Instants.prototype.GetLeaderboardScore=function(e,t){FBInstant.getLeaderboardAsync(e).then(function(e){return e.getPlayerEntryAsync()}).then(function(e){Log('Score retrieved'),Log(e),t!=null&&t(e)}).catch(function(e){t!=null&&t(null),console.error(e)})},b5.Instants.prototype.CanMatchPlayer=function(e){FBInstant.checkCanPlayerMatchAsync().then(function(t){e!==void 0&&e(t)}).catch(function(t){Log(t),e!==void 0&&e(!1)})},b5.Instants.prototype.MatchPlayer=function(e,t,o){FBInstant.matchPlayerAsync(e,t).then(function(){o!==void 0&&o(!0)}).catch(function(){o!==void 0&&o(!1)})},b5.Instants.prototype.Quit=function(){FBInstant.quit()},b5.Instants.prototype.GetPlayerPhotoURL=function(){return FBInstant.player.getPhoto()},b5.Instants.prototype.PreloadVideoAd=function(e,t){if(this.videoAdsSupported){var o=this;FBInstant.getRewardedVideoAsync(t).then(function(e){return o.preloadedVideoAd=e,o.preloadedVideoAd.loadAsync()}).then(function(){o.adReady=!0,o.adLoadError='',Log('Rewarded video preloaded'),void 0!==e&&e(!0)}).catch(function(t){o.adLoadError=t.message,Log('Rewarded video failed to preload: '+t.message),void 0!==e&&e(!1,t)})}},b5.Instants.prototype.ReloadVideoAd=function(e){if(this.videoAdsSupported){var t=this;this.preloadedVideoAd.loadAsync().then(function(){t.adReady=!0,t.adLoadError='',Log('Rewarded video preloaded'),void 0!==e&&e(!0)}).catch(function(o){t.adLoadError=o.message,Log('Rewarded video failed to preload: '+o.message),void 0!==e&&e(!1,o)})}},b5.Instants.prototype.ShowVideoAd=function(t){var o=this;return this.videoAdsSupported?void(null===this.preloadedVideoAd||this.preloadedVideoAd.showAsync().then(function(){t!==void 0&&(Log('Rewarded video paid'),t(!0))}).catch(function(a){Log('Rewarded video playback error: '+a.message),o.adLoadError=a.message,t!==void 0&&t(!1,a)})):(Log('Rewarded video ads not supported on this device'),o.adLoadError='Not supported',void(void 0!==t&&t(!1)))},b5.Instants.prototype.PreloadInterstitialAd=function(e,t){if(this.interstitialAdsSupported){var o=this;FBInstant.getInterstitialAdAsync(t).then(function(e){return o.preloadedInterAd=e,o.preloadedInterAd.loadAsync()}).then(function(){o.adReady=!0,o.adLoadError='',Log('Interstitial preloaded'),void 0!==e&&e(!0)}).catch(function(t){o.adLoadError=t.message,Log('Interstitial failed to preload: '+t.message),void 0!==e&&e(!1,t)})}},b5.Instants.prototype.ReloadInterstitialAd=function(e){if(this.interstitialAdsSupported){var t=this;this.preloadedInterAd.loadAsync().then(function(){t.adReady=!0,t.adLoadError='',Log('Interstitial preloaded'),void 0!==e&&e(!0)}).catch(function(o){t.adLoadError=o.message,Log('Interstitial failed to preload: '+o.message),void 0!==e&&e(!1,o)})}},b5.Instants.prototype.ShowInterstitialAd=function(t){var o=this;return this.interstitialAdsSupported?null===this.preloadedInterAd?void(void 0!==t&&t(!0)):void this.preloadedInterAd.showAsync().then(function(){t!==void 0&&t(!0)}).catch(function(a){Log('Interstitial playback error: '+a.message),o.adLoadError=a.message,t!==void 0&&t(!1,a)}):(Log('Interstitial ads not supported on this device'),o.adLoadError='Not supported',void(void 0!==t&&t(!1)))},b5.Instants.prototype.IsAdReady=function(){var e=this.adReady;return this.adReady=!1,e},b5.Instants.prototype.CreateScreenshotCache=function(e){var t=b5.app.display;if(this.shotCache=t.createCache(),null===this.shotCache)return null;var o=b5.app.canvas;this.shotCache.height=e,this.shotCache.width=o.width*(this.shotCache.height/o.height)},b5.Instants.prototype.GetScreenshot=function(e,t,o){var a=b5.app.display;if(null===this.shotCache)return null;try{var n=b5.app.canvas;void 0!==e&&(n=e);var r=this.shotCache.height/n.height/b5.app.pixel_ratio;return a.setCache(this.shotCache),a.setTransform(r,0,0,r,0,0),a.drawImage(n,0,0),a.setCache(null),'jpeg'===t?this.shotCache.toDataURL('image/jpeg',o):this.shotCache.toDataURL('image/png')}catch(e){return null}},b5.Instants.prototype.LogEvent=function(e,t,o){FBInstant.logEvent(e,o,t)},b5.Instants.prototype.GetProducts=function(e){FBInstant.payments.getCatalogAsync().then(function(t){e!==void 0&&e(t)}).catch(function(t){Log(t),e!==void 0&&e(null)})},b5.Instants.prototype.GetUnconsumedProducts=function(e){FBInstant.payments.getPurchasesAsync().then(function(t){e!==void 0&&e(t)}).catch(function(t){Log(t),e!==void 0&&e(null)})},b5.Instants.prototype.BuyProduct=function(e,t,o){FBInstant.payments.purchaseAsync({productID:e,developerPayload:t}).then(function(e){o!==void 0&&o(e)}).catch(function(t){Log('Purchase error: '+t.message),o!==void 0&&o(null,t)})},b5.Instants.prototype.ConsumeProduct=function(e,t){FBInstant.payments.consumePurchaseAsync(e).then(function(){t!==void 0&&t(!0)}).catch(function(o){Log('Purchase consumption error: '+o.message),t!==void 0&&t(!1,o)})},b5.Instants.prototype.CreateShortcut=function(e){FBInstant.canCreateShortcutAsync().then(function(t){t?FBInstant.createShortcutAsync().then(function(){console.log('Shortcut created'),e!==void 0&&e(!0)}).catch(function(t){console.log('Shortcut creation error '+t),e!==void 0&&e(!1)}):e!==void 0&&e(!1)})},b5.Instants.instance=new b5.Instants,'use strict',b5.A_ChangeActions=function(e,t){this.actions=e,this.action=t},b5.A_ChangeActions.prototype.onInit=function(){this.actions=b5.Utils.resolveObject(this.actions,'actions');var e=this.actions;if(null!==e){var t=this.action;'play'===t?e.play():'pause'===t?e.pause():'restart'===t&&e.restart()}},b5.ActionsRegister.register('ChangeActions',function(e){return new b5.A_ChangeActions(e[1],e[2])}),'use strict',b5.A_CreateExplosion=function(e,t,o,a,n,r,i,s,c,p){this.container=e,this.actor=p,this.count=t,this.type=o,this.duration=a,this.speed=n,this.spin_speed=r,this.rate=i,this.damping=s,this.properties=c},b5.A_CreateExplosion.prototype.onInit=function(){this.container=b5.Utils.resolveObject(this.container),this.actor=b5.Utils.resolveObject(this.actor);var e=new b5.ParticleActor;this.container.addActor(e),e.generateExplosion(this.count,this.type,this.duration,this.speed,this.spin_speed,this.rate,this.damping,this.properties),null!==this.actor&&(e._x=this.actor.x,e._y=this.actor.y,e._rotation=this.actor.rotation)},b5.ActionsRegister.register('CreateExplosion',function(e){return new b5.A_CreateExplosion(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10])}),b5.A_CreatePlume=function(e,t,o,a,n,r,i,s,c,p){this.container=e,this.actor=p,this.count=t,this.type=o,this.duration=a,this.speed=n,this.spin_speed=r,this.rate=i,this.damping=s,this.properties=c},b5.A_CreatePlume.prototype.onInit=function(){this.container=b5.Utils.resolveObject(this.container),this.actor=b5.Utils.resolveObject(this.actor);var e=new b5.ParticleActor;this.container.addActor(e),e.generatePlume(this.count,this.type,this.duration,this.speed,this.spin_speed,this.rate,this.damping,this.properties),null!==this.actor&&(e._x=this.actor.x,e._y=this.actor.y,e._rotation=this.actor.rotation)},b5.ActionsRegister.register('CreatePlume',function(e){return new b5.A_CreatePlume(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10])}),'use strict',b5.A_AttractX=function(e,t,o,a,n,r,i,s,c){this.target=e,this.container=t,this.min_x=o,this.max_x=a,this.min_y=n,this.max_y=r,this.strength=i,this.stop=s,this.bounce=c},b5.A_AttractX.prototype.onTick=function(){this.target=b5.Utils.resolveObject(this.target),this.container=b5.Utils.resolveObject(this.container);for(var e=this.target,o=this.container.actors,a=o.length,n=e.x,r=e.y,i=this.min_x,s=this.max_x,c=this.min_y,p=this.max_y,d=this.strength,l=this.stop,y=this.bounce,_=0,u;_<a;_++)if(u=o[_],void 0!==u.attract){var h=u.y-r;if(h>c&&h<p){var g=n-u.x;g<i&&g>-i?l&&(u.x<n?u._x=n-i:u.x>n&&(u._x=n+i),u.vx=y?-u.vx:0):g>i&&g<s?u.vx+=d:g>-s&&g<-i&&(u.vx-=d)}}return!0},b5.ActionsRegister.register('AttractX',function(e){return new b5.A_AttractX(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9])}),b5.A_AttractY=function(e,t,o,a,n,r,i,s,c){this.target=e,this.container=t,this.min_y=o,this.max_y=a,this.min_x=n,this.max_x=r,this.strength=i,this.stop=s,this.bounce=c},b5.A_AttractY.prototype.onTick=function(){this.target=b5.Utils.resolveObject(this.target),this.container=b5.Utils.resolveObject(this.container);for(var e=this.target,o=this.container.actors,a=o.length,n=e.x,r=e.y,i=this.min_y,s=this.max_y,c=this.min_x,p=this.max_x,d=this.strength,l=this.stop,y=this.bounce,_=0,u;_<a;_++)if(u=o[_],void 0!==u.attract){var h=u.x-n;if(h>c&&h<p){var g=r-u.y;g<i&&g>-i?l&&(u.y<r?u._y=r-i:u.y>r&&(u._y=r+i),u.vy=y?-u.vy:0):g>i&&g<s?u.vy+=d:g>-s&&g<-i&&(u.vy-=d)}}return!0},b5.ActionsRegister.register('AttractY',function(e){return new b5.A_AttractY(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9])}),b5.A_Attract=function(e,t,o,a,n,r,i){this.target=e,this.container=t,this.min_dist=o,this.max_dist=a,this.strength=n,this.stop=r,this.bounce=i},b5.A_Attract.prototype.onTick=function(){var e=Math.sqrt;this.target=b5.Utils.resolveObject(this.target),this.container=b5.Utils.resolveObject(this.container);for(var o=this.target,a=this.container.actors,n=a.length,r=o.x,i=o.y,s=this.min_dist,c=this.max_dist,p=this.strength,l=this.stop,y=this.bounce,_=e(s),u=0,h;u<n;u++)if(h=a[u],void 0!==h.attract){var g=h.x-r,m=h.y-i,f=g*g+m*m;f>s&&f<c?(f=e(f),h.vx-=p*g/f,h.vy-=p*m/f):f<s&&(f=e(f),l&&(h._x=r+_*g/f,h._y=i+_*m/f,y?(h.vx=-h.vx,h.vy=-h.vy):(h.vx=0,h.vy=0)))}return!0},b5.ActionsRegister.register('Attract',function(e){return new b5.A_Attract(e[1],e[2],e[3],e[4],e[5],e[6],e[7])}),'use strict',b5.A_Sound=function(e,t){this.sound=e,this.action=t},b5.A_Sound.prototype.onInit=function(){this.sound=b5.Utils.resolveResource(this.sound,'sound');var e=this.sound;if(null!==e){var t=this.action;'play'===t?e.play():'pause'===t?e.pause():'stop'===t&&e.stop()}},b5.ActionsRegister.register('Sound',function(e){return new b5.A_Sound(e[1],e[2])}),'use strict',b5.A_ChangeTimeline=function(e,t){this.timeline=e,this.action=t},b5.A_ChangeTimeline.prototype.onInit=function(){this.timeline=b5.Utils.resolveObject(this.timeline,'timeline');var e=this.timeline;if(null!==e){var t=this.action;'play'===t?e.play():'pause'===t?e.pause():'restart'===t&&e.restart()}},b5.ActionsRegister.register('ChangeTimeline',function(e){return new b5.A_ChangeTimeline(e[1],e[2])}),'use strict',b5.A_Wait=function(e){this.duration=e},b5.A_Wait.prototype.onInit=function(){this.time=Date.now()},b5.A_Wait.prototype.onTick=function(){return Date.now()-this.time<1e3*this.duration},b5.ActionsRegister.register('Wait',function(e){return new b5.A_Wait(e[1])}),b5.A_SetProps=function(e,t){this.target=e,this.properties=t},b5.A_SetProps.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);var e=this.target,t=this.properties;for(var o in t)e[o]=t[o]},b5.ActionsRegister.register('SetProps',function(e){return new b5.A_SetProps(e[1],e[2])}),b5.A_AddProps=function(e,t){this.target=e,this.properties=t},b5.A_AddProps.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);var e=this.target,t=this.properties;for(var o in t)e[o]+=t[o]},b5.ActionsRegister.register('AddProps',function(e){return new b5.A_AddProps(e[1],e[2])}),b5.A_TweenProps=function(e,t,o,a,n,r){this.target=e,this.props=t,this.start=o,this.end=a,this.duration=n,this.ease=r},b5.A_TweenProps.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target),this.time=Date.now();for(var e=this.target,o=this.props,a=this.start,n=o.length,r=0;r<n;r++)e[o[r]]=a[r]},b5.A_TweenProps.prototype.onTick=function(){var e=Date.now()-this.time,o=this.duration;if(0!==o){var a=this.props,n=this.start,r=this.end,i=a.length,s=this.target,c=this.ease,p=e/(1e3*o);1<p&&(p=1);for(var l=0;l<i;l++)s[a[l]]=n[l]+(r[l]-n[l])*b5.Ease.easingFuncs[c[l]](p)}return e<1e3*o},b5.ActionsRegister.register('TweenProps',function(e){return new b5.A_TweenProps(e[1],e[2],e[3],e[4],e[5],e[6])}),b5.A_Call=function(e,t){this.func=e,this.params=t},b5.A_Call.prototype.onInit=function(){window[this.func](this.params)},b5.ActionsRegister.register('Call',function(e){return new b5.A_Call(e[1],e[2])}),b5.A_Create=function(e,t,o,a,n){this.objects=e,this.temp_name=o,this.type=a,this.scene=t,this.properties=n},b5.A_Create.prototype.onInit=function(){'string'==typeof this.objects&&(this.objects=b5.data[this.objects]),this.scene=b5.Utils.resolveObject(this.scene);var e=b5.Xoml.findResource(this.objects,this.temp_name,this.type),t=new b5.Xoml(b5.app);t.current_scene=this.scene;var o=t.parseResource(this.scene,e),a=this.properties;for(var n in a)o[n]=a[n]},b5.ActionsRegister.register('Create',function(e){return new b5.A_Create(e[1],e[2],e[3],e[4],e[5])}),b5.A_Destroy=function(e){this.target=e},b5.A_Destroy.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target),this.target.destroy()},b5.ActionsRegister.register('Destroy',function(e){return new b5.A_Destroy(e[1])}),b5.A_FocusScene=function(e,t){this.target=e,this.focus2=t},b5.A_FocusScene.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);var e=this.target;!0===this.focus2?b5.app.focus_scene2=e:b5.app.focus_scene=e},b5.ActionsRegister.register('FocusScene',function(e){return new b5.A_FocusScene(e[1],e[2])}),'use strict',b5.A_StopMove=function(e,t,o,a,n){this.target=e,this.stop_vx=t,this.stop_vy=o,this.stop_vr=a,this.duration=n},b5.A_StopMove.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target),this.time=Date.now()},b5.A_StopMove.prototype.onTick=function(){if(!(Date.now()-this.time<1e3*this.duration)){var e=this.target;return this.stop_vx&&(e.vx=0),this.stop_vy&&(e.vy=0),this.stop_vr&&(e.vr=0),!1}return!0},b5.ActionsRegister.register('StopMove',function(e){return new b5.A_StopMove(e[1],e[2],e[3],e[4],e[5])}),b5.A_Gravity=function(e,t,o){this.target=e,this.gravity_x=t,this.gravity_y=o},b5.A_Gravity.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target)},b5.A_Gravity.prototype.onTick=function(){this.target=b5.Utils.resolveObject(this.target);var e=this.target;return e.vx+=this.gravity_x,e.vy+=this.gravity_y,!1},b5.ActionsRegister.register('Gravity',function(e){return new b5.A_Gravity(e[1],e[2],e[3])}),b5.A_Move=function(e,t,o,a){this.target=e,this.dx=t,this.dy=o,this.duration=a,this.x=e.x,this.y=e.y},b5.A_Move.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);var e=this.target;null!=this.dx&&(e.vx=this.dx/this.duration),null!=this.dy&&(e.vy=this.dy/this.duration),this.time=Date.now()},b5.A_Move.prototype.onTick=function(){return Date.now()-this.time<1e3*this.duration},b5.ActionsRegister.register('Move',function(e){return new b5.A_Move(e[1],e[2],e[3],e[4])}),b5.A_MoveTo=function(e,t,o,a,n,r){this.target=e,this.duration=a,this.x=t,this.y=o,this.sx=e.x,this.sy=e.y,this.ease_x=n||b5.Ease.linear,this.ease_y=r||b5.Ease.linear},b5.A_MoveTo.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);var e=this.target;this.time=Date.now(),this.sx=e.x,this.sy=e.y},b5.A_MoveTo.prototype.onTick=function(){var e=this.target,t=Date.now()-this.time,o=t/(1e3*this.duration);return 1<o&&(o=1),null!=this.x&&(e._x=this.sx+(this.x-this.sx)*b5.Ease.easingFuncs[this.ease_x](o)),null!=this.y&&(e._y=this.sy+(this.y-this.sy)*b5.Ease.easingFuncs[this.ease_y](o)),Date.now()-this.time<1e3*this.duration},b5.ActionsRegister.register('MoveTo',function(e){return new b5.A_MoveTo(e[1],e[2],e[3],e[4],e[5],e[6])}),b5.A_MoveWithSpeed=function(e,t,o,a){this.target=e,this.speed=t,this.duration=o,this.ease=a},b5.A_MoveWithSpeed.prototype.onInit=function(){if(this.target=b5.Utils.resolveObject(this.target),this.time=Date.now(),0===this.duration){var e=this.target,t=this.speed,o=e.rotation;e.vx=t*Math.sin(o),e.vy=-t*Math.cos(o)}},b5.A_MoveWithSpeed.prototype.onTick=function(){var e=Date.now()-this.time,t=this.duration;if(0!==t){var o=this.target,a=o.rotation,n=e/(1e3*t);1<n&&(n=1);var r=this.speed*b5.Ease.easingFuncs[this.ease](n);o.vx=r*Math.sin(a),o.vy=-r*Math.cos(a)}return e<1e3*t},b5.ActionsRegister.register('MoveWithSpeed',function(e){return new b5.A_MoveWithSpeed(e[1],e[2],e[3],e[4])}),b5.A_Follow=function(e,t,o,a){this.source=e,this.target=t,this.speed=o,this.distance=a},b5.A_Follow.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target),this.source=b5.Utils.resolveObject(this.source)},b5.A_Follow.prototype.onTick=function(){var e=this.target,t=this.source,o=this.speed,a=e.x-t.x,n=e.y-t.y;return a*a+n*n<this.distance?(t.vx=0,t.vy=0):(t.vx=a/o,t.vy=n/o),!0},b5.ActionsRegister.register('Follow',function(e){return new b5.A_Follow(e[1],e[2],e[3],e[4])}),b5.A_LookAt=function(e,t,o,a){this.source=e,this.target=t,this.lower=o,this.upper=a},b5.A_LookAt.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target),this.source=b5.Utils.resolveObject(this.source)},b5.A_LookAt.prototype.onTick=function(){var e=this.target,t=this.source,o=Math.atan2(e.y-t.y,e.x-t.x)+Math.PI/2,a=this.lower;void 0!==a&&o<a&&(o=a);var n=this.upper;return void 0!==n&&o>n&&(o=n),t._rotation=o,!0},b5.ActionsRegister.register('LookAt',function(e){return new b5.A_LookAt(e[1],e[2],e[3],e[4])}),b5.A_FollowPath=function(e,o,a,n,r){this.target=e,this.path=o,this.distance=a,this.speed=n,this.angle=r;var i=o.length>>1,s=0;this.distances=[],this.angles=[],this.distances[0]=0;for(var c=1;c<i;c++){var p=o[c<<1]-o[c-1<<1],d=o[(c<<1)+1]-o[(c-1<<1)+1];s+=Math.sqrt(p*p+d*d),this.distances[c]=s,this.angle&&(this.angles[c-1]=Math.atan2(d,p)+Math.PI/2)}},b5.A_FollowPath.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target)},b5.A_FollowPath.prototype.onTick=function(){for(var e=this.target,o=this.path,a=o.length>>1,n=this.distances,r=this.distance+this.speed,i=n[a-1];r>=i;)r-=i;for(;0>r;)r+=i;this.distance=r;for(var s=0;s<a;s++)if(r<n[s]){var c=s-1;c>=a&&(c=0);var p=o[c<<1],l=o[s<<1],y=o[(c<<1)+1],_=o[(s<<1)+1],u=(r-n[c])/(n[s]-n[c]);e._x=p+(l-p)*u,e._y=y+(_-y)*u,this.angle&&(e._rotation=this.angles[c]);break}return!0},b5.ActionsRegister.register('FollowPath',function(e){return new b5.A_FollowPath(e[1],e[2],e[3],e[4],e[5])}),b5.A_FollowPathVel=function(e,o,a,n,r,i){this.target=e,this.path=o,this.distance=a,this.speed=n,this.angle=i,this.catchup_speed=r;var s=o.length>>1,c=0;this.distances=[],this.distances[0]=0;for(var p=1;p<s;p++){var d=o[p<<1]-o[p-1<<1],l=o[(p<<1)+1]-o[(p-1<<1)+1];c+=Math.sqrt(d*d+l*l),this.distances[p]=c}},b5.A_FollowPathVel.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target)},b5.A_FollowPathVel.prototype.onTick=function(){for(var e=this.target,o=this.path,a=o.length>>1,n=this.distances,r=this.distance+this.speed,i=n[a-1];r>=i;)r-=i;for(;0>r;)r+=i;this.distance=r;for(var s=0;s<a;s++)if(r<n[s]){var c=s-1;c>=a&&(c=0);var p=o[c<<1],l=o[s<<1],y=o[(c<<1)+1],_=o[(s<<1)+1],u=(r-n[c])/(n[s]-n[c]),d=this.catchup_speed;e.vx=(p+(l-p)*u-e.x)*d,e.vy=(y+(_-y)*u-e.y)*d,this.angle&&(e._rotation=Math.atan2(e.vy,e.vx)+Math.PI/2);break}return!0},b5.ActionsRegister.register('FollowPathVel',function(e){return new b5.A_FollowPathVel(e[1],e[2],e[3],e[4],e[5],e[6])}),b5.A_LimitMove=function(e,t,o,a){this.target=e,this.area=t,'bounce'===o?this.hit=0:'stop'===o?this.hit=1:'wrap'==o&&(this.hit=2),this.bounce=a},b5.A_LimitMove.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target)},b5.A_LimitMove.prototype.onTick=function(){var e=this.target,o=e.x,a=e.y,n=this.hit,i=this.area,s=this.bounce;if(0!==i[2]){var c=i[0],p=c+i[2];o<c?0===n?e.vx=-e.vx*s:1===n?e.vx=0:2===n&&(e._x=p):o>p&&(0===n?e.vx=-e.vx*s:1===n?e.vx=0:2===n&&(e._x=c))}if(0!==i[3]){var r=i[1],t=r+i[3];a<r?0===n?e.vy=-e.vy*s:1===n?e.vy=0:2===n&&(e._y=t):a>t&&(0===n?e.vy=-e.vy*s:1===n?e.vy=0:2===n&&(e._y=r))}return!1},b5.ActionsRegister.register('LimitMove',function(e){return new b5.A_LimitMove(e[1],e[2],e[3],e[4])}),'use strict',b5.A_CamStopMove=function(e,t,o,a){this.target=e,this.stop_vx=t,this.stop_vy=o,this.duration=a},b5.A_CamStopMove.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target),this.time=Date.now()},b5.A_CamStopMove.prototype.onTick=function(){if(!(Date.now()-this.time<1e3*this.duration)){var e=this.target;return this.stop_vx&&(e.camera_vx=0),this.stop_vy&&(e.camera_vy=0),!1}return!0},b5.ActionsRegister.register('CamStopMove',function(e){return new b5.A_CamStopMove(e[1],e[2],e[3],e[4])}),b5.A_CamGravity=function(e,t,o){this.target=e,this.gravity_x=t,this.gravity_y=o},b5.A_CamGravity.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target)},b5.A_CamGravity.prototype.onTick=function(){this.target=b5.Utils.resolveObject(this.target);var e=this.target;return e.camera_vx+=this.gravity_x,e.camera_vy+=this.gravity_y,!1},b5.ActionsRegister.register('CamGravity',function(e){return new b5.A_CamGravity(e[1],e[2],e[3])}),b5.A_CamMove=function(e,t,o,a){this.target=e,this.dx=t,this.dy=o,this.duration=a,this.x=e.x,this.y=e.y},b5.A_CamMove.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);var e=this.target;null!=this.dx&&(e.camera_vx=this.dx/this.duration),null!=this.dy&&(e.camera_vy=this.dy/this.duration),this.time=Date.now()},b5.A_CamMove.prototype.onTick=function(){return Date.now()-this.time<1e3*this.duration},b5.ActionsRegister.register('CamMove',function(e){return new b5.A_CamMove(e[1],e[2],e[3],e[4])}),b5.A_CamMoveTo=function(e,t,o,a,n,r){this.target=e,this.duration=a,this.x=t,this.y=o,this.ease_x=n||b5.Ease.linear,this.ease_y=r||b5.Ease.linear},b5.A_CamMoveTo.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);var e=this.target;this.time=Date.now(),this.sx=e.camera_x,this.sy=e.camera_y},b5.A_CamMoveTo.prototype.onTick=function(){var e=this.target,t=Date.now()-this.time,o=t/(1e3*this.duration);return 1<o&&(o=1),null!=this.x&&(e.camera_x=this.sx+(this.x-this.sx)*b5.Ease.easingFuncs[this.ease_x](o)),null!=this.y&&(e.camera_y=this.sy+(this.y-this.sy)*b5.Ease.easingFuncs[this.ease_y](o)),Date.now()-this.time<1e3*this.duration},b5.ActionsRegister.register('CamMoveTo',function(e){return new b5.A_CamMoveTo(e[1],e[2],e[3],e[4],e[5],e[6])}),b5.A_CamFollow=function(e,t,o,a){this.source=e,this.target=t,this.speed=o,this.distance=a},b5.A_CamFollow.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target),this.source=b5.Utils.resolveObject(this.source)},b5.A_CamFollow.prototype.onTick=function(){var e=this.target,t=this.source,o=this.speed,a=e.x-t.camera_x,n=e.y-t.camera_y;return a*a+n*n<this.distance?(t.camera_vx=0,t.camera_vy=0):(t.camera_vx=a/o,t.camera_vy=n/o),!0},b5.ActionsRegister.register('CamFollow',function(e){return new b5.A_CamFollow(e[1],e[2],e[3],e[4])}),b5.A_CamFollowPath=function(e,o,a,n){this.target=e,this.path=o,this.distance=a,this.speed=n;var r=o.length>>1,i=0;this.distances=[],this.distances[0]=0;for(var s=1;s<r;s++){var c=o[s<<1]-o[s-1<<1],p=o[(s<<1)+1]-o[(s-1<<1)+1];i+=Math.sqrt(c*c+p*p),this.distances[s]=i}},b5.A_CamFollowPath.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target)},b5.A_CamFollowPath.prototype.onTick=function(){for(var e=this.target,o=this.path,a=o.length>>1,n=this.distances,r=this.distance+this.speed,i=n[a-1];r>=i;)r-=i;for(;0>r;)r+=i;this.distance=r;for(var s=0;s<a;s++)if(r<n[s]){var c=s-1;c>=a&&(c=0);var p=o[c<<1],l=o[s<<1],y=o[(c<<1)+1],_=o[(s<<1)+1],u=(r-n[c])/(n[s]-n[c]);e.camera_x=p+(l-p)*u,e.camera_y=y+(_-y)*u;break}return!0},b5.ActionsRegister.register('CamFollowPath',function(e){return new b5.A_CamFollowPath(e[1],e[2],e[3],e[4])}),b5.A_CamFollowPathVel=function(e,o,a,n,r){this.target=e,this.path=o,this.distance=a,this.speed=n,this.catchup_speed=r;var i=o.length>>1,s=0;this.distances=[],this.distances[0]=0;for(var c=1;c<i;c++){var p=o[c<<1]-o[c-1<<1],d=o[(c<<1)+1]-o[(c-1<<1)+1];s+=Math.sqrt(p*p+d*d),this.distances[c]=s}},b5.A_CamFollowPathVel.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target)},b5.A_CamFollowPathVel.prototype.onTick=function(){for(var e=this.target,o=this.path,a=o.length>>1,n=this.distances,r=this.distance+this.speed,i=n[a-1];r>=i;)r-=i;for(;0>r;)r+=i;this.distance=r;for(var s=0;s<a;s++)if(r<n[s]){var c=s-1;c>=a&&(c=0);var p=o[c<<1],l=o[s<<1],y=o[(c<<1)+1],_=o[(s<<1)+1],u=(r-n[c])/(n[s]-n[c]),d=this.catchup_speed;e.camera_vx=(p+(l-p)*u-e.x)*d,e.camera_vy=(y+(_-y)*u-e.y)*d;break}return!0},b5.ActionsRegister.register('CamFollowPathVel',function(e){return new b5.A_CamFollowPathVel(e[1],e[2],e[3],e[4],e[5])}),b5.A_CamLimitMove=function(e,t,o,a){this.target=e,this.area=t,'bounce'===o?this.hit=0:'stop'===o?this.hit=1:'wrap'==o&&(this.hit=2),this.bounce=a},b5.A_CamLimitMove.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target)},b5.A_CamLimitMove.prototype.onTick=function(){var e=this.target,o=e.camera_x,a=e.camera_y,n=this.hit,i=this.area,s=this.bounce;if(0!==i[2]){var c=i[0],p=c+i[2];o<c?0===n?e.camera_vx=-e.camera_vx*s:1===n?e.camera_vx=0:2===n&&(e.camera_x=p):o>p&&(0===n?e.camera_vx=-e.camera_vx*s:1===n?e.camera_vx=0:2===n&&(e.camera_x=c))}if(0!==i[3]){var r=i[1],t=r+i[3];a<r?0===n?e.camera_vy=-e.camera_vy*s:1===n?e.camera_vy=0:2===n&&(e.camera_y=t):a>t&&(0===n?e.camera_vy=-e.camera_vy*s:1===n?e.camera_vy=0:2===n&&(e.camera_y=r))}return!1},b5.ActionsRegister.register('CamLimitMove',function(e){return new b5.A_CamLimitMove(e[1],e[2],e[3],e[4])}),'use strict',b5.A_SetLinearVelocity=function(e,t,o,a){this.target=e,this.vx=t,this.vy=o,this.duration=a},b5.A_SetLinearVelocity.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target),this.time=Date.now()},b5.A_SetLinearVelocity.prototype.onTick=function(){var e=this.target,t=e.body;if(null!==t){var o=Box2D.Common.Math.b2Vec2;t.SetAwake(!0),t.SetLinearVelocity(new o(this.vx,this.vy))}return Date.now()-this.time<1e3*this.duration},b5.ActionsRegister.register('SetLinearVelocity',function(e){return new b5.A_SetLinearVelocity(e[1],e[2],e[3],e[4])}),b5.A_SetAngularVelocity=function(e,t,o){this.target=e,this.vr=t,this.duration=o},b5.A_SetAngularVelocity.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target),this.time=Date.now()},b5.A_SetAngularVelocity.prototype.onTick=function(){var e=this.target,t=e.body;return null!==t&&(t.SetAwake(!0),t.SetAngularVelocity(this.vr)),Date.now()-this.time<1e3*this.duration},b5.ActionsRegister.register('SetAngularVelocity',function(e){return new b5.A_SetAngularVelocity(e[1],e[2],e[3])}),b5.A_ApplyForce=function(e,t,o,a,n,r){this.target=e,this.fx=t,this.fy=o,this.dx=a,this.dy=n,this.duration=r},b5.A_ApplyForce.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target),this.time=Date.now()},b5.A_ApplyForce.prototype.onTick=function(){var e=this.target,t=e.body;if(null!==t){var o=e.scene.world_scale,a=Box2D.Common.Math.b2Vec2;t.SetAwake(!0);var n=t.GetWorldPoint(new a(this.dx/o,this.dy/o));t.ApplyForce(new a(this.fx,this.fy),n)}return Date.now()-this.time<1e3*this.duration},b5.ActionsRegister.register('ApplyForce',function(e){return new b5.A_ApplyForce(e[1],e[2],e[3],e[4],e[5],e[6])}),b5.A_ApplyImpulse=function(e,t,o,a,n){this.target=e,this.ix=t,this.iy=o,this.dx=a,this.dy=n},b5.A_ApplyImpulse.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target);var e=this.target,t=e.body;if(null!==t){var o=e.scene.world_scale,a=Box2D.Common.Math.b2Vec2;t.SetAwake(!0);var n=t.GetWorldPoint(new a(this.dx/o,this.dy/o));t.ApplyImpulse(new a(this.ix,this.iy),n)}},b5.ActionsRegister.register('ApplyImpulse',function(e){return new b5.A_ApplyImpulse(e[1],e[2],e[2],e[3],e[4])}),b5.A_ApplyTorque=function(e,t,o){this.target=e,this.torque=t,this.duration=o},b5.A_ApplyTorque.prototype.onInit=function(){this.target=b5.Utils.resolveObject(this.target),this.time=Date.now()},b5.A_ApplyTorque.prototype.onTick=function(){var e=this.target,t=e.body;return null!==t&&(t.SetAwake(!0),t.ApplyTorque(this.torque)),Date.now()-this.time<1e3*this.duration},b5.ActionsRegister.register('ApplyTorque',function(e){return new b5.A_ApplyTorque(e[1],e[2],e[3])});