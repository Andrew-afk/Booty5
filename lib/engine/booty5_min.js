'use strict';var b5={};b5.app=null,b5.data={},b5.version=1.54,function(){for(var e=0,t=['ms','moz','webkit','o'],o=0;o<t.length&&!window.requestAnimationFrame;++o)window.requestAnimationFrame=window[t[o]+'RequestAnimationFrame'],window.cancelAnimationFrame=window[t[o]+'CancelAnimationFrame']||window[t[o]+'CancelRequestAnimationFrame'];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var o=new Date().getTime(),a=Math.max(0,16-(o-e)),n=window.setTimeout(function(){t(o+a)},a);return e=o+a,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),'use strict',b5.Ease=function(){},b5.Ease.linear=0,b5.Ease.quadin=1,b5.Ease.quadout=2,b5.Ease.cubicin=3,b5.Ease.cubicout=4,b5.Ease.quartin=5,b5.Ease.quartout=6,b5.Ease.sin=7,b5.Ease.sinin=7,b5.Ease.sinout=8,b5.Ease.sininout=9,b5.Ease.quadinout=10,b5.Ease.cubicinout=11,b5.Ease.quarticinout=12,b5.Ease.bouncein=13,b5.Ease.bounceout=14,b5.Ease.bounceinout=15,b5.Ease.backin=16,b5.Ease.backout=17,b5.Ease.backinout=18,b5.Ease.circin=19,b5.Ease.circout=20,b5.Ease.circinout=21,b5.Ease.expin=22,b5.Ease.expout=23,b5.Ease.expinout=24,b5.Ease.easingFuncs=[function(e){return e},function(e){return e*e},function(e){return e*(2-e)},function(e){return e*e*e},function(e){return e-=1,e*e*e+1},function(e){return e*e*e*e},function(e){return e-=1,-(e*e*e*e-1)},function(e){return 1-Math.cos(e*Math.PI/2)},function(e){return Math.sin(e*Math.PI/2)},function(e){return 0.5*(1-Math.cos(Math.PI*e))},function(e){return 0.5>e?2*e*e:-1+(4-2*e)*e},function(e){return 0.5>e?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},function(e){return 0.5>e?8*e*e*e*e:1-8*--e*e*e*e},function(e){return 1-b5.Ease.easingFuncs[b5.Ease.bounceout](1-e)},function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+0.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+0.9375:7.5625*(e-=2.625/2.75)*e+0.984375},function(e){return 0.5>e?0.5*b5.Ease.easingFuncs[b5.Ease.bounceout](2*e):0.5*b5.Ease.easingFuncs[b5.Ease.bounceout](2*e-1)+0.5},function(e){var t=1.70158;return e*e*((t+1)*e-t)},function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},function(e){var t=1.525*1.70158;e=1>(e*=2)?0.5*(e*e*((t+1)*e-t)):0.5*((e-=2)*e*((t+1)*e+t)+2)},function(e){return 1-Math.sqrt(1-e*e)},function(e){return Math.sqrt(1- --e*e)},function(e){var t=Math.sqrt;e*=2,e=1>e?-0.5*(t(1-e*e)-1):0.5*(t(1-(e-=2)*e)+1)},function(e){return 0==e?0:Math.pow(1024,e-1)},function(e){return 1==e?e:1-Math.pow(2,-10*e)},function(e){var t=Math.pow;return 0==e?0:1==e?1:1>(e*=2)?0.5*t(1024,e-1):0.5*(-t(2,-10*(e-1))+2)}],'use strict',b5.Animation=function(e,t,o,a,n,r,s){this.timeline=e,this.state=b5.Animation.AS_playing,this.time=-1e-6,this.repeats_left=r,this.index=-1,this.name=null,this.target=t,this.property=o,this.frames=a,this.times=n,this.easing=s,this.repeat=r,this.destroy=!0,this.actions=[],this.time_scale=1,this.delay=-1e-3,this.tween=!0,this.deactivate=!1},b5.Animation.AS_playing=0,b5.Animation.AS_paused=1,b5.Animation.prototype.setRelative=function(e){this.initial_value=e?this.target[this.property]:void 0},b5.Animation.prototype.pause=function(){this.state=b5.Animation.AS_paused},b5.Animation.prototype.play=function(){this.state=b5.Animation.AS_playing},b5.Animation.prototype.restart=function(){this.state=b5.Animation.AS_playing,this.time=this.delay,this.index=-1,this.repeats_left=this.repeat},b5.Animation.prototype.update=function(e){if(this.state!==b5.Animation.AS_playing)return!1;e*=this.time_scale;var o=this.time+e,a=this.times,n=this.frames,r=a.length,s=this.index;if(0>o){var i=n[0];return void 0!==this.initial_value&&(i+=this.initial_value),this.target[this.property]=i,this.time=o,!0}if(1>=r)return!1;for(var c=s,t;c<r;c++)if(t=a[c],o<t){if(this.index=c,o>=a[0]){if(this.index!==s){var p=this.actions[this.index-1];void 0!==p&&p()}var d=a[c-1],l=n[c-1],y=o-d;if(0!=y){var i;if(this.tween){var _=t-d,h=n[c]-l;i=void 0===this.easing?l+h*y/_:l+h*b5.Ease.easingFuncs[this.easing[c-1]](y/_)}else i=l;void 0!==this.initial_value&&(i+=this.initial_value),this.target[this.property]=i}}break}var u=a[a.length-1];if(o>u){if(0<this.repeat&&this.repeats_left--,0===this.repeat||0<this.repeats_left){for(;o>=u;)o-=u;void 0!==this.onRepeat&&this.onRepeat(this);var i=n[0];void 0!==this.initial_value&&(i+=this.initial_value),this.target[this.property]=i}else{var i=n[a.length-1];void 0!==this.initial_value&&(i+=this.initial_value),this.target[this.property]=i,this.state=b5.Animation.AS_paused,this.destroy&&this.timeline.remove(this),void 0!==this.onEnd&&this.onEnd(this),this.deactivate&&(this.target._av=!1)}this.index=-1}return this.time=o,!0},b5.Animation.prototype.setTime=function(e){this.time=e,this.index=-1,this.update(0)},b5.Animation.prototype.setAction=function(e,t){this.actions[e]=t},'use strict',b5.Timeline=function(e,t,o,a,n,r){this.anims=[],this.manager=null,this.name=null,this.playing=!1,e!==void 0&&this.add(e,t,o,a,n,r)},b5.Timeline.prototype.setRelative=function(e){for(var o=this.anims,a=o.length,n=0;n<a;n++)o[n].setRelative(e)},b5.Timeline.prototype.setRepeats=function(e){for(var o=this.anims,a=o.length,n=0;n<a;n++)o[n].repeat=e,o[n].repeats_left=e},b5.Timeline.prototype.add=function(e,t,o,a,n,r){if(1==arguments.length)return e.timeline=this,this.anims.push(e),e;var s=new b5.Animation(this,e,t,o,a,n,r);return this.anims.push(s),s},b5.Timeline.prototype.remove=function(e){for(var o=this.anims,a=o.length,n=0;n<a;n++)if(o[n]===e)return void o.splice(n,1)},b5.Timeline.prototype.changeTarget=function(e){for(var o=this.anims,a=o.length,n=0;n<a;n++)o[n].target=e},b5.Timeline.prototype.find=function(e){for(var o=this.anims,a=o.length,n=0;n<a;n++)if(o[n].name===e)return o[n];return null},b5.Timeline.prototype.setDelay=function(e){for(var o=this.anims,a=o.length,n=0;n<a;n++)o[n].delay=-e,o[n].time=-e},b5.Timeline.prototype.pause=function(){for(var e=this.anims.length,o=0;o<e;o++)this.anims[o].pause()},b5.Timeline.prototype.play=function(){for(var e=this.anims.length,o=0;o<e;o++)this.anims[o].play()},b5.Timeline.prototype.restart=function(){for(var e=this.anims.length,o=0;o<e;o++)this.anims[o].restart()},b5.Timeline.prototype.print=function(){for(var e=this.anims.length,o=0;o<e;o++)console.log(this.anims[o])},b5.Timeline.prototype.update=function(e){var o=this.anims.length;if(0===o&&void 0!==this.manager)return this.manager.remove(this),!0;this.playing=!1;for(var a=o-1;0<=a;a--)this.anims[a].update(e)&&(this.playing=!0);return this.playing},'use strict',b5.TimelineManager=function(){this.timelines=[],this.playing=!1},b5.TimelineManager.prototype.add=function(e){return this.timelines.push(e),e.manager=this,e},b5.TimelineManager.prototype.remove=function(e){if(void 0===e)return void(this.timelines=[]);for(var o=this.timelines,a=o.length,n=0;n<a;n++)if(o[n]===e)return void o.splice(n,1)},b5.TimelineManager.prototype.changeTarget=function(e){for(var o=this.timelines,a=o.length,n=0;n<a;n++)o[n].changeTarget(e)},b5.TimelineManager.prototype.find=function(e){for(var o=this.timelines,a=o.length,n=0;n<a;n++)if(o[n].name===e)return o[n];return null},b5.TimelineManager.prototype.setRepeats=function(e){for(var o=this.timelines,a=o.length,n=0;n<a;n++)o[n].setRepeats(e)},b5.TimelineManager.prototype.pause=function(){for(var e=this.timelines.length,o=0;o<e;o++)this.timelines[o].pause()},b5.TimelineManager.prototype.play=function(){for(var e=this.timelines.length,o=0;o<e;o++)this.timelines[o].play()},b5.TimelineManager.prototype.restart=function(){for(var e=this.timelines.length,o=0;o<e;o++)this.timelines[o].restart()},b5.TimelineManager.prototype.print=function(){for(var e=this.timelines.length,o=0;o<e;o++)console.log(this.timelines[o])},b5.TimelineManager.prototype.update=function(e){var o=this.timelines.length;if(0===o)return!1;this.playing=!1;for(var a=o-1;0<=a;a--)this.timelines[a].update(e)&&(this.playing=!0);return this.playing},'use strict',b5.EventsManager=function(){this.events=[]},b5.EventsManager.prototype.on=function(e,t,o){this.events.push({name:e,func:t,data:o})},b5.EventsManager.prototype.remove=function(e){var t=this.events,o=t.length;this.events=array.filter(function(t){return t.name!==e})},b5.EventsManager.prototype.clear=function(){this.events=[]},b5.EventsManager.prototype.dispatch=function(e){for(var o=this.events,a=o.length,n=0;n<a;n++)if(o[n].name===e)return void o[n].func(o[n])},'use strict',b5.Task=function(e,t,o,a,n){this.name=e,this.func=a,this.data=n,this.state=b5.Task.Stopped,this.running_time=0,this.delay=t,this.loops=0,this.repeat=o,this.last_time=0,this.wait=0,this.pause=function(){this.state=b5.Task.Paused},this.play=function(){this.state=b5.Task.Running},this.stop=function(){this.state=b5.Task.Stopped},0===t?this.play():this.state=b5.Task.Dormant},b5.Task.Dormant=0,b5.Task.Running=1,b5.Task.Paused=2,b5.Task.Stopped=3,b5.TasksQ=function(){this.q=!0,this.tasks=[]},b5.TasksQ.prototype.add=function(e,t,o,a,n){var r=new b5.Task(e,t,o,a,n);return this.tasks.push(r),r},b5.TasksQ.prototype.removeAt=function(e){this.tasks.splice(e,1)},b5.TasksQ.prototype.remove=function(e){for(var o=this.tasks,a=o.length,n=0;n<a;n++)if(o[n].name===e)return void o.splice(n,1)},b5.TasksQ.prototype.removeTask=function(e){for(var o=this.tasks,a=o.length,n=0;n<a;n++)if(o[n]===e)return void o.splice(n,1)},b5.TasksQ.prototype.find=function(e){for(var o=this.tasks,a=o.length,n=0;n<a;n++)if(o[n].name===e)return o[n];return null},b5.TasksQ.prototype.clear=function(){this.tasks=[]},b5.TasksQ.prototype.execute=function(){var e=b5.app.dt,t=this.tasks,o=t.length;if(0===o)return 0;var a=t[0];if(a.state===b5.Task.Dormant&&(a.running_time+=e,a.running_time>=a.delay&&(a.play(),a.running_time-=e)),a.state===b5.Task.Running){var n=!0;0!==a.wait&&(a.last_time+=e,a.last_time>=a.wait?a.last_time-=a.wait:n=!1),!0==n&&(a.func(a),a.running_time+=e,0>a.delay?a.stop():0<a.repeat&&(a.loops++,a.loops>=a.repeat&&(a.stop(),void 0!==a.onComplete&&a.onComplete(this),this.removeTask(a))))}return t.length},b5.TasksManager=function(){this.tasks=[]},b5.TasksManager.prototype.add=function(e,t,o,a,n){var r=new b5.Task(e,t,o,a,n);return this.tasks.push(r),r},b5.TasksManager.prototype.removeAt=function(e){this.tasks.splice(e,1)},b5.TasksManager.prototype.remove=function(e){for(var o=this.tasks,a=o.length,n=0;n<a;n++)if(o[n].name===e)return void o.splice(n,1)},b5.TasksManager.prototype.removeTask=function(e){for(var o=this.tasks,a=o.length,n=0;n<a;n++)if(o[n]===e)return void o.splice(n,1)},b5.TasksManager.prototype.find=function(e){for(var o=this.tasks,a=o.length,n=0;n<a;n++)if(o[n].name===e)return o[n];return null},b5.TasksManager.prototype.clear=function(){this.tasks=[]},b5.TasksManager.prototype.execute=function(){for(var e=[],o=b5.app.dt,a=this.tasks,n=a.length,r=0,t;r<n;r++)if(t=a[r],t.q)0===t.execute()&&(void 0!==t.onComplete&&t.onComplete(this),e.push(t));else if(t.state===b5.Task.Dormant&&(t.running_time+=o,t.running_time>=t.delay&&(t.play(),t.running_time-=o)),t.state===b5.Task.Running){var s=!0;0!==t.wait&&(t.last_time+=o,t.last_time>=t.wait?t.last_time-=t.wait:s=!1),s&&(t.func(t),t.running_time+=o,0>t.delay?t.stop():0<t.repeat&&(t.loops++,t.loops>=t.repeat&&(e.push(t),t.stop(),void 0!==t.onComplete&&t.onComplete(this))))}for(var r=0;r<e.length;r++)this.removeTask(e[r])},'use strict',b5.Actor=function(e){this.type=b5.Actor.Type_Image,this.scene=null,this.parent=null,this.actors=[],this.removals=[],this.joints=[],this.timelines=new b5.TimelineManager,b5.ActionsListManager!==void 0&&(this.actions=new b5.ActionsListManager),this.tasks=new b5.TasksManager,this.frame_count=0,this.accum_scale_x=1,this.accum_scale_y=1,this.accum_opacity=1,this.body=null,this.transform=[],this.transform_dirty=!0,this.touching=!1,this.touchmove=!1,this.layer=0,this.order_changed=!0,this.cache_canvas=null,this.name='',this.tag='',this.id=-1,this.active=!0,this.visible=!0,this.touchable=!1,this.hit=!0,this.x=0,this.y=0,this.w=0,this.h=0,this.ox=0,this.oy=0,this.ignore_atlas_size=!1,this.absolute_origin=!0,this.rotation=0,this.scale_x=1,this.scale_y=1,this.depth=0,this.opacity=1,this.use_parent_opacity=!0,this.current_frame=0,this.prev_frame=0,this.frame_speed=0,this.anim_frames=null,this.frames_repeat=!1,this.bitmap=null,this.atlas=null,this.vr=0,this.vx=0,this.vy=0,this.vd=0,this.vr_damping=1,this.vx_damping=1,this.vy_damping=1,this.vd_damping=1,this.ignore_camera=!1,this.wrap_position=!1,this.dock_x=0,this.dock_y=0,this.dock_screen=!1,this.margin=[0,0,0,0],this.bubbling=!1,this.clip_children=!1,this.clip_margin=[0,0,0,0],this.clip_shape=null,this.self_clip=!1,this.orphaned=!1,this.virtual=!1,this.shadow=!1,this.shadow_x=0,this.shadow_y=0,this.shadow_blur=0,this.shadow_colour='#000000',this.composite_op=null,this.cache=!1,this.merge_cache=!1,this.round_pixels=!1,this.padding=0,this.scale_method=0,this.draw_reverse=!1,!0===e&&this.makeVirtual()},b5.Actor.Dock_None=0,b5.Actor.Dock_Top=1,b5.Actor.Dock_Bottom=2,b5.Actor.Dock_Left=1,b5.Actor.Dock_Right=2,b5.Actor.Type_Image=0,b5.Actor.Type_Label=1,b5.Actor.Type_Rect=2,b5.Actor.Type_Arc=3,b5.Actor.Type_Polygon=4,b5.Actor.Type_Particle=5,b5.Actor.Type_Map=6,Object.defineProperty(b5.Actor.prototype,'_x',{get:function(){return this.x},set:function(e){this.x!==e&&(this.x=e,this.dirty())}}),Object.defineProperty(b5.Actor.prototype,'_y',{get:function(){return this.y},set:function(e){this.y!==e&&(this.y=e,this.dirty())}}),Object.defineProperty(b5.Actor.prototype,'_ox',{get:function(){return this.ox},set:function(e){this.ox!==e&&(this.ox=e,this.dirty())}}),Object.defineProperty(b5.Actor.prototype,'_oy',{get:function(){return this.oy},set:function(e){this.oy!==e&&(this.oy=e,this.dirty())}}),Object.defineProperty(b5.Actor.prototype,'_rotation',{get:function(){return this.rotation},set:function(e){this.rotation!==e&&(this.rotation=e,this.dirty())}}),Object.defineProperty(b5.Actor.prototype,'_scale_x',{get:function(){return this.scale_x},set:function(e){this.scale_x!==e&&(this.scale_x=e,this.dirty())}}),Object.defineProperty(b5.Actor.prototype,'_scale_y',{get:function(){return this.scale_y},set:function(e){this.scale_y!==e&&(this.scale_y=e,this.dirty())}}),Object.defineProperty(b5.Actor.prototype,'_scale',{set:function(e){this._scale_x=e,this._scale_y=e,this.dirty()}}),Object.defineProperty(b5.Actor.prototype,'_depth',{get:function(){return this.depth},set:function(e){this.depth!==e&&(this.depth=e,this.dirty())}}),Object.defineProperty(b5.Actor.prototype,'_layer',{get:function(){return this.layer},set:function(e){this.layer!==e&&(this.layer=e,null===this.parent?this.scene.order_changed=!0:this.parent.order_changed=!0)}}),Object.defineProperty(b5.Actor.prototype,'_atlas',{get:function(){return this.atlas},set:function(e){if(this.atlas!==e){if(null===e)return void(this.atlas=null);this.atlas=b5.Utils.resolveResource(e,'brush'),this.ignore_atlas_size||(this.ow=this.atlas.frames[0].w,this.oh=this.atlas.frames[0].h)}}}),Object.defineProperty(b5.Actor.prototype,'_bitmap',{get:function(){return this.bitmap},set:function(e){this.bitmap!==e&&(this.atlas=null,this.bitmap=b5.Utils.resolveResource(e,'bitmap'))}}),Object.defineProperty(b5.Actor.prototype,'_clip_shape',{get:function(){return this.clip_shape},set:function(e){this.clip_shape!==e&&(this.clip_shape=b5.Utils.resolveResource(e,'shape'))}}),Object.defineProperty(b5.Actor.prototype,'_av',{set:function(e){this.visible=e,this.active=e}}),b5.Actor.prototype.setPosition=function(e,t){if((this.x!==e||this.y!==t)&&(this.x=e,this.y=t,this.dirty(),null!==this.body)){var o=Box2D.Common.Math.b2Vec2,a=this.scene.world_scale;this.body.SetPosition(new o(e/a,t/a))}},b5.Actor.prototype.setPositionPhysics=function(e,t){this.setPosition(e,t)},b5.Actor.prototype.setOrigin=function(e,t){(this.ox!==e||this.oy!==t)&&(this.ox=e,this.oy=t,this.dirty())},b5.Actor.prototype.setScale=function(e,t){(this.scale_x!==e||this.scale_y!==t)&&(this.scale_x=e,this.scale_y=t,this.dirty())},b5.Actor.prototype.setRotation=function(e){this.rotation!==e&&(this.rotation=e,this.dirty(),null!==this.body&&this.body.SetAngle(e))},b5.Actor.prototype.setRotationPhysics=function(e){this.setRotation(e)},b5.Actor.prototype.setDepth=function(e){this.depth!==e&&(this.depth=e,this.dirty())},b5.Actor.prototype.playAnim=function(e,t){if(this.active||(this.active=!0,this.visible=!0),null!==this.atlas){var o=this.atlas.getAnim(e);null===o?this.app.debug&&console.log('Warning: Could not find brush anim \''+e+'\' for actor \''+this.name+'\''):(this.current_frame=0,this.anim_frames=o.indices,this.frame_speed=o.speed,this.frames_repeat=t,this.dirty())}},b5.Actor.prototype.playTimeline=function(e,o){var a=this.timelines.find(e);if(null!==a&&(!this.active&&(this.active=!0,this.visible=!0),a.restart(),a.update(0)),o)for(var n=this.actors,r=n.length,s=0;s<r;s++)n[s].playTimeline(e,o);return a},b5.Actor.prototype.TweenTo=function(e,t,o,a,n,r){!0===n&&this.timelines.remove();var s=new b5.Timeline(this,e,[this[e],t],[0,o],1,[a]);return void 0!==r&&s.setDelay(r),this.timelines.add(s),s},b5.Actor.prototype.TweenToWithEnd=function(e,t,o,a,n,r,s){var i=this.TweenTo(e,t,o,a,n,r);return void 0!=s&&(i.anims[0].onEnd=s),i},b5.Actor.prototype.TweenToMany=function(e){for(var o=0;o<e.length;o++){var t=e[o],a=!(0!==o)&&t.wipe;this.TweenToWithEnd(t.property,t.to,t.duration,t.easing,a,t.delay,t.onend)}},b5.Actor.prototype.TweenFrom=function(e,t,o,a,n){!0===n&&this.timelines.remove(),this.timelines.add(new b5.Timeline(this,e,[t,this[e]],[0,o],1,[a]))},b5.Actor.prototype.addTask=function(e,t,o,a,n){this.tasks.add(e,t,o,a,n)},b5.Actor.prototype.removeTask=function(e){this.tasks.remove(e)},b5.Actor.prototype.release=function(){this.onDestroy!==void 0&&this.onDestroy(),this.releaseJoints(),this.releaseBody()},b5.Actor.prototype.destroy=function(){null===this.parent?null!==this.scene&&this.scene.removeActor(this):this.parent.removeActor(this)},b5.Actor.prototype.changeParent=function(e){var o=null===this.parent?this.scene.actors:this.parent.actors;for(var a=o.length,n=0;n<a;n++)if(this===o[n]){o.splice(n,1),e.addActor(this);break}},b5.Actor.prototype.addActor=function(e){return null===this.scene&&(this.scene=b5.app.focus_scene),this.actors.push(e),e.parent=this,e.scene=this.scene,e},b5.Actor.prototype.removeActor=function(e){this.removals.push(e)},b5.Actor.prototype.removeActorsWithTag=function(e){for(var o=this.actors,a=o.length,n=0,r=this.removals,s=0;s<a;s++)o[s].tag===e&&(r.push(o[s]),n++);return n},b5.Actor.prototype.removeAllActors=function(){for(var e=this.actors,o=e.length,a=this.removals,n=0;n<o;n++)a.push(e[n])},b5.Actor.prototype.cleanupDestroyedActors=function(){var e=this.removals.length;if(0<e)for(var o=this.removals,a=this.actors,n=a.length,r=0,s;r<e;r++){s=o[r];for(var i=0;i<n;i++)if(s===a[i]){s.release(),a.splice(i,1),n--;break}}this.removals=[]},b5.Actor.prototype.findActor=function(e,o){o===void 0&&(o=!1);for(var a=this.actors,n=a.length,r=0;r<n;r++){if(a[r].name===e)return a[r];if(o){var t=a[r].findActor(e,o);if(null!==t)return t}}return null},b5.Actor.prototype.findActorById=function(e,o){o===void 0&&(o=!1);for(var a=this.actors,n=a.length,r=0;r<n;r++){if(a[r].id===e)return a[r];if(o){var t=a[r].findActorById(e,o);if(null!==t)return t}}return null},b5.Actor.prototype.findFirstParent=function(){for(var e=this;null!==e;){if(null===e.parent)return e;e=e.parent}return null},b5.Actor.prototype.findFirstCachedParent=function(){for(var e=this.parent;null!==e;){if(null!==e.cache_canvas)return e;e=e.parent}return null},b5.Actor.prototype.updateParentTransforms=function(){for(var e=[],o=this;null!==o;)e.push(o),o=o.parent;for(var a=e.length-1;0<=a;a--)e[a].updateTransform()},b5.Actor.prototype.getSlot=function(){var e=null===this.parent?this.scene.actors:this.parent.actors;for(var o=e.length,a=0;a<o;a++)if(e[a]===this)return a},b5.Actor.prototype.moveToSlot=function(e){var t=null===this.parent?this.scene.actors:this.parent.actors;var o=this.getSlot();o===e||(t.splice(e,0,this),e<o&&o++,t.splice(o,1))},b5.Actor.prototype.bringToFront=function(){var e=null===this.parent?this.scene.actors:this.parent.actors;for(var o=e.length,a=-1,n=0;n<o;n++)if(e[n]===this){a=n;break}0<=a&&(e.splice(a,1),e.push(this))},b5.Actor.prototype.sendToBack=function(){var e=null===this.parent?this.scene.actors:this.parent.actors;for(var o=e.length,a=-1,n=0;n<o;n++)if(e[n]===this){a=n;break}0<=a&&(e.splice(a,1),e.unshift(this))},b5.Actor.prototype.onBeginTouchBase=function(e){this.touching=!0,this.bubbling&&null!==this.parent&&this.parent.onBeginTouchBase(e),this.onBeginTouch!==void 0&&this.onBeginTouch(e)},b5.Actor.prototype.onEndTouchBase=function(e){this.touching&&this.onTapped!==void 0&&this.onTapped(e),this.touching=!1,this.touchmove=!1,this.bubbling&&null!==this.parent&&this.parent.onEndTouchBase(e),this.onEndTouch!==void 0&&this.onEndTouch(e)},b5.Actor.prototype.onMoveTouchBase=function(e){this.touchmove=!0,this.bubbling&&null!==this.parent&&this.parent.onMoveTouchBase(e),this.virtual&&this.Virtual_onMoveTouch(e),this.onMoveTouch!==void 0&&this.onMoveTouch(e)},b5.Actor.prototype.releaseBody=function(){null!==this.body&&(this.scene.world.DestroyBody(this.body),this.body=null)},b5.Actor.prototype.releaseJoints=function(){if(null!==this.body){for(var e=0;e<this.joints.length;e++)this.scene.world.DestroyJoint(this.joints[e]);this.joints=null}},b5.Actor.prototype.initBody=function(e,t,o){if(!this.scene.app.box2d)return null;var a=this.scene,n=new Box2D.Dynamics.b2BodyDef,r=a.world_scale;return n.type='static'===e?Box2D.Dynamics.b2Body.b2_staticBody:'kinematic'===e?Box2D.Dynamics.b2Body.b2_kinematicBody:Box2D.Dynamics.b2Body.b2_dynamicBody,n.position.Set(this.x/r,this.y/r),n.angle=this.rotation,n.fixedRotation=t,n.bullet=o,this.body=a.world.CreateBody(n),this.body.SetUserData(this),this.body},b5.Actor.prototype.addFixture=function(e){if(null===this.body)return null;var o=e,a=e,n;void 0!==e.shape&&(o=e.shape),void 0!==e.material&&(a=e.material);var r=this.scene.world_scale,i=this.scale_x,c=this.scale_y;if(o.type===b5.Shape.TypeBox)n=new Box2D.Dynamics.b2FixtureDef,n.shape=new Box2D.Collision.Shapes.b2PolygonShape,n.shape.SetAsBox(o.width/(2*r)*i,o.height/(2*r)*c);else if(o.type===b5.Shape.TypeCircle)n=new Box2D.Dynamics.b2FixtureDef,n.shape=new Box2D.Collision.Shapes.b2CircleShape(o.width/r*i);else if(o.type===b5.Shape.TypePolygon){if(void 0!==o.convexVertices&&0<o.convexVertices.length){for(var p=[],d=o.convexVertices.length,l=0;l<d;l++){n=new Box2D.Dynamics.b2FixtureDef,n.shape=new Box2D.Collision.Shapes.b2PolygonShape;for(var s=o.convexVertices[l],y=[],_=s.length,h=0;h<_;h+=2)y.push({x:s[h]/r*i,y:s[h+1]/r*c});n.shape.SetAsArray(y,y.length),void 0!==a.density&&(n.density=a.density),void 0!==a.friction&&(n.friction=a.friction),void 0!==a.restitution&&(n.restitution=a.restitution),void 0!==e.is_sensor&&(n.isSensor=e.is_sensor),void 0!==e.collision_category&&(n.filter.categoryBits=e.collision_category),void 0!==e.collision_mask&&(n.filter.maskBits=e.collision_mask),void 0!==e.collision_group&&(n.filter.groupIndex=e.collision_group),p.push(this.body.CreateFixture(n))}return p}n=new Box2D.Dynamics.b2FixtureDef,n.shape=new Box2D.Collision.Shapes.b2PolygonShape;for(var s=o.vertices,y=[],_=s.length,h=0;h<_;h+=2)y.push({x:s[h]/r*i,y:s[h+1]/r*c});n.shape.SetAsArray(y,y.length)}return void 0!==a.density&&(n.density=a.density),void 0!==a.friction&&(n.friction=a.friction),void 0!==a.restitution&&(n.restitution=a.restitution),void 0!==a.is_sensor&&(n.isSensor=a.is_sensor),void 0!==e.collision_category&&(n.filter.categoryBits=e.collision_category),void 0!==e.collision_mask&&(n.filter.maskBits=e.collision_mask),void 0!==e.collision_group&&(n.filter.groupIndex=e.collision_group),this.body.CreateFixture(n)},b5.Actor.prototype.addJoint=function(e){var t=Math.PI;if(null===this.body)return null;var o=this.scene,a=o.world,n=o.world_scale,r=Box2D.Common.Math.b2Vec2,s=this.body,i=e.actor_b.body,c=s.GetWorldCenter(),p=i.GetWorldCenter(),d=new r(c.x,c.y),l;d.x+=e.anchor_a.x/n,d.y+=e.anchor_a.y/n;var y=new r(p.x,p.y);if(y.x+=e.anchor_b.x/n,y.y+=e.anchor_b.y/n,'weld'===e.type)l=new Box2D.Dynamics.Joints.b2WeldJointDef,l.Initialize(s,i,d),l.collideConnected=e.self_collide;else if('distance'===e.type)l=new Box2D.Dynamics.Joints.b2DistanceJointDef,l.Initialize(s,i,d,y),l.collideConnected=e.self_collide,l.frequencyHz=e.frequency,l.dampingRatio=e.damping;else if('revolute'===e.type)l=new Box2D.Dynamics.Joints.b2RevoluteJointDef,l.Initialize(s,i,d),l.collideConnected=e.self_collide,e.limit_joint&&(l.enableLimit=!0,l.lowerAngle=e.lower_limit*(t/180),l.upperAngle=e.upper_limit*(t/180)),e.motor_enabled&&(l.enableMotor=!0,l.motorSpeed=e.motor_speed,l.maxMotorTorque=e.max_motor_torque);else if('prismatic'===e.type)l=new Box2D.Dynamics.Joints.b2PrismaticJointDef,l.Initialize(s,i,d,new r(e.axis.x,e.axis.y)),l.collideConnected=e.self_collide,e.limit_joint&&(l.enableLimit=!0,l.lowerTranslation=e.lower_limit/n,l.upperTranslation=e.upper_limit/n),e.motor_enabled&&(l.enableMotor=!0,l.motorSpeed=e.motor_speed,l.maxMotorForce=e.max_motor_force);else if('pulley'===e.type){var _=new r(c.x,c.y);_.x+=e.ground_a.x/n,_.y+=e.ground_a.y/n;var h=new r(p.x,p.y);h.x+=e.ground_b.x/n,h.y+=e.ground_b.y/n,l=new Box2D.Dynamics.Joints.b2PulleyJointDef,l.Initialize(s,i,_,h,d,y,e.ratio),l.collideConnected=e.self_collide}else'wheel'===e.type?(l=new Box2D.Dynamics.Joints.b2LineJointDef,l.Initialize(s,i,d,e.axis),l.collideConnected=e.self_collide,e.limit_joint&&(l.enableLimit=!0,l.lowerTranslation=e.lower_limit/n,l.upperTranslation=e.upper_limit/n),e.motor_enabled&&(l.enableMotor=!0,l.motorSpeed=e.motor_speed,l.maxMotorForce=e.max_motor_force)):'mouse'===e.type&&(l=new Box2D.Dynamics.Joints.b2MouseJointDef,l.collideConnected=e.self_collide,l.bodyA=s,l.bodyB=i,l.collideConnected=e.self_collide,l.maxForce=e.max_motor_force,l.dampingRatio=e.damping);var u=a.CreateJoint(l);return this.joints.push(u),u},b5.Actor.prototype.removeJoint=function(e){for(var o=this.joints,a=o.length,n=0;n<a;n++)if(o[n]===e)return world.DestroyJoint(e),void o.splice(n,1)},b5.Actor.prototype.getScaleFromMethod=function(e){var t=1,o=1,a=e;if(0!==a){var n=b5.app,r=1/n.canvas_scale,s=n.inner_width/n.design_width*r,i=n.inner_height/n.design_height*r;if(4===a)s<i?(t*=s,o*=s):(t*=i,o*=i);else if(2===a)t*=s,o*=s;else if(3===a)t*=i,o*=i;else if(5===a){var c=0.5*(s+i);t*=c,o*=c}else if(6===a){var c;c=n.inner_width>n.inner_height?s:i,t*=c,o*=c}else if(7===a){var c;c=n.inner_width<n.inner_height?s:i,t*=c,o*=c}else 8===a?(t*=s,o*=i):1===a&&(t*=r,o*=r)}return{x:t,y:o}},b5.Actor.prototype.updateTransform=function(){if(this.transform_dirty){var e=this.transform,t=this.scene,o=this.rotation,a=this.scale_x,n=this.scale_y,r=this.scale_method;if(0!==r){var i=this.getScaleFromMethod(r);a*=i.x,n*=i.y}var s=this.parent;null===s||this.orphaned?(this.accum_scale_x=a,this.accum_scale_y=n):(this.accum_scale_x=a*s.accum_scale_x,this.accum_scale_y=n*s.accum_scale_y);var c=Math.cos(o),p=Math.sin(o);if(0!==this.depth&&1!==this.depth){var d=1/this.depth;a*=d,n*=d,e[4]=(this.x-t.camera_x)*d,e[5]=(this.y-t.camera_y)*d}else this.transform_dirty=!1,e[4]=this.x,e[5]=this.y;e[0]=c*a,e[1]=p*a,e[2]=-p*n,e[3]=c*n;var l=null,y=this.atlas;null!==y&&(null===this.anim_frames?l=y.getFrame(0|this.current_frame):l=y.getFrame(this.anim_frames[0|this.current_frame]));var _=this.ox,h=this.oy;if(0!==_||0!==h||null!==l){this.absolute_origin||(_*=this.w,h*=this.h),e[4]-=_,e[5]-=h,null!==l&&(_-=l.ox,h-=l.oy);var u=[1,0,0,1,_,h];b5.Maths.preMulMatrix(e,u)}null===s||this.orphaned||b5.Maths.mulMatrix(e,s.transform)}},b5.Actor.prototype.draw=function(){if(this.visible&&(this.cache&&(this.drawToCache(),this.cache=!1),!this.merge_cache)){var e=this.cache_canvas,o=this.scene,a=o.app,n=a.canvas_scale,r=a.display;this.preDraw();var s=null;if(null===e){var i=this.atlas;null!==i&&(s=null===this.anim_frames?i.getFrame(0|this.current_frame):i.getFrame(this.anim_frames[0|this.current_frame]),!this.ignore_atlas_size&&(this.w=s.w,this.h=s.h),(0|this.prev_frame)!=(0|this.current_frame)&&this.dirty(),this.prev_frame=this.current_frame)}var c=a.canvas_cx+o.x*n,p=a.canvas_cy+o.y*n;void 0===this.ow&&(this.ow=this.w,this.oh=this.h);var d=this.ow/2,l=this.oh/2;this.ignore_camera||0!==this.depth&&1!==this.depth||(c-=o.camera_x*n,p-=o.camera_y*n),this.updateTransform();var y=this.self_clip,_=this.clip_children,h=this.transform,u=h[4]*n+c,g=h[5]*n+p;this.round_pixels&&(d=0|d+0.5,l=0|l+0.5,u=0|u+0.5,g=0|g+0.5),r.setTransform(h[0]*n,h[1]*n,h[2]*n,h[3]*n,u,g),y&&this.setClipping(-d,-l),null===e?null===i?null!==this.bitmap&&r.drawImage(this.bitmap.image,-d,-l,this.w,this.h):r.drawAtlasImage(i.bitmap.image,s.x,s.y,s.w,s.h,-d,-l,this.w+1,this.h+1):r.drawImage(e,-e.width>>1,-e.height>>1),this.postDraw(),_?!y&&this.setClipping(-d,-l):y&&r.restoreContext();var m=this.actors.length;if(0<m){var f=this.actors;if(this.draw_reverse)for(var x=m-1;0<=x;x--)f[x].draw();else for(var x=0;x<m;x++)f[x].draw()}_&&r.restoreContext()}},b5.Actor.prototype.drawToCache=function(){var e=b5.app.display,t=null,o=0,a=0;if(this.merge_cache){var n=this.findFirstCachedParent();null!==n&&(t=n.cache_canvas,o=this.x+t.width/2-this.w/2,a=this.y+t.height/2-this.h/2)}var r=null,s=this.atlas;null!==s&&(null===this.anim_frames?r=s.getFrame(this.current_frame<<0):r=s.getFrame(this.anim_frames[this.current_frame<<0])),null===t&&(t=e.createCache(),t.width=this.w,t.height=this.h),e.setCache(t),null===s?null!==this.bitmap&&e.drawImage(this.bitmap.image,o,a,this.w,this.h):e.drawAtlasImage(s.bitmap.image,r.x,r.y,r.w,r.h,o,a,this.w,this.h),e.setCache(null),this.cache_canvas=t},b5.Actor.prototype.preDraw=function(){var e=b5.app.display;this.accum_opacity=null!==this.parent&&this.use_parent_opacity?this.parent.accum_opacity*this.opacity:this.opacity*this.scene.opacity,e.setGlobalAlpha(this.accum_opacity),this.shadow&&e.setShadow(this.shadow_x,this.shadow_y,this.shadow_colour,this.shadow_blur),null!==this.composite_op&&e.setGlobalCompositeOp(this.composite_op)},b5.Actor.prototype.postDraw=function(){var e=b5.app.display;this.shadow&&e.setShadowOff(),null!==this.composite_op&&e.setGlobalCompositeOp('source-over')},b5.Actor.prototype.baseUpdate=function(e){if(this.active){void 0!==this.onTick&&this.onTick(e),this.timelines.update(e),void 0!==this.actions&&this.actions.execute(),this.tasks.execute(),this.virtual&&this.Virtual_update(e);var o=this.scene;if(null!==this.atlas){this.current_frame+=this.frame_speed*e;var a;if(a=null===this.anim_frames?this.atlas.getMaxFrames():this.anim_frames.length,!this.frames_repeat)this.current_frame>=a?this.current_frame=a-1:0>this.current_frame&&(this.current_frame=0);else if(0>this.current_frame)for(;0>this.current_frame;)this.current_frame+=a;else for(;this.current_frame>=a;)this.current_frame-=a}var n=this.x,r=this.y,i=this.body;if(null!==i){var c=i.GetPosition(),p=o.world_scale;this.setRotation(i.GetAngle()),this.setPosition(c.x*p,c.y*p)}else this.rotation+=this.vr*e,this.vr*=this.vr_damping,this.x+=this.vx*e,this.vx*=this.vx_damping,this.y+=this.vy*e,this.vy*=this.vy_damping;if(0!==this.vd&&(this.depth+=this.vd*e,this.vd*=this.vd_damping),this.wrap_position){var d=o.extents[0],l=d+o.extents[2],y=o.extents[1],_=y+o.extents[3];this.x<d?this.x=l:this.x>l&&(this.x=d),this.y<y?this.y=_:this.y>_&&(this.y=y)}if(null===this.parent||!this.parent.virtual)if(this.dock_screen){if(0!==this.dock_x){var h=this.getScaleFromMethod(2),s=0===this.scale_method?1:h.x;this.dock_x===b5.Actor.Dock_Left?this.x=-o.w*h.x/2+(this.w*this.scale_x*s/2+this.margin[0]*h.x):this.dock_x===b5.Actor.Dock_Right&&(this.x=o.w*h.x/2-(this.w*this.scale_x*s/2+this.margin[1]*h.x))}if(0!==this.dock_y){var h=this.getScaleFromMethod(3),u=0===this.scale_method?1:h.y;this.dock_y===b5.Actor.Dock_Top?this.y=-o.h*h.y/2+(this.h*this.scale_y*u/2+this.margin[2]*h.y):this.dock_y===b5.Actor.Dock_Bottom&&(this.y=o.h*h.y/2-(this.h*this.scale_y*u/2+this.margin[3]*h.y))}}else 0!==this.dock_x&&(this.dock_x===b5.Actor.Dock_Left?this.x=-o.w/2+this.w*this.scale_x/2+this.margin[0]:this.dock_x===b5.Actor.Dock_Right&&(this.x=o.w/2-this.w*this.scale_x/2+this.margin[1])),0!==this.dock_y&&(this.dock_y===b5.Actor.Dock_Top?this.y=-o.h/2+this.h*this.scale_y/2+this.margin[2]:this.dock_y===b5.Actor.Dock_Bottom&&(this.y=o.h/2-this.h*this.scale_y/2+this.margin[3]));(this.x!==n||this.y!==r||null===i&&0!==this.vr)&&this.dirty();var g=this.actors.length;if(0<g)for(var m=this.actors,f=0;f<g;f++)m[f].update(e);this.cleanupDestroyedActors(),this.order_changed&&(this.order_changed=!1,b5.Utils.sortLayers(this.actors)),this.frame_count++}},b5.Actor.prototype.update=function(e){this.baseUpdate(e)},b5.Actor.prototype.updateToPhysics=function(){if(null!==this.body){var e=Box2D.Common.Math.b2Vec2;this.body.SetLinearVelocity(new e(this.vx,this.vy)),this.body.SetAngularVelocity(this.vr),this.body.SetAwake(!0)}},b5.Actor.prototype.dirty=function(){this.transform_dirty=!0;for(var e=this.actors,o=e.length,a=0;a<o;a++)e[a].dirty()},b5.Actor.prototype.makeVirtual=function(){this.prev_scroll_pos_x=0,this.prev_scroll_pos_y=0,this.scroll_pos_x=0,this.scroll_pos_y=0,this.scroll_vx=0,this.scroll_vy=0,this.scroll_range=[0,0,0,0],this.virtual=!0},b5.Actor.prototype.Virtual_onMoveTouch=function(){if(this.touching&&(0!==this.scroll_range[2]||0!==this.scroll_range[3])){var e=this.scene.app;this.prev_scroll_pos_x=this.scroll_pos_x,this.prev_scroll_pos_y=this.scroll_pos_y,this.scroll_vx=e.touch_drag_x,this.scroll_pos_x+=e.touch_drag_x,this.scroll_vy=e.touch_drag_y,this.scroll_pos_y+=e.touch_drag_y,(0!==this.scroll_vx||0!==this.scroll_vy)&&(this.Virtual_scrollRangeCheck(),this.Virtual_updateLayout())}},b5.Actor.prototype.Virtual_update=function(){this.touching||(this.prev_scroll_pos_x=this.scroll_pos_x,this.prev_scroll_pos_y=this.scroll_pos_y,this.scroll_pos_x+=this.scroll_vx,this.scroll_pos_y+=this.scroll_vy,(0!==this.scroll_vx||0!==this.scroll_vy)&&(this.Virtual_scrollRangeCheck(),this.Virtual_updateLayout()),this.scroll_vx*=0.9,this.scroll_vy*=0.9,-0.5<this.scroll_vx&&0.5>this.scroll_vx&&(this.scroll_vx=0),-0.5<this.scroll_vy&&0.5>this.scroll_vy&&(this.scroll_vy=0)),0===this.frame_count&&this.Virtual_updateLayout()},b5.Actor.prototype.Virtual_scrollRangeCheck=function(){var e=this.scroll_pos_x,t=this.scroll_pos_y,o=-this.scroll_range[0],a=o-this.scroll_range[2],n=-this.scroll_range[1],r=n-this.scroll_range[3];e<a?(e=a,this.scroll_vx=0):e>o&&(e=o,this.scroll_vx=0),t<r?(t=r,this.scroll_vy=0):t>n&&(t=n,this.scroll_vy=0),this.scroll_pos_x=e,this.scroll_pos_y=t},b5.Actor.prototype.Virtual_updateLayout=function(){var e=this.prev_scroll_pos_x-this.scroll_pos_x,o=this.prev_scroll_pos_y-this.scroll_pos_y,a=this.actors.length,n=this.w*this.scale_x/2,r=this.h*this.scale_y/2;if(0<a)for(var s=this.actors,i=0,t;i<a;i++)t=s[i],0===t.dock_x?t.x+=e:t.dock_x===b5.Actor.Dock_Left?t.x=-n+t.w*t.scale_x/2+t.margin[0]:t.dock_x===b5.Actor.Dock_Right&&(t.x=n-t.w*t.scale_x/2+t.margin[1]),0===t.dock_y?t.y+=o:t.dock_y===b5.Actor.Dock_Top?t.y=-r+t.h*t.scale_y/2+t.margin[2]:t.dock_y===b5.Actor.Dock_Bottom&&(t.y=r-t.h*t.scale_y/2+t.margin[3]),t.dirty()},b5.Actor.prototype.hitTest=function(e){if(!this.touchable||!this.active)return null;var o=this.actors.length,a;if(0<o)for(var n=this.actors,r=o-1;0<=r;r--)if(a=n[r].hitTest(e),null!==a)return a;if(this.hit){var t=this.scene,s=this.transform,i=s[4]+t.x,c=s[5]+t.y;this.ignore_camera||(i-=t.camera_x,c-=t.camera_y);var p=this.accum_scale_x,d=this.accum_scale_y,l=(e.x-i)/p,y=(e.y-c)/d,_=l*s[0]+y*s[1],h=l*s[2]+y*s[3],u=this.w*p/2,g=this.h*d/2;if(_>=-u&&_<=u&&h>=-g&&h<=g)return this}return null},b5.Actor.prototype.transformPoint=function(e,t){return b5.Maths.vecMulMatrix(e,t,this.transform)},b5.Actor.prototype.setClipping=function(e,t){var o=Math.PI,a=b5.app.display;a.saveContext();var n=this.clip_margin,r=this.clip_shape;if(null===r){var s=this.type;s===b5.Actor.Type_Arc?a.clipArc(0,0,this.radius,0,2*o):s===b5.Actor.Type_Polygon?a.clipPolygon(this.points):a.clipRect(e+n[0],t+n[1],this.w-n[2]-n[0],this.h-n[3]-n[1])}else{var s=r.type;s===b5.Shape.TypeBox?a.clipRect(e+n[0],t+n[1],r.width-n[2]-n[0],r.height-n[3]-n[1]):s===b5.Shape.TypeCircle?a.clipArc(0,0,r.width,0,2*o):s===b5.Shape.TypePolygon&&a.clipPolygon(r.vertices)}},b5.Actor.prototype.overlaps=function(e){var t=this.w,o=this.h,a=e.w,n=e.h,r=this.x-t/2,s=this.y-o/2,i=e.x-a/2,c=e.y-n/2;return!(s+o<c||s>c+n||r>i+a||r+t<i)},b5.Actor.prototype.overlapsRect=function(e){var t=this.w,o=this.h,a=e.x1+e.x2,n=e.y1+e.y2,r=this.x-t/2,s=this.y-o/2,i=e.x1-a/2,c=e.y1-n/2;return!(s+o<c||s>c+n||r>i+a||r+t<i)},b5.Actor.prototype.circleOverlaps=function(e){var t=e.x-e.w/2,o=e.y-e.h/2,a=e.x+e.w/2,n=e.y+e.h/2,r=this.x,s=this.y,i=r<t?t:r>a?a:r,c=s<o?o:s>n?n:s,p=r-i,d=s-c;return p*p+d*d<this.w/2*this.w/2},b5.Actor.prototype.circleOverlapsRect=function(e){var t=e.x1,o=e.y1,a=e.x2,n=e.y2,r=this.x,s=this.y,i=r<t?t:r>a?a:r,c=s<o?o:s>n?n:s,p=r-i,d=s-c;return p*p+d*d<this.w/2*this.w/2},b5.Actor.fullCircleOverlapTest=function(e,t){var o=e.transformPoint(0,0),a=t.transformPoint(0,0),n=a.x-o.x,r=a.y-o.y,s=e.w*e.w/2+t.w*t.w/2;return!!(n*n+r*r<=s)},'use strict',b5.ArcActor=function(){this.fill_style='#ffffff',this.stroke_style='#ffffff',this.stroke_thickness=1,this.radius=1,this.start_angle=0,this.end_angle=2*Math.PI,this.filled=!0,this.stroke_filled=!1,b5.Actor.call(this),this.type=b5.Actor.Type_Arc},b5.ArcActor.prototype=new b5.Actor,b5.ArcActor.prototype.constructor=b5.ArcActor,b5.ArcActor.prototype.parent=b5.Actor.prototype,b5.ArcActor.prototype.update=function(e){return this.baseUpdate(e)},b5.ArcActor.prototype.draw=function(){if(this.visible&&(this.cache&&(this.drawToCache(),this.cache=!1),!this.merge_cache)){var e=this.cache_canvas,o=this.scene,a=o.app,n=a.canvas_scale,r=a.display;null===e&&(this.filled&&''!==this.fill_style&&r.setFillStyle(this.fill_style),this.stroke_filled&&''!==this.stroke_style&&r.setStrokeStyle(this.stroke_style),this.stroke_filled&&r.setLineWidth(this.stroke_thickness)),this.preDraw();var s=a.canvas_cx+o.x*n,i=a.canvas_cy+o.y*n;this.ignore_camera||0!==this.depth&&1!==this.depth||(s-=o.camera_x*n,i-=o.camera_y*n),this.updateTransform();var c=this.self_clip,p=this.clip_children,d=this.transform,l=d[4]*n+s,y=d[5]*n+i;this.round_pixels&&(l=0|l+0.5,y=0|y+0.5),r.setTransform(d[0]*n,d[1]*n,d[2]*n,d[3]*n,l,y),c&&this.setClipping(0,0),null===e?r.drawArc(0,0,this.radius,this.start_angle,this.end_angle,this.filled):r.drawImage(e,-e.width>>1,-e.height>>1),this.postDraw(),p?!c&&this.setClipping(0,0):c&&r.restoreContext();var _=this.actors.length;if(0<_)for(var h=this.actors,u=0;u<_;u++)h[u].draw();p&&r.restoreContext()}},b5.ArcActor.prototype.drawToCache=function(){var e=b5.app.display,t=null,o=this.w,a=this.h,n=0,r=0;if(this.merge_cache){var s=this.findFirstCachedParent();null!==s&&(t=s.cache_canvas,n=this.x+t.width/2-o/2,r=this.y+t.height/2-a/2)}null===t&&(t=e.createCache(),this.stroke_filled&&''!==this.stroke_style&&(o+=this.stroke_thickness,a+=this.stroke_thickness,n=this.stroke_thickness/2+0.5<<0,r=this.stroke_thickness/2+0.5<<0),t.width=o,t.height=a),e.setCache(t),this.filled&&''!==this.fill_style&&e.setFillStyle(this.fill_style),this.stroke_filled&&''!==this.stroke_style&&e.setStrokeStyle(this.stroke_style),this.stroke_filled&&e.setLineWidth(this.stroke_thickness),e.setTransform(1,0,0,1,n+this.w/2,r+this.h/2),e.drawArc(0,0,this.radius,this.start_angle,this.end_angle,this.filled),e.setCache(null),this.cache_canvas=t},b5.ArcActor.prototype.hitTest=function(e){if(!this.touchable)return null;var o=this.actors.length,a;if(0<o)for(var n=this.actors,s=0;s<o;s++)if(a=n[s].hitTest(e),null!==a)return a;var t=this.scene,i=this.transform,c=i[4]+t.x,p=i[5]+t.y;this.ignore_camera||(c-=t.camera_x,p-=t.camera_y);var d=this.accum_scale_x,l=this.accum_scale_y,y=(e.x-c)/d,_=(e.y-p)/l,h=y*i[0]+_*i[1],u=y*i[2]+_*i[3],g=this.radius*d;g*=g;return h*h+u*u<=g?this:null},'use strict',b5.LabelActor=function(){this.text='',this.font='16pt Calibri',this.text_align='center',this.text_baseline='middle',this.fill_style='#ffffff',this.stroke_style='#ffffff',this.stroke_thickness=1,this.filled=!0,this.stroke_filled=!1,this.line_height=16,b5.Actor.call(this),this.type=b5.Actor.Type_Label},b5.LabelActor.prototype=new b5.Actor,b5.LabelActor.prototype.constructor=b5.LabelActor,b5.LabelActor.prototype.parent=b5.Actor.prototype,Object.defineProperty(b5.LabelActor.prototype,'_text',{get:function(){return this.text},set:function(e){this.text!==e&&(this.text=''+e,null!==this.cache_canvas&&(this.cache=!0))}}),b5.LabelActor.prototype.update=function(e){return this.baseUpdate(e)},b5.LabelActor.prototype.draw=function(){if(this.visible&&''!==this.text&&(this.cache&&(this.drawToCache(),this.cache=!1),!this.merge_cache)){var e=this.cache_canvas,o=this.scene,a=o.app,n=a.canvas_scale,r=a.display;null===e&&(''!==this.font&&r.setFont(this.font),''!==this.textAlign&&r.setTextAlign(this.text_align),''!==this.textBaseline&&r.setTextBaseline(this.text_baseline),this.filled&&''!==this.fill_style&&r.setFillStyle(this.fill_style),this.stroke_filled&&''!==this.stroke_style&&r.setStrokeStyle(this.stroke_style),this.stroke_filled&&r.setLineWidth(this.stroke_thickness)),this.preDraw();var s=b5.app.pixel_ratio;null===e&&(s=1);var i=a.canvas_cx+o.x*n/s,c=a.canvas_cy+o.y*n/s;this.ignore_camera||0!==this.depth&&1!==this.depth||(i-=o.camera_x*n,c-=o.camera_y*n),this.updateTransform();var p=this.transform,d=p[4]*n+i,l=p[5]*n+c;if(this.round_pixels&&(d=0|d+0.5,l=0|l+0.5),n/=s,r.setTransform(p[0]*n,p[1]*n,p[2]*n,p[3]*n,d,l),null===e)this.stroke_filled&&r.drawText(this.text,0,0,this.line_height,!1),this.filled&&r.drawText(this.text,0,0,this.line_height,!0);else{var _=-e.width/2,h=-e.height/2;r.drawImage(e,_,h)}this.postDraw();var y=this.actors.length;if(0<y)for(var u=this.actors,g=0;g<y;g++)u[g].draw()}},b5.LabelActor.prototype.drawToCache=function(){var e=b5.app.display,t=null,o=this.w+2*this.padding,a=this.h+2*this.padding,n=0,r=0;if(this.merge_cache){var s=this.findFirstCachedParent();null!==s&&(t=s.cache_canvas,n=this.x+t.width/2-o/2,r=this.y+t.height/2-a/2)}null===t&&(t=e.createCache(),t.width=0|o*b5.app.pixel_ratio,t.height=0|a*b5.app.pixel_ratio),e.setCache(t),''!==this.font&&e.setFont(this.font),''!==this.textAlign&&e.setTextAlign(this.text_align),''!==this.textBaseline&&e.setTextBaseline(this.text_baseline),this.filled&&''!==this.fill_style&&e.setFillStyle(this.fill_style),this.stroke_filled&&''!==this.stroke_style&&e.setStrokeStyle(this.stroke_style),this.stroke_filled&&e.setLineWidth(this.stroke_thickness),e.setTransform(1,0,0,1,0,0),this.stroke_filled&&e.drawText(this.text,n+o/2,r+a/2,this.line_height,!1),this.filled&&e.drawText(this.text,n+o/2,r+a/2,this.line_height,!0),e.setCache(null),this.cache_canvas=t},'use strict',b5.ParticleActor=function(){b5.Actor.call(this),this.type=b5.Actor.Type_Particle,this.gravity=0},b5.ParticleActor.prototype=new b5.Actor,b5.ParticleActor.prototype.constructor=b5.ParticleActor,b5.ParticleActor.prototype.parent=b5.Actor.prototype,b5.ParticleActor.prototype.resetParticle=function(e){if(e.life_time=0,e.orphaned){var t=this.transformPoint(e.org_x+this.x,e.org_y+this.y);e.x=t.x,e.y=t.y}else e.x=e.org_x,e.y=e.org_y;e.rotation=e.org_rotation,e.scale_x=e.org_scale_x,e.scale_y=e.org_scale_y,e.depth=e.org_depth,e.opacity=e.org_opacity,e.current_frame=e.org_current_frame,e.vr=e.org_vr,e.vx=e.org_vx,e.vy=e.org_vy,e.vd=e.org_vd,e.vo=e.org_vo,e.vsx=e.org_vsx,e.vsy=e.org_vsy},b5.ParticleActor.prototype.addParticle=function(e,t,o,a){if(this.addActor(e),void 0===e.vo&&(e.vo=0),void 0===e.vsx&&(e.vsx=0),void 0===e.vsy&&(e.vsy=0),e.life_time=-a,e.life_span=t,e.num_lives=o,0>e.life_time&&(e.active=!1,e.visible=!1),e.org_num_lives=e.num_lives,e.org_x=e.x,e.org_y=e.y,e.org_rotation=e.rotation,e.org_scale_x=e.scale_x,e.org_scale_y=e.scale_y,e.org_depth=e.depth,e.org_opacity=e.opacity,e.org_current_frame=e.current_frame,e.org_vr=e.vr,e.org_vx=e.vx,e.org_vy=e.vy,e.org_vd=e.vd,e.org_vo=e.vo,e.org_vsx=e.vsx,e.org_vsy=e.vsy,e.orphaned){var n=this.transformPoint(e.org_x+this.x,e.org_y+this.y);e.x=n.x,e.y=n.y}return e},b5.ParticleActor.prototype.update=function(e){var o=this.actors,a=o.length;if(0===a)void 0!==this.onParticlesEnd&&this.onParticlesEnd(),this.destroy();else for(var n=a-1,t;0<=n;n--){t=o[n],t.life_time+=e;var r=t.life_time;0<=r&&(0>r-e&&0<=r&&(t.active=!0,t.visible=!0),t.active&&(t.scale_x+=t.vsx*e,t.scale_y+=t.vsy*e,t.opacity+=t.vo*e,0>t.opacity&&(t.opacity=0),t.vy+=this.gravity*e,t.update(e),r>=t.life_span&&(0<t.num_lives&&t.num_lives--,0<t.num_lives||0===t.org_num_lives?this.resetParticle(t):void 0===this.onParticleLost?t.destroy():this.onParticleLost(t)&&t.destroy())))}return this.baseUpdate(e)},b5.ParticleActor.prototype.generateExplosion=function(e,o,a,n,r,s,i,c){this.updateParentTransforms();for(var d=0;d<e;d++){var t;for(var p in t='string'==typeof o?new b5[o]:new o,c)t[p]=c[p];t.vr+=Math.random()*r,t.vx+=Math.random()*n-n/2,t.vy+=Math.random()*n-n/2,t.vx_damping=i,t.vy_damping=i,t.vo=-1/a,this.addParticle(t,a,1,d/(e*s))}},b5.ParticleActor.prototype.generatePlume=function(e,o,a,n,r,s,i,c){this.updateParentTransforms();for(var d=0;d<e;d++){var t;for(var p in t='string'==typeof o?new b5[o]:new o,c)t[p]=c[p];t.vr+=Math.random()*r,t.vx+=Math.random()*n-n/2,t.vy+=Math.random()*-n-n/2,t.vx_damping=i,t.vy_damping=i,t.vo=-1/a,this.addParticle(t,a,0,d/(e*s))}},b5.ParticleActor.prototype.generateRain=function(e,o,a,n,r,s,i,c,d){this.updateParentTransforms();for(var l=0;l<e;l++){var t;for(var p in t='string'==typeof o?new b5[o]:new o,d)t[p]=d[p];t.x=Math.random()*c-c/2,t.vr+=Math.random()*r,t.vy+=Math.random()*n+n/2,t.vx_damping=i,t.vy_damping=i,t.vo=-1/a,this.addParticle(t,a,0,l/(e*s))}},'use strict',b5.PolygonActor=function(){this.fill_style='#ffffff',this.stroke_style='',this.stroke_thickness=1,this.filled=!0,this.stroke_filled=!1,this.points=null,b5.Actor.call(this),this.type=b5.Actor.Type_Polygon},b5.PolygonActor.prototype=new b5.Actor,b5.PolygonActor.prototype.constructor=b5.PolygonActor,b5.PolygonActor.prototype.parent=b5.Actor.prototype,b5.PolygonActor.prototype.update=function(e){return this.baseUpdate(e)},b5.PolygonActor.prototype.draw=function(){if(this.visible&&null!==this.points&&(this.cache&&(this.drawToCache(),this.cache=!1),!this.merge_cache)){var e=this.cache_canvas,o=this.scene,a=o.app,n=a.display;null===e&&(this.filled&&''!==this.fill_style&&n.setFillStyle(this.fill_style),this.stroke_filled&&''!==this.stroke_style&&n.setStrokeStyle(this.stroke_style),this.stroke_filled&&n.setLineWidth(this.stroke_thickness)),this.preDraw();var r=a.canvas_scale,s=a.canvas_cx+this.scene.x*r,i=a.canvas_cy+this.scene.y*r;this.ignore_camera||0!==this.depth&&1!==this.depth||(s-=o.camera_x*r,i-=o.camera_y*r),this.updateTransform();var c=this.self_clip,p=this.clip_children,d=this.transform,l=d[4]*r+s,y=d[5]*r+i;this.round_pixels&&(l=0|l+0.5,y=0|y+0.5),n.setTransform(d[0]*r,d[1]*r,d[2]*r,d[3]*r,l,y),c&&this.setClipping(0,0),null===e?n.drawPolygon(0,0,this.points,this.filled):n.drawImage(e,-e.width>>1,-e.height>>1),this.postDraw(),p?!c&&this.setClipping(0,0):c&&n.restoreContext();var _=this.actors.length;if(0<_)for(var h=this.actors,u=0;u<_;u++)h[u].draw();p&&n.restoreContext()}},b5.PolygonActor.prototype.drawToCache=function(){var e=b5.app.display,t=null,o=this.w,a=this.h,n=0,r=0;if(this.merge_cache){var s=this.findFirstCachedParent();null!==s&&(t=s.cache_canvas,n=this.x+t.width/2-o/2,r=this.y+t.height/2-a/2)}null===t&&(t=e.createCache(),!this.filled&&''!==this.stroke_style&&(o+=this.stroke_thickness,a+=this.stroke_thickness),t.width=o,t.height=a),e.setCache(t),this.filled&&''!==this.fill_style&&e.setFillStyle(this.fill_style),this.stroke_filled&&''!==this.stroke_style&&e.setStrokeStyle(this.stroke_style),this.stroke_filled&&e.setLineWidth(this.stroke_thickness),e.setTransform(1,0,0,1,n+this.w/2,r+this.h/2),e.drawPolygon(0,0,this.points,this.filled),e.setCache(null),this.cache_canvas=t},'use strict',b5.RectActor=function(){this.fill_style='#ffffff',this.stroke_style='#ffffff',this.stroke_thickness=1,this.corner_radius=0,this.filled=!0,this.stroke_filled=!1,b5.Actor.call(this),this.type=b5.Actor.Type_Rect},b5.RectActor.prototype=new b5.Actor,b5.RectActor.prototype.constructor=b5.RectActor,b5.RectActor.prototype.parent=b5.Actor.prototype,b5.RectActor.prototype.update=function(e){return this.baseUpdate(e)},b5.RectActor.prototype.draw=function(){if(this.visible&&(this.cache&&(this.drawToCache(),this.cache=!1),!this.merge_cache)){var e=this.cache_canvas,o=this.scene,a=o.app,n=a.canvas_scale,r=a.display;null===e&&(this.filled&&''!==this.fill_style&&r.setFillStyle(this.fill_style),this.stroke_filled&&''!==this.stroke_style&&r.setStrokeStyle(this.stroke_style),this.stroke_filled&&r.setLineWidth(this.stroke_thickness)),this.preDraw();var s=a.canvas_cx+o.x*n,i=a.canvas_cy+o.y*n,c=this.w/2,p=this.h/2;this.ignore_camera||0!==this.depth&&1!==this.depth||(s-=o.camera_x*n,i-=o.camera_y*n),this.updateTransform();var d=this.self_clip,l=this.clip_children,y=this.transform,_=y[4]*n+s,h=y[5]*n+i;this.round_pixels&&(c=0|c+0.5,p=0|p+0.5,_=0|_+0.5,h=0|h+0.5),r.setTransform(y[0]*n,y[1]*n,y[2]*n,y[3]*n,_,h),d&&this.setClipping(-c,-p),null===e?0===this.corner_radius?r.drawRect(-c,-p,this.w,this.h,this.filled):r.drawRoundRect(-c,-p,this.w,this.h,this.corner_radius,this.filled):r.drawImage(e,-e.width>>1,-e.height>>1),this.postDraw(),l?!d&&this.setClipping(-c,-p):d&&r.restoreContext();var u=this.actors.length;if(0<u)for(var g=this.actors,m=0;m<u;m++)g[m].draw();l&&r.restoreContext()}},b5.RectActor.prototype.drawToCache=function(){var e=b5.app.display,t=null,o=this.w,a=this.h,n=0,r=0;if(this.merge_cache){var s=this.findFirstCachedParent();null!==s&&(t=s.cache_canvas,n=this.x+t.width/2-o/2,r=this.y+t.height/2-a/2)}null===t&&(t=e.createCache(),this.stroke_filled&&''!==this.stroke_style&&(o+=this.stroke_thickness,a+=this.stroke_thickness,n=this.stroke_thickness>>1,r=this.stroke_thickness>>1),t.width=o,t.height=a),e.setCache(t),this.filled&&''!==this.fill_style&&e.setFillStyle(this.fill_style),this.stroke_filled&&''!==this.stroke_style&&e.setStrokeStyle(this.stroke_style),this.stroke_filled&&e.setLineWidth(this.stroke_thickness),e.setTransform(1,0,0,1,o/2+n,a/2+r),0===this.corner_radius?e.drawRect(-o/2,-a/2,this.w,this.h,this.filled):e.drawRoundRect(-o/2,-a/2,this.w,this.h,this.corner_radius,this.filled),e.setCache(null),this.cache_canvas=t},'use strict',b5.MapActor=function(){this.tiles=[],this.map=[],this.collision_map=[],this.tile_width=32,this.tile_height=32,this.map_width=0,this.map_height=0,this.display_width=8,this.display_height=8,b5.Actor.call(this),this.type=b5.Actor.Type_Map},b5.MapActor.prototype=new b5.Actor,b5.MapActor.prototype.constructor=b5.MapActor,b5.MapActor.prototype.parent=b5.Actor.prototype,b5.MapActor.prototype.update=function(e){return this.baseUpdate(e)},b5.MapActor.prototype.generateTiles=function(e,o,a,n){for(var r=0.5,s=0.5,i=0;i<e;i++)this.tiles[i]={x:r,y:s},r+=o,r>=n&&(r=0.5,s+=a);this.tile_width=o,this.tile_height=a},b5.MapActor.prototype.setTile=function(e,t,o,a){var n=this.map_width,r=this.map_height;0>e||e>=n||0>t||t>=r||(a!==void 0&&a?this.collision_map[t*n+e]=o:this.map[t*n+e]=o)},b5.MapActor.prototype.getTile=function(e,t,o){var a=this.map_width,n=this.map_height;return 0>e||e>=a?-1:0>t||t>=n?-1:void 0!==o&&o?this.collision_map[t*a+e]:this.map[t*a+e]},b5.MapActor.prototype.getTileXY=function(e,t){var o=Math.round,a=this.map_width,n=this.map_height,r=this.tile_width,s=this.tile_height;return{x:o((e-r/2)/r)+(a>>1),y:o((t-s/2)/s)+(n>>1)}},b5.MapActor.prototype.getTilePosition=function(e,t,o){var a=this.tile_width,n=this.tile_height,r=this.getTileXY(e,t);return r.x-=this.map_width>>1,r.y-=this.map_height>>1,r.x*=a,r.y*=n,'m'===o?r.y+=n/2:'b'===o?r.y+=n:'c'===o?r.x+=a/2:'r'===o&&(r.x+=a),r},b5.MapActor.prototype.getTileFromPosition=function(e,t,o){var a=this.getTileXY(e,t);return this.getTile(a.x,a.y,o)},b5.MapActor.prototype.draw=function(){if(this.visible){var e=this.scene,o=e.app,a=o.canvas_scale,n=o.display;this.preDraw();var r=o.canvas_cx+e.x*a,s=o.canvas_cy+e.y*a;this.ignore_camera||0!==this.depth&&1!==this.depth||(r-=e.camera_x*a,s-=e.camera_y*a),this.updateTransform();var i=this.transform,c=i[4]*a+r,p=i[5]*a+s;this.round_pixels&&(c=0|c+0.5,p=0|p+0.5),n.setTransform(i[0]*a,i[1]*a,i[2]*a,i[3]*a,c,p);var d=this.map_width,l=this.map_height,_=this.tile_width,h=this.tile_height,u=this.map,g=this.tiles,m,f,y,x,v;null===this.bitmap?null!==this.atlas&&(v=this.atlas.bitmap):v=this.bitmap;var A=v.image,w=this.display_width,T=this.display_height;r=w===d?-w>>1:0|(e.camera_x-this.x)/_-(w>>1)+0.5;var S=r;s=T===l?-T>>1:0|(e.camera_y-this.y)/h-(T>>1)+0.5;var b=r*_,k=b,C=s*h;for(r+=d>>1,S=r,s+=l>>1,f=0;f<T;f++){if(0<=s&&s<l)for(r=S,b=k,m=0;m<w&&(0<=r&&(y=u[s*d+r],x=g[y],n.drawAtlasImage(A,x.x,x.y,_-1,h-1,b,C,_+1,h+1)),b+=_,r++,!(r>=d));m++);if(C+=h,s++,s>=l)break}this.postDraw();var P=this.actors.length;if(0<P)for(var R=this.actors,D=0;D<P;D++)R[D].draw()}},'use strict',b5.App=function(e,t){b5.app=this,this.removals=[],this.touched=!1,this.touch_pos={x:0,y:0},this.touch_drag_x=0,this.touch_drag_y=0,this.timer=null,this.last_time=Date.now(),this.dt=0,this.avg_time=0,this.avg_fps=60,this.avg_frame=0,this.canvas_scale=1,this.pixel_ratio=1,this.design_width=e.width,this.design_height=e.height,this.display_width=e.width,this.display_height=e.height,this.canvas_cx=this.design_width>>1,this.canvas_cy=this.design_height>>1,this.order_changed=!0,this.total_loaded=0,this.total_load_errors=0,this.inner_width=b5.Display.getWidth(),this.inner_height=b5.Display.getHeight(),this.fill_screen=!1,this.started=null,this.num_logic=0,this.num_draw=0,this.scenes=[],this.canvas=e,this.canvas_scale_method=b5.App.FitNone,this.touch_supported=this.isTouchSupported(),this.allow_touchables=!0,this.target_frame_rate=60,this.adaptive_physics=!1,this.focus_scene=null,this.focus_scene2=null,this.clear_canvas=!1,this.touch_focus=null,this.prevent_default=!1,this.debug=!1,this.timelines=new b5.TimelineManager,b5.ActionsListManager!==void 0&&(this.actions=new b5.ActionsListManager),this.events=new b5.EventsManager,this.tasks=new b5.TasksManager,this.box2d='undefined'!=typeof Box2D,this.instants='undefined'!=typeof FBInstant,this.loading_screen={background_fill:'#fffff',background_image:'loading.png',bar_background_fill:'#8080ff',bar_fill:'#ffffff'},this.use_web_audio=t||!0,this.bitmaps={},this.brushes={},this.shapes={},this.materials={},this.sounds={},this.fonts={},this.raw={},this.onResourceLoaded=function(e,t){this.onResourceLoadedBase(e,t)},this.display=new b5.Display(this.canvas),this.use_web_audio=b5.Sound.init(this),window.navigator.msPointerEnabled&&(e.addEventListener('MSPointerDown',this.onTouchStart,!1),e.addEventListener('MSPointerMove',this.onTouchMove,!1),e.addEventListener('MSPointerUp',this.onTouchEnd,!1)),e.addEventListener('touchstart',this.onTouchStart,!1),e.addEventListener('touchmove',this.onTouchMove,!1),e.addEventListener('touchend',this.onTouchEnd,!1),e.addEventListener('mousedown',this.onTouchStart,!1),e.addEventListener('mousemove',this.onTouchMove,!1),e.addEventListener('mouseup',this.onTouchEnd,!1),e.addEventListener('mouseout',this.onTouchEnd,!1),window.addEventListener('keypress',this.onKeyPress,!1),window.addEventListener('keydown',this.onKeyDown,!1),window.addEventListener('keyup',this.onKeyUp,!1)},Object.defineProperty(b5.App.prototype,'_focus_scene',{get:function(){return this.focus_scene},set:function(e){this.focus_scene!==e&&(this.focus_scene=b5.Utils.resolveObject(e))}}),Object.defineProperty(b5.App.prototype,'_focus_scene2',{get:function(){return this.focus_scene2},set:function(e){this.focus_scene2!==e&&(this.focus_scene2=b5.Utils.resolveObject(e))}}),b5.App.FitNone=0,b5.App.FitX=1,b5.App.FitY=2,b5.App.FitBest=3,b5.App.FitSize=4,b5.App.FitGreatest=5,b5.App.FitSmallest=6,b5.App.prototype.onKeyPress=function(t){var e=b5.app;null!=e.focus_scene&&e.focus_scene.onKeyPressBase(t)},b5.App.prototype.onKeyDown=function(t){var e=b5.app;null!=e.focus_scene&&e.focus_scene.onKeyDownBase(t)},b5.App.prototype.onKeyUp=function(t){var e=b5.app;null!=e.focus_scene&&e.focus_scene.onKeyUpBase(t)},b5.App.prototype.isTouchSupported=function(){var e=window.navigator.msMaxTouchPoints,t='ontouchstart'in this.canvas;return e||t},b5.App.prototype.onTouchStart=function(t){var e=b5.app;e.touch_supported&&(t.stopPropagation(),e.prevent_default&&t.preventDefault());var o=e.focus_scene,a=e.focus_scene2,n=e.display;if(e.touched=!0,e.touch_pos=e.touch_supported&&void 0!==t.changedTouches?n.getCanvasPoint(t.changedTouches[0].pageX,t.changedTouches[0].pageY):n.getCanvasPoint(t.pageX,t.pageY),null!=o&&o.onBeginTouchBase(e.touch_pos),null!=a&&a.onBeginTouchBase(e.touch_pos),e.allow_touchables){var r=e.findHitActor(e.touch_pos);null!=r&&(e.touch_focus=r,r.onBeginTouchBase(e.touch_pos))}},b5.App.prototype.onTouchEnd=function(t){var e=b5.app;e.touch_supported&&(t.stopPropagation(),e.prevent_default&&t.preventDefault());var o=e.focus_scene,a=e.focus_scene2,n=e.display;if(e.touched=!1,e.touch_pos=e.touch_supported&&void 0!==t.changedTouches?n.getCanvasPoint(t.changedTouches[0].pageX,t.changedTouches[0].pageY):n.getCanvasPoint(t.pageX,t.pageY),null!=o&&o.onEndTouchBase(e.touch_pos),null!=a&&a.onEndTouchBase(e.touch_pos),e.allow_touchables){var r=e.findHitActor(e.touch_pos);null!=r&&r.onEndTouchBase(e.touch_pos),null!=e.touch_focus&&(void 0!==e.touch_focus.onLostTouchFocus&&e.touch_focus.onLostTouchFocus(e.touch_pos),e.touch_focus=null)}},b5.App.prototype.onTouchMove=function(t){var e=b5.app;e.touch_supported&&(t.stopPropagation(),e.prevent_default&&t.preventDefault());var o=e.focus_scene,a=e.focus_scene2,n=e.touch_pos.x,r=e.touch_pos.y,s=e.display;if(e.touch_pos=e.touch_supported&&void 0!==t.changedTouches?s.getCanvasPoint(t.changedTouches[0].pageX,t.changedTouches[0].pageY):s.getCanvasPoint(t.pageX,t.pageY),e.raw_touch_x=t.pageX,e.raw_touch_y=t.pageY,e.touch_drag_x=n-e.touch_pos.x,e.touch_drag_y=r-e.touch_pos.y,null!=o&&o.onMoveTouchBase(e.touch_pos),null!=a&&a.onMoveTouchBase(e.touch_pos),e.allow_touchables){var i=e.findHitActor(e.touch_pos);null!=i&&i.onMoveTouchBase(e.touch_pos)}},b5.App.prototype.addScene=function(e){return this.scenes.push(e),e.app=this,e},b5.App.prototype.removeScene=function(e){this.focus_scene==e&&(this.focus_scene=null),this.removals.push(e)},b5.App.prototype.cleanupDestroyedScenes=function(){var e=this.removals.length;if(0<e)for(var o=this.removals,a=this.scenes,n=a.length,r=0,s;r<e;r++){s=o[r];for(var i=0;i<n;i++)if(s==a[i]){s.release(),a.splice(i,1),n--;break}}this.removals=[]},b5.App.prototype.findScene=function(e){for(var o=this.scenes,a=o.length,n=0;n<a;n++)if(o[n].name==e)return o[n];return null},b5.App.prototype.addResource=function(e,t){var o=b5.Utils.getResFromType(this,t);null!=o&&(o[e.name]=e,e.parent=this)},b5.App.prototype.removeResource=function(e,t){var o=b5.Utils.getResFromType(this,t);null!=o&&(o[e.name]=void 0)},b5.App.prototype.findResource=function(e,t){var o=b5.Utils.getResFromType(this,t);if(null==o)return null;var a=o[e];return void 0===a?(this.debug&&console.log('resource \''+e+'\' ('+t+') not found'),null):a},b5.App.prototype.countResourcesNeedLoading=function(){var e=0,t=this.bitmaps;for(var o in t)t[o].preload&&e++;for(var o in t=this.sounds,t)t[o].preload&&e++;for(var o in t=this.fonts,t)t[o].preload&&e++;for(var o in t=this.raw,t)t[o].preload&&e++;return e},b5.App.prototype.onResourceLoadedBase=function(e,t){e.preload&&b5.app.total_loaded++,t?(e.preload&&b5.app.total_load_errors++,console.log('Error loading resource '+e.name)):this.debug&&console.log('Resource loaded '+e.name),e.loaded=!0},b5.App.prototype.waitForResources=function(e){var t=this;if(null!==t.loading_screen){var o=t.display,a=t.canvas_scale,n=400,r=80;o.setTransform(1,0,0,1,0,0),o.setFillStyle(t.loading_screen.background_fill),o.drawRect(0,0,t.display_width,t.display_height);var s=new Image;s.src=t.loading_screen.background_image,s.onload=function(){o.setTransform(a,0,0,a,t.canvas_cx,t.canvas_cy),o.drawImage(s,-s.width>>1,-s.height>>1,s.width,s.height),o.setFillStyle(t.loading_screen.bar_background_fill),o.drawRoundRect(-n>>1,(t.canvas_height>>2)-(r>>1),n,r,20,!0)}}var i=t.countResourcesNeedLoading(!0),c=setInterval(function(){var a=b5.app.total_loaded;if(a>=i){b5.app.debug&&(console.log('Total resources loaded '+a+' of '+i),console.log('Total resource load errors '+b5.app.total_load_errors)),e!==void 0&&e(a,i),clearInterval(c);var s=setInterval(function(){e!==void 0&&e(i,i),t.start(),clearInterval(s)},1e3)}if(null!==t.loading_screen){var p=n-20,d=r-20,l=a/i;1<l&&(l=1);var y=p*l<<0;o.setFillStyle(t.loading_screen.bar_fill),o.drawRoundRect(-p>>1,(t.canvas_height>>2)-(d>>1),y,d,10,!0)}},100)},b5.App.prototype.draw=function(){for(var e=this.scenes,o=e.length,a=0;a<o;a++)e[a].draw()},b5.App.prototype.update=function(e){var o=b5.app,a=this.scenes,n=a.length;o.dt=e,o.timelines.update(e),o.actions!==void 0&&o.actions.execute(),o.tasks.execute();for(var r=0;r<n;r++)a[r].update(e);this.cleanupDestroyedScenes(),this.order_changed&&(this.order_changed=!1,b5.Utils.sortLayers(this.scenes))},b5.App.prototype.mainLogic=function(){var e=b5.app,t=Date.now(),o=t-e.last_time;e.last_time=t;var a;a=0===e.target_frame_rate?o/1e3:1/e.target_frame_rate,0.1<a&&(a=0.1),e.update(a),e.avg_time+=o,e.avg_frame++,60==e.avg_frame&&(e.avg_frame=0,e.avg_fps=6e4/e.avg_time,e.avg_time=0),e.num_logic++},b5.App.prototype.mainDraw=function(){var e=b5.app,t=0|b5.Display.getWidth()-e.inner_width,o=0|b5.Display.getHeight()-e.inner_height;(0!=t||0!=o)&&e.setCanvasScalingMethod(),e.mainLogic(),e.clear_canvas&&e.display.clear(!0),e.draw(),e.num_draw++,requestAnimationFrame(e.mainDraw)},b5.App.prototype.start=function(){null!==this.started&&this.started(),this.mainDraw(),this.dirty()},b5.App.prototype.findHitActor=function(e){var t=null;return null!==this.focus_scene&&(t=this.focus_scene.findHitActor(e)),null===t&&null!==this.focus_scene2&&(t=this.focus_scene2.findHitActor(e)),t},b5.App.prototype.dirty=function(){for(var e=this.scenes,o=e.length,a=0;a<o;a++)e[a].dirty()},b5.App.prototype.setCanvasScalingMethod=function(e){void 0!==e&&(this.canvas_scale_method=e);var t=this.design_width,o=this.design_height,a=b5.Display.getWidth(),n=b5.Display.getHeight();if(!this.fill_screen){var r=!0;switch(this.canvas_scale_method){case b5.App.FitX:r=!0;break;case b5.App.FitY:r=!1;break;case b5.App.FitBest:r=!!(a/t<n/o);break;case b5.App.FitGreatest:r=!!(a>n);break;case b5.App.FitSmallest:r=!!(a<n);}r?n=a*this.design_height/this.design_width:a=n*this.design_width/this.design_height}this.inner_width=a,this.inner_height=n;var s=t,i=o,c=1,p=1;if(this.canvas_scale=1,this.canvas_scale_method===b5.App.FitNone);else if(this.canvas_scale_method===b5.App.FitSize)s=a,i=n;else{s=a,i=n,c=s/t,p=i/o;var d=1;switch(this.canvas_scale_method){case b5.App.FitX:d=c;break;case b5.App.FitY:d=p;break;case b5.App.FitBest:d=c<p?c:p;break;case b5.App.FitGreatest:d=s>i?c:p;break;case b5.App.FitSmallest:d=s<i?c:p;}this.canvas_scale=d}var l=0|s*this.pixel_ratio,y=0|i*this.pixel_ratio;this.canvas.width=l,this.canvas.height=y,this.canvas.style.width=s+'px',this.canvas.style.height=i+'px',this.canvas_cx=s/2,this.canvas_cy=i/2,this.display_width=s,this.display_height=i,this.dirty()},b5.App.prototype.parseAndSetFocus=function(e){new b5.Xoml(this).parseResources(this,[b5.data[e]]),this.order_changed=!0,this.focus_scene=this.findScene(e)},b5.App.prototype.addTask=function(e,t,o,a,n){return this.tasks.add(e,t,o,a,n)},b5.App.prototype.removeTask=function(e){this.tasks.remove(e)},'use strict',b5.Scene=function(){this.app=null,this.actors=[],this.removals=[],this.world=null,this.timelines=new b5.TimelineManager,b5.ActionsListManager!==void 0&&(this.actions=new b5.ActionsListManager),this.tasks=new b5.TasksManager,this.events=new b5.EventsManager,this.order_changed=!0,this.name='',this.tag='',this.active=!0,this.visible=!0,this.layer=0,this.x=0,this.y=0,this.w=1024,this.h=768,this.clip_children=!0,this.clip_shape=null,this.camera_x=0,this.camera_y=0,this.camera_vx=0,this.camera_vy=0,this.vx_damping=1,this.vy_damping=1,this.follow_speed_x=0.3,this.follow_speed_y=0.3,this.target_x=null,this.target_y=null,this.touch_pan_x=!1,this.touch_pan_y=!1,this.panning=!1,this.min_panning=0,this.world_scale=20,this.time_step=0,this.extents=[0,0,0,0],this.opacity=1,this.frame_count=0,this.touching=!1,this.touchmove=!1,this.draw_reverse=!1,this.bitmaps=[],this.brushes=[],this.shapes=[],this.materials=[],this.sounds=[],this.fonts=[],this.raw=[]},Object.defineProperty(b5.Scene.prototype,'_x',{get:function(){return this.x},set:function(e){this.x!==e&&(this.x=e)}}),Object.defineProperty(b5.Scene.prototype,'_y',{get:function(){return this.y},set:function(e){this.y!==e&&(this.y=e)}}),Object.defineProperty(b5.Scene.prototype,'_layer',{get:function(){return this.layer},set:function(e){this.layer!==e&&(this.layer=e,this.app.order_changed=!0)}}),Object.defineProperty(b5.Scene.prototype,'_clip_shape',{get:function(){return this.clip_shape},set:function(e){this.clip_shape!==e&&(this.clip_shape=b5.Utils.resolveResource(e,'shape'))}}),Object.defineProperty(b5.Scene.prototype,'_av',{set:function(e){this.visible=e,this.active=e}}),b5.Scene.prototype.release=function(){this.onDestroy!==void 0&&this.onDestroy(),this.world=null,this.actors=null},b5.Scene.prototype.destroy=function(){this.app.removeScene(this)},b5.Scene.prototype.addActor=function(e){return this.actors.push(e),e.scene=this,e},b5.Scene.prototype.removeActor=function(e){this.removals.push(e)},b5.Scene.prototype.removeActorsWithTag=function(e){for(var o=this.actors,a=o.length,n=this.removals,r=0;r<a;r++)o[r].tag===e&&n.push(o[r])},b5.Scene.prototype.cleanupDestroyedActors=function(){var e=this.removals.length;if(0<e)for(var o=this.removals,a=this.actors,n=a.length,r=0,s;r<e;r++){s=o[r];for(var i=0;i<n;i++)if(s===a[i]){s.release(),a.splice(i,1),n--;break}}this.removals=[]},b5.Scene.prototype.findActor=function(e,o){o===void 0&&(o=!1);for(var a=this.actors,n=a.length,r=0;r<n;r++){if(a[r].name===e)return a[r];if(o){var t=a[r].findActor(e,o);if(null!==t)return t}}return null},b5.Scene.prototype.findActorById=function(e,o){o===void 0&&(o=!1);for(var a=this.actors,n=a.length,r=0;r<n;r++){if(a[r].id===e)return a[r];if(o){var t=a[r].findActorById(e,o);if(null!==t)return t}}return null},b5.Scene.prototype.bringToFront=function(){for(var e=this.app.scenes,o=e.length,a=-1,n=0;n<o;n++)if(e[n]===this){a=n;break}0<=a&&(e.splice(a,1),e.push(this))},b5.Scene.prototype.sendToBack=function(){for(var e=this.app.scenes,o=e.length,a=-1,n=0;n<o;n++)if(e[n]===this){a=n;break}0<=a&&(e.splice(a,1),e.unshift(this))},b5.Scene.prototype.onKeyPressBase=function(t){this.onKeyPress!==void 0&&this.onKeyPress(t)},b5.Scene.prototype.onKeyDownBase=function(t){this.onKeyDown!==void 0&&this.onKeyDown(t)},b5.Scene.prototype.onKeyUpBase=function(t){this.onKeyUp!==void 0&&this.onKeyUp(t)},b5.Scene.prototype.onBeginTouchBase=function(e){this.touching=!0,this.onBeginTouch!==void 0&&this.onBeginTouch(e)},b5.Scene.prototype.onEndTouchBase=function(e){this.touching&&this.onTapped!==void 0&&this.onTapped(e),this.touching=!1,this.touchmove=!1,this.onEndTouch!==void 0&&this.onEndTouch(e),this.panning=!1},b5.Scene.prototype.onMoveTouchBase=function(e){if(this.touchmove=!0,void 0!==this.onMoveTouch&&this.onMoveTouch(e),this.touching){var t=this.app,o=0;this.touch_pan_x&&(o=t.touch_drag_x,this.camera_vx=o*t.target_frame_rate,this.camera_x+=o),this.touch_pan_y&&(o=t.touch_drag_y,this.camera_vy=o*t.target_frame_rate,this.camera_y+=o),t.touch_drag_x*t.touch_drag_x+t.touch_drag_y*t.touch_drag_y>this.min_panning&&(this.panning=!0)}},b5.Scene.prototype.initWorld=function(e,t,o){if(this.app.box2d){this.world=new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(e,t),o);var a=new Box2D.Dynamics.b2ContactListener;a.BeginContact=function(e){var t=e.GetFixtureA().GetBody().GetUserData();void 0!==t.onCollisionStart&&t.onCollisionStart(e),t=e.GetFixtureB().GetBody().GetUserData(),void 0!==t.onCollisionStart&&t.onCollisionStart(e)},a.EndContact=function(e){var t=e.GetFixtureA().GetBody().GetUserData();void 0!==t.onCollisionEnd&&t.onCollisionEnd(e),t=e.GetFixtureB().GetBody().GetUserData(),void 0!==t.onCollisionEnd&&t.onCollisionEnd(e)},this.world.SetContactListener(a)}},b5.Scene.prototype.draw=function(){if(this.visible){var e=this.app,o=e.canvas_scale,a=e.display;if(this.clip_children){var n=e.canvas_cx+this.x,r=e.canvas_cy+this.y;if(a.setTransform(o,0,0,o,n,r),a.saveContext(),null===this.clip_shape)a.clipRect(-this.w/2,-this.h/2,this.w,this.h);else{var s=this.clip_shape;this.clip_shape.type===b5.Shape.TypeBox?a.clipRect(0,0,s.width,s.height):this.clip_shape.type===b5.Shape.TypeCircle?a.clipArc(0,0,s.width,0,2*Math.PI):this.clip_shape.type===b5.Shape.TypePolygon&&a.clipPolygon(s.vertices)}}var i=this.actors,c=i.length;if(this.draw_reverse)for(var p=c-1;0<=p;p--)i[p].draw();else for(var p=0;p<c;p++)i[p].draw();this.clip_children&&a.restoreContext()}},b5.Scene.prototype.baseUpdate=function(e){if(!this.active)return!1;void 0!==this.onTick&&this.onTick(e),this.timelines.update(e),void 0!==this.actions&&this.actions.execute(),this.tasks.execute(),this.updateCamera(e);for(var o=this.actors,a=o.length,n=0;n<a;n++)o[n].update(e);if(null!==this.world){var t=b5.app;if(0===this.time_step)this.world.Step(e,10,10);else{var r=1;t.adaptive_physics&&(r=t.target_frame_rate/t.avg_fps+0.5<<0,1>r?r=1:3<r&&(r=3));for(var n=0;n<r;n++)this.world.Step(this.time_step,10,10)}}return null!==this.world&&this.world.ClearForces(),this.frame_count++,this.cleanupDestroyedActors(),this.order_changed&&(this.order_changed=!1,b5.Utils.sortLayers(this.actors)),!0},b5.Scene.prototype.update=function(e){return this.baseUpdate(e)},b5.Scene.prototype.updateCamera=function(e){if(null!==this.target_x&&(0===this.follow_speed_x?(this.camera_x=this.target_x.x,this.camera_vx=0):this.camera_vx+=(this.target_x.x-this.camera_x)*this.follow_speed_x),null!==this.target_y&&(0===this.follow_speed_y?(this.camera_y=this.target_y.y,this.camera_vy=0):this.camera_vy+=(this.target_y.y-this.camera_y)*this.follow_speed_y),this.touching||(this.camera_x+=this.camera_vx*e,this.camera_y+=this.camera_vy*e,this.camera_vx*=this.vx_damping,this.camera_vy*=this.vy_damping),0!==this.camera_x||0!==this.camera_y){var t=this.extents[2],o=this.extents[3],a=this.app.design_width,n=this.app.design_height;if(0!==t&&a<=t){var r=a/2,s=this.extents[0]+r,i=this.extents[0]+t-r;this.camera_x<s&&(this.camera_x=s,this.camera_vx=0),this.camera_x>i&&(this.camera_x=i,this.camera_vx=0)}if(a>t&&(this.camera_x=0),0!==o&&n<=o){var c=n/2,p=this.extents[1]+c,d=this.extents[1]+o-c;this.camera_y<p&&(this.camera_y=p,this.camera_vy=0),this.camera_y>d&&(this.camera_y=d,this.camera_vy=0)}n>o&&(this.camera_y=0)}},b5.Scene.prototype.findHitActor=function(e){for(var o=this.actors,a=o.length,n=null,r=a-1;0<=r;r--)if(n=o[r].hitTest(e),null!==n)return n;return n},b5.Scene.prototype.dirty=function(){for(var e=this.actors,o=e.length,a=0;a<o;a++)e[a].dirty()},b5.Scene.prototype.addResource=function(e,t){if(t===void 0)throw'Resource type not specified';var o=b5.Utils.getResFromType(this,t);null!==o&&(o.push(e),e.parent=this)},b5.Scene.prototype.removeResource=function(e,o){var a=b5.Utils.getResFromType(this,o);if(null!==a)for(var n=a.length,r=0;r<n;r++)if(a[r]===e)return a.parent=null,void a.splice(r,1)},b5.Scene.prototype.playTimeline=function(e){this.active||(this.active=!0,this.visible=!0);var t=this.timelines.find(e);null!==t&&t.restart()},b5.Scene.prototype.addTask=function(e,t,o,a,n){this.tasks.add(e,t,o,a,n)},b5.Scene.prototype.removeTask=function(e){this.tasks.remove(e)},b5.Scene.prototype.findResource=function(e,o){var a=b5.Utils.getResFromType(this,o);if(null===a)return null;for(var n=a.length,r=0;r<n;r++)if(a[r].name===e)return a[r];return this.app.findResource(e,o)},b5.Scene.prototype.areResourcesLoaded=function(){for(var e=this.bitmaps,o=e.length,a=0;a<o;a++)if(e[a].preload&&!e[a].loaded)return!1;return!0},b5.Scene.prototype.countResourcesNeedLoading=function(){for(var e=0,o=this.bitmaps,a=o.length,n=0;n<a;n++)o[n].preload&&e++;for(o=this.sounds,a=o.length,n=0;n<a;n++)o[n].preload&&e++;for(o=this.fonts,a=o.length,n=0;n<a;n++)o[n].preload&&e++;for(o=this.raw,a=o.length,n=0;n<a;n++)o[n].preload&&e++;return e},'use strict',b5.Xoml=function(e){this.current_scene=null,this.app=e},b5.Xoml.prototype.parseScene=function(e,o){this.app.debug&&console.log('Parsing Scene '+o.Name);var a=new b5.Scene;null!==e&&(e.addScene(a),o.Current?e.focus_scene=a:o.Current2&&(e.focus_scene2=a)),this.current_scene=a,a.name=o.Name,void 0!==o.Tag&&(a.tag=o.Tag),a.x=o.Position[0],a.y=o.Position[1],void 0!==o.CanvasSize&&(a.w=o.CanvasSize[0],a.h=o.CanvasSize[1]),void 0!==o.Layer&&(a.layer=o.Layer),void 0!==o.Visible&&(a.visible=o.Visible),void 0!==o.Active&&(a.active=o.Active),void 0!==o.Physics&&o.Physics&&(a.initWorld(o.Gravity[0],o.Gravity[1],o.DoSleep),void 0!==o.PhysicsTimestep&&(a.time_step=o.PhysicsTimestep),void 0!==o.WorldScale&&(a.world_scale=o.WorldScale)),void 0!==o.ClipChildren&&(a.clip_children=o.ClipChildren),'Both'===o.TouchPan?(a.touch_pan_x=!0,a.touch_pan_y=!0):'X'===o.TouchPan?a.touch_pan_x=!0:'Y'===o.TouchPan&&(a.touch_pan_y=!0),a.extents[0]=o.Extents[0],a.extents[1]=o.Extents[1],a.extents[2]=o.Extents[2],a.extents[3]=o.Extents[3],a.follow_speedx=o.FollowSpeed[0],a.follow_speedy=o.FollowSpeed[1];var n=o.UserProps;if(void 0!==n)for(var r=0;r<n.length;r++)a[n[r].N]=n[r].V;var t=o.TimelineCollection;if(void 0!==t)for(var r=0;r<t.length;r++)this.parseTimeline(a,t[r]);var s=o.ActionsList;if(void 0!==s)for(var r=0;r<s.length;r++)this.parseActionsList(a,s[r]);return void 0!==o.Alpha&&(a.opacity=o.Alpha),void 0===o.Cn||this.parseResources(a,o.Cn),void 0!==o.ClipShape&&''!==o.ClipShape&&(a.clip_shape=a.findResource(o.ClipShape,'shape')),''!==o.TargetX&&(a.target_x=a.findActor(o.TargetX)),''!==o.TargetY&&(a.target_y=a.findActor(o.TargetY)),void 0!==o.VelocityDamping&&(a.vx_damping=o.VelocityDamping[0],a.vy_damping=o.VelocityDamping[1]),void 0!==o.OnCreate&&(a.onCreate=Function(o.OnCreate)),void 0!==o.OnDestroy&&(a.onDestroy=Function(o.OnDestroy)),void 0!==o.OnTick&&(a.onTick=Function('dt',o.OnTick)),void 0!==o.OnTapped&&(a.onTapped=Function('touch_pos',o.OnTapped)),void 0!==o.OnBeginTouch&&(a.onBeginTouch=Function('touch_pos',o.OnBeginTouch)),void 0!==o.OnEndTouch&&(a.onEndTouch=Function('touch_pos',o.OnEndTouch)),void 0!==o.OnMoveTouch&&(a.onMoveTouch=Function('touch_pos',o.OnMoveTouch)),void 0!==o.OnKeyPress&&(a.onKeyPress=Function('e',o.OnKeyPress)),void 0!==o.OnKeyDown&&(a.onKeyDown=Function('e',o.OnKeyDown)),void 0!==o.OnKeyUp&&(a.onKeyUp=Function('e',o.OnKeyUp)),void 0!==a.onCreate&&a.onCreate(),a},b5.Xoml.prototype.parseBrush=function(e,o){this.app.debug&&console.log('Parsing Brush '+o.N);var a;if(0===o.BT){var n=o.RC,r=e.findResource(o.I,'bitmap'),s=o.F;if(0===s.length)a=new b5.ImageAtlas(o.N,r,n[0],n[1],n[2],n[3],n[4],n[5]);else{a=new b5.ImageAtlas(o.N,r);for(var i=0,t;i<s.length;i++)t=s[i],a.addFrame(t[0],t[1],t[2],t[3],t[5],t[6])}var c=o.AN;if(void 0!==c&&0!==c.length)for(var i=0;i<c.length;i++)a.addAnim(c[i].N,c[i].F,c[i].S)}else{var p=o.ST;a=new b5.Gradient(o.N);for(var i=0,d;i<p.length;i++)d=p[i],a.addColourStop(d.c,d.o);void 0!==o.Angle&&(a.angle=o.Angle)}return e.addResource(a,'brush'),a},b5.Xoml.prototype.parseRaw=function(e,t){this.app.debug&&console.log('Parsing Raw '+t.N);var o=new b5.Raw(t.N,t.Loc,t.P);return e.addResource(o,'raw'),o},b5.Xoml.prototype.parseImage=function(e,t){this.app.debug&&console.log('Parsing Image '+t.N);var o=new b5.Bitmap(t.N,t.Loc,t.P);return e.addResource(o,'bitmap'),o},b5.Xoml.prototype.parseSound=function(e,t){this.app.debug&&console.log('Parsing Sound '+t.N);var o=new b5.Sound(t.N,t.Loc,t.R);return void 0!==t.P&&(o.preload=1==t.P),void 0!==t.A&&(o.auto_play=1==t.A),void 0!==t.Loc2&&(o.location2=t.Loc2),void 0!==t.L&&(o.loop=1==t.L),o.preload&&o.load(),e.addResource(o,'sound'),o},b5.Xoml.prototype.parseFont=function(e,t){this.app.debug&&console.log('Parsing Font '+t.Name);var o=new b5.Font(t.Name,t.Name,t.Preload);e.addResource(o,'font')},b5.Xoml.prototype.parseShape=function(e,o){this.app.debug&&console.log('Parsing Shape '+o.N);var a=new b5.Shape(o.N);if(a.width=o.W,a.height=o.H,'Circle'===o.ST)a.type=b5.Shape.TypeCircle;else if('Box'===o.ST)a.type=b5.Shape.TypeBox;else if('Polygon'===o.ST){a.type=b5.Shape.TypePolygon;for(var n=o.V,r=n.length,i=0;i<r;i++)a.vertices.push(n[i]);if(void 0!==o.CV)for(var t=o.CV.length,i=0;i<t;i++){var c=[],n=o.CV[i];r=n.length;for(var p=0;p<r;p++)c.push(n[p]);a.convexVertices.push(c)}}return e.addResource(a,'shape'),a},b5.Xoml.prototype.parseMaterial=function(e,t){this.app.debug&&console.log('Parsing Material '+t.N);var o=new b5.Material;return o.name=t.N,o.type=t.MT,o.density=t.D,o.friction=t.F,o.restitution=t.R,o.gravity_scale=t.GS,o.fixed_rotation=t.FR,o.is_bullet=t.IB,e.addResource(o,'material'),o},b5.Xoml.prototype.parseTimeline=function(e,o){var a=new b5.Timeline;o.N!==void 0&&(a.name=o.N);for(var n=o.A.length,r=0;r<n;r++){var t=o.A[r],s=new b5.Animation(a,e,t.P,t.V,t.TI,0,t.E);if(void 0!==t.T&&(s.tween=t.T),void 0!==t.D&&(s.destroy=t.D),void 0!==t.R&&(s.repeat=t.R),s.repeats_left=s.repeat,void 0!==t.TS&&(s.time_scale=t.TS),void 0!==t.DA&&(s.deactivate=t.DA),void 0!==t.DE&&(s.delay=-t.DE),!1===t.A&&s.pause(),void 0!==t.OnE&&(s.onEnd=Function(t.OnE)),void 0!==t.OnR&&(s.onRepeat=Function(t.OnR)),void 0!==t.AC)for(var i=0;i<t.AC.length;i++)if(''!==t.Actions[i]){var c=t.AC[i];s.setAction(i,Function(c))}a.anims.push(s)}e.timelines.add(a)},b5.Xoml.prototype.parseActionsList=function(e,o){var a=new b5.ActionsList;o.N!==void 0&&(a.name=o.N),o.R!==void 0&&(a.repeats_left=o.R,a.repeat=o.R),a.destroy=!1;for(var n=o.A,r=n.length,s=0;s<r;s++){var t=n[s][0],i;'Custom'===t&&(t=n[s][1],n[s].splice(0,1)),i=b5.ActionsRegister.create(t,n[s]),a.actions.push(i)}o.P!==void 0&&o.P&&a.play(),e.actions.add(a)},b5.Xoml.prototype.parseActor=function(e,o,a){var n=null;if(e.scene=this.current_scene,void 0!==a.N&&(e.name=a.N),void 0!==a.T&&(e.tag=a.T),void 0!==a.V&&(e.visible=a.V),void 0!==a.Ac&&(e.active=a.Ac),void 0!==a.L&&(e.layer=a.L),void 0!==a.P&&(e.x=a.P[0],e.y=a.P[1]),void 0!==a.S&&(e.scale_x=a.S[0],e.scale_y=a.S[1]),void 0!==a.SM&&(e.scale_method=a.SM),void 0!==a.FX&&a.FX&&(e.scale_x=-e.scale_x),void 0!==a.FY&&a.FY&&(e.scale_y=-e.scale_y),void 0!==a.Or&&(e.orphaned=a.Or),void 0!==a.A&&(e.rotation=a.A),void 0!==a.C&&(e.fill_style=a.C),void 0!==a.SC&&(e.stroke_style=a.SC),void 0!==a.F&&(e.filled=a.F),void 0!==a.FS&&(e.stroke_filled=a.FS),void 0!==a.Th&&(e.stroke_thickness=a.Th),void 0!==a.Sz&&(e.w=a.Sz[0],e.h=a.Sz[1],e.ow=a.Sz[0],e.oh=a.Sz[1]),void 0!==a.O&&(e.ox=a.O[0],e.oy=a.O[1]),e.absolute_origin=-1>=e.ox||1<=e.ox||-1>=e.oy||1<=e.oy,void 0!==a.Al&&(e.opacity=a.Al),void 0!==a.SAl&&(e.stroke_opacity=a.SAl),void 0!==a.UPO&&(e.use_parent_opacity=a.UPO),void 0!==a.D&&(e.depth=a.D),e.use_transform=!0,void 0!==a.Ve&&(e.vx=a.Ve[0],e.vy=a.Ve[1]),void 0!==a.AV&&(e.vr=a.AV),void 0!==a.VD&&(e.vx_damping=a.VD[0],e.vy_damping=a.VD[1]),void 0!==a.AVD&&(e.vr_damping=a.AVD),void 0!==a.WP&&(e.wrap_position=a.WP),void 0!==a.IC&&(e.ignore_camera=a.IC),void 0!==a.CC&&(e.clip_children=a.CC),void 0!==a.To&&(e.touchable=a.To),void 0!==a.Ht&&(e.hit=a.Ht),void 0!==a.Bu&&(e.bubbling=a.Bu),void 0!==a.Do){var r=a.Do;void 0!==a.Dse&&(e.dock_screen=a.Dse),'top'===r||'topleft'===r||'topright'===r?e.dock_y=b5.Actor.Dock_Top:('bottom'===r||'bottomleft'===r||'bottomright'===r)&&(e.dock_y=b5.Actor.Dock_Bottom),'left'===r||'topleft'===r||'bottomleft'===r?e.dock_x=b5.Actor.Dock_Left:('right'===r||'topright'===r||'bottomright'===r)&&(e.dock_x=b5.Actor.Dock_Right)}if(void 0!==a.M&&(e.margin[0]=a.M[0],e.margin[1]=a.M[1],e.margin[2]=a.M[2],e.margin[3]=a.M[3]),void 0!==a.CM&&(e.clip_margin[0]=a.CM[0],e.clip_margin[1]=a.CM[1],e.clip_margin[2]=a.CM[2],e.clip_margin[3]=a.CM[3]),void 0!==a.Sh&&(e.shadow=a.Sh),void 0!==a.ShO&&(e.shadow_x=a.ShO[0],e.shadow_y=a.ShO[1]),void 0!==a.ShB&&(e.shadow_blur=a.ShB),void 0!==a.ShC&&(e.shadow_colour=a.ShC),void 0!==a.CO&&(e.composite_op=a.CO),void 0!==a.BG)if(n=this.current_scene.findResource(a.BG,'brush'),void 0!==n.stops){var s={x:0,y:0},i={x:0,y:1};void 0!==a.GS&&(s.x=a.GS[0],s.y=a.GS[1]),void 0!==a.GE&&(i.x=a.GE[0],i.y=a.GE[1]);var c=n.createStyle(e.w,e.h,s,i);e.filled?e.fill_style=c:e.stroke_filled&&(e.stroke_style=c)}else e.atlas=n;if(void 0!==a.DA&&null!==n&&e.playAnim(a.DA),3===a.RA){var p=a.TX,d=a.TY;e.map_width=a.MW,e.map_height=a.MH,e.tile_width=a.TW,e.tile_height=a.TH,e.display_width=a.DW,e.display_height=a.DH,e.map=a.Map,e.collision_map=a.CMap,e.generateTiles(p*d,e.tile_width,e.tile_height,e.tile_width*p)}null!==o&&o.addActor(e),void 0!==a.OnC&&(e.onCreate=Function(a.OnC)),void 0!==a.OnD&&(e.onDestroy=Function(a.OnD)),void 0!==a.OnTi&&(e.onTick=Function('dt',a.OnTi)),void 0!==a.OnT&&(e.touchable=!0,e.onTapped=Function('touch_pos',a.OnT)),void 0!==a.OnB&&(e.touchable=!0,e.onBeginTouch=Function('touch_pos',a.OnB)),void 0!==a.OnE&&(e.touchable=!0,e.onEndTouch=Function('touch_pos',a.OnE)),void 0!==a.OnM&&(e.touchable=!0,e.onMoveTouch=Function('touch_pos',a.OnM)),void 0!==a.OnL&&(e.touchable=!0,e.onLostTouchFocus=Function('touch_pos',a.OnL)),void 0!==a.OnCS&&(e.onCollisionStart=Function('contact',a.OnCS)),void 0!==a.OnCE&&(e.onCollisionEnd=Function('contact',a.OnCE));var l=a.UP;if(void 0!==l)for(var y=0;y<l.length;y++)e[l[y].N]=l[y].V;var t=a.Fxs;if(void 0!==t)for(var y=0;y<t.length;y++){var _={},h=null,u=null;void 0!==t[y].M&&''!==t[y].M&&(h=this.current_scene.findResource(t[y].M,'material')),void 0!==t[y].S&&''!==t[y].S&&(u=this.current_scene.findResource(t[y].S,'shape')),0===y&&e.initBody(h.type,h.fixed_rotation,h.is_bullet),null===u?1===a.RA?(_.type=b5.Shape.TypeCircle,_.width=e.w/2):(_.type=b5.Shape.TypeBox,_.width=e.w,_.height=e.h):_.shape=u,null!==h&&(_.material=h),_.is_sensor=t[y].R,void 0!==t[y].C&&(_.collision_category=t[y].C[0],_.collision_mask=t[y].C[1],_.collision_group=t[y].C[2]),e.addFixture(_)}var g=a.Jts;if(void 0!==g)for(var y=0;y<g.length;y++){var _=[],m=this.current_scene.findActor(g[y].AB);_.type=g[y].T,_.actor_b=m,_.anchor_a={x:g[y].OA[0],y:g[y].OA[1]},_.anchor_b={x:g[y].OB[0],y:g[y].OB[1]},_.self_collide=g[y].SC,_.damping=g[y].D,_.frequency=g[y].F,_.limit_joint=g[y].LJ,_.lower_limit=g[y].LL,_.upper_limit=g[y].UL,_.motor_enabled=g[y].ME,_.motor_speed=g[y].MS,_.max_motor_torque=g[y].MT,_.max_motor_force=g[y].MF,_.ground_a={x:g[y].GA[0],y:g[y].GA[1]},_.ground_b={x:g[y].GB[0],y:g[y].GB[1]},_.axis={x:g[y].A[0],y:g[y].A[1]},_.ratio=g[y].R,e.addJoint(_)}var f=a.TC;if(void 0!==f)for(var y=0;y<f.length;y++)this.parseTimeline(e,f[y]);var x=a.AL;if(void 0!==x)for(var y=0;y<x.length;y++)this.parseActionsList(e,x[y]);if(null!==e.body){var v=Box2D.Common.Math.b2Vec2;e.body.SetLinearVelocity(new v(e.vx,e.vy)),e.body.SetAngularVelocity(e.vr),e.body.SetLinearDamping(e.vx_damping),e.body.SetAngularDamping(e.vr_damping)}return void 0!==a.Cn&&this.parseResources(e,a.Cn),e},b5.Xoml.prototype.parseIcon=function(e,t){this.app.debug&&console.log('Parsing Icon '+t.N);var o=0,a;if(void 0!==t.RA&&(o=t.RA),1===o)a=new b5.ArcActor;else if(2===o)a=new b5.RectActor;else if(3===o)a=new b5.MapActor;else if(0===o)if(void 0!==t.Geo){a=new b5.PolygonActor;var n=this.current_scene.findResource(t.Geo,'shape');null!==n&&(a.points=n.vertices)}else a=new b5.Actor;return void 0!==t.CR&&(a.corner_radius=t.CR),this.parseActor(a,e,t),1===o&&(a.radius=a.w/2),void 0!==t.Vi&&t.Vi&&(a.makeVirtual(),void 0!==t.SR&&(a.scroll_range[0]=t.SR[0],a.scroll_range[1]=t.SR[1],a.scroll_range[2]=t.SR[2],a.scroll_range[3]=t.SR[3]),void 0!==t.SPos&&(a.scroll_pos_x=t.SPos[0],a.scroll_pos_y=t.SPos[1])),void 0!==t.IAS&&(a.ignore_atlas_size=t.IAS),void 0!==t.SCl&&(a.self_clip=t.SCl),void 0!==t.CS&&(a.clip_shape=this.current_scene.findResource(t.CS,'shape')),!0===t.Ca&&(a.cache=!0),!0===t.Me&&(a.merge_cache=!0),!0===t.Rd&&(a.round_pixels=!0),void 0!==a.onCreate&&a.onCreate(),a},b5.Xoml.prototype.parseLabel=function(e,t){this.app.debug&&console.log('Parsing Label '+t.N);var o=new b5.LabelActor;return o.text=t.Text,o.font=t.Font,o.text_align=t.AlignH,o.text_baseline=t.AlignV,this.parseActor(o,e,t),void 0!==t.Pd&&(o.padding=t.Pd),void 0!==t.Lh&&(o.line_height=t.Lh),!0===t.Ca&&(o.cache=!0),!0===t.Me&&(o.merge_cache=!0),!0===t.Rd&&(o.round_pixels=!0),void 0!==o.onCreate&&o.onCreate(),o},b5.Xoml.prototype.parseResources=function(e,o){for(var a=o.length,n=0;n<a;n++)this.parseResource(e,o[n])},b5.Xoml.prototype.parseResource=function(e,t){var o=t.RT;if('Scene'===o)return this.parseScene(e,t);return'Brush'===o?this.parseBrush(e,t):'Image'===o?this.parseImage(e,t):'Sound'===o?this.parseSound(e,t):'Font'===o?this.parseFont(e,t):'Shape'===o?this.parseShape(e,t):'Material'===o?this.parseMaterial(e,t):'Icon'===o?this.parseIcon(e,t):'Label'===o?this.parseLabel(e,t):'GFile'===o?this.parseRaw(e,t):null},b5.Xoml.findResource=function(e,o,a){e.Cn!==void 0&&(e=e.Cn);for(var n=e.length,r=0;r<n;r++)if(e[r].RT.toLowerCase()===a&&e[r].N===o)return e[r];return null},'use strict',b5.Maths=function(){},b5.Maths.mulMatrix=function(e,t){var o=t[0],a=t[1],n=t[2],r=t[3],s=t[4],i=t[5],c=e[0],p=e[1],d=e[2],l=e[3],y=e[4],_=e[5];e[0]=o*c+n*p,e[1]=a*c+r*p,e[2]=o*d+n*l,e[3]=a*d+r*l,e[4]=o*y+n*_+s,e[5]=a*y+r*_+i},b5.Maths.preMulMatrix=function(e,t){var o=e[0],a=e[1],n=e[2],r=e[3],s=e[4],i=e[5],c=t[0],p=t[1],d=t[2],l=t[3],y=t[4],_=t[5];e[0]=o*c+n*p,e[1]=a*c+r*p,e[2]=o*d+n*l,e[3]=a*d+r*l,e[4]=o*y+n*_+s,e[5]=a*y+r*_+i},b5.Maths.vecMulMatrix=function(e,t,o){var a=e*o[0]+t*o[2]+o[4],n=e*o[1]+t*o[3]+o[5];return{x:a,y:n}},'use strict',b5.Display=function(e){this.canvas=e,this.cache_ctx=null,this.context=e.getContext('2d'),this.context.lineWidth=1,this.context.strokeStyle='black',this.context.fillStyle='black',this.context.globalAlpha=1,this.context.lineJoin='round',this.context.lineCap='round';var t=b5.Utils.GetDevicePixelRatio(),o=b5.Utils.GetBackingStorePixelRatio(this.context);t!==o&&(b5.app.pixel_ratio=t/o)},b5.Display.getWidth=function(){return document.documentElement.clientWidth},b5.Display.getHeight=function(){return document.documentElement.clientHeight},b5.Display.prototype.getCanvasPoint=function(e,t){var o=b5.app,a=o.canvas_scale;return{x:(e-this.canvas.offsetLeft-o.canvas_cx)/a,y:(t-this.canvas.offsetTop-o.canvas_cy)/a}},b5.Display.prototype.clear=function(){var e=b5.app,t=this.context,o=b5.app.pixel_ratio;t.setTransform(1*o,0,0,1*o,0,0),t.clearRect(0,0,e.display_width,e.display_height)},b5.Display.prototype.drawPolygon=function(e,t,o,a){var n=this.context;null!==this.cache_ctx&&(n=this.cache_ctx);var r=o.length;n.beginPath(),n.moveTo(o[0]+e,o[1]+t);for(var s=2;s<r;s+=2)n.lineTo(o[s]+e,o[s+1]+t);return a?n.fill():(n.lineTo(o[0]+e,o[1]+t),n.stroke()),this},b5.Display.prototype.drawLine=function(e,t,o,a){var n=this.context;return null!==this.cache_ctx&&(n=this.cache_ctx),n.beginPath(),n.moveTo(e,t),n.lineTo(o,a),n.stroke(),this},b5.Display.prototype.drawRect=function(e,t,o,a,n){var r=this.context;return null!==this.cache_ctx&&(r=this.cache_ctx),n?r.fillRect(e,t,o,a):r.strokeRect(e,t,o,a),this},b5.Display.prototype.drawRoundRect=function(e,t,o,a,n,r){var s=this.context;null!==this.cache_ctx&&(s=this.cache_ctx),s.beginPath(),s.moveTo(e+n,t),s.lineTo(e+o-n,t),s.quadraticCurveTo(e+o,t,e+o,t+n),s.lineTo(e+o,t+a-n),s.quadraticCurveTo(e+o,t+a,e+o-n,t+a),s.lineTo(e+n,t+a),s.quadraticCurveTo(e,t+a,e,t+a-n),s.lineTo(e,t+n),s.quadraticCurveTo(e,t,e+n,t),s.closePath(),r?s.fill():s.stroke()},b5.Display.prototype.drawArc=function(e,t,o,a,n,r){var s=this.context;return null!==this.cache_ctx&&(s=this.cache_ctx),s.beginPath(),s.arc(e,t,o,a,n),r?s.fill():s.stroke(),this},b5.Display.prototype.drawAtlasImage=function(e,t,o,a,n,r,s,i,c){if(!(0>=e.width||0>=e.height)){var p=this.context;null!==this.cache_ctx&&(p=this.cache_ctx),p.drawImage(e,t,o,a,n,r,s,i,c)}},b5.Display.prototype.drawImage=function(e,t,o,a,n){if(!(0>=e.width||0>=e.height)){var r=this.context;null!==this.cache_ctx&&(r=this.cache_ctx),void 0===a?r.drawImage(e,t,o):r.drawImage(e,t,o,a,n)}},b5.Display.prototype.drawText=function(e,o,a,n,r){var s=this.context;null!==this.cache_ctx&&(s=this.cache_ctx),e=''+e;for(var i=e.split('\n'),c=0;c<i.length;c++)r?s.fillText(i[c],o,a):s.strokeText(i[c],o,a),a+=n},b5.Display.prototype.meaureText=function(e){var t=this.context;return null!==this.cache_ctx&&(t=this.cache_ctx),t.measureText(e)},b5.Display.prototype.setTransform=function(e,t,o,a,n,r){var s=b5.app.pixel_ratio;e*=s,t*=s,o*=s,a*=s,n*=s,r*=s;var i=this.context;null!==this.cache_ctx&&(i=this.cache_ctx),i.setTransform(e,t,o,a,n,r)},b5.Display.prototype.clipRect=function(e,t,o,a){var n=this.context;null!==this.cache_ctx&&(n=this.cache_ctx),n.beginPath(),n.rect(e,t,o,a),n.clip()},b5.Display.prototype.clipArc=function(e,t,o,a,n){var r=this.context;null!==this.cache_ctx&&(r=this.cache_ctx),r.beginPath(),r.arc(e,t,o,a,n),r.clip()},b5.Display.prototype.clipPolygon=function(e){var t=this.context;null!==this.cache_ctx&&(t=this.cache_ctx),t.beginPath();var o=e.length;t.moveTo(e[0],e[1]);for(var a=2;a<o;a+=2)t.lineTo(e[a],e[a+1]);t.closePath(),t.clip()},b5.Display.prototype.saveContext=function(){var e=this.context;null!==this.cache_ctx&&(e=this.cache_ctx),e.save()},b5.Display.prototype.restoreContext=function(){var e=this.context;null!==this.cache_ctx&&(e=this.cache_ctx),e.restore()},b5.Display.prototype.createCache=function(){return document.createElement('canvas')},b5.Display.prototype.createCacheWithSize=function(e,t){var o=document.createElement('canvas');return o.width=e,o.height=t,o},b5.Display.prototype.setGlobalAlpha=function(e){this.context.globalAlpha=e},b5.Display.prototype.setGlobalCompositeOp=function(e){this.context.globalCompositeOperation=e},b5.Display.prototype.setShadow=function(e,t,o,a){var n=this.context;null!==this.cache_ctx&&(n=this.cache_ctx),n.shadowOffsetX=e,n.shadowOffsetY=t,n.shadowColor=o,n.shadowBlur=a},b5.Display.prototype.setShadowOff=function(){var e=this.context;null!==this.cache_ctx&&(e=this.cache_ctx),e.shadowColor='transparent'},b5.Display.prototype.setFillStyle=function(e){var t=this.context;null!==this.cache_ctx&&(t=this.cache_ctx),t.fillStyle=e},b5.Display.prototype.setStrokeStyle=function(e){var t=this.context;null!==this.cache_ctx&&(t=this.cache_ctx),t.strokeStyle=e},b5.Display.prototype.setLineWidth=function(e){var t=this.context;null!==this.cache_ctx&&(t=this.cache_ctx),t.lineWidth=e},b5.Display.prototype.setFont=function(e){var t=this.context;null!==this.cache_ctx&&(t=this.cache_ctx),t.font=e},b5.Display.prototype.setTextAlign=function(e){var t=this.context;null!==this.cache_ctx&&(t=this.cache_ctx),t.textAlign=e},b5.Display.prototype.setTextBaseline=function(e){var t=this.context;null!==this.cache_ctx&&(t=this.cache_ctx),t.textBaseline=e},b5.Display.prototype.setSmoothing=function(e){var t=this.context;null!==this.cache_ctx&&(t=this.cache_ctx),t.imageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.oImageSmoothingEnabled=e,t.imageSmoothingEnabled=e,t.msImageSmoothingEnabled=e},b5.Display.prototype.setCache=function(e){this.cache_ctx=null===e?null:e.getContext('2d')},'use strict',b5.Raw=function(e,t,o,a){this.data=null,this.parent=null,this.name=e,this.location=t,this.onload=a,this.preload=o,this.loaded=!1,this.load_retry=0,o&&this.load()},b5.Raw.prototype.load=function(){var e=this;b5.Utils.loadJSON(this.location,!1,function(t){e.data=t,null===t?(e.load_retry++,3<e.load_retry?(b5.app.onResourceLoaded(e,!0),onload!==void 0&&onload(t)):e.load()):(e.loaded=!0,b5.app.onResourceLoaded(e,!1))},!1)},b5.Raw.prototype.destroy=function(){this.data=null,null!==this.parent&&this.parent.removeResource(this,'raw')},function(){function e(e,t){document.addEventListener?e.addEventListener('scroll',t,!1):e.attachEvent('scroll',t)}function o(e){document.body?e():document.addEventListener?document.addEventListener('DOMContentLoaded',function t(){document.removeEventListener('DOMContentLoaded',t),e()}):document.attachEvent('onreadystatechange',function t(){('interactive'==document.readyState||'complete'==document.readyState)&&(document.detachEvent('onreadystatechange',t),e())})}function s(e){this.a=document.createElement('div'),this.a.setAttribute('aria-hidden','true'),this.a.appendChild(document.createTextNode(e)),this.b=document.createElement('span'),this.c=document.createElement('span'),this.h=document.createElement('span'),this.f=document.createElement('span'),this.g=-1,this.b.style.cssText='max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;',this.c.style.cssText='max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;',this.f.style.cssText='max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;',this.h.style.cssText='display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;',this.b.appendChild(this.h),this.c.appendChild(this.f),this.a.appendChild(this.b),this.a.appendChild(this.c)}function r(e,t){e.a.style.cssText='max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:'+t+';'}function t(e){var t=e.a.offsetWidth,o=t+100;return e.f.style.width=o+'px',e.c.scrollLeft=o,e.b.scrollLeft=e.b.scrollWidth+100,e.g!==t&&(e.g=t,!0)}function i(o,n){function a(){var e=r;t(e)&&e.a.parentNode&&n(e.g)}var r=o;e(o.b,a),e(o.c,a),t(o)}function a(e,t){var o=t||{};this.family=e,this.style=o.style||'normal',this.weight=o.weight||'normal',this.stretch=o.stretch||'normal'}function n(){if(null==d)if(p()&&/Apple/.test(window.navigator.vendor)){var e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))(?:\.([0-9]+))/.exec(window.navigator.userAgent);d=!!e&&603>parseInt(e[1],10)}else d=!1;return d}function p(){return null==h&&(h=!!document.fonts),h}function c(){if(null==_){var e=document.createElement('div');try{e.style.font='condensed 100px sans-serif'}catch(e){}_=''!==e.style.font}return _}function l(e,t){return[e.style,e.weight,c()?e.stretch:'','100px',t].join(' ')}var y=null,d=null,_=null,h=null;a.prototype.load=function(e,t){var _=this,c=e||'BESbswy',m=0,x=t||3E3,v=new Date().getTime();return new Promise(function(e,t){if(p()&&!n()){var a=new Promise(function(t,o){function a(){new Date().getTime()-v>=x?o():document.fonts.load(l(_,'"'+_.family+'"'),c).then(function(e){1<=e.length?t():setTimeout(a,25)},function(){o()})}a()}),d=new Promise(function(e,t){m=setTimeout(t,x)});Promise.race([d,a]).then(function(){clearTimeout(m),e(_)},function(){t(_)})}else o(function(){function o(){var t;(t=-1!=p&&-1!=f||-1!=p&&-1!=g||-1!=f&&-1!=g)&&((t=p!=f&&p!=g&&f!=g)||(null===y&&(t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),y=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))),t=y&&(p==a&&f==a&&g==a||p==h&&f==h&&g==h||p==w&&f==w&&g==w)),t=!t),t&&(S.parentNode&&S.parentNode.removeChild(S),clearTimeout(m),e(_))}function u(){if(new Date().getTime()-v>=x)S.parentNode&&S.parentNode.removeChild(S),t(_);else{var e=document.hidden;(!0===e||void 0===e)&&(p=A.a.offsetWidth,f=T.a.offsetWidth,g=n.a.offsetWidth,o()),m=setTimeout(u,50)}}var A=new s(c),T=new s(c),n=new s(c),p=-1,f=-1,g=-1,a=-1,h=-1,w=-1,S=document.createElement('div');S.dir='ltr',r(A,l(_,'sans-serif')),r(T,l(_,'serif')),r(n,l(_,'monospace')),S.appendChild(A.a),S.appendChild(T.a),S.appendChild(n.a),document.body.appendChild(S),a=A.a.offsetWidth,h=T.a.offsetWidth,w=n.a.offsetWidth,u(),i(A,function(e){p=e,o()}),r(A,l(_,'"'+_.family+'",sans-serif')),i(T,function(e){f=e,o()}),r(T,l(_,'"'+_.family+'",serif')),i(n,function(e){g=e,o()}),r(n,l(_,'"'+_.family+'",monospace'))})})},'object'==typeof module?module.exports=a:(window.FontFaceObserver=a,window.FontFaceObserver.prototype.load=a.prototype.load)}(),'use strict',b5.Font=function(e,t,o){this.data=null,this.parent=null,this.name=e,this.font_name=t,this.preload=o,this.loaded=!1,this.load_retry=0,o&&this.load()},b5.Font.prototype.load=function(){var e=this,t=new FontFaceObserver(this.font_name);t.load().then(function(){e.loaded=!0,b5.app.onResourceLoaded(e,!1)},function(){e.load_retry++,3<e.load_retry?b5.app.onResourceLoaded(e,!0):e.load(),b5.app.debug&&console.log('Error: Could not load font')})},b5.Font.prototype.destroy=function(){this.data=null,null!==this.parent&&this.parent.removeResource(this,'font')},'use strict',b5.Bitmap=function(e,t,o,a){this.image=new Image,this.parent=null,this.name=e,this.location=t,this.onload=a,this.preload=o,this.loaded=!1,this.load_retry=0,o&&this.load()},b5.Bitmap.prototype.load=function(){var e=this;this.image.onload=function(){b5.app.onResourceLoaded(e,!1),e.onload!==void 0&&(0>=e.image.width||0>=e.image.naturalWidth||0>=e.image.naturalHeight||!e.image.complete?e.onload(e,!1):e.onload(e,!0))},this.image.onerror=function(){e.load_retry++,3<e.load_retry?(b5.app.onResourceLoaded(e,!0),e.onload!==void 0&&e.onload(e,!1)):e.load()},this.image.src=this.location},b5.Bitmap.prototype.destroy=function(){this.image=null,null!==this.parent&&this.parent.removeResource(this,'bitmap')},'use strict',b5.Gradient=function(e,t){this.parent=null,this.stops=void 0===t?[]:t,this.name=e},b5.Gradient.prototype.addColourStop=function(e,t){this.stops.push({c:e,offs:t})},b5.Gradient.prototype.getColourStop=function(e){return this.stops[e]},b5.Gradient.prototype.getMaxStops=function(){return this.stops.length},b5.Gradient.prototype.destroy=function(){null!==this.parent&&this.parent.removeResource(this,'brush')},b5.Gradient.prototype.createStyle=function(e,o,a,n){if(this.stops!==void 0){var r=0,i=0,c=1,p=0;a!==void 0&&(r=a.x,i=a.y),n!==void 0&&(c=n.x,p=n.y),r=r*e-e/2,i=i*o-o/2,c=c*e-e/2,p=p*o-o/2;for(var d=b5.app.display.context.createLinearGradient(r,i,c,p),l=0,t;l<this.stops.length;l++)t=this.stops[l],d.addColorStop(t.offs,t.c);return d}return null},'use strict',b5.ImageAtlas=function(e,t,o,a,n,r,s,i){this.frames=[],this.anims=[],this.parent=null,this.name=e,this.bitmap=t,o!==void 0&&a!==void 0&&n!==void 0&&r!==void 0&&this.addFrame(o,a,n,r,s,i)},b5.ImageAtlas.prototype.addFrame=function(e,t,o,a,n,r){n===void 0&&(n=0),r===void 0&&(r=0),this.frames.push({x:e,y:t,w:o,h:a,ox:n,oy:r})},b5.ImageAtlas.prototype.getFrame=function(e){return this.frames[e]},b5.ImageAtlas.prototype.getMaxFrames=function(){return this.frames.length},b5.ImageAtlas.prototype.addAnim=function(e,t,o){this.anims[e]={indices:t,speed:o}},b5.ImageAtlas.prototype.getAnim=function(e){return this.anims[e]},b5.ImageAtlas.prototype.generate=function(e,t,o,a,n,r,s){s!==void 0&&(s=n*r);for(var i=t,c=0,p;c<r;c++){p=e;for(var d=0;d<n;d++)if(this.addFrame(p,i,o,a,0,0),p+=o,s--,0>=s)return;i+=a}},b5.ImageAtlas.prototype.destroy=function(){null!==this.parent&&this.parent.removeResource(this,'brush')},'use strict',b5.Material=function(e){this.parent=null,this.name=e,this.type='static',this.density=1,this.friction=0.1,this.restitution=0.1,this.gravity_scale=1,this.fixed_rotation=!1,this.is_bullet=!1},b5.Material.prototype.destroy=function(){null!==this.parent&&this.parent.removeResource(this,'material')},'use strict',b5.Shape=function(e){this.parent=null,this.name=e,this.type=b5.Shape.TypeBox,this.width=0,this.height=0,this.vertices=[],this.convexVertices=[]},b5.Shape.TypeBox=0,b5.Shape.TypeCircle=1,b5.Shape.TypePolygon=2,b5.Shape.prototype.typeToConst=function(){if('polygon'===shape.type)return b5.Shape.TypePolygon;return'circle'===shape.type?b5.Shape.TypeCircle:b5.Shape.TypeBox},b5.Shape.prototype.remove=function(){null!==this.parent&&this.parent.removeResource(this,'shape')},'use strict',b5.Sound=function(e,t,o){this.parent=null,this.snd=null,this.buffer=null,this.name=e,this.location=t,this.location2=null,this.loop=!1,this.reuse=void 0!==o&&o,this.preload=!1,this.loaded=!1,this.auto_play=!1,this.load_retry=0},b5.Sound.context=null,b5.Sound.mp3_supported=!1,b5.Sound.ogg_supported=!1,b5.Sound.wav_supported=!1,b5.Sound.muted=!1,b5.Sound.init=function(e){if(b5.Sound.ogg_supported=''!==new Audio().canPlayType('audio/ogg'),b5.Sound.mp3_supported=''!==new Audio().canPlayType('audio/mpeg'),b5.Sound.wav_supported=''!==new Audio().canPlayType('audio/wav'),e.use_web_audio){try{if(window.AudioContext=window.AudioContext||window.webkitAudioContext,void 0===window.AudioContext)return!1;b5.Sound.context=new AudioContext}catch(t){return b5.app.instants&&FBInstant.logEvent('Web audio error'),!1}return!0}return!1},b5.Sound.isSupported=function(e){var t=e.substr(e.lastIndexOf('.')+1);return'ogg'===t&&b5.Sound.ogg_supported||'mp3'===t&&b5.Sound.mp3_supported||'wav'===t&&b5.Sound.wav_supported},b5.Sound.prototype.load=function(e){var t=b5.app.debug,o=this,a=this.location,n=this.auto_play;b5.app.use_web_audio&&!b5.Utils.loadJSON(a,!1,function(t){null===t?(o.load_retry++,3<o.load_retry?b5.app.onResourceLoaded(o,!0):o.load()):b5.Sound.context.decodeAudioData(t,function(t){o.buffer=t,b5.app.onResourceLoaded(o,!1),n&&o.play(e)},function(t){console.log(t)})},!0)&&(o.load_retry++,3<o.load_retry?b5.app.onResourceLoaded(o,!0):o.load())},b5.Sound.prototype.play=function(e){if(!0!=e&&b5.Sound.muted)return null;if(b5.app.use_web_audio){if(null===this.buffer)return null;var t=b5.Sound.context,o=t.createBufferSource(),a=t.createGain();return o.buffer=this.buffer,o.loop=this.loop,o.connect(a),a.connect(t.destination),a.gain.value=1,o.start(0),this.auto_play&&(this.snd={source:o,gain:a}),{source:o,gain:a}}},b5.Sound.prototype.stop=function(){var e=this.snd;null===e||void 0===e||(b5.app.use_web_audio&&(e=e.source),e.stop())},b5.Sound.prototype.pause=function(){var e=this.snd;null===e||void 0===e||b5.app.use_web_audio||e.pause()},b5.Sound.prototype.destroy=function(){},'use strict',b5.Utils=function(){},b5.Utils.loadJSON=function(e,t,o,a){var n=new XMLHttpRequest;n.open('GET',e,!t),n.overrideMimeType('application/json'),a&&(n.responseType='arraybuffer'),t||(n.onreadystatechange=function(){4===n.readyState&&(200===n.status||0===n.status?a?o(n.response):o(n.responseText):o(null))});try{n.send()}catch(t){return!1}return t&&(200===n.status?a?o(n.response):o(n.responseText):o(null)),!0},b5.Utils.loadJS=function(e){var t=document.createElement('script');t.setAttribute('type','text/javascript'),t.setAttribute('src',e),'undefined'!=typeof t&&document.getElementsByTagName('head')[0].appendChild(t)},b5.Utils.SendGetRequest=function(e,t){var o=new XMLHttpRequest;o.onreadystatechange=function(){t!=void 0&&4==o.readyState&&t(o)},o.open('GET',e,!0),o.send()},b5.Utils.findObjectFromPath=function(e,o){var a=e.split('.'),n=a.length;if(0===n)return null;var r=b5.app.findScene(a[0]);if(1===n&&void 0===o)return r;if(1<n){if(void 0===o){for(var s=1;s<n;s++)r=r.findActor(a[s]);return null===r?(b5.app.debug&&console.log('Warning: Could not resolve object with path \''+e+'\''),null):r}var t=o.charAt(0);if('t'==t&&'timeline'===o){for(var s=1;s<n-1;s++)r=r.findActor(a[s]);return null===r?(b5.app.debug&&console.log('Warning: Could not resolve timeline with path \''+e+'\''),null):r.timelines.find(a[n-1])}if('a'==t&&'actions'===o){for(var s=1;s<n-1;s++)r=r.findActor(a[s]);return null===r?(b5.app.debug&&console.log('Warning: Could not resolve actions with path \''+e+'\''),null):r.actions.find(a[n-1])}}return b5.app.debug&&console.log('Warning: Could not resolve object with path \''+e+'\''),null},b5.Utils.findResourceFromPath=function(e,t){var o=e.split('.'),a=o.length;if(0===a)return null;var n=b5.app;1<a&&(n=b5.app.findScene(e));var r=n.findResource(o[a-1],t);return null===r?(b5.app.debug&&console.log('Warning: Could not resolve resource for path \''+e+'\''),null):r},b5.Utils.resolveObject=function(e,t){return void 0===e?null:'string'==typeof e?b5.Utils.findObjectFromPath(e,t):e},b5.Utils.resolveResource=function(e,t){return void 0===e?null:'string'==typeof e?b5.Utils.findResourceFromPath(e,t):e},b5.Utils.getResFromType=function(e,t){var o=t.charAt(0);if('b'==o){if('brush'===t)return e.brushes;if('bitmap'===t)return e.bitmaps}else if('s'==o){if('sound'===t)return e.sounds;if('shape'===t)return e.shapes}else{if('m'==o&&'material'===t)return e.materials;if('raw'===t)return e.raw;if('font'===t)return e.fonts}return null},b5.Utils.sortLayers=function(e){var o=e.length,a,n;for(n=0;n<o;n++)for(a=n+1;a<o;a++)if(e[n].layer>e[a].layer){var t=e[n];e[n]=e[a],e[a]=t}},b5.Utils.CreateCanvas=function(e,t,o,a){var n=document.createElement('canvas');return n.id=e,n.width=t,n.style.width=t+'px',n.height=o,n.style.height=o+'px',n.style.zIndex=a,n.style.position='fixed',n.style.display='block',n.style.left=0,n.style.top=0,n.style.right=0,n.style.bottom=0,n.style.margin='auto',n.style.pointerEvents='auto',n.style.visibility='visible',document.body.appendChild(n),n},b5.Utils.GetDevicePixelRatio=function(){if(window.devicePixelRatio!==void 0)return window.devicePixelRatio;var e=window.screen;return e!==void 0&&e.systemXDPI!==void 0&&e.logicalXDPI!==void 0&&e.systemXDPI>e.logicalXDPI?e.systemXDPI/e.logicalXDPI:1},b5.Utils.GetBackingStorePixelRatio=function(e){return e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1},b5.Utils.RunafterTime=function(e,t,o){b5.app.addTask('',e,1,t,o)},'use strict';var Log=function(e){b5.app.debug&&console.log(e)};b5.Instants=function(){this.onPaused=void 0,this.onPaymentsReady=void 0,this.videoAdsSupported=!1,this.interstitialAdsSupported=!1,this.purchasingSupported=!1,this.purchasingReady=!1,this.preloadedVideoAd=null,this.preloadedInterAd=null,this.adReady=!1,this.adLoadError='',this.shotCache=null;var e=this;FBInstant!==void 0&&(FBInstant.onPause(function(){e.onPaused!==void 0&&e.onPaused()}),FBInstant.payments.onReady(function(){Log('>>>> Purchasing is ready'),e.purchasingReady=!0,e.onPaymentsReady!==void 0&&e.onPaymentsReady()}))},b5.Instants.prototype.Init=function(){var e=FBInstant.getSupportedAPIs();e.includes('getInterstitialAdAsync')&&(this.interstitialAdsSupported=!0),e.includes('getRewardedVideoAsync')&&(this.videoAdsSupported=!0),e.includes('payments.purchaseAsync')&&(this.purchasingSupported=!0)},b5.Instants.prototype.GetLocale=function(){return FBInstant.getLocale()},b5.Instants.prototype.GetPlatform=function(){return FBInstant.getPlatform()},b5.Instants.prototype.GetEntryPointData=function(){return FBInstant.getEntryPointData()},b5.Instants.prototype.GetPlayerID=function(){return FBInstant.player.getID()},b5.Instants.prototype.GetPlayerName=function(){return FBInstant.player.getName()},b5.Instants.prototype.GetPlayerPhotoURL=function(){return FBInstant.player.getPhoto()},b5.Instants.prototype.GetConnectedPlayers=function(e){FBInstant.player.getConnectedPlayersAsync().then(function(t){e!==void 0&&e(t)})},b5.Instants.prototype.GetContext=function(){return FBInstant.context},b5.Instants.prototype.GetContextPlayers=function(e){FBInstant.context.getPlayersAsync().then(function(t){e!==void 0&&e(t)})},b5.Instants.prototype.ChooseContext=function(e){FBInstant.context.chooseAsync().then(function(){e!==void 0&&e(!0)}).catch(function(t){Log(t),null!=e&&e(!1,t)})},b5.Instants.prototype.ChooseContextWithOptions=function(e,t){FBInstant.context.chooseAsync(e).then(function(){t!==void 0&&t(!0)}).catch(function(e){Log(e),null!=t&&t(!1,e)})},b5.Instants.prototype.SwitchContext=function(e,t){FBInstant.context.switchAsync(e).then(function(){t!==void 0&&t(!0)}).catch(function(e){Log(e),null!=t&&t(!1,e)})},b5.Instants.prototype.CreateContext=function(e,t){FBInstant.context.createAsync(e).then(function(){t!==void 0&&t(!0,FBInstant.context.getID())}).catch(function(e){Log(e),null!=t&&t(!1,e)})},b5.Instants.prototype.SetPlayerData=function(e,t){FBInstant.player.setDataAsync(e).then(function(){t!==void 0&&t(!0),Log('Player data set')})},b5.Instants.prototype.GetPlayerData=function(e,t){FBInstant.player.getDataAsync(e).then(function(e){t!==void 0&&t(e),Log('Player data loaded')}).catch(function(e){Log(e),null!=t&&t()})},b5.Instants.prototype.SetSessionData=function(e){FBInstant.setSessionData(e)},b5.Instants.prototype.SwitchGame=function(e,t,o){FBInstant.switchGameAsync(e,t).catch(function(t){o!==void 0&&o(t)})},b5.Instants.prototype.PostCustomUpdate=function(e,t,o,a,n,r,s){FBInstant.updateAsync({action:'CUSTOM',cta:e,image:t,text:{default:o,localizations:{}},template:a,data:{myReplayData:r},strategy:n,notification:'NO_PUSH'}).then(function(){Log('Message was sent successfully'),s!==void 0&&s()})},b5.Instants.prototype.PostLeaderboardUpdate=function(e,t,o){FBInstant.updateAsync({action:'LEADERBOARD',name:e,text:t}).then(function(){Log('Leaderboard message was sent successfully'),o!==void 0&&o()})},b5.Instants.prototype.ShareCustom=function(e,t,o,a,n){FBInstant.shareAsync({intent:e,image:t,text:o,data:{myReplayData:a}}).then(function(){Log('Shared successfully'),n!==void 0&&n(!0)}).catch(function(e){Log(e),null!=n&&n(!1,e)})},b5.Instants.prototype.GetLeaderboardEntries=function(e,t,o,a){FBInstant.getLeaderboardAsync(e).then(function(e){return e.getEntriesAsync(o,t)}).then(function(e){Log('Leaderboard retrieved'),Log(e),a!=void 0&&a(e)}).catch(function(e){Log(e),a!=void 0&&a(null)})},b5.Instants.prototype.GetConnectedLeaderboardEntries=function(e,t,o,a){FBInstant.getLeaderboardAsync(e).then(function(e){return e.getConnectedPlayerEntriesAsync(o,t)}).then(function(e){Log('Connected leaderboard retrieved'),Log(e),a!=void 0&&a(e)}).catch(function(e){Log(e),a!=void 0&&a(null)})},b5.Instants.prototype.SetLeaderboardScore=function(e,t,o,a){FBInstant.getLeaderboardAsync(e).then(function(e){return e.setScoreAsync(t,o)}).then(function(e){Log('Score saved'),Log(e),a!=void 0&&a(!0,e)}).catch(function(e){Log(e),a!=void 0&&a(!1)})},b5.Instants.prototype.GetLeaderboardScore=function(e,t){FBInstant.getLeaderboardAsync(e).then(function(e){return e.getPlayerEntryAsync()}).then(function(e){Log('Score retrieved'),Log(e),t!=void 0&&t(e)}).catch(function(e){t!=void 0&&t(null),console.error(e)})},b5.Instants.prototype.CanMatchPlayer=function(e){FBInstant.checkCanPlayerMatchAsync().then((t)=>{e!==void 0&&e(t)})},b5.Instants.prototype.MatchPlayer=function(e,t,o){FBInstant.matchPlayerAsync(e,t).then(function(){o!==void 0&&o(!0)}).catch(function(){o!==void 0&&o(!1)})},b5.Instants.prototype.Quit=function(){FBInstant.quit()},b5.Instants.prototype.GetPlayerPhotoURL=function(){return FBInstant.player.getPhoto()},b5.Instants.prototype.PreloadVideoAd=function(e,t){if(this.videoAdsSupported){var o=this;FBInstant.getRewardedVideoAsync(t).then(function(e){return o.preloadedVideoAd=e,o.preloadedVideoAd.loadAsync()}).then(function(){o.adReady=!0,o.adLoadError='',Log('Rewarded video preloaded'),void 0!==e&&e(!0)}).catch(function(t){o.adLoadError=t.message,Log('Rewarded video failed to preload: '+t.message),void 0!==e&&e(!1,t)})}},b5.Instants.prototype.ReloadVideoAd=function(e){if(this.videoAdsSupported){var t=this;this.preloadedVideoAd.loadAsync().then(function(){t.adReady=!0,t.adLoadError='',Log('Rewarded video preloaded'),void 0!==e&&e(!0)}).catch(function(o){t.adLoadError=o.message,Log('Rewarded video failed to preload: '+o.message),void 0!==e&&e(!1,o)})}},b5.Instants.prototype.ShowVideoAd=function(t){var o=this;return this.videoAdsSupported?void this.preloadedVideoAd.showAsync().then(function(){t!==void 0&&(Log('Rewarded video paid'),t(!0))}).catch(function(a){Log('Rewarded video playback error: '+a.message),o.adLoadError=a.message,t!==void 0&&t(!1,a)}):(Log('Rewarded video ads not supported on this device'),o.adLoadError='Not supported',void(void 0!==t&&t(!1)))},b5.Instants.prototype.PreloadInterstitialAd=function(e,t){if(this.interstitialAdsSupported){var o=this;FBInstant.getInterstitialAdAsync(t).then(function(e){return o.preloadedInterAd=e,o.preloadedInterAd.loadAsync()}).then(function(){o.adReady=!0,o.adLoadError='',Log('Interstitial preloaded'),void 0!==e&&e(!0)}).catch(function(t){o.adLoadError=t.message,Log('Interstitial failed to preload: '+t.message),void 0!==e&&e(!1,t)})}},b5.Instants.prototype.ReloadInterstitialAd=function(e){if(this.interstitialAdsSupported){var t=this;this.preloadedInterAd.loadAsync().then(function(){t.adReady=!0,t.adLoadError='',Log('Interstitial preloaded'),void 0!==e&&e(!0)}).catch(function(o){t.adLoadError=o.message,Log('Interstitial failed to preload: '+o.message),void 0!==e&&e(!1,o)})}},b5.Instants.prototype.ShowInterstitialAd=function(t){var o=this;return this.interstitialAdsSupported?void this.preloadedInterAd.showAsync().then(function(){t!==void 0&&t(!0)}).catch(function(a){Log('Interstitial playback error: '+a.message),o.adLoadError=a.message,t!==void 0&&t(!1,a)}):(Log('Interstitial ads not supported on this device'),o.adLoadError='Not supported',void(void 0!==t&&t(!1)))},b5.Instants.prototype.IsAdReady=function(){var e=this.adReady;return this.adReady=!1,e},b5.Instants.prototype.CreateScreenshotCache=function(e){var t=b5.app.display;if(this.shotCache=t.createCache(),null===this.shotCache)return null;var o=b5.app.canvas;this.shotCache.height=e,this.shotCache.width=o.width*(this.shotCache.height/o.height)},b5.Instants.prototype.GetScreenshot=function(e){var t=b5.app.display;if(null===this.shotCache)return null;try{var o=b5.app.canvas;void 0!==e&&(o=e);var a=this.shotCache.height/o.height/b5.app.pixel_ratio;return t.setCache(this.shotCache),t.setTransform(a,0,0,a,0,0),t.drawImage(o,0,0),t.setCache(null),this.shotCache.toDataURL('image/png')}catch(e){return null}},b5.Instants.prototype.LogEvent=function(e,t,o){FBInstant.logEvent(e,o,t)},b5.Instants.prototype.GetProducts=function(e){FBInstant.payments.getCatalogAsync().then(function(t){e!==void 0&&e(t)})},b5.Instants.prototype.GetUnconsumedProducts=function(e){FBInstant.payments.getPurchasesAsync().then(function(t){e!==void 0&&e(t)})},b5.Instants.prototype.BuyProduct=function(e,t,o){FBInstant.payments.purchaseAsync({productID:e,developerPayload:t}).then(function(e){o!==void 0&&o(e)}).catch(function(t){Log('Purchase error: '+t.message),o!==void 0&&o(null,t)})},b5.Instants.prototype.ConsumeProduct=function(e,t){FBInstant.payments.consumePurchaseAsync(e).then(function(){t!==void 0&&t(!0)}).catch(function(o){Log('Purchase consumption error: '+o.message),t!==void 0&&t(!1,o)})},b5.Instants.prototype.CreateShortcut=function(e){FBInstant.canCreateShortcutAsync().then(function(t){t&&FBInstant.createShortcutAsync().then(function(){console.log('Shortcut created'),e!==void 0&&e(!0)}).catch(function(t){console.log('Shortcut creation error '+t),e!==void 0&&e(!1)})})};